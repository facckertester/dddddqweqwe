var Ye=Object.defineProperty,qe=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var be=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var xe=(t,c,v)=>c in t?Ye(t,c,{enumerable:!0,configurable:!0,writable:!0,value:v}):t[c]=v,a=(t,c)=>{for(var v in c||(c={}))Ze.call(c,v)&&xe(t,v,c[v]);if(be)for(var v of be(c))et.call(c,v)&&xe(t,v,c[v]);return t},d=(t,c)=>qe(t,Qe(c));var tt=(t,c)=>()=>(c||t((c={exports:{}}).exports,c),c.exports);var oe=(t,c,v)=>new Promise((k,y)=>{var b=j=>{try{M(v.next(j))}catch(L){y(L)}},T=j=>{try{M(v.throw(j))}catch(L){y(L)}},M=j=>j.done?k(j.value):Promise.resolve(j.value).then(b,T);M((v=v.apply(t,c)).next())});import{j as r,r as h,a as ot,R as nt}from"./vendor-react-CUeQczFW.js";import{t as s,f as z,T as we,i as Se,B as $,P as st,m as ne,A as rt,M as lt,a as at,j as Pe,e as it,c as ct,d as dt,b as ut,h as ft,g as mt}from"./core-uFyQeYSz.js";import{g as Ee,T as gt,G as ht}from"./components-ui-crbNLD7e.js";import{B as je,W as Ce}from"./components-store-Dd054QoF.js";import{M as Te}from"./components-main-CkOgjXq3.js";import{s as pt,O as vt,E as yt,T as bt,P as xt,S as wt,a as St,b as Pt,C as Et,R as jt,L as Ct}from"./components-modals-BZ9wh27C.js";import{P as Tt}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-DCFXKO6C.js";import"./vendor-firebase-DA79ldrn.js";var It=tt(se=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))k(y);new MutationObserver(y=>{for(const b of y)if(b.type==="childList")for(const T of b.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&k(T)}).observe(document,{childList:!0,subtree:!0});function v(y){const b={};return y.integrity&&(b.integrity=y.integrity),y.referrerPolicy&&(b.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?b.credentials="include":y.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function k(y){if(y.ep)return;y.ep=!0;const b=v(y);fetch(y.href,b)}})();const Lt=({gameState:t})=>{const{weather:c,buildings:v,totalGold:k}=t,y=H=>{var D;return((D=v[H])==null?void 0:D.toNumber())||0};let b="wilderness";y("palace")>0?b="empire":y("castle")>0||y("market")>0?b="city":(y("peasant")>20||y("field")>10||k.gt(s(500)))&&(b="hamlet");let T="",M="";switch(b){case"wilderness":T="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",M="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":T="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",M="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":T="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",M="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":T="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",M="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const j=c.current;let L="none",O="",G=0;return j==="rainy"?(L="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",O="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",G=1):j==="stormy"?(L="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",O="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",G=1):j==="sunny"?(L="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",O="â˜€ï¸",G=.6):j==="windy"&&(O="ðŸƒ ðŸƒ ðŸƒ",G=.8),r.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:T,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[r.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:G,animation:j==="windy"?"float 3s infinite ease-in-out":"none"},children:O}),L!=="none"&&r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:L,pointerEvents:"none"}}),r.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:M}),r.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),r.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},B={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:s(1),layout:{left:s(1),center:s(1),right:s(1)},borderWidth:s(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},A={gold:s(0),totalGold:s(0),totalRenownEarned:s(0),startTime:s(Date.now()),lastSaveTime:s(Date.now()),buildings:{},achievements:[],renown:s(0),prestigeCount:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:s(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:B,stats:{totalClicks:s(0),dragonsKilled:s(0),tavernGamesPlayed:s(0)},playerProfile:null},W=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(W);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const c={};for(const v in t)t.hasOwnProperty(v)&&(c[v]=W(t[v]));return c}return t},kt=()=>{var pe;const[t,c]=h.useState(()=>{var o,n,l,i,m,g,u,P,p,E,w,S;const e=localStorage.getItem("kingdom_save");if(e)try{const f=JSON.parse(e),C=f.interface||{},F=d(a(a({},B),C),{lastBuyAmount:s((o=C.lastBuyAmount)!=null?o:1),crownAnimations:(n=C.crownAnimations)!=null?n:!0,layout:{left:s((i=(l=C.layout)==null?void 0:l.left)!=null?i:B.layout.left),center:s((g=(m=C.layout)==null?void 0:m.center)!=null?g:B.layout.center),right:s((P=(u=C.layout)==null?void 0:u.right)!=null?P:B.layout.right)},borderWidth:s((p=C.borderWidth)!=null?p:B.borderWidth),customColors:a(a({},B.customColors),C.customColors||{})});return d(a(a({},A),f),{renown:s(f.renown||0),totalRenownEarned:s(f.totalRenownEarned||0),prestigeCount:f.prestigeCount||0,gold:s(f.gold||0),totalGold:s(f.totalGold||0),startTime:s(f.startTime||Date.now()),lastSaveTime:s(f.lastSaveTime||Date.now()),buildings:Object.keys(f.buildings||{}).reduce((ve,ye)=>(ve[ye]=s(f.buildings[ye]),ve),{}),stats:d(a(a({},A.stats),f.stats||{}),{totalClicks:s(((E=f.stats)==null?void 0:E.totalClicks)||0),dragonsKilled:s(((w=f.stats)==null?void 0:w.dragonsKilled)||0),tavernGamesPlayed:s(((S=f.stats)==null?void 0:S.tavernGamesPlayed)||0)}),nationalProjects:f.nationalProjects||{},clickUpgradeLevel:f.clickUpgradeLevel||0,offlineUpgradeLevel:f.offlineUpgradeLevel||0,weather:f.weather?d(a({},f.weather),{timeLeft:s(Number(f.weather.timeLeft)||120)}):A.weather,theme:f.theme||"default",numberFormat:f.numberFormat||"standard",idleModeEnabled:f.idleModeEnabled!==void 0?f.idleModeEnabled:!1,interface:F,playerProfile:f.playerProfile?d(a({},f.playerProfile),{lastLeaderboardSubmit:f.playerProfile.lastLeaderboardSubmit||0}):null})}catch(f){console.error("Save load failed",f)}return A}),v=h.useRef(t);h.useEffect(()=>{v.current=t},[t]);const k=h.useRef("");h.useEffect(()=>{const e=o=>{k.current=(k.current+o.key).slice(-20);const n=k.current.toLowerCase();n.endsWith("godon")?(c(l=>d(a({},l),{godMode:!0})),x("God Mode Enabled: +99999s per click","success"),k.current=""):n.endsWith("godoff")&&(c(l=>d(a({},l),{godMode:!1})),x("God Mode Disabled","info"),k.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const y=()=>{X(null);const e=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(e){const n=o-parseInt(e),l=s(n/1e3);if(l.gte(s(60))){const i=t.offlineUpgradeLevel||0,{efficiency:m,duration:g}=Se(i),u=s(g),P=l.lt(u)?l:u,E=q(t).times(s(m)).times(P).floor();E.gt(s(0))&&(X({gained:E,effectiveTime:P,totalTime:l,efficiency:m,completedProjects:[],currentLevel:i,maxDuration:g}),c(w=>d(a({},w),{gold:w.gold.plus(E),totalGold:w.totalGold.plus(E)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[b,T]=h.useState(!1);h.useEffect(()=>{let e;const o=()=>{T(!1),clearTimeout(e),t.idleModeEnabled&&(e=setTimeout(()=>{T(!0)},2e4))};o();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(l=>window.addEventListener(l,o)),()=>{clearTimeout(e),n.forEach(l=>window.removeEventListener(l,o))}},[t.idleModeEnabled]),h.useEffect(()=>{t.event&&T(!1)},[t.event]),h.useEffect(()=>{const e=z(t.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[t.gold]),h.useEffect(()=>{const e=document.documentElement,o=t.interface||B,n=t.theme||"default",l=we[n]||we.default;l&&Object.entries(l.colors).forEach(([g,u])=>{e.style.setProperty(g,u)});const i={compact:"8px",normal:"12px",spacious:"20px"},m={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",i[o.density]),e.style.setProperty("--gap-size",m[o.density]),e.style.setProperty("--col-left",String(o.layout.left)),e.style.setProperty("--col-center",String(o.layout.center)),e.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[M,j]=h.useState(!1);h.useEffect(()=>{var e;t.gold.gte(s(1e7))&&!((e=t.playerProfile)!=null&&e.hasChosenName)&&!M&&ie(!0)},[t.gold,t.playerProfile,M]);const[L,O]=h.useState(null),[G,H]=h.useState([]),[D,X]=h.useState(null),[re,ke]=h.useState("buildings"),[le,Me]=h.useState("army"),[K,Ie]=h.useState(!1),[I,J]=h.useState("throne");h.useEffect(()=>{const e=()=>{Ie(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[De,Q]=h.useState(!1),[Oe,V]=h.useState(!1),[Be,R]=h.useState(!1),[Ge,Re]=h.useState(!1),[Ne,Z]=h.useState(!1),[Ae,Y]=h.useState(!1),[ae,ie]=h.useState(!1),[ce,ee]=h.useState(!1),[Ue,te]=h.useState(!1),x=(e,o="info")=>{const n=Date.now().toString()+Math.random();H(l=>[...l,{id:n,message:e,type:o}]),setTimeout(()=>{H(l=>l.filter(i=>i.id!==n))},3e3)};h.useEffect(()=>{const e=Date.now();if(t.lastSaveTime&&s(e).minus(t.lastSaveTime).gt(s(6e4))){const o=s(e).minus(t.lastSaveTime).dividedBy(s(1e3)),{efficiency:n,duration:l}=Se(t.offlineUpgradeLevel||0),i=s(l),m=o.lt(i)?o:i,u=q(t).times(s(n)).times(m).floor(),P=[];let p=a({},t.nationalProjects),E=!1;Object.keys(p).forEach(w=>{var f;const S=p[w];if(S.active&&S.endTime&&e>=S.endTime){p[w]=d(a({},S),{active:!1,level:S.level+1,startTime:0,endTime:0});const C=(f=$.find(F=>F.id===w))==null?void 0:f.name;C&&P.push(`${C} Infrastructure (Lvl ${S.level+1})`),E=!0}}),(u.gt(s(0))||P.length>0)&&(X(w=>w||{gained:u,effectiveTime:m,totalTime:o,efficiency:n,completedProjects:P,currentLevel:t.offlineUpgradeLevel||0,maxDuration:l}),c(w=>d(a({},w),{gold:w.gold.plus(u),totalGold:w.totalGold.plus(u),nationalProjects:E?p:w.nationalProjects})))}},[]),h.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&c(o=>{const n=d(a({},o),{lastSaveTime:s(Date.now())}),l=W(n);return localStorage.setItem("kingdom_save",JSON.stringify(l)),n})},1e3);return()=>clearInterval(e)},[]),h.useEffect(()=>{const e=()=>{const n=v.current,l=W(n);localStorage.setItem("kingdom_save",JSON.stringify(l)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const o=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&y()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",o)}},[]),h.useEffect(()=>{var o;if(!((o=t.playerProfile)!=null&&o.hasChosenName))return;const e=setInterval(()=>{var g;const n=v.current,l=Date.now(),i=((g=n.playerProfile)==null?void 0:g.lastLeaderboardSubmit)||0,m=3600*1e3;l-i>=m&&pt({rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.totalGold,renown:n.totalRenownEarned,achievements:n.achievements.length,totalClicks:n.stats.totalClicks,period:"alltime"}).then(()=>{c(u=>d(a({},u),{playerProfile:d(a({},u.playerProfile),{lastLeaderboardSubmit:Date.now()})})),x("Leaderboard data submitted successfully!","success")}).catch(u=>{console.error("Auto leaderboard submission failed:",u)})},6e4);return()=>clearInterval(e)},[(pe=t.playerProfile)==null?void 0:pe.hasChosenName]),h.useEffect(()=>{const e=setInterval(()=>{if(!t.event&&Math.random()<.05){const l=["dragon","merchant","jester"],i=l[Math.floor(Math.random()*l.length)],m=i==="dragon"?6e5:3e4,g={id:Date.now().toString(),type:i,expiresAt:s(Date.now()).plus(s(m)),hp:i==="dragon"?s(10):void 0,maxHp:i==="dragon"?s(10):void 0,reward:s(0),startTime:i==="dragon"?Date.now():void 0};c(u=>d(a({},u),{event:g}))}},1e4);return()=>clearInterval(e)},[t.event]);const q=e=>{var g;let o=s(0);const n=((g=e.weather)==null?void 0:g.current)||"clear";$.forEach(u=>{const P=e.buildings[u.id]||s(0);let p=u.baseProduction;n==="sunny"?(u.id==="peasant"||u.id==="field"||u.id==="stable"||u.id==="cathedral")&&(p=p.times(s(1.2))):n==="rainy"?(u.id==="silver_mine"||u.id==="alchemist"||u.id==="market"||u.id==="tavern")&&(p=p.times(s(1.2))):n==="stormy"?((u.id==="blacksmith"||u.id==="void_portal")&&(p=p.times(s(1.3))),(u.id==="field"||u.id==="stable")&&(p=p.times(s(.8)))):n==="windy"&&(u.id==="market"||u.id==="castle"||u.id==="time_chamber")&&(p=p.times(s(1.15))),o=o.plus(P.times(p))});let l=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(u=>{l+=u.level||0});let i=s(1);const m=s(1).plus(s(l*st));if(i=i.times(m),i=i.times(Ee(e.totalRenownEarned).plus(s(e.achievements.length*.02))),e.event&&e.event.type==="dragon"&&e.event.startTime){const u=Math.floor((Date.now()-e.event.startTime)/1e3),p=1-Math.min(99,u)/100;i=i.times(s(p))}return o=o.times(i),o},U=q(t),_=h.useRef(U);_.current=U,h.useEffect(()=>{const e=setInterval(()=>{c(o=>{const n=Date.now(),l=_.current.times(s(ne)).dividedBy(s(1e3));let i=o.totalGold.plus(l),m=o.gold.plus(l),g=a({},o.weather);const u=s(ne/1e3);if(g.timeLeft=g.timeLeft.minus(u),g.timeLeft.lte(s(0))){const S=["clear","sunny","rainy","stormy","windy"],f=S[Math.floor(Math.random()*S.length)],C=s(Math.floor(Math.random()*120)+60);g={current:f,timeLeft:C}}let P=o.event;P&&P.expiresAt&&s(P.expiresAt).lt(s(n))&&(P=null);let p=a({},o.nationalProjects||{});Object.keys(p).forEach(S=>{var C;const f=p[S];f.active&&f.endTime&&n>=f.endTime&&(p[S]=d(a({},f),{active:!1,level:f.level+1,startTime:0,endTime:0}),x(`Project Completed: ${(C=$.find(F=>F.id===S))==null?void 0:C.name} Infrastructure Level ${f.level+1}!`,"success"))});const E=[...o.achievements];let w=null;return rt.forEach(S=>{E.includes(S.id)||S.condition(d(a({},o),{totalGold:i,gold:m}),_.current)&&(E.push(S.id),w=S)}),w&&(O(w),setTimeout(()=>O(null),3e3)),d(a({},o),{gold:m,totalGold:i,achievements:E,event:P,weather:g,nationalProjects:p})})},ne);return()=>clearInterval(e)},[]);const N=(e="light")=>{if("vibrate"in navigator&&K)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},de=(e=!1)=>{e||N("light");const o=_e(v.current);c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),stats:d(a({},n.stats),{totalClicks:e?n.stats.totalClicks:n.stats.totalClicks.plus(s(1))})}))},_e=e=>{const o=Ee(e.totalRenownEarned),n=s(1),l=e.clickUpgradeLevel||0,i=Math.min(l,15),m=s(2).pow(i),g=n.times(m),u=q(e),P=mt(l),p=u.times(P);let E=g.plus(p);if(E=E.times(o),e.godMode){const w=u.times(s(99999));E=E.plus(w)}return E},Fe=()=>{const e=t.clickUpgradeLevel||0;if(e>=dt){x("Maximum Royal Scepter level reached!","warning");return}const o=ut(e+1);if(t.gold.lt(o)){x("Not enough gold!","error");return}c(n=>d(a({},n),{gold:n.gold.minus(o),clickUpgradeLevel:n.clickUpgradeLevel+1})),x(`Royal Scepter upgraded to level ${e+1}!`,"success")},ze=()=>{const e=t.offlineUpgradeLevel||0;if(e>=it){x("Maximum Passive Income level reached!","warning");return}const o=ct(e+1);if(t.renown.lt(o)){x("Not enough Renown!","error");return}c(n=>d(a({},n),{renown:n.renown.minus(o),offlineUpgradeLevel:n.offlineUpgradeLevel+1})),x(`Passive Income upgraded to level ${e+1}!`,"success")},ue=(e,o)=>{const n=$.find(m=>m.id===e);if(!n||o<=0)return;const l=t.buildings[e]||s(0),i=Pe(n.baseCost,l,s(o)).floor();t.gold.gte(i)&&(N("medium"),c(m=>d(a({},m),{gold:m.gold.minus(i),buildings:d(a({},m.buildings),{[e]:(m.buildings[e]||s(0)).plus(s(o))})})))},fe=(e,o)=>{const n=$.find(g=>g.id===e);if(!n||o<=0)return;const l=t.buildings[e]||s(0),i=s(Math.min(o,l.toNumber()));if(i.lte(s(0)))return;const m=Pe(n.baseCost,l.minus(i),i).times(s(.25)).floor();c(g=>d(a({},g),{gold:g.gold.plus(m),buildings:d(a({},g.buildings),{[e]:l.minus(i)})}))},me=e=>{if(e.type==="merchant"){const o=_.current.times(s(10));c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),event:null})),x(`The merchant gifted you ${z(o.floor(),t.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const o=t.gold.times(s(.1)),n=Math.random()>.5;c(l=>d(a({},l),{gold:n?l.gold.plus(o):l.gold.minus(o),totalGold:n?l.totalGold.plus(o):l.totalGold,event:null})),n?x(`Jester pays out! +${z(o.floor(),t.numberFormat)}`,"success"):x(`Jester tricked you! -${z(o.floor(),t.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let o=!1;c(n=>{if(!n.event||n.event.type!=="dragon")return n;const i=s(n.event.hp||10).minus(s(1));if(i.lte(0)){const m=_.current.times(s(30));return o=!0,d(a({},n),{gold:n.gold.plus(m),totalGold:n.totalGold.plus(m),event:null,stats:d(a({},n.stats),{dragonsKilled:n.stats.dragonsKilled.plus(s(1))})})}return d(a({},n),{event:d(a({},n.event),{hp:i})})}),o&&x("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),x("Error interacting with dragon","error")}},$e=()=>{const e=s(1),o=s(1e12),n=t.totalGold;if(n.lt(o))return;const l=n.dividedBy(o),m=s(Math.floor(Math.pow(l.toNumber(),.33))).times(e).minus(t.renown);if(m.lte(0))return;const g=a({},t.nationalProjects);Object.keys(g).forEach(u=>{g[u].active&&(g[u]=d(a({},g[u]),{active:!1,startTime:0,endTime:0}))}),c(d(a({},A),{renown:t.renown.plus(m),totalRenownEarned:t.totalRenownEarned.plus(m),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:g,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:s(Date.now()),lastSaveTime:s(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface})),V(!1),x("Abdication Successful. Long live the new King!","success")},We=()=>{localStorage.removeItem("kingdom_save"),c(d(a({},A),{startTime:s(Date.now())})),R(!1),x("Game Reset","warning")},He=()=>{const o=W(t);localStorage.setItem("kingdom_save",JSON.stringify(o)),x("Game Saved","info")},Xe=()=>{c(e=>{const o=a({},e.nationalProjects);return Object.keys(o).forEach(n=>{o[n].active&&(o[n]=d(a({},o[n]),{endTime:Date.now()+5e3}))}),d(a({},e),{nationalProjects:o})}),x("Projects sped up to 5 seconds!","success")};window.speedUpProjects=Xe;const Ke=e=>{c(o=>d(a({},o),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),x(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),j(!1)},Je=()=>oe(null,null,function*(){$e()}),Ve=e=>oe(null,null,function*(){var l;const o=((l=t.playerProfile)==null?void 0:l.id)||"default_player",n=yield Tt.redeemPromoCode(o,e);if(!n){x("Invalid or expired promo code!","error");return}switch(n.type){case"gold":c(i=>d(a({},i),{gold:i.gold.plus(s(n.value)),totalGold:i.totalGold.plus(s(n.value))})),x(`Received ${z(s(n.value))} gold!`,"success");break;case"betaTester":c(i=>d(a({},i),{playerProfile:i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:n.icon||"ðŸ§ª",specialTitle:n.title||"Beta Tester",isBetaTester:!0}):null})),x("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":c(i=>d(a({},i),{playerProfile:i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],e],specialIcon:n.icon||"â­",specialTitle:n.title||"Special"}):null})),x(`Special icon unlocked: ${n.icon}!`,"success");break;default:x("Promo code redeemed!","success")}}),ge=e=>{c(o=>d(a({},o),{interface:d(a({},o.interface),{lastBuyAmount:e})}))},he=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:b&&t.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return r.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:K?"column":"row"},children:[r.jsx(gt,{toasts:G}),r.jsx(ht,{}),b&&t.idleModeEnabled&&r.jsx(Lt,{gameState:t}),!K&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:he("left"),children:[r.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:r.jsx("button",{className:`tab-btn ${re==="buildings"?"active":""}`,onClick:()=>ke("buildings"),children:"Estates"})}),r.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:re==="buildings"&&r.jsx(je,{gameState:t,onBuyBuilding:ue,onSellBuilding:fe,onSetBuyAmount:ge})})]}),r.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:b&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:r.jsx(Te,{gameState:t,gps:U,onClick:()=>de(!1),onEventInteract:me,onOpenTavern:()=>Q(!0),onOpenPrestige:()=>V(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>Z(!0),onOpenLeaderboard:()=>{ee(!0)},onOpenEmpire:()=>Y(!0),isIdle:b&&t.idleModeEnabled})}),r.jsxs("div",{style:he("right"),children:[r.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:r.jsx("button",{className:`tab-btn ${le==="army"?"active":""}`,onClick:()=>Me("army"),children:"Future"})}),r.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:le==="army"&&r.jsx(Ce,{gameState:t})})]})]}),K&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[I==="buildings"&&r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[r.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:r.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),r.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:r.jsx(je,{gameState:t,onBuyBuilding:ue,onSellBuilding:fe,onSetBuyAmount:ge})})]}),I==="throne"&&r.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:r.jsx(Te,{gameState:t,gps:U,onClick:()=>de(!1),onEventInteract:me,onOpenTavern:()=>Q(!0),onOpenPrestige:()=>V(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>Z(!0),onOpenLeaderboard:()=>ee(!0),onOpenEmpire:()=>Y(!0),isIdle:b&&t.idleModeEnabled})}),I==="army"&&r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[r.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:r.jsx("button",{className:"tab-btn active",children:"Future"})}),r.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:r.jsx(Ce,{gameState:t})})]}),I==="empire"&&r.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:r.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:r.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[r.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),r.jsx("p",{children:"Construct massive infrastructure to boost global production."}),r.jsx("button",{className:"btn",onClick:()=>Y(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[r.jsxs("button",{className:`mobile-nav-btn ${I==="buildings"?"active":""}`,onClick:()=>{N("light"),J("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[r.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),r.jsx("div",{children:"Estates"})]}),r.jsxs("button",{className:`mobile-nav-btn ${I==="throne"?"active":""}`,onClick:()=>{N("light"),J("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[r.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),r.jsx("div",{children:"Throne"})]}),r.jsxs("button",{className:`mobile-nav-btn ${I==="army"?"active":""}`,onClick:()=>{N("light"),J("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[r.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),r.jsx("div",{children:"Future"})]}),r.jsxs("button",{className:`mobile-nav-btn ${I==="empire"?"active":""}`,onClick:()=>{N("light"),J("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[r.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),r.jsx("div",{children:"Projects"})]})]})]}),!(b&&t.idleModeEnabled)&&L&&r.jsxs("div",{className:"achievement-popup",children:[r.jsx("div",{style:{fontSize:"2rem"},children:L.icon}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),r.jsx("div",{style:{color:"var(--accent-color)"},children:L.name})]})]}),D&&r.jsx(vt,{gained:D.gained,effectiveTime:D.effectiveTime,totalTime:D.totalTime,efficiency:D.efficiency,completedProjects:D.completedProjects,currentLevel:D.currentLevel,maxDuration:D.maxDuration,numberFormat:t.numberFormat,onClose:()=>X(null)}),Ae&&r.jsx(yt,{gameState:t,onClose:()=>Y(!1),onStartProject:e=>{var i;const o=((i=t.nationalProjects[e])==null?void 0:i.level)||0;if(o>=lt)return;const n=at(e,o+1);if(t.gold.lt(n.gold))return;const l=ft(o+1);c(m=>d(a({},m),{gold:m.gold.minus(n.gold),nationalProjects:d(a({},m.nationalProjects),{[e]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+l*1e3}})})),x("Construction started!","info")},onUpgradeClickPower:Fe,onUpgradeOffline:ze}),De&&r.jsx(bt,{gameState:t,onGamble:(e,o)=>{const n=s(e);c(l=>d(a({},l),{gold:o?l.gold.plus(n):l.gold.minus(n).max(0),stats:d(a({},l.stats),{tavernGamesPlayed:l.stats.tavernGamesPlayed.plus(s(1))})}))},onClose:()=>Q(!1)}),Oe&&r.jsx(xt,{gameState:t,onPrestige:Je,onClose:()=>V(!1)}),Be&&r.jsx(wt,{gameState:t,onClose:()=>R(!1),onHardReset:We,onSave:He,onSetTheme:e=>c(o=>d(a({},o),{theme:e})),onSetNumberFormat:e=>c(o=>d(a({},o),{numberFormat:e})),onToggleIdleMode:()=>c(e=>d(a({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>c(o=>d(a({},o),{interface:a(a({},o.interface),e)})),onOpenPromoCodes:()=>{R(!1),te(!0)}}),Ue&&r.jsx(St,{gameState:t,onClose:()=>te(!1),onRedeemPromoCode:Ve,onBackToSettings:()=>{te(!1),R(!0)}}),Ne&&r.jsx(Pt,{gameState:t,currentGps:U,onClose:()=>Z(!1)}),Ge&&r.jsx(Et,{onClose:()=>Re(!1)}),ae&&r.jsx(jt,{isOpen:ae,onClose:()=>{ie(!1),j(!0)},onConfirm:Ke,gameState:t}),ce&&r.jsx(Ct,{isOpen:ce,onClose:()=>ee(!1),playerProfile:t.playerProfile})]})},Le=document.getElementById("root");if(!Le)throw new Error("Could not find root element to mount to");const Mt=ot.createRoot(Le);Mt.render(r.jsx(nt.StrictMode,{children:r.jsx(kt,{})}))});export default It();
