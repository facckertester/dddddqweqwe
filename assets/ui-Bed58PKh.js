import{r as v,j as e}from"./app-IkKTLatH.js";import{e as z}from"./game-Cwc6eCQa.js";import{t as s,f as u,B as E,P as T,C as w,A as _}from"./constants-DvQBoasu.js";const L=({gameState:r,building:o,x:t,y:l,visible:c,onHide:x})=>{const a=v.useRef(null),[d,n]=v.useState({x:0,y:0});if(v.useEffect(()=>{if(!c||!a.current)return;const h=a.current.getBoundingClientRect();let b=t+15,g=l-h.height/2;b+h.width>window.innerWidth&&(b=t-h.width-15),g<10&&(g=10),g+h.height>window.innerHeight-10&&(g=window.innerHeight-h.height-10),n({x:b,y:g})},[c,t,l]),!c||!o)return null;const i=r.buildings[o.id]||s(0),m=C(r,o),f=m.times(i),p=R(r),B=p.gt(0)?f.div(p).times(100):s(0),y=S(o.baseCost,i),j=y.gt(0)?m.div(y):s(0),k=j.gt(0)?y.div(m):s(0);return e.jsxs("div",{ref:a,className:"advanced-tooltip",style:{position:"fixed",left:`${d.x}px`,top:`${d.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"13px",lineHeight:"1.4",width:"280px",minWidth:"280px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:x,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:o.icon}),e.jsx("span",{children:o.name})]}),e.jsxs("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(33, 150, 243, 0.1)",borderRadius:"4px",border:"1px solid rgba(33, 150, 243, 0.3)"},children:[e.jsxs("div",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:["Count: ",u(i,r.numberFormat)]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Each: ",e.jsxs("span",{style:{color:"var(--success-color)"},children:[u(m,r.numberFormat),"/s"]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Total: ",e.jsxs("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:[u(f,r.numberFormat),"/s"]})]})]}),e.jsx("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(76, 175, 80, 0.1)",borderRadius:"4px",border:"1px solid var(--success-color)"},children:e.jsxs("div",{style:{fontWeight:"bold",color:"var(--success-color)",fontSize:"12px"},children:["ðŸ“Š ",u(B,r.numberFormat),"% of total income"]})}),e.jsxs("div",{style:{marginBottom:"6px",padding:"4px",background:"rgba(141, 110, 99, 0.1)",borderRadius:"4px",border:"1px solid var(--accent-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--accent-color)",fontSize:"12px",marginBottom:"2px"},children:"ðŸ’° Economy"}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Next: ",e.jsxs("span",{style:{color:"var(--accent-color)"},children:[u(y,r.numberFormat)," gold"]})]}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Payoff: ",e.jsx("span",{style:{color:"#ff9800"},children:W(k)})]}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Efficiency: ",e.jsxs("span",{style:{color:"var(--success-color)"},children:[u(j.times(100),r.numberFormat)," gold/s per gold"]})]})]}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"8px",borderTop:"1px solid var(--border-color)",paddingTop:"6px"},children:o.description})]})};function C(r,o){var d;let t=o.baseProduction;const l=((d=r.weather)==null?void 0:d.current)||"clear";l==="sunny"&&(o.id==="peasant"||o.id==="field")?t=t.times(s(1.2)):l==="rainy"&&(o.id==="silver_mine"||o.id==="alchemist")?t=t.times(s(1.2)):l==="stormy"?(o.id==="blacksmith"&&(t=t.times(s(1.3))),o.id==="field"&&(t=t.times(s(.8)))):l==="windy"&&o.id==="market"&&(t=t.times(s(1.15)));let c=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(n=>{c+=n.level||0});const x=1+c*T;t=t.times(s(x));const a=P(r.renown);return t=t.times(a),t}function P(r){const o=r.toNumber();if(o<=0)return s(1);let t=s(1);o<=100?t=s(1+o*.01):o<=1e3?t=s(2).plus(s(o-100).times(s(.005))):o<=1e4?t=s(2.5).plus(s(o-1e3).times(s(.001))):t=s(10).plus(s(10).times(Math.log10(o)));const l=s(1e3);return z.min(t,l)}function R(r){let o=s(0);return E.forEach(t=>{const l=r.buildings[t.id]||s(0);if(l.gt(0)){const c=C(r,t);o=o.plus(c.times(l))}}),o}function S(r,o){return r.times(s(1.15).pow(o)).floor()}function W(r){if(r.lte(0))return"Instant";const o=r.toNumber(),t=Math.floor(o/31536e3),l=Math.floor(o%31536e3/86400),c=Math.floor(o%86400/3600),x=Math.floor(o%3600/60),a=Math.floor(o%60),d=[];return t>0&&d.push(`${t}y`),l>0&&d.push(`${l}d`),c>0&&d.push(`${c}h`),x>0&&d.push(`${x}m`),(a>0||d.length===0)&&d.push(`${a}s`),d.length>4?d.slice(0,4).join(" "):d.join(" ")}const I=({onClose:r})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:w.map((o,t)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:t<w.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",o.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:o.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:o.changes.map((l,c)=>e.jsx("li",{style:{marginBottom:"3px"},children:l},c))})]},o.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:r,children:"Close Chronicles"})]})}),O=({gameState:r})=>{var d;const[o,t]=v.useState("all"),l=()=>{const n=_.sort((i,m)=>{const f=r.achievements.includes(i.id),p=r.achievements.includes(m.id);return f&&!p?-1:!f&&p?1:0});return o==="all"?n:n.filter(i=>o==="buildings"?i.id.startsWith("build_"):o==="clicks"?i.id.startsWith("clicks_"):o==="gold"?i.id.startsWith("gold_"):o==="soldiers"?i.id.startsWith("soldiers_"):o==="renown"?i.id.startsWith("renown_"):o==="dragons"?i.id.startsWith("dragons_"):o==="gambler"?i.id.startsWith("gambler_"):o==="total_builds"?i.id.startsWith("total_builds"):o==="efficiency"?["speed_1m","speed_1b","prestige_master"].includes(i.id):o==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(i.id):o==="trade"?["first_trade","trade_master"].includes(i.id):o==="secret"?["click_master","idle_time_master"].includes(i.id):o==="bonus"?["gold_veteran","production_master","speed_baker","prestige_novice","golden_touch","combo_master"].includes(i.id):o==="combo"?["building_soldier_combo"].includes(i.id):!0)},c=[{id:"all",name:"All",icon:"ðŸ†"},{id:"buildings",name:"Buildings",icon:"ðŸ—ï¸"},{id:"clicks",name:"Clicks",icon:"ðŸ‘†"},{id:"gold",name:"Gold",icon:"ðŸ’°"},{id:"soldiers",name:"Army",icon:"âš”ï¸"},{id:"renown",name:"Prestige",icon:"ðŸ‘‘"},{id:"dragons",name:"Dragons",icon:"ðŸ‰"},{id:"gambler",name:"Tavern",icon:"ðŸŽ²"},{id:"total_builds",name:"Total Buildings",icon:"ðŸ›ï¸"},{id:"efficiency",name:"Efficiency",icon:"âš¡"},{id:"wonders",name:"Wonders",icon:"ðŸŒŸ"},{id:"trade",name:"Trade",icon:"ðŸš¢"},{id:"secret",name:"Secret",icon:"ðŸ”"},{id:"bonus",name:"Bonus",icon:"âœ¨"},{id:"combo",name:"Combo",icon:"âš¡"}],x={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"5px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},a=n=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${n?"var(--gold-color)":"#ccc"}`,background:n?"#fff8e1":"#eee",borderRadius:"4px",opacity:n?1:.3,cursor:n?"help":"default",position:"relative",fontSize:"0.8rem"});return e.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[e.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textAlign:"center"},children:[r.achievements.length," / ",_.length," Unlocked",o!=="all"&&e.jsxs("span",{children:[" | ",l().filter(n=>r.achievements.includes(n.id)).length," / ",l().length," in ",(d=c.find(n=>n.id===o))==null?void 0:d.name]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:c.map(n=>e.jsxs("button",{onClick:()=>t(n.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${o===n.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:o===n.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:n.name,children:[e.jsx("span",{style:{marginRight:"2px"},children:n.icon}),e.jsx("span",{style:{display:o===n.id?"inline":"none"},children:n.name})]},n.id))}),e.jsx("div",{style:x,children:l().map(n=>{const i=r.achievements.includes(n.id);return e.jsx("div",{style:a(i),"data-tooltip":i?`${n.name}: ${n.description}`:"Locked",children:e.jsx("div",{style:{fontSize:"1rem",filter:i?"none":"grayscale(100%)",opacity:i?1:.2},children:i?n.icon:"â“"})},n.id)})})]})},D=({gained:r,effectiveTime:o,totalTime:t,efficiency:l,completedProjects:c,onClose:x,numberFormat:a})=>{const d=n=>{const i=Math.floor(n/3600),m=Math.floor(n%3600/60),f=Math.floor(n%60),p=[];return i>0&&p.push(`${i}h`),m>0&&p.push(`${m}m`),(f>0||p.length===0)&&p.push(`${f}s`),p.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"ðŸŒ™ Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:d(t.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:d(o.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(l*100).toFixed(0),"%"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",u(r,a)]})]})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"âœ… Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:c.map((n,i)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:n},i))})]})]}),e.jsx("button",{className:"btn",onClick:x,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})};export{O as A,I as C,D as O,L as a,P as g};
