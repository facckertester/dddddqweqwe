var Pt=Object.defineProperty,xt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable;var Fe=(n,u,w)=>u in n?Pt(n,u,{enumerable:!0,configurable:!0,writable:!0,value:w}):n[u]=w,l=(n,u)=>{for(var w in u||(u={}))Tt.call(u,w)&&Fe(n,w,u[w]);if(_e)for(var w of _e(u))kt.call(u,w)&&Fe(n,w,u[w]);return n},a=(n,u)=>xt(n,St(u));var Ct=(n,u)=>()=>(u||n((u={exports:{}}).exports,u),u.exports);var se=(n,u,w)=>new Promise((G,x)=>{var S=M=>{try{B(w.next(M))}catch(I){x(I)}},E=M=>{try{B(w.throw(M))}catch(I){x(I)}},B=M=>M.done?G(M.value):Promise.resolve(M.value).then(S,E);B((w=w.apply(n,u)).next())});import{j as c,r as b,a as Lt,R as Mt}from"./vendor-react-CUeQczFW.js";import{t as e,f as q,T as We,j as $e,B as J,P as Et,g as ze,p as me,A as jt,k as It,l as ge,M as Gt,b as Bt,m as He,i as Dt,d as Ot,e as Nt,c as Ut,q as Rt,a as At}from"./core-BR814W9x.js";import{a as Je,T as _t,G as Ft}from"./components-ui-BCK3Jg1B.js";import{B as Ke,P as Xe}from"./components-store-CjXPDcC0.js";import{M as Ve}from"./components-main-DgX_7zlt.js";import{s as Ye,a as ie,O as Wt,E as $t,T as zt,P as Ht,S as Jt,b as Kt,c as Xt,C as Vt,R as Yt,L as qt,d as Qt,u as Zt}from"./components-modals-CyHj8TTA.js";import{P as eo}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-grga0VIe.js";import"./vendor-firebase-IMiYFFvY.js";var ro=Ct(ae=>{(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))G(x);new MutationObserver(x=>{for(const S of x)if(S.type==="childList")for(const E of S.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&G(E)}).observe(document,{childList:!0,subtree:!0});function w(x){const S={};return x.integrity&&(S.integrity=x.integrity),x.referrerPolicy&&(S.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?S.credentials="include":x.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function G(x){if(x.ep)return;x.ep=!0;const S=w(x);fetch(x.href,S)}})();const to=({gameState:n})=>{const{weather:u,buildings:w,totalGold:G}=n,x=Q=>{var O;return((O=w[Q])==null?void 0:O.toNumber())||0};let S="wilderness";x("palace")>0?S="empire":x("castle")>0||x("market")>0?S="city":(x("peasant")>20||x("field")>10||G.gt(e(500)))&&(S="hamlet");let E="",B="";switch(S){case"wilderness":E="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",B="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":E="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",B="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":E="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",B="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":E="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",B="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const M=u.current;let I="none",U="",W=0;return M==="rainy"?(I="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",U="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",W=1):M==="stormy"?(I="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",U="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",W=1):M==="sunny"?(I="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",U="â˜€ï¸",W=.6):M==="windy"&&(U="ðŸƒ ðŸƒ ðŸƒ",W=.8),c.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:E,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[c.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:W,animation:M==="windy"?"float 3s infinite ease-in-out":"none"},children:U}),I!=="none"&&c.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:I,pointerEvents:"none"}}),c.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:B}),c.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),c.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},F={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:e(1),layout:{left:e(1),center:e(1),right:e(1)},borderWidth:e(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},_={gold:e(0),totalGold:e(0),totalRenownEarned:e(0),startTime:e(Date.now()),lastSaveTime:e(Date.now()),buildings:{},achievements:[],renown:e(0),prestigeCount:0,darkMatterGold:e(0),infiniteTowerLevel:0,portalProgress:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:e(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:F,stats:{totalClicks:e(0),currentPrestigeClicks:e(0),dragonsKilled:e(0),tavernGamesPlayed:e(0),prestigeCount:0,infiniteTowerLevel:0,darkMatterGold:e(0),portalProgress:0,clickUpgradeLevel:0,offlineUpgradeLevel:0,totalBuildingsPurchased:e(0),totalGoldSpent:e(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1,isBetaTesterBlessingObtained:!1,betaTesterIncomeMultiplier:1},K=n=>{if(n==null||typeof n=="string"||typeof n=="number"||typeof n=="boolean")return n;if(Array.isArray(n))return n.map(K);if(typeof n=="object"&&n.toString&&typeof n.toString=="function"&&(n.hasOwnProperty("mantissa")||n.hasOwnProperty("exponent")))return n.toString();if(typeof n=="object"){const u={};for(const w in n)n.hasOwnProperty(w)&&(u[w]=K(n[w]));return u}return n},oo=()=>{var Me,Ee;const[n,u]=b.useState(()=>{var o,r,s,d,f,h,p,P,g,k,v,L,N,R,C,j,$,re,je,Ie,Ge,Be,De,Oe,Ne,Ue,Re;const t=localStorage.getItem("kingdom_save");if(t)try{const i=JSON.parse(t);if((o=i.playerProfile)!=null&&o.id){const m=localStorage.getItem(`playerProfile_${i.playerProfile.id}`);m&&(i.playerProfile=JSON.parse(m))}const A=i.interface||{},Ae=a(l(l({},F),A),{lastBuyAmount:e((r=A.lastBuyAmount)!=null?r:1),crownAnimations:(s=A.crownAnimations)!=null?s:!0,layout:{left:e((f=(d=A.layout)==null?void 0:d.left)!=null?f:F.layout.left),center:e((p=(h=A.layout)==null?void 0:h.center)!=null?p:F.layout.center),right:e((g=(P=A.layout)==null?void 0:P.right)!=null?g:F.layout.right)},borderWidth:e((k=A.borderWidth)!=null?k:F.borderWidth),customColors:l(l({},F.customColors),A.customColors||{})});return a(l(l({},_),i),{renown:e(i.renown||0),totalRenownEarned:e(i.totalRenownEarned||0),prestigeCount:i.prestigeCount||0,gold:e(i.gold||0),totalGold:e(i.totalGold||0),startTime:e(i.startTime||Date.now()),lastSaveTime:e(i.lastSaveTime||Date.now()),darkMatterGold:e(i.darkMatterGold||0),infiniteTowerLevel:i.infiniteTowerLevel||0,portalProgress:i.portalProgress||0,buildings:Object.keys(i.buildings||{}).reduce((m,T)=>(m[T]=e(i.buildings[T]),m),{}),stats:a(l(l({},_.stats),i.stats||{}),{totalClicks:e(((v=i.stats)==null?void 0:v.totalClicks)||0),currentPrestigeClicks:e(((L=i.stats)==null?void 0:L.currentPrestigeClicks)||0),dragonsKilled:e(((N=i.stats)==null?void 0:N.dragonsKilled)||0),tavernGamesPlayed:e(((R=i.stats)==null?void 0:R.tavernGamesPlayed)||0),prestigeCount:((C=i.stats)==null?void 0:C.prestigeCount)||0,infiniteTowerLevel:((j=i.stats)==null?void 0:j.infiniteTowerLevel)||0,darkMatterGold:e((($=i.stats)==null?void 0:$.darkMatterGold)||0),portalProgress:((re=i.stats)==null?void 0:re.portalProgress)||0,clickUpgradeLevel:((je=i.stats)==null?void 0:je.clickUpgradeLevel)||0,offlineUpgradeLevel:((Ie=i.stats)==null?void 0:Ie.offlineUpgradeLevel)||0,totalBuildingsPurchased:e(((Ge=i.stats)==null?void 0:Ge.totalBuildingsPurchased)||0),totalGoldSpent:e(((Be=i.stats)==null?void 0:Be.totalGoldSpent)||0)}),nationalProjects:i.nationalProjects||{},clickUpgradeLevel:i.clickUpgradeLevel||0,offlineUpgradeLevel:i.offlineUpgradeLevel||0,interface:Ae,playerProfile:i.playerProfile?a(l({},i.playerProfile),{lastLeaderboardSubmit:i.playerProfile.lastLeaderboardSubmit||0}):null,globalIncomeMultiplier:i.globalIncomeMultiplier||1,isDeveloperWifeBlessingObtained:i.isDeveloperWifeBlessingObtained||!1,betaTesterIncomeMultiplier:i.betaTesterIncomeMultiplier||1,isBetaTesterBlessingObtained:i.isBetaTesterBlessingObtained||!1})}catch(i){console.error("Save load failed",i)}return _}),w=b.useRef(n);b.useEffect(()=>{w.current=n},[n]);const G=b.useRef("");b.useEffect(()=>{const t=o=>{G.current=(G.current+o.key).slice(-20);const r=G.current.toLowerCase();r.endsWith("godon")?(u(s=>a(l({},s),{godMode:!0})),y("God Mode Enabled: +99999s per click","success"),G.current=""):r.endsWith("godoff")&&(u(s=>a(l({},s),{godMode:!1})),y("God Mode Disabled","info"),G.current="")};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const x=()=>{Z(null);const t=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(t){const r=o-parseInt(t),s=e(r/1e3);if(s.gte(e(60))){const d=n.offlineUpgradeLevel||0,{efficiency:f,duration:h}=$e(d),p=e(h),P=s.lt(p)?s:p,k=X(n).times(e(f)).times(P).floor();k.gt(e(0))&&(Z({gained:k,effectiveTime:P,totalTime:s,efficiency:f,completedProjects:[],currentLevel:d,maxDuration:h}),u(v=>a(l({},v),{gold:v.gold.plus(k),totalGold:v.totalGold.plus(k)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[S,E]=b.useState(!1);b.useEffect(()=>{let t;const o=()=>{E(!1),clearTimeout(t),n.idleModeEnabled&&(t=setTimeout(()=>{E(!0)},2e4))};o();const r=["mousemove","mousedown","keydown","touchstart","scroll"];return r.forEach(s=>window.addEventListener(s,o)),()=>{clearTimeout(t),r.forEach(s=>window.removeEventListener(s,o))}},[n.idleModeEnabled]),b.useEffect(()=>{n.event&&E(!1)},[n.event]),b.useEffect(()=>{const t=q(n.gold);document.title=`Gold: ${t} - Kingdom Clicker`},[n.gold]),b.useEffect(()=>{const t=document.documentElement,o=n.interface||F,r=n.theme||"default",s=We[r]||We.default;s&&Object.entries(s.colors).forEach(([h,p])=>{t.style.setProperty(h,p)});const d={compact:"8px",normal:"12px",spacious:"20px"},f={compact:"6px",normal:"12px",spacious:"16px"};t.style.setProperty("--panel-padding",d[o.density]),t.style.setProperty("--gap-size",f[o.density]),t.style.setProperty("--col-left",String(o.layout.left)),t.style.setProperty("--col-center",String(o.layout.center)),t.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[n.theme,n.interface]);const[B,M]=b.useState(!1);b.useEffect(()=>{var t;n.gold.gte(e(1e7))&&!((t=n.playerProfile)!=null&&t.hasChosenName)&&!B&&ye(!0)},[n.gold,n.playerProfile,B]);const[I,U]=b.useState(null),[W,Q]=b.useState([]),[O,Z]=b.useState(null),[pe,Qe]=b.useState("buildings"),[he,Ze]=b.useState("army"),[ee,et]=b.useState(!1),[D,te]=b.useState("throne");b.useEffect(()=>{const t=()=>{et(window.innerWidth<768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const[tt,ce]=b.useState(!1),[ot,oe]=b.useState(!1),[nt,z]=b.useState(!1),[rt,lt]=b.useState(!1),[st,de]=b.useState(!1),[it,ne]=b.useState(!1),[be,ye]=b.useState(!1),[ve,ue]=b.useState(!1),[at,fe]=b.useState(!1),[we,Pe]=b.useState(!1),y=(t,o="info")=>{const r=Date.now().toString()+Math.random();Q(s=>[...s,{id:r,message:t,type:o}]),setTimeout(()=>{Q(s=>s.filter(d=>d.id!==r))},3e3)};b.useEffect(()=>{const t=Date.now();if(n.lastSaveTime&&e(t).minus(n.lastSaveTime).gt(e(6e4))){const o=e(t).minus(n.lastSaveTime).dividedBy(e(1e3)),{efficiency:r,duration:s}=$e(n.offlineUpgradeLevel||0),d=e(s),f=o.lt(d)?o:d,p=X(n).times(e(r)).times(f).floor(),P=[];let g=l({},n.nationalProjects),k=!1;Object.keys(g).forEach(v=>{var N;const L=g[v];if(L.active&&L.endTime&&t>=L.endTime){g[v]=a(l({},L),{active:!1,level:L.level+1,startTime:0,endTime:0});const R=(N=J.find(C=>C.id===v))==null?void 0:N.name;R&&P.push(`${R} Infrastructure (Lvl ${L.level+1})`),k=!0}}),(p.gt(e(0))||P.length>0)&&(Z(v=>v||{gained:p,effectiveTime:f,totalTime:o,efficiency:r,completedProjects:P,currentLevel:n.offlineUpgradeLevel||0,maxDuration:s}),u(v=>a(l({},v),{gold:v.gold.plus(p),totalGold:v.totalGold.plus(p),nationalProjects:k?g:v.nationalProjects})))}},[]),b.useEffect(()=>{const t=setInterval(()=>{Date.now()%3e4<1e3&&u(o=>{const r=a(l({},o),{lastSaveTime:e(Date.now())}),s=K(r);return localStorage.setItem("kingdom_save",JSON.stringify(s)),r})},1e3);return()=>clearInterval(t)},[]),b.useEffect(()=>{const t=()=>{const r=w.current,s=K(r);localStorage.setItem("kingdom_save",JSON.stringify(s)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",t);const o=()=>{document.visibilityState==="hidden"?t():document.visibilityState==="visible"&&x()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",o)}},[]),b.useEffect(()=>{var r;if(!((r=n.playerProfile)!=null&&r.hasChosenName))return;(()=>{var h;const s=Date.now(),d=((h=n.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,f=3600*1e3;if(s-d>=f){const p={rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.totalGold,renown:n.totalRenownEarned,achievements:n.achievements.length,totalClicks:n.stats.totalClicks};Promise.all([ie(a(l({},p),{period:"alltime"})),ie(a(l({},p),{period:"weekly"})),Ye(n,n.playerProfile.rulerId,n.playerProfile.rulerName)]).then(()=>{u(P=>a(l({},P),{playerProfile:a(l({},P.playerProfile),{lastLeaderboardSubmit:Date.now()})})),y("Leaderboard data synced on load!","success")}).catch(P=>{console.error("Initial leaderboard submission failed:",P)})}})();const o=setInterval(()=>{var p;const s=w.current,d=Date.now(),f=((p=s.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,h=3600*1e3;if(d-f>=h){Ye(s,s.playerProfile.rulerId,s.playerProfile.rulerName).catch(g=>{console.error("Failed to save player stats:",g)});const P={rulerName:s.playerProfile.rulerName,rulerId:s.playerProfile.rulerId,gold:s.totalGold,renown:s.totalRenownEarned,achievements:s.achievements.length,totalClicks:s.stats.totalClicks};Promise.all([ie(a(l({},P),{period:"alltime"})),ie(a(l({},P),{period:"weekly"}))]).then(()=>{u(g=>a(l({},g),{playerProfile:a(l({},g.playerProfile),{lastLeaderboardSubmit:Date.now()})})),y("Leaderboard data submitted successfully!","success")}).catch(g=>{console.error("Auto leaderboard submission failed:",g)})}},6e4);return()=>clearInterval(o)},[(Me=n.playerProfile)==null?void 0:Me.hasChosenName]),b.useEffect(()=>{const t=setInterval(()=>{if(!n.event&&Math.random()<.05){const s=["dragon","merchant","jester"],d=s[Math.floor(Math.random()*s.length)],f=d==="dragon"?6e5:3e4,h={id:Date.now().toString(),type:d,expiresAt:e(Date.now()).plus(e(f)),hp:d==="dragon"?e(10):void 0,maxHp:d==="dragon"?e(10):void 0,reward:e(0),startTime:d==="dragon"?Date.now():void 0};u(p=>a(l({},p),{event:h}))}},1e4);return()=>clearInterval(t)},[n.event]);const X=t=>{var P;let o=e(0);const r=((P=t.weather)==null?void 0:P.current)||"clear";J.forEach(g=>{const k=t.buildings[g.id]||e(0);let v=g.baseProduction;o=o.plus(k.times(v))});const s=Je(t.totalRenownEarned);s.gt(e(1))&&(o=o.times(s));let d=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(g=>{d+=g.level||0});const f=e(1).plus(e(d*Et));o=o.times(f);const h=ze(t.infiniteTowerLevel||0);o=o.times(h),e(1),J.forEach(g=>{const k=t.buildings[g.id]||e(0);if(k.gt(0)){let v=e(1);r==="sunny"?(g.id==="peasant"||g.id==="field"||g.id==="stable"||g.id==="cathedral")&&(v=e(1.2)):r==="rainy"?(g.id==="silver_mine"||g.id==="alchemist"||g.id==="market"||g.id==="tavern")&&(v=e(1.2)):r==="stormy"?((g.id==="blacksmith"||g.id==="void_portal")&&(v=e(1.3)),(g.id==="field"||g.id==="stable")&&(v=e(.8))):r==="windy"&&(g.id==="market"||g.id==="castle"||g.id==="time_chamber")&&(v=e(1.15));const L=k.times(g.baseProduction);if(s.gt(e(1))){const N=L.times(s).times(f).times(v.minus(e(1)));o=o.plus(N)}else{const N=L.times(f).times(v.minus(e(1)));o=o.plus(N)}}});const p=e(1).plus(e(t.achievements.length*.02));if(o=o.times(p),t.globalIncomeMultiplier&&(o=o.times(e(t.globalIncomeMultiplier))),t.betaTesterIncomeMultiplier&&(o=o.times(e(t.betaTesterIncomeMultiplier))),t.event&&t.event.type==="dragon"&&t.event.startTime){const g=Math.floor((Date.now()-t.event.startTime)/1e3),v=1-Math.min(99,g)/100;o=o.times(e(v))}return o},V=X(n),Y=b.useRef(V);Y.current=V,b.useEffect(()=>{const t=setInterval(()=>{u(o=>{const r=Date.now(),s=Y.current.times(e(me)).dividedBy(e(1e3));let d=o.totalGold.plus(s),f=o.gold.plus(s),h=l({},o.weather);const p=e(me/1e3);if(h.timeLeft=e(h.timeLeft||0).minus(p),h.timeLeft.lte(e(0))){const C=["clear","sunny","rainy","stormy","windy"],j=C[Math.floor(Math.random()*C.length)],$=e(Math.floor(Math.random()*120)+60);h={current:j,timeLeft:$}}let P=o.event;P&&P.expiresAt&&e(P.expiresAt).lt(e(r))&&(P=null);let g=l({},o.nationalProjects||{});Object.keys(g).forEach(C=>{var $;const j=g[C];j.active&&j.endTime&&r>=j.endTime&&(g[C]=a(l({},j),{active:!1,level:j.level+1,startTime:0,endTime:0}),y(`Project Completed: ${($=J.find(re=>re.id===C))==null?void 0:$.name} Infrastructure Level ${j.level+1}!`,"success"))});const k=[...o.achievements];let v=null;jt.forEach(C=>{k.includes(C.id)||C.condition(a(l({},o),{totalGold:d,gold:f}),Y.current)&&(k.push(C.id),v=C)}),v&&(U(v),setTimeout(()=>U(null),3e3));const L=It(d),N=(o.infiniteTowerLevel||0)>0?Array.from({length:o.infiniteTowerLevel},(C,j)=>ge(j)).reduce((C,j)=>C.plus(j),e(0)):e(0),R=L.minus(N);return a(l({},o),{gold:f,totalGold:d,darkMatterGold:R,achievements:k,event:P,weather:h,nationalProjects:g,stats:a(l({},o.stats),{darkMatterGold:R})})})},me);return()=>clearInterval(t)},[]);const H=(t="light")=>{if("vibrate"in navigator&&ee)switch(t){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},xe=(t=!1)=>{if(t||H("light"),!t&&!n.isDeveloperWifeBlessingObtained&&n.totalGold.gte(e(1e12))&&Math.random()<1e-6){u(s=>a(l({},s),{globalIncomeMultiplier:(s.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...s.achievements,"developer_wife_blessing"])]})),y("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const o=ct(w.current);u(r=>a(l({},r),{gold:r.gold.plus(o),totalGold:r.totalGold.plus(o),stats:a(l({},r.stats),{totalClicks:t?r.stats.totalClicks:r.stats.totalClicks.plus(e(1)),currentPrestigeClicks:t?r.stats.currentPrestigeClicks:r.stats.currentPrestigeClicks.plus(e(1))})}))},ct=t=>{const o=e(1),r=t.clickUpgradeLevel||0,s=Math.min(r,15),d=e(2).pow(s),f=o.times(d),h=Je(t.totalRenownEarned);let p=f;h.gt(e(1))&&(p=f.times(h));const P=ze(t.infiniteTowerLevel||0);p=p.times(P);const g=At(r);if(g>0){const L=X(t).times(g);p=p.plus(L)}const k=e(1).plus(e(t.achievements.length*.02));if(p=p.times(k),t.globalIncomeMultiplier&&(p=p.times(e(t.globalIncomeMultiplier))),t.betaTesterIncomeMultiplier&&(p=p.times(e(t.betaTesterIncomeMultiplier))),t.godMode){const L=X(t).times(e(99999));p=p.plus(L)}return p},dt=()=>{const t=n.clickUpgradeLevel||0;if(t>=Nt){y("Maximum Royal Scepter level reached!","warning");return}const o=Ut(t+1);if(n.gold.lt(o)){y("Not enough gold!","error");return}u(r=>a(l({},r),{gold:r.gold.minus(o),clickUpgradeLevel:r.clickUpgradeLevel+1,stats:a(l({},r.stats),{clickUpgradeLevel:r.clickUpgradeLevel+1,totalGoldSpent:r.stats.totalGoldSpent.plus(o)})})),y(`Royal Scepter upgraded to level ${t+1}!`,"success")},ut=()=>{const t=n.offlineUpgradeLevel||0;if(t>=Dt){y("Maximum Passive Income level reached!","warning");return}const o=Ot(t+1);if(n.renown.lt(o)){y("Not enough Renown!","error");return}u(r=>a(l({},r),{renown:r.renown.minus(o),offlineUpgradeLevel:r.offlineUpgradeLevel+1,stats:a(l({},r.stats),{offlineUpgradeLevel:r.offlineUpgradeLevel+1})})),y(`Passive Income upgraded to level ${t+1}!`,"success")},Se=(t,o)=>{const r=J.find(f=>f.id===t);if(!r||o<=0)return;const s=n.buildings[t]||e(0),d=He(r.baseCost,s,e(o)).floor();n.gold.gte(d)&&(H("medium"),u(f=>a(l({},f),{gold:f.gold.minus(d),buildings:a(l({},f.buildings),{[t]:(f.buildings[t]||e(0)).plus(e(o))}),stats:a(l({},f.stats),{totalBuildingsPurchased:f.stats.totalBuildingsPurchased.plus(e(o)),totalGoldSpent:f.stats.totalGoldSpent.plus(d)})})),n.isBetaTesterBlessingObtained||Math.random()<1e-4&&(u(h=>a(l({},h),{betaTesterIncomeMultiplier:(h.betaTesterIncomeMultiplier||1)+1.3,isBetaTesterBlessingObtained:!0,achievements:[...new Set([...h.achievements,"beta_tester_blessing"])]})),y("ðŸ§ª Beta-Tester Legendary blessing received! +130% global income!","success")))},Te=(t,o)=>{const r=J.find(h=>h.id===t);if(!r||o<=0)return;const s=n.buildings[t]||e(0),d=e(Math.min(o,s.toNumber()));if(d.lte(e(0)))return;const f=He(r.baseCost,s.minus(d),d).times(e(.25)).floor();u(h=>a(l({},h),{gold:h.gold.plus(f),buildings:a(l({},h.buildings),{[t]:s.minus(d)})}))},ke=t=>{if(t.type==="merchant"){const o=Y.current.times(e(10));u(r=>a(l({},r),{gold:r.gold.plus(o),totalGold:r.totalGold.plus(o),event:null})),y(`The merchant gifted you ${q(o.floor(),n.numberFormat)} gold!`,"success")}else if(t.type==="jester"){const o=n.gold.times(e(.1)),r=Math.random()>.5;u(s=>a(l({},s),{gold:r?s.gold.plus(o):s.gold.minus(o),totalGold:r?s.totalGold.plus(o):s.totalGold,event:null})),r?y(`Jester pays out! +${q(o.floor(),n.numberFormat)}`,"success"):y(`Jester tricked you! -${q(o.floor(),n.numberFormat)}`,"warning")}else if(t.type==="dragon")try{let o=!1;u(r=>{if(!r.event||r.event.type!=="dragon")return r;const d=e(r.event.hp||10).minus(e(1));if(d.lte(0)){const f=Y.current.times(e(30));return o=!0,a(l({},r),{gold:r.gold.plus(f),totalGold:r.totalGold.plus(f),event:null,stats:a(l({},r.stats),{dragonsKilled:r.stats.dragonsKilled.plus(e(1))})})}return a(l({},r),{event:a(l({},r.event),{hp:d})})}),o&&y("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),y("Error interacting with dragon","error")}},ft=()=>{const t=e(1),o=e(1e12),r=n.totalGold;if(r.lt(o))return;const s=r.dividedBy(o),f=e(Math.floor(Math.pow(s.toNumber(),.33))).times(t).minus(n.renown);if(f.lte(0))return;const h=l({},n.nationalProjects);Object.keys(h).forEach(p=>{h[p].active&&(h[p]=a(l({},h[p]),{active:!1,startTime:0,endTime:0}))}),u(a(l({},_),{renown:n.renown.plus(f),totalRenownEarned:n.totalRenownEarned.plus(f),prestigeCount:n.prestigeCount+1,totalGold:n.totalGold,achievements:n.achievements,nationalProjects:h,offlineUpgradeLevel:n.offlineUpgradeLevel,darkMatterGold:n.darkMatterGold,infiniteTowerLevel:n.infiniteTowerLevel,playerProfile:n.playerProfile,startTime:e(Date.now()),lastSaveTime:e(Date.now()),theme:n.theme,idleModeEnabled:n.idleModeEnabled,interface:n.interface,stats:a(l({},_.stats),{prestigeCount:n.prestigeCount+1,infiniteTowerLevel:n.infiniteTowerLevel,darkMatterGold:n.darkMatterGold,clickUpgradeLevel:n.clickUpgradeLevel,offlineUpgradeLevel:n.offlineUpgradeLevel})})),oe(!1),y("Abdication Successful. Long live the new King!","success")},mt=()=>{localStorage.removeItem("kingdom_save"),u(a(l({},_),{startTime:e(Date.now())})),z(!1),y("Game Reset","warning")},gt=()=>{const o=K(n);localStorage.setItem("kingdom_save",JSON.stringify(o)),y("Game Saved","info")},pt=()=>{u(t=>{const o=l({},t.nationalProjects);return Object.keys(o).forEach(r=>{o[r].active&&(o[r]=a(l({},o[r]),{endTime:Date.now()+5e3}))}),a(l({},t),{nationalProjects:o})}),y("Projects sped up to 5 seconds!","success")};window.speedUpProjects=pt;const ht=t=>{u(o=>a(l({},o),{playerProfile:t})),localStorage.setItem(`playerProfile_${t.id}`,JSON.stringify(t)),y(`Welcome, ${t.rulerName} ${t.rulerId}!`,"success"),M(!1)},bt=()=>se(null,null,function*(){ft()}),yt=t=>se(null,null,function*(){var o;if(!((o=n.playerProfile)!=null&&o.id)){y("Error: Player profile not found","error");return}try{yield Zt(n.playerProfile.id,t);const r=a(l({},n.playerProfile),{rulerName:t});u(f=>a(l({},f),{playerProfile:r}));const s=a(l({},n),{playerProfile:r}),d=K(s);localStorage.setItem("kingdom_save",JSON.stringify(d)),y(`Name successfully changed to "${t}"!`,"success")}catch(r){console.error("Error changing name:",r),y("Failed to change name. Please try again.","error")}}),vt=t=>se(null,null,function*(){var s;const o=((s=n.playerProfile)==null?void 0:s.id)||"default_player",r=yield eo.redeemPromoCode(o,t);if(!r){y("Invalid or expired promo code!","error");return}switch(r.type){case"gold":u(d=>a(l({},d),{gold:d.gold.plus(e(r.value)),totalGold:d.totalGold.plus(e(r.value))})),y(`Received ${q(e(r.value))} gold!`,"success");break;case"betaTester":u(d=>{const f=d.playerProfile?a(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:r.icon||"ðŸ§ª",specialTitle:r.title||"Beta Tester",isBetaTester:!0}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(l({},d),{playerProfile:f})}),y("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":u(d=>{const f=d.playerProfile?a(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],t],specialIcon:r.icon||"â­",specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(l({},d),{playerProfile:f})}),y(`Special icon unlocked: ${r.icon}!`,"success");break;case"title":u(d=>{const f=d.playerProfile?a(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],t],specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(l({},d),{playerProfile:f})}),y(`Special title unlocked: ${r.title}!`,"success");break;default:y("Promo code redeemed!","success")}}),Ce=t=>{u(o=>a(l({},o),{interface:a(l({},o.interface),{lastBuyAmount:t})}))},Le=t=>({flex:t==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:t==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:t==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:S&&n.idleModeEnabled?t==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return c.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:ee?"column":"row"},children:[c.jsx(_t,{toasts:W}),c.jsx(Ft,{}),S&&n.idleModeEnabled&&c.jsx(to,{gameState:n}),!ee&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:Le("left"),children:[c.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:c.jsx("button",{className:`tab-btn ${pe==="buildings"?"active":""}`,onClick:()=>Qe("buildings"),children:"Estates"})}),c.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:pe==="buildings"&&c.jsx(Ke,{gameState:n,onBuyBuilding:Se,onSellBuilding:Te,onSetBuyAmount:Ce})})]}),c.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:S&&n.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:c.jsx(Ve,{gameState:n,gps:V,onClick:()=>xe(!1),onEventInteract:ke,onOpenTavern:()=>ce(!0),onOpenPrestige:()=>oe(!0),onOpenSettings:()=>z(!0),onOpenStatistics:()=>de(!0),onOpenLeaderboard:()=>{ue(!0)},onOpenEmpire:()=>ne(!0),isIdle:S&&n.idleModeEnabled})}),c.jsxs("div",{style:Le("right"),children:[c.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:c.jsx("button",{className:`tab-btn ${he==="army"?"active":""}`,onClick:()=>Ze("army"),children:"Future"})}),c.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"var(--accent-color) transparent"},children:he==="army"&&c.jsx(Xe,{gameState:n,onBuyTowerFloor:()=>{const t=ge(n.infiniteTowerLevel||0);n.darkMatterGold.gte(t)&&(u(o=>a(l({},o),{darkMatterGold:o.darkMatterGold.minus(t),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,stats:a(l({},o.stats),{infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,darkMatterGold:o.darkMatterGold.minus(t)})})),y("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]})]}),ee&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[D==="buildings"&&c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[c.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:c.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),c.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsx(Ke,{gameState:n,onBuyBuilding:Se,onSellBuilding:Te,onSetBuyAmount:Ce})})]}),D==="throne"&&c.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:c.jsx(Ve,{gameState:n,gps:V,onClick:()=>xe(!1),onEventInteract:ke,onOpenTavern:()=>ce(!0),onOpenPrestige:()=>oe(!0),onOpenSettings:()=>z(!0),onOpenStatistics:()=>de(!0),onOpenLeaderboard:()=>ue(!0),onOpenEmpire:()=>ne(!0),isIdle:S&&n.idleModeEnabled})}),D==="army"&&c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[c.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:c.jsx("button",{className:"tab-btn active",children:"Future"})}),c.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsx(Xe,{gameState:n,onBuyTowerFloor:()=>{const t=ge(n.infiniteTowerLevel||0);n.darkMatterGold.gte(t)&&(u(o=>a(l({},o),{darkMatterGold:o.darkMatterGold.minus(t),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,stats:a(l({},o.stats),{infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,darkMatterGold:o.darkMatterGold.minus(t)})})),y("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]}),D==="empire"&&c.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:c.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[c.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),c.jsx("p",{children:"Construct massive infrastructure to boost global production."}),c.jsx("button",{className:"btn",onClick:()=>ne(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[c.jsxs("button",{className:`mobile-nav-btn ${D==="buildings"?"active":""}`,onClick:()=>{H("light"),te("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:D==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),c.jsx("div",{children:"Estates"})]}),c.jsxs("button",{className:`mobile-nav-btn ${D==="throne"?"active":""}`,onClick:()=>{H("light"),te("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:D==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),c.jsx("div",{children:"Throne"})]}),c.jsxs("button",{className:`mobile-nav-btn ${D==="army"?"active":""}`,onClick:()=>{H("light"),te("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:D==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),c.jsx("div",{children:"Future"})]}),c.jsxs("button",{className:`mobile-nav-btn ${D==="empire"?"active":""}`,onClick:()=>{H("light"),te("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:D==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),c.jsx("div",{children:"Projects"})]})]})]}),!(S&&n.idleModeEnabled)&&I&&c.jsxs("div",{className:"achievement-popup",children:[c.jsx("div",{style:{fontSize:"2rem"},children:I.icon}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),c.jsx("div",{style:{color:"var(--accent-color)"},children:I.name})]})]}),O&&c.jsx(Wt,{gained:O.gained,effectiveTime:O.effectiveTime,totalTime:O.totalTime,efficiency:O.efficiency,completedProjects:O.completedProjects,currentLevel:O.currentLevel,maxDuration:O.maxDuration,numberFormat:n.numberFormat,onClose:()=>Z(null)}),it&&c.jsx($t,{gameState:n,onClose:()=>ne(!1),onStartProject:t=>{var d;const o=((d=n.nationalProjects[t])==null?void 0:d.level)||0;if(o>=Gt)return;const r=Bt(t,o+1);if(n.gold.lt(r.gold))return;const s=Rt();u(f=>a(l({},f),{gold:f.gold.minus(r.gold),nationalProjects:a(l({},f.nationalProjects),{[t]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+s*1e3}})})),y("Construction started!","info")},onUpgradeClickPower:dt,onUpgradeOffline:ut}),tt&&c.jsx(zt,{gameState:n,onGamble:(t,o)=>{const r=e(t);u(s=>a(l({},s),{gold:o?s.gold.plus(r):s.gold.minus(r).max(0),stats:a(l({},s.stats),{tavernGamesPlayed:s.stats.tavernGamesPlayed.plus(e(1))})}))},onClose:()=>ce(!1)}),ot&&c.jsx(Ht,{gameState:n,onPrestige:bt,onClose:()=>oe(!1)}),nt&&c.jsx(Jt,{gameState:n,onClose:()=>z(!1),onHardReset:mt,onSave:gt,onSetTheme:t=>u(o=>a(l({},o),{theme:t})),onSetNumberFormat:t=>u(o=>a(l({},o),{numberFormat:t})),onToggleIdleMode:()=>u(t=>a(l({},t),{idleModeEnabled:!t.idleModeEnabled})),onUpdateInterface:t=>u(o=>a(l({},o),{interface:l(l({},o.interface),t)})),onOpenPromoCodes:()=>{z(!1),fe(!0)},onChangeName:()=>Pe(!0)}),at&&c.jsx(Kt,{gameState:n,onClose:()=>fe(!1),onRedeemPromoCode:vt,onBackToSettings:()=>{fe(!1),z(!0)}}),st&&c.jsx(Xt,{gameState:n,currentGps:V,onClose:()=>de(!1)}),rt&&c.jsx(Vt,{onClose:()=>lt(!1)}),be&&c.jsx(Yt,{isOpen:be,onClose:()=>{ye(!1),M(!0)},onConfirm:ht,gameState:n}),ve&&c.jsx(qt,{isOpen:ve,onClose:()=>ue(!1),playerProfile:n.playerProfile,gameState:n,addToast:y}),we&&c.jsx(Qt,{isOpen:we,onClose:()=>Pe(!1),onConfirm:yt,currentName:((Ee=n.playerProfile)==null?void 0:Ee.rulerName)||""})]})},qe=document.getElementById("root");if(!qe)throw new Error("Could not find root element to mount to");const no=Lt.createRoot(qe);no.render(c.jsx(Mt.StrictMode,{children:c.jsx(oo,{})}))});export default ro();
