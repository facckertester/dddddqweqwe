import{r as Mu,g as Lu}from"./vendor-B--z-fyW.js";import{a as tt}from"./game-Dc_pgXx_.js";var oi={exports:{}},or={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa;function Ou(){if(aa)return or;aa=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,s,o){var a=null;if(o!==void 0&&(a=""+o),s.key!==void 0&&(a=""+s.key),"key"in s){o={};for(var d in s)d!=="key"&&(o[d]=s[d])}else o=s;return s=o.ref,{$$typeof:n,type:r,key:a,ref:s!==void 0?s:null,props:o}}return or.Fragment=e,or.jsx=t,or.jsxs=t,or}var la;function Fu(){return la||(la=1,oi.exports=Ou()),oi.exports}var c=Fu(),$=Mu();const yi=Lu($),l=n=>n instanceof tt?n:new tt(n),Je=l(2e3),ca=[{version:"2.7.0",date:"Current",changes:["EMPIRE UPDATE: Wonders & Trade","Added 'Empire' menu (Unlocks with Castle).","Great Wonders: Build 3 massive multi-stage monuments for permanent bonuses.","Trade Routes: Invest gold and send caravans to distant lands.","New mechanics for spending excess Gold, Soldiers, and Elite Units."]},{version:"2.6.0",date:"Previous",changes:["ELITE ARMY UPDATE: Quality over Quantity","Added 'Royal Academy': Convert basic soldiers into Elite Units.","New Units: Knights, Paladins, and Void Sentinels.","Updated Crusades: High-level missions now require Elite Units to start.","Fixed 'Train 1M' button visibility."]},{version:"2.5.0",date:"Previous",changes:["WAR UPDATE: The Grand Army","New Crusades: toDecimal(5) new campaigns for massive armies (up to 1 Billion soldiers).","Replayability: Crusades can now be replayed for Gold rewards (Critical Success).","New Artifacts: Cosmic-tier relics providing up to x10,000 production.","Added 'Reality Defense' campaign for the ultimate challenge."]},{version:"2.4.0",date:"Previous",changes:["THE TRANSCENDENCE UPDATE","5 New God-Tier Buildings: Reaching up to 1e240 cost.","Renown Shop Expansion: Upgrades for the ultra-rich (up to 1e200 Renown).","New Advisor: The Time Keeper.","Achievement Extension: Gold and Renown tiers expanded significantly.","Endgame Balancing: New synergies for massive empires."]},{version:"2.3.0",date:"Previous",changes:["COSMIC EXPANSION: The Reality Engine","New Endgame Buildings: Chronosphere & Reality Engine.","Synergy Upgrades: Bonuses based on Achievements, Army, and Clicks.","New Renown Upgrades: Spend your prestige points on massive multipliers.","Progressive Unlocks: Buildings now appear only when you are ready.","Extended Achievement tiers for the ultimate tycoons."]},{version:"2.2.0",date:"Previous",changes:["ENDGAME EXPANSION: The Astral Age","New Building: Astral Rift. Harness the power of the void.","Renown Shop: Added powerful upgrades purchasable with Renown.","Quality of Life: 'Buy Amount' multiplier is now saved between sessions."]},{version:"2.1.0",date:"Previous",changes:["Advanced Design Studio: Customize every color!","Layout Control: Adjust the width of the 3 main columns.","Border Customization: Change border thickness and color.","Created the ultimate personalized experience."]},{version:"2.0.0",date:"Previous",changes:["Major Update: Full Interface Customization!","Added Interface settings for Font Size and Layout Density.","Added toggles for Animations, Floating Text, and Weather Widget.","Refined Settings menu organization."]},{version:"1.9.9",date:"Previous",changes:["Interface Update: Moved Statistics to a separate window.","Settings Update: Added ability to toggle 'Cinematic Idle Mode' on/off.","Settings Layout: Reorganized visual preferences."]},{version:"1.9.8",date:"Previous",changes:["Added Number Formatting Options.","Choose between 'Standard' (1k, 1M), 'Scientific' (1e6), or 'Plain' (1,000,000) notation.","Gold Per Second now displays with proper comma separators."]},{version:"1.9.7",date:"Previous",changes:["Added 'Cinematic Idle Mode'!","If you are inactive for 20 seconds, the UI clears away.","Enjoy procedural landscapes based on your kingdom's progress.","Weather effects are now fully visualized in Idle Mode.","Move your mouse to return to ruling."]},{version:"1.9.6",date:"Previous",changes:["Bug Fix: Click visual effect now shows correct gold amount.","The floating text now accounts for upgrades, renown, and decrees."]},{version:"1.9.5",date:"Previous",changes:["UI Update: Added dedicated 'Upgrades' tab.","Content: Added 6 new Upgrades to fill progression gaps.","Balance: Removed 'Divine Tithe' decree.","Upgrades are now sorted by cost."]},{version:"1.9.4",date:"Previous",changes:["Content Update: Added 2 new Click Upgrades.","Added 'Golden Gauntlet' (75k) and 'Hand of Midas' (3.5m).","Sorted all upgrades by price for better progression."]},{version:"1.9.3",date:"Previous",changes:["Army Update: Added bulk recruitment options.","You can now train 100 or 1,000 soldiers at once.","Improved war logistics for late-game empires."]},{version:"1.9.2",date:"Previous",changes:["UI Update: Detailed production stats.","Buildings now display both 'Per Unit' and 'Total' production.","Stats update in real-time with weather and buffs."]},{version:"1.9.1",date:"Previous",changes:["UI Update: Building stats now show REAL production per second.","Production display now accounts for Weather, Upgrades, Renown, and Artifacts.","Fixed descriptions to be more accurate."]},{version:"1.9.0",date:"Previous",changes:["Added Theme Support!","Choose between 'Royal Parchment', 'Dark Ages', and 'Midnight Realm' in Settings.","Improved visual comfort for different lighting conditions."]},{version:"1.8.1",date:"Previous",changes:["Balance Update: Decrees are no longer available immediately.","Added Unlock Conditions for all Decrees to prevent early-game exploits.","Added 'Emergency Draft' Decree (Unlock: toDecimal(100) Peasants).","Added 'Divine Tithe' Decree (Unlock: toDecimal(3) Cathedrals).","Royal Tax Audit now requires the Treasurer Advisor."]},{version:"1.8.0",date:"Previous",changes:["Added Bulk Buy Options: toDecimal(1)x, 10x, 100x, Max.","Expanded Conquest System: Crusades now have risk!","Risk Mechanics: Failure (Retreat), Success, and Critical Success.","Advisors Update: Warmaster now reduces Crusade risk."]},{version:"1.7.0",date:"Previous",changes:["Massive Achievement Update: Added 30 new achievements!","New Milestones: Early game, Prestige, Total Buildings, and Upgrades.","Can you reach 'Immortal Lineage' or build a 'Megalopolis'?"]},{version:"1.6.1",date:"Previous",changes:["Added 10 new hidden achievements.","Can you discover the requirements to unlock them?"]},{version:"1.6.0",date:"Previous",changes:["Added Dynamic Weather System!","Weather changes periodically, affecting production.","Sunny: Boosts Fields/Peasants.","Rainy: Boosts Mines/Alchemists.","Stormy: Major boost to Blacksmiths, penalty to Fields.","Windy: Speeds up Crusades and boosts Markets."]},{version:"1.5.0",date:"Previous",changes:["Added 'Royal Council' system.","Spend Renown to hire permanent Advisors.","4 Unique Advisors: Treasurer, Warmaster, Guildmaster, Alchemist.","Strategic choices for long-term kingdom planning."]},{version:"1.4.3",date:"Previous",changes:["Added 'Royal Tax Audit' decree.","Instantly collect 800s of production (10m cooldown)."]},{version:"1.4.2",date:"Previous",changes:["Added 10 new secret achievements.","Can you unlock them all?"]},{version:"1.4.1",date:"Previous",changes:["Removed sunburst/glow effect around the main button.","Cleaned up UI visual noise."]},{version:"1.4.0",date:"Previous",changes:["New Layout: Screen divided into 3 equal columns.","Left Column: Buildings & Decrees.","Middle Column: The Throne (Clicker & Stats).","Right Column: Army & Achievements.","Improved UI Organization."]},{version:"1.3.2",date:"Previous",changes:["Improved Auto-Save: Game now saves every 30 seconds.","Added Smart Save: Game immediately saves when tab is closed or refreshed.","Fixed issue where progress could be lost on quick exits."]},{version:"1.3.1",date:"Previous",changes:["Fixed Decree timer display: Now shows Active duration first, then Cooldown.","UI improvements for better timer readability."]},{version:"1.3.0",date:"Previous",changes:["Added 'Stables' building (35k cost)","Added 'Silver Mine' building (280k cost)","Made Prestige/Legacy button visible earlier (50k Gold)","Added explanation to Prestige menu"]},{version:"1.2.0",date:"Previous",changes:["Added Statistics tracking (Clicks, Dragon Kills, etc.)","Added 5 New Achievements","Added 'Updates' menu in Settings","Improved Save System stability"]},{version:"1.1.1",date:"Old",changes:["Added Grand Palace building","Added 'The Last Crusade' campaign","Added Notification System (Toasts)","Removed intrusive alerts"]},{version:"1.1.0",date:"Old",changes:["Added Market and Alchemist Guild buildings","Added Tavern Dice Game","Added Settings Menu","Added Hard Reset option"]},{version:"1.0.0",date:"Release",changes:["Initial Release","Basic Buildings & Upgrades","Prestige System","Day/Night Cycle"]}],U=(n,e="standard")=>{let t;try{typeof n=="number"?t=l(n):typeof n=="string"?t=new tt(n):n&&typeof n=="object"&&typeof n.eq=="function"?t=n:t=l(0)}catch(a){return console.error("Error converting to Decimal in formatNumber:",a,"Input:",n),"0"}if(t.eq(l(0)))return"0";if(e==="scientific")return t.abs().lt(l(1e3))?t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1}):t.toExponential(2);if(e==="plain")return t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1});if(t.abs().lt(1e3))return t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1});const r=["","k","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qd","Qn","Sx","St","Oa","Nn","Vg"],s=Math.floor(t.log10()/3);return s===0?t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1}):s>=r.length?t.toExponential(2):t.dividedBy(l(10).pow(s*3)).toFixed(2)+r[s]},_i={default:{id:"default",name:"Royal Parchment",colors:{"--bg-color":"#e8dcc5","--panel-bg":"#fdf6e3","--text-color":"#3e2723","--text-secondary":"#5d4037","--text-on-accent":"#ffffff","--accent-color":"#8d6e63","--accent-hover":"#6d4c41","--gold-color":"#bf9000","--border-color":"#a1887f","--success-color":"#2e7d32","--danger-color":"#c62828","--shadow":"4px 4px 0px rgba(62, 39, 35, 0.2)","--bg-image":`url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d7c9a8' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E")`}},dark:{id:"dark",name:"Dark Ages",colors:{"--bg-color":"#262626","--panel-bg":"#333333","--text-color":"#e0e0e0","--text-secondary":"#bdbdbd","--text-on-accent":"#ffffff","--accent-color":"#8d6e63","--accent-hover":"#795548","--gold-color":"#ffd700","--border-color":"#555555","--success-color":"#66bb6a","--danger-color":"#ef5350","--shadow":"4px 4px 0px rgba(0, 0, 0, 0.5)","--bg-image":"none"}},midnight:{id:"midnight",name:"Midnight Realm",colors:{"--bg-color":"#0d1b2a","--panel-bg":"#1b263b","--text-color":"#e0e1dd","--text-secondary":"#778da9","--text-on-accent":"#ffffff","--accent-color":"#415a77","--accent-hover":"#778da9","--gold-color":"#ffcc00","--border-color":"#415a77","--success-color":"#00e676","--danger-color":"#ff1744","--shadow":"4px 4px 0px rgba(0, 0, 0, 0.5)","--bg-image":"none"}}},Tl={clear:{id:"clear",name:"Clear Skies",icon:"â˜€ï¸",description:"A calm day. No special effects.",color:"rgba(255, 243, 224, 0.5)"},sunny:{id:"sunny",name:"Bountiful Sun",icon:"ðŸŒ…",description:"+20% Production for Peasants and Wheat Fields.",color:"rgba(255, 236, 179, 0.5)"},rainy:{id:"rainy",name:"Heavy Rain",icon:"ðŸŒ§ï¸",description:"+20% Production for Silver Mines and Alchemists.",color:"rgba(227, 242, 253, 0.5)"},stormy:{id:"stormy",name:"Thunderstorm",icon:"âš¡",description:"+30% Blacksmith production (Energy), but -20% Wheat Fields.",color:"rgba(207, 216, 220, 0.5)"},windy:{id:"windy",name:"High Winds",icon:"ðŸƒ",description:"Crusades are 20% faster. Markets produce +15% more.",color:"rgba(224, 242, 241, 0.5)"}},ds=[{id:"knight",name:"Royal Knight",description:"Heavily armored elite infantry.",icon:"ðŸ›¡ï¸",goldCost:l(25e3),soldierCost:l(100)},{id:"paladin",name:"Divine Paladin",description:"Blessed warriors who fear no darkness.",icon:"âœ¨",goldCost:l(15e4),soldierCost:l(500)},{id:"void_sentinel",name:"Void Sentinel",description:"Infused with cosmic energy to fight reality itself.",icon:"ðŸ”®",goldCost:l(5e6),soldierCost:l(2e3)}];l(10),l(1),l(5),l(25),l(2),l(5),l(50),l(3),l(5),l(100),l(5),l(5),l(250),l(10),l(5),l(500),l(20),l(5);const _t=[{id:"peasant",name:"Peasant",baseCost:l(15),baseProduction:l(.1),description:"A loyal subject to work the fields.",icon:"ðŸŒ¾"},{id:"field",name:"Wheat Field",baseCost:l(60),baseProduction:l(.8),description:"Golden wheat to feed the kingdom.",icon:"ðŸšœ"},{id:"blacksmith",name:"Blacksmith",baseCost:l(250),baseProduction:l(5),description:"Forging tools and weapons.",icon:"ðŸ”¨"},{id:"market",name:"Market",baseCost:l(1200),baseProduction:l(18),description:"Trade hub for exotic goods.",icon:"âš–ï¸"},{id:"tavern",name:"Tavern",baseCost:l(5e3),baseProduction:l(45),description:"Where gold flows as freely as ale.",icon:"ðŸº"},{id:"stable",name:"Stables",baseCost:l(18e3),baseProduction:l(120),description:"Horses for trade and war.",icon:"ðŸŽ"},{id:"castle",name:"Castle",baseCost:l(6e4),baseProduction:l(280),description:"The seat of your power.",icon:"ðŸ°"},{id:"silver_mine",name:"Silver Mine",baseCost:l(2e5),baseProduction:l(650),description:"Deep shafts rich with precious metal.",icon:"â›ï¸"},{id:"alchemist",name:"Alchemist Guild",baseCost:l(6e5),baseProduction:l(1200),description:"Transmuting lead into gold.",icon:"âš—ï¸"},{id:"cathedral",name:"Cathedral",baseCost:l(2e6),baseProduction:l(2800),description:"Divine blessings bring great fortune.",icon:"â›ª"},{id:"palace",name:"Grand Palace",baseCost:l(8e6),baseProduction:l(15e3),description:"A wonder of the world to cement your legacy.",icon:"ðŸ¯"},{id:"void_portal",name:"Void Portal",baseCost:l(5e7),baseProduction:l(5e4),description:"Gateway to endless void energy.",icon:"ðŸŒ€"},{id:"time_chamber",name:"Time Chamber",baseCost:l(2e8),baseProduction:l(2e5),description:"Manipulate time flow for infinite wealth.",icon:"â°"},{id:"dimension_gate",name:"Dimension Gate",baseCost:l(8e8),baseProduction:l(8e5),description:"Open portals to parallel dimensions.",icon:"ðŸŒŒ"},{id:"astral_rift",name:"Astral Rift",baseCost:l(1e18),baseProduction:l(5e9),description:"Tear open reality to harvest void energy.",icon:"ðŸŒŒ"},{id:"chronosphere",name:"Chronosphere",baseCost:l(1e21),baseProduction:l(5e14),description:"Manipulate time to generate endless wealth.",icon:"â³"},{id:"reality_engine",name:"Reality Engine",baseCost:l(1e24),baseProduction:l(1e17),description:"Rewrite the physical laws of the universe.",icon:"âš›ï¸"},{id:"quantum_computer",name:"Quantum Supercomputer",baseCost:l(1e45),baseProduction:l(1e40),description:"Simulate infinite universes for profit.",icon:"ðŸ’»"},{id:"multiverse_nexus",name:"Multiverse Nexus",baseCost:l(1e48),baseProduction:l(1e43),description:"Trade with parallel realities.",icon:"ðŸŒ€"},{id:"dyson_sphere",name:"Dyson Sphere",baseCost:l(1e51),baseProduction:l(1e46),description:"Harness entire energy of a star.",icon:"ðŸŒž"},{id:"matter_replicator",name:"Matter Replicator",baseCost:l(1e54),baseProduction:l(1e49),description:"Convert energy directly into gold.",icon:"ðŸ–¨ï¸"},{id:"architect_quill",name:"The Architect's Quill",baseCost:l(1e57),baseProduction:l(1e52),description:"Rewrite code of existence itself.",icon:"âœ’ï¸"}],rt=[{id:"rusty_pitchfork",name:"Rusty Pitchforks",description:"Peasants work 2x harder.",cost:l(500),triggerId:"peasant",triggerCount:l(1),type:"building",targetId:"peasant",multiplier:l(2)},{id:"royal_scepter",name:"Royal Scepter",description:"Clicking is 2x more effective.",cost:l(1e3),type:"click",multiplier:l(2)},{id:"iron_plough",name:"Iron Plough",description:"Fields produce +50% more.",cost:l(2500),triggerId:"field",triggerCount:l(10),type:"building",targetId:"field",multiplier:l(1.5)},{id:"heavy_anvil",name:"Heavy Anvil",description:"Blacksmiths produce 2x gold.",cost:l(11e3),triggerId:"blacksmith",triggerCount:l(10),type:"building",targetId:"blacksmith",multiplier:l(2)},{id:"steel_plough",name:"Steel Plough",description:"Fields produce 2x gold.",cost:l(15e3),triggerId:"field",triggerCount:l(25),type:"building",targetId:"field",multiplier:l(2)},{id:"merchant_guild",name:"Merchant Guild",description:"Markets generate +50% profit.",cost:l(25e3),triggerId:"market",triggerCount:l(15),type:"building",targetId:"market",multiplier:l(1.5)},{id:"ale_yeast",name:"Imported Yeast",description:"Taverns produce +50% more.",cost:l(45e3),triggerId:"tavern",triggerCount:l(5),type:"building",targetId:"tavern",multiplier:l(1.5)},{id:"golden_gauntlet",name:"Golden Gauntlet",description:"Clicking is 2x more effective.",cost:l(75e3),type:"click",multiplier:l(2)},{id:"thoroughbreds",name:"Thoroughbreds",description:"Stables produce 2x gold.",cost:l(85e3),triggerId:"stable",triggerCount:l(10),type:"building",targetId:"stable",multiplier:l(2)},{id:"tax_collector",name:"Tax Collector",description:"Global production +20%.",cost:l(1e5),type:"global",multiplier:l(1.2)},{id:"guild_charters",name:"Guild Charters",description:"Markets produce 2x gold.",cost:l(12e4),triggerId:"market",triggerCount:l(25),type:"building",targetId:"market",multiplier:l(2)},{id:"standing_army",name:"Standing Army",description:"Global production +10% (Security).",cost:l(15e4),type:"global",multiplier:l(1.1)},{id:"war_horses",name:"War Horses",description:"Stables produce +50% more.",cost:l(18e4),triggerId:"stable",triggerCount:l(20),type:"building",targetId:"stable",multiplier:l(1.5)},{id:"mining_safety",name:"Mining Safety",description:"Silver Mines produce 2x gold.",cost:l(45e4),triggerId:"silver_mine",triggerCount:l(5),type:"building",targetId:"silver_mine",multiplier:l(2)},{id:"deep_shafts",name:"Deep Shafts",description:"Silver Mines produce +50% more.",cost:l(6e5),triggerId:"silver_mine",triggerCount:l(10),type:"building",targetId:"silver_mine",multiplier:l(1.5)},{id:"royal_banner",name:"Royal Banner",description:"Global production +15%.",cost:l(12e5),type:"global",multiplier:l(1.15)},{id:"elixir_life",name:"Elixir of Wealth",description:"Alchemists triple their output.",cost:l(2e6),triggerId:"alchemist",triggerCount:l(5),type:"building",targetId:"alchemist",multiplier:l(3)},{id:"stained_glass",name:"Stained Glass",description:"Cathedrals inspire 2x donations.",cost:l(3e6),triggerId:"cathedral",triggerCount:l(5),type:"building",targetId:"cathedral",multiplier:l(2)},{id:"hand_of_midas",name:"Hand of Midas",description:"Clicking is 3x more effective.",cost:l(35e5),type:"click",multiplier:l(3)},{id:"diamond_click",name:"Diamond Touch",description:"Clicking is 5x more effective.",cost:l(1e7),type:"click",multiplier:l(5)},{id:"royal_treasury",name:"Royal Treasury",description:"Grand Palaces produce 2x gold.",cost:l(5e7),triggerId:"palace",triggerCount:l(1),type:"building",targetId:"palace",multiplier:l(2)},{id:"obsidian_walls",name:"Obsidian Walls",description:"Castles produce 3x gold.",cost:l(2e6),triggerId:"castle",triggerCount:l(200),type:"building",targetId:"castle",multiplier:l(3)},{id:"philosopher_stone",name:"Philosopher's Stone",description:"Alchemists produce 5x gold.",cost:l(8e6),triggerId:"alchemist",triggerCount:l(200),type:"building",targetId:"alchemist",multiplier:l(5)},{id:"divine_intervention",name:"Divine Intervention",description:"Cathedrals produce 5x gold.",cost:l(5e7),triggerId:"cathedral",triggerCount:l(250),type:"building",targetId:"cathedral",multiplier:l(5)},{id:"empire_bureaucracy",name:"Imperial Bureaucracy",description:"Global Production x1.5.",cost:l(3e8),triggerId:"peasant",triggerCount:l(1500),type:"global",multiplier:l(1.5)},{id:"void_harvesting",name:"Void Harvesting",description:"Astral Rifts produce x5 energy.",cost:l(2e16),triggerId:"astral_rift",triggerCount:l(10),type:"building",targetId:"astral_rift",multiplier:l(5)},{id:"temporal_batteries",name:"Temporal Batteries",description:"Chronospheres produce x2 Gold.",cost:l(1e23),triggerId:"chronosphere",triggerCount:l(5),type:"building",targetId:"chronosphere",multiplier:l(2)},{id:"reality_weave",name:"Reality Weave",description:"Reality Engines produce x2 Gold.",cost:l(1e26),triggerId:"reality_engine",triggerCount:l(5),type:"building",targetId:"reality_engine",multiplier:l(2)},{id:"army_synergy",name:"Conqueror's Tithe",description:"Global Production +1% for every 1000 Soldiers.",cost:l(1e15),triggerId:"castle",triggerCount:l(100),type:"global",multiplier:l(1)},{id:"achievement_synergy",name:"Hall of Fame",description:"Global Production +5% per Achievement unlocked.",cost:l(1e18),triggerId:"peasant",triggerCount:l(2e3),type:"global",multiplier:l(1)},{id:"click_synergy",name:"Finger of God",description:"Global Production +0.01% per Manual Click (Lifetime).",cost:l(1e20),triggerId:"peasant",triggerCount:l(2500),type:"global",multiplier:l(1)},{id:"legacy_of_kings",name:"Legacy of Kings",description:"Global Production x5 (Permanent)",cost:l(5e3),currency:"renown",type:"global",multiplier:l(5)},{id:"divine_right",name:"Divine Right",description:"Global Production x10 (Permanent)",cost:l(5e4),currency:"renown",type:"global",multiplier:l(10)},{id:"time_dilation",name:"Time Dilation",description:"Global Production x50 (Permanent)",cost:l(5e5),currency:"renown",type:"global",multiplier:l(50)},{id:"omniscience",name:"Omniscience",description:"Global Production x200 (Permanent)",cost:l(5e6),currency:"renown",type:"global",multiplier:l(200)},{id:"reality_bending",name:"Reality Bending",description:"Global Production x1000 (Permanent)",cost:l(5e7),currency:"renown",type:"global",multiplier:l(1e3)},{id:"ascended_knowledge",name:"Ascended Knowledge",description:"Global Production x10,000 (Permanent)",cost:l(5e8),currency:"renown",type:"global",multiplier:l(1e4)},{id:"universal_truth",name:"Universal Truth",description:"Global Production x1,000,000 (Permanent)",cost:l(1e50),currency:"renown",type:"global",multiplier:l(1e6)},{id:"god_mode",name:"Divinity",description:"Global Production x1e9 (Permanent)",cost:l(1e100),currency:"renown",type:"global",multiplier:l(1e9)},{id:"developer_access",name:"Creative Mode",description:"Global Production x1e12 (Permanent)",cost:l(1e150),currency:"renown",type:"global",multiplier:l(1e12)},{id:"the_end",name:"The End",description:"Global Production x1e20 (Permanent)",cost:l(1e200),currency:"renown",type:"global",multiplier:l(1e20)}],Bu=(n,e)=>{const t=l(1.15);return n.times(t.pow(e)).floor()},Dt=(n,e,t)=>{const r=l(1.15),s=n.times(r.pow(e)),o=r.pow(t).minus(l(1)),a=r.minus(l(1));return s.times(o).dividedBy(a).floor()},ua=(n,e,t)=>{const r=l(1.15),s=n.times(r.pow(e));if(t.lt(s))return l(0);let o=l(0),a=l(1);for(;Dt(n,e,a).lte(t)&&(a=a.times(l(2)),!a.gt(l(1e9))););for(;a.minus(o).gt(l(1));){const d=o.plus(a).dividedBy(l(2)).floor();Dt(n,e,d).lte(t)?o=d:a=d}return o},Gt=(n,e,t,r,s,o)=>e.map(a=>({id:`${n}_${a}`,name:t(a),description:r(a),icon:s,condition:d=>o(d,a)})),Uu=[1,10,25,50,100,150,200,300,400,500,750,1e3,1500,2e3,3e3,4e3,5e3],zu=_t.flatMap(n=>Gt(`build_${n.id}`,Uu,e=>`${n.name} Owner ${e}`,e=>`Own ${e} ${n.name}s.`,n.icon,(e,t)=>(e.buildings[n.id]||l(0)).gte(l(t)))),qu=[10,50,100,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6],$u=Gt("clicks",qu,n=>`Finger Workout ${U(n)}`,n=>`Click manually ${U(n)} times.`,"ðŸ‘†",(n,e)=>n.stats.totalClicks.gte(l(e))),Gu=()=>{const n=[];let e=l(1e3);for(let t=0;t<100;t++)n.push(e.toNumber()),e=e.times(t%2===0?l(5):l(2));return n},Wu=Gt("gold",Gu(),n=>`Hoarder ${U(n)}`,n=>`Amass a lifetime total of ${U(n)} gold.`,"ðŸ’°",(n,e)=>n.totalGold.gte(l(e))),Hu=[10,25,50,100,200,300,400,500,750,1e3,1500,2e3,3e3,4e3,5e3,7500,1e4],Ku=Gt("total_builds",Hu,n=>`Architect ${n}`,n=>`Own ${n} total buildings.`,"ðŸ—ï¸",(n,e)=>Object.values(n.buildings).reduce((t,r)=>t.plus(r),l(0)).gte(l(e))),Qu=[10,50,100,500,1e3,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6],Yu=Gt("soldiers",Qu,n=>`Commander ${U(n)}`,n=>`Train a standing army of ${U(n)}.`,"âš”ï¸",(n,e)=>n.soldiers.gte(l(e))),Xu=[1,5,10,25,50,100,250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,5e5,1e6,1e7,1e8,1e10,1e20,1e50,1e100,1e150,1e200,1e250],Ju=Gt("renown",Xu,n=>`Legend ${U(n)}`,n=>`Reach ${U(n)} Renown (Prestige).`,"ðŸ‘‘",(n,e)=>n.renown.gte(l(e))),Zu=[1,5,10,20,50,100,200,300,400,500],ed=Gt("dragons",Zu,n=>`Slayer ${n}`,n=>`Defeat ${n} Dragons.`,"ðŸ‰",(n,e)=>n.stats.dragonsKilled.gte(l(e))),td=[1,10,25,50,100,250,500,1e3,2500,5e3],nd=Gt("gambler",td,n=>`High Roller ${n}`,n=>`Play ${n} games in the Tavern.`,"ðŸŽ²",(n,e)=>n.stats.tavernGamesPlayed.gte(l(e))),rd=[{id:"all_artifacts",name:"Museum Curator",description:"Collect all unique Artifacts.",icon:"ðŸ†",condition:n=>n.artifacts.length>=Sn.length},{id:"first_artifact",name:"Artifact Collector",description:"Collect your first Artifact.",icon:"ðŸ…",condition:n=>n.artifacts.length>=1},{id:"half_artifacts",name:"Artifact Hunter",description:"Collect half of all Artifacts.",icon:"ðŸ¥ˆ",condition:n=>n.artifacts.length>=Math.floor(Sn.length/2)}],sd=[{id:"first_advisor",name:"Royal Advisor",description:"Hire your first Advisor.",icon:"ðŸ‘‘",condition:n=>n.advisors.length>=1},{id:"all_advisors",name:"Royal Council",description:"Hire all basic Advisors.",icon:"ðŸ‘‘",condition:n=>n.advisors.length>=8},{id:"advisor_upgrade",name:"Advisor Master",description:"Upgrade any Advisor to level 5.",icon:"ðŸŽ“",condition:n=>Object.values(n.advisorLevels||{}).some(e=>e.gte(l(5)))}],id=[{id:"first_wonder",name:"Wonder Builder",description:"Complete first stage of any Wonder.",icon:"ðŸ—ï¸",condition:n=>Object.keys(n.wonders||{}).length>=1},{id:"complete_wonder",name:"Wonder Master",description:"Complete any Wonder.",icon:"ðŸ›ï¸",condition:n=>Object.keys(n.wonders||{}).length>=1&&Object.values(n.wonders||{}).some(e=>e>=3)},{id:"all_wonders",name:"Architect of Eternity",description:"Complete all Wonders.",icon:"ðŸŒŸ",condition:n=>Object.keys(n.wonders||{}).length>=3&&Object.values(n.wonders||{}).every(e=>e>=3)}],od=[{id:"first_trade",name:"Merchant",description:"Complete your first trade route.",icon:"ðŸ’°",condition:n=>n.gold.gte(l(1e6))},{id:"trade_master",name:"Trade Master",description:"Complete 50 successful trades.",icon:"ðŸ—ºï¸",condition:n=>n.gold.gte(l(1e8))}],ad=[{id:"speed_1m",name:"Quick Start",description:"Earn 1M gold.",icon:"âš¡",condition:n=>n.totalGold.gte(l(1e6))},{id:"speed_1b",name:"Golden Touch",description:"Earn 1B gold.",icon:"ðŸ‘‘",condition:n=>n.totalGold.gte(l(1e9))},{id:"prestige_master",name:"Prestige Master",description:"Prestige 10 times.",icon:"â­",condition:n=>n.renown.gte(l(1e4))}],ld=[{id:"click_master",name:"Click Master",description:"Make 1000 manual clicks.",icon:"ðŸ‘†",condition:n=>{var e,t;return(t=(e=n.stats)==null?void 0:e.totalClicks)==null?void 0:t.gte(l(1e3))}},{id:"idle_master",name:"True Idle Master",description:"Play for 24 hours without clicking.",icon:"â°",condition:n=>{var e,t;return((t=(e=n.stats)==null?void 0:e.totalClicks)==null?void 0:t.lt(l(50)))&&n.totalGold.gte(l(1e9))}}],cd=[{id:"building_soldier_combo",name:"War Economy",description:"Have 500 buildings and 100,000 soldiers.",icon:"âš”ï¸",condition:n=>Object.values(n.buildings).reduce((t,r)=>t.plus(r),l(0)).gte(l(500))&&n.soldiers.gte(l(1e5))},{id:"advisor_artifact_combo",name:"Royal Collector",description:"Have all advisors and all artifacts.",icon:"ðŸ‘‘",condition:n=>n.advisors.length>=8&&n.artifacts.length>=Sn.length}],hs=[...zu,...$u,...Wu,...Ku,...Yu,...Ju,...ed,...nd,...rd,...sd,...id,...od,...ad,...ld,...cd],Al=[{id:"royal_feast",name:"Royal Feast",description:"Production x2 for 30s.",duration:l(30),cooldown:l(300),icon:"ðŸ–",effectType:"production_mult",value:l(2),unlockCondition:n=>(n.buildings.tavern||l(0)).gte(l(1)),unlockDescription:"Build a Tavern"},{id:"call_to_arms",name:"Call to Arms",description:"Click Power x5 for 20s.",duration:l(20),cooldown:l(180),icon:"âš”ï¸",effectType:"click_mult",value:l(5),unlockCondition:n=>(n.buildings.blacksmith||l(0)).gte(l(1)),unlockDescription:"Build a Blacksmith"},{id:"royal_tax_audit",name:"Royal Tax Audit",description:"Instantly collect 600s of production.",duration:l(0),cooldown:l(600),icon:"ðŸ“œ",effectType:"instant_gold",value:l(600),unlockCondition:n=>n.advisors.includes("treasurer"),unlockDescription:"Hire Treasurer Advisor"},{id:"emergency_draft",name:"Emergency Draft",description:"Recruit 50 Soldiers instantly.",duration:l(0),cooldown:l(300),icon:"ðŸ’‚",effectType:"add_soldiers",value:l(50),unlockCondition:n=>(n.buildings.peasant||l(0)).gte(l(100)),unlockDescription:"Own 100 Peasants"}],Sn=[{id:"ancient_crown",name:"Ancient Crown",description:"Global Production +50%.",icon:"ðŸ‘‘",globalMultiplier:l(1.5)},{id:"blessed_chalice",name:"Blessed Chalice",description:"Global Production +25%.",icon:"ðŸ†",globalMultiplier:l(1.25)},{id:"dragon_scale",name:"Dragon Scale Shield",description:"Global Production +35%.",icon:"ðŸ›¡ï¸",globalMultiplier:l(1.35)},{id:"lunar_stone",name:"Lunar Stone",description:"Global Production x5.",icon:"ðŸŒ‘",globalMultiplier:l(5)},{id:"solar_flare",name:"Solar Core",description:"Global Production x25.",icon:"â˜€ï¸",globalMultiplier:l(25)},{id:"void_essence",name:"Void Essence",description:"Global Production x100.",icon:"ðŸŸ£",globalMultiplier:l(100)},{id:"galactic_map",name:"Galactic Map",description:"Global Production x500.",icon:"ðŸ—ºï¸",globalMultiplier:l(500)},{id:"reality_shard",name:"Reality Shard",description:"Global Production x10,000.",icon:"ðŸ’Ž",globalMultiplier:l(1e4)}],fs=[{id:"goblin_lands",name:"Goblin Lands",description:"Raid goblin camps for treasure.",duration:l(60),soldierCost:l(200),rewardArtifactId:"ancient_crown",icon:"ðŸ‘¹",baseRisk:l(.25)},{id:"orc_fortress",name:"Orc Fortress",description:"Assault the orc stronghold.",duration:l(300),soldierCost:l(1e3),rewardArtifactId:"blessed_chalice",icon:"ðŸ°",baseRisk:l(.35)},{id:"dragon_lair",name:"Dragon's Lair",description:"Slay the dragon for riches.",duration:l(1800),soldierCost:l(5e3),rewardArtifactId:"dragon_scale",icon:"ðŸ‰",baseRisk:l(.45)},{id:"demon_portal",name:"Demon Portal",description:"Close the demonic invasion.",duration:l(7200),soldierCost:l(25e3),rewardArtifactId:"lunar_stone",icon:"ðŸ”¥",baseRisk:l(.55)},{id:"void_invasion",name:"Void Invasion",description:"Defend reality from void creatures.",duration:l(14400),soldierCost:l(1e5),rewardArtifactId:"solar_flare",icon:"ðŸŒŒ",baseRisk:l(.65)},{id:"dimensional_war",name:"Dimensional War",description:"Fight enemies from parallel universes.",duration:l(43200),soldierCost:l(1e8),requiredUnits:{paladin:l(1e3),void_sentinel:l(20)},rewardArtifactId:"galactic_map",icon:"ðŸŒ€",baseRisk:l(.75)},{id:"reality_defense",name:"Reality Defense",description:"Protect fabric of existence itself.",duration:l(86400),soldierCost:l(2e9),requiredUnits:{void_sentinel:l(200)},rewardArtifactId:"reality_shard",icon:"ðŸ›¡ï¸",baseRisk:l(.85)}],Il=[{id:"treasurer",name:"Royal Treasurer",description:"Auto-clicks once every 5 seconds. Can be upgraded.",cost:l(12),icon:"ðŸ’°"},{id:"warmaster",name:"Warmaster",description:"Crusades are 25% faster and 30% safer. Can be upgraded.",cost:l(50),icon:"âš”ï¸"},{id:"guildmaster",name:"Guildmaster",description:"Buildings are 10% cheaper. Can be upgraded.",cost:l(125),icon:"ðŸ”¨"},{id:"alchemist",name:"Court Alchemist",description:"Doubles chance of Random Events. Can be upgraded.",cost:l(250),icon:"âš—ï¸"},{id:"chronomancer",name:"Chronomancer",description:"Reduces decree cooldowns by 25%. Can be upgraded.",cost:l(2500),icon:"â°"},{id:"void_scholar",name:"Void Scholar",description:"Increases Renown gain by 20%. Can be upgraded.",cost:l(25e3),icon:"ðŸ“š"},{id:"cosmic_mage",name:"Cosmic Mage",description:"All production bonuses increased by 15%. Can be upgraded.",cost:l(25e4),icon:"ðŸ”®"},{id:"time_keeper",name:"Time Keeper",description:"Decree cooldowns are 50% shorter. Can be upgraded.",cost:l(25e7),icon:"â³"}],Cl=(n,e)=>n.cost.times(l(2.5).pow(e)),Pt=(n,e)=>{const r={treasurer:l(1),warmaster:l(.25),guildmaster:l(.1),alchemist:l(1),chronomancer:l(.25),void_scholar:l(.2),cosmic_mage:l(.15),time_keeper:l(.5)}[n]||l(1),s=n==="void_scholar"?l(1.2).pow(e):l(1.2).pow(e.minus(l(1)));return r.times(s)};l(10),l(25),l(50),l(100),l(250),l(500);const ms=[{id:"local_villages",name:"Local Villages",description:"Safe, quick trade with neighbors.",baseDuration:l(300),risk:l(.25),maxInvestment:l(1e6),rewardMultiplier:l(1.5),icon:"ðŸ˜ï¸"},{id:"iron_dwarves",name:"Iron Mountain Dwarves",description:"High risk, high reward trade for precious metals.",baseDuration:l(1800),risk:l(.55),maxInvestment:l(1e9),rewardMultiplier:l(3),icon:"âš’ï¸"},{id:"high_elves",name:"High Elven Spires",description:"Long expeditions for magical artifacts.",baseDuration:l(7200),risk:l(.75),maxInvestment:l(1e18),rewardMultiplier:l(10),icon:"ðŸ§"},{id:"void_traders",name:"Void Walkers",description:"Inter-dimensional trade. Extreme danger.",baseDuration:l(21600),risk:l(.95),maxInvestment:l(1e18),rewardMultiplier:l(100),icon:"ðŸŒ€"}],Rl=[{id:"great_pyramid",name:"The Golden Pyramid",description:"A monument to eternal wealth.",icon:"ðŸ”º",bonusDescription:"Trade Routes are 50% safer and 2x faster.",stages:[{name:"Foundation",description:"Lay base of massive structure.",cost:[{type:"gold",amount:l(5e17)},{type:"soldiers",amount:l(25e3)}]},{name:"Structure",description:"Build limestone walls.",cost:[{type:"gold",amount:l(5e17)},{type:"soldiers",amount:l(1e5)},{type:"knight",amount:l(500)}]},{name:"Capstone",description:"Place golden capstone.",cost:[{type:"gold",amount:l(5e17)},{type:"paladin",amount:l(250)},{type:"renown",amount:l(500)}]}]},{id:"sky_citadel",name:"Sky Citadel",description:"A floating fortress to rule the skies.",icon:"â˜ï¸",bonusDescription:"Global Production x100 (Permanent).",stages:[{name:"Anti-Gravity Base",description:"Enchant earth to float.",cost:[{type:"gold",amount:l(5e17)},{type:"soldiers",amount:l(5e17)}]},{name:"Cloud Towers",description:"Construct towers that pierce heavens.",cost:[{type:"gold",amount:l(5e17)},{type:"paladin",amount:l(2500)}]},{name:"Storm Core",description:"Harness lightning to power city.",cost:[{type:"gold",amount:l(5e17)},{type:"void_sentinel",amount:l(50)},{type:"renown",amount:l(5e17)}]}]},{id:"void_gate",name:"Gate of Oblivion",description:"A portal to the source of all magic.",icon:"ðŸŒŒ",bonusDescription:"Offline Gains 100%.",stages:[{name:"Rift Stabilizer",description:"Prevent reality from collapsing.",cost:[{type:"gold",amount:l(5e17)},{type:"void_sentinel",amount:l(500)}]},{name:"Event Horizon",description:"Expand tear in space-time.",cost:[{type:"gold",amount:l(5e17)},{type:"renown",amount:l(5e17)}]},{name:"Void Anchor",description:"Bind void to your will.",cost:[{type:"gold",amount:l(5e17)},{type:"void_sentinel",amount:l(5e3)},{type:"renown",amount:l(5e17)}]}]}],ai=100,ps=(n,e=!1,t=!1,r=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:t?"rgba(0,0,0,0.05)":e?"rgba(46, 125, 50, 0.1)":r?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:t?"rgba(0,0,0,0.2)":r?"#7b1fa2":n?"var(--border-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:n&&!t?"pointer":"default",opacity:n&&!t||e?1:.7,transition:"all 0.2s",boxShadow:n&&!t?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:t?"grayscale(1)":"none"}),gr={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},ud=({gameState:n,onBuyUpgrade:e})=>{const t=rt.filter(r=>!(n.upgrades.includes(r.id)||r.triggerId&&(n.buildings[r.triggerId]||l(0)).lt(r.triggerCount||l(0))||r.currency==="renown"&&n.renown.lt(r.cost.times(l(.1)))));return t.length===0?c.jsxs("div",{style:{...gr,justifyContent:"center",alignItems:"center",color:"var(--text-secondary)"},children:[c.jsx("div",{children:"No upgrades available yet."}),c.jsx("div",{style:{fontSize:"0.8rem",marginTop:"5px"},children:"Build more structures to unlock new technologies!"})]}):(t.sort((r,s)=>r.currency==="renown"&&s.currency!=="renown"?-1:r.currency!=="renown"&&s.currency==="renown"?1:r.cost.cmp(s.cost)),c.jsx("div",{style:gr,children:t.map(r=>{const s=r.currency==="renown",o=s?n.renown.gte(r.cost):n.gold.gte(r.cost);return c.jsxs("div",{style:ps(o,!1,!1,s),onClick:()=>o&&e(r.id),"data-tooltip":`${r.name}: ${r.description}`,children:[c.jsx("div",{style:{fontSize:"1.4rem",marginRight:"15px",width:"30px",textAlign:"center"},children:""}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold",color:s?"#4a148c":"var(--text-color)"},children:r.name}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:r.description})]}),c.jsxs("div",{style:{textAlign:"right",fontWeight:"bold",color:o?s?"#4a148c":"var(--accent-color)":"var(--text-secondary)"},children:[U(r.cost,n.numberFormat)," ",s?"":"G"]})]},r.id)})}))},dd=({gameState:n,onBuyBuilding:e,onSellBuilding:t,onSetBuyAmount:r})=>{var A;const s=n.advisors.includes("guildmaster"),o=l(s?.9:1),a=((A=n.interface)==null?void 0:A.lastBuyAmount)||l(1),[d,f]=$.useState(!1),[m,y]=$.useState(1);$.useEffect(()=>{const C=P=>{P.ctrlKey?y(10):P.shiftKey?y(100):y(1)},F=P=>C(P),N=P=>C(P);return window.addEventListener("keydown",F),window.addEventListener("keyup",N),()=>{window.removeEventListener("keydown",F),window.removeEventListener("keyup",N)}},[]);const v=(C,F)=>{var Q;let N=F;const P=((Q=n.weather)==null?void 0:Q.current)||"clear";P==="sunny"&&(C==="peasant"||C==="field")||P==="rainy"&&(C==="silver_mine"||C==="alchemist")?N=N.times(l(1.2)):P==="stormy"?(C==="blacksmith"&&(N=N.times(l(1.3))),C==="field"&&(N=N.times(l(.8)))):P==="windy"&&C==="market"&&(N=N.times(l(1.15)));let q=l(0);rt.forEach(J=>{n.upgrades.includes(J.id)&&J.type==="building"&&J.targetId===C&&J.multiplier&&(q=q.plus(F.times(J.multiplier.minus(l(1)))))});let B=N.plus(q),G=l(1);return rt.forEach(J=>{n.upgrades.includes(J.id)&&J.type==="global"&&J.multiplier&&(G=G.times(J.multiplier))}),n.artifacts.forEach(J=>{const Z=Sn.find(w=>w.id===J);Z&&(G=G.times(Z.globalMultiplier))}),G=G.times(l(1).plus(n.renown.times(l(.01)))),(n.activeDecrees.royal_feast||l(0)).gt(l(Date.now()))&&(G=G.times(l(2))),C==="astral_rift"&&(n.upgrades.includes("void_harvesting")&&(G=G.times(l(10))),n.upgrades.includes("singularity")&&(G=G.times(l(5)))),B.times(G)};return c.jsxs("div",{style:gr,children:[c.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[l(1),l(10),l(100),l(500),l(1e3),l(-1)].map(C=>c.jsx("button",{onClick:()=>r(C),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:a.equals(C)?"var(--accent-color)":"var(--panel-bg)",color:a.equals(C)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:C.equals(l(-1))?"Max":`${C.toString()}`},`amount-${C.toString()}`))}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[c.jsx("button",{className:"btn",style:{background:d?"var(--panel-bg)":"var(--accent-color)",color:d?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>f(!1),children:"ðŸ›’ Buy Mode"}),c.jsx("button",{className:"btn",style:{background:d?"#e65100":"var(--panel-bg)",color:d?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>f(!0),children:"ðŸ’° Sell Mode (25%)"})]}),c.jsxs("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:["Estates ",s&&c.jsx("span",{style:{color:"var(--success-color)",fontSize:"0.8rem"},children:"(Guildmaster Discount Active)"})]}),_t.map((C,F)=>{if(F>0){const _=_t[F-1].id,b=n.buildings[_]||l(0),T=n.buildings[C.id]||l(0);if(C.id==="astral_rift"){if(b.lt(l(100))&&T.eq(l(0)))return null}else if(F>_t.findIndex(x=>x.id==="astral_rift")){if(b.lt(l(20))&&T.eq(l(0)))return null}else if(b.lt(l(10))&&T.eq(l(0)))return null}const N=n.buildings[C.id]||l(0);if(d){if(N.eq(l(0)))return null;let _;a.equals(l(-1))?_=N:(_=a.times(m),_.gt(N)&&(_=N));const b=Dt(C.baseCost,N.minus(_),_).times(l(.25)).floor(),T=v(C.id,C.baseProduction),x=`Sell ${U(_,n.numberFormat)} ${C.name} for ${U(b,n.numberFormat)} gold (25% of last buildings cost)`;return c.jsxs("div",{style:ps(!0,!1,!1,!1),onClick:()=>t(C.id,_.toNumber()),"data-tooltip":x,children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:C.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:C.name}),c.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#e65100"},children:U(N,n.numberFormat)})]}),c.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--success-color)",marginTop:"2px",display:"flex",flexDirection:"column"},children:[c.jsxs("span",{children:["Each: ",U(T,n.numberFormat),"/s"]}),N.gt(l(0))&&c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.9,color:"var(--text-secondary)"},children:["Total: +",U(T.times(N),n.numberFormat),"/s"]})]})]}),c.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[c.jsxs("div",{style:{color:"#e65100",fontWeight:"bold"},children:["+",U(b,n.numberFormat)]}),c.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",U(_,n.numberFormat)]})]})]},C.id)}let P=l(0),q=l(0);a.equals(l(-1))?(P=ua(C.baseCost,N,n.gold.div(o)),P.eq(l(0))?(P=l(1),q=Bu(C.baseCost,N).times(o).floor()):q=Dt(C.baseCost,N,P).times(o).floor()):(P=a,q=Dt(C.baseCost,N,P).times(o).floor());const B=n.gold.gte(q),G=a.equals(l(-1))&&ua(C.baseCost,N,n.gold.div(o)).eq(l(0)),Q=v(C.id,C.baseProduction);let J=P,Z=q,w=B;return a.equals(l(-1))||(J=P.times(m),Z=Dt(C.baseCost,N,J).times(o).floor(),w=n.gold.gte(Z)),c.jsxs("div",{style:ps(w&&!G),onClick:()=>{if(!(w&&!G))return;const _=a.equals(l(-1))?P:J;e(C.id,_.toNumber())},"data-tooltip":`${C.name}: ${C.description}`,children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:C.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:C.name}),c.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"var(--accent-color)"},children:U(N,n.numberFormat)})]}),c.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--success-color)",marginTop:"2px",display:"flex",flexDirection:"column"},children:[c.jsxs("span",{children:["Each: ",U(Q,n.numberFormat),"/s"]}),N.gt(l(0))&&c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.9,color:"var(--text-secondary)"},children:["Total: +",U(Q.times(N),n.numberFormat),"/s"]})]})]}),c.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[c.jsx("div",{style:{color:w&&!G?"#b8860b":"var(--text-secondary)",fontWeight:"bold"},children:U(a.equals(l(-1))?q:Z,n.numberFormat)}),!a.equals(l(-1))&&c.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",U(J,n.numberFormat)]})]})]},C.id)})]})},hd=({gameState:n,onActivateDecree:e})=>{const[t,r]=$.useState(Date.now());return $.useEffect(()=>{const s=setInterval(()=>r(Date.now()),1e3);return()=>clearInterval(s)},[]),c.jsxs("div",{style:gr,children:[c.jsx("div",{style:{marginBottom:"10px",fontSize:"0.9rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Issue Royal Decrees to boost your kingdom."}),Al.map(s=>{const o=l(t),a=n.activeDecrees[s.id]||l(0),d=n.decreeCooldowns[s.id]||l(0),f=s.unlockCondition?!s.unlockCondition(n):!1,m=a.gt(o),y=d.gt(o),v=!m&&!y&&!f;let A="Ready";return f?A="LOCKED":m?A="Active: "+a.minus(o).dividedBy(l(1e3)).ceil().toString()+"s":y&&(A="Wait: "+d.minus(o).dividedBy(l(1e3)).ceil().toString()+"s"),c.jsxs("div",{style:ps(v,m,f),onClick:()=>v&&e(s.id),"data-tooltip":f?`LOCKED: ${s.unlockDescription}`:`${s.name}: ${s.description}`,children:[c.jsx("div",{style:{fontSize:"1.8rem",marginRight:"15px"},children:f?"":s.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold",color:f?"var(--text-secondary)":"var(--text-color)"},children:s.name}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:s.description}),f&&c.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--danger-color)",marginTop:"2px",fontWeight:"bold"},children:["Requirement: ",s.unlockDescription]})]}),c.jsx("div",{style:{textAlign:"right",fontWeight:"bold",color:v?"var(--success-color)":m?"blue":f?"var(--text-secondary)":"var(--danger-color)",minWidth:"80px"},children:A})]},s.id)})]})},fd=({gameState:n,onTrainSoldier:e,onTrainElite:t})=>{const r=(n.buildings.castle||l(0)).gt(l(0)),[s,o]=$.useState(1);return $.useEffect(()=>{const a=m=>{m.ctrlKey?o(10):m.shiftKey?o(100):o(1)},d=m=>a(m),f=m=>a(m);return window.addEventListener("keydown",d),window.addEventListener("keyup",f),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",f)}},[]),c.jsxs("div",{style:gr,children:[c.jsxs("div",{style:{padding:"15px",background:"#e0f2f1",borderRadius:"4px",marginBottom:"10px",border:"1px solid #b2dfdb"},children:[c.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"5px",color:"#004d40"},children:" Royal Army"}),c.jsx("div",{style:{fontSize:"2rem",color:"#004d40"},children:U(n.soldiers,n.numberFormat)}),c.jsx("div",{style:{fontSize:"0.8rem",color:"#00695c"},children:"Basic Soldiers Ready"})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[c.jsxs("button",{className:"btn",disabled:n.gold.lt(Je.times(l(1*s))),onClick:()=>{e(1*s)},children:["Train ",s>1?`${1*s}`:"1"," (",U(Je.times(l(1*s)),n.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:n.gold.lt(Je.times(l(10*s))),onClick:()=>{e(10*s)},children:["Train ",s>1?`${10*s}`:"10"," (",U(Je.times(l(10*s)),n.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:n.gold.lt(Je.times(l(100*s))),onClick:()=>{e(100*s)},children:["Train ",s>1?`${100*s}`:"100"," (",U(Je.times(l(100*s)),n.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:n.gold.lt(Je.times(l(1e3*s))),onClick:()=>{e(1e3*s)},children:["Train ",s>1?`${1e3*s/1e3}K`:"1K"," (",U(Je.times(l(1e3*s)),n.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",style:{gridColumn:"1 / -1",background:"#e65100",borderColor:"#bf360c"},disabled:n.gold.lt(Je.times(l(1e6*s))),onClick:()=>{e(1e6*s)},children:["Train ",s>1?`${1e6*s/1e6}M`:"1M"," (",U(Je.times(l(1e6*s)),n.numberFormat)," G)"]})]}),c.jsxs("div",{style:{borderTop:"2px solid var(--border-color)",paddingTop:"15px"},children:[c.jsxs("h3",{style:{fontSize:"1rem",color:"#4a148c",fontWeight:"bold",marginBottom:"10px"},children:["Royal Academy ",c.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",color:"var(--text-secondary)"},children:"(Convert Soldiers)"})]}),ds.map(a=>{const d=n.eliteUnits[a.id]||l(0),f=l(s),m=a.goldCost.times(f),y=a.soldierCost.times(f),v=n.gold.gte(m)&&n.soldiers.gte(y);return c.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"#f3e5f5",border:"1px solid #7b1fa2",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[c.jsx("div",{style:{fontSize:"2rem"},children:a.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("div",{style:{fontWeight:"bold",color:"#4a148c",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[c.jsxs("span",{children:[a.name," ",c.jsxs("span",{style:{color:"#000"},children:["x",U(d,n.numberFormat)]})]}),c.jsxs("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem",background:v?"#7b1fa2":"#999"},disabled:!v,onClick:()=>t(a.id,s),children:["Train ",s>1?`x${s}`:""]})]}),c.jsx("div",{style:{fontSize:"0.85rem",color:"#4a148c",marginTop:"4px"},children:a.description}),c.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"2px"},children:["Requires ",U(m,n.numberFormat)," Gold and ",U(y,n.numberFormat)," Soldiers"]})]})]},a.id)})]}),c.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:r?"#fff8e1":"#ffebee",border:`1px solid ${r?"#ffb300":"#ef5350"}`,borderRadius:"4px"},children:[c.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:r?"#f57f17":"#c62828"},children:r?"âœ… Orders Received":"âš ï¸ Requirements Missing"}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:r?"Send your army on Crusades via the 'Conquest' menu. Elite units are required for high-level dimensions.":"You have soldiers, but no headquarters! You must build a **Castle** to command your troops."})]})]})},md=({gameState:n,gps:e,onClick:t,onEventInteract:r,onOpenConquest:s,onOpenTavern:o,onOpenPrestige:a,onOpenSettings:d,onOpenCouncil:f,onOpenStatistics:m,onOpenLeaderboard:y,onOpenEmpire:v,isIdle:A})=>{var w,_,b,T;const[C,F]=$.useState([]),N=$.useRef(null),P=n.interface||{showFloatingText:!0,showWeatherWidget:!0},q=x=>{var E;if(P.showFloatingText){const g=(E=N.current)==null?void 0:E.getBoundingClientRect();if(g){const ne=x.clientX-g.left+(Math.random()*40-20),ge=x.clientY-g.top+(Math.random()*40-20);let Ee=l(1);rt.filter(ee=>ee.type==="click"&&n.upgrades.includes(ee.id)).forEach(ee=>{ee.multiplier&&(Ee=Ee.times(ee.multiplier))}),(n.activeDecrees.call_to_arms||l(0)).gt(l(Date.now()))&&(Ee=Ee.times(l(5))),Ee=Ee.times(l(1).plus(n.renown.times(l(.01))));const Ke="+"+U(Ee,n.numberFormat),$e={id:Date.now(),x:ne,y:ge,val:Ke};F(ee=>[...ee,$e]),setTimeout(()=>{F(ee=>ee.filter(nt=>nt.id!==$e.id))},1e3)}}t(x)},B=Tl[((w=n.weather)==null?void 0:w.current)||"clear"],G={transition:"all 0.8s ease-in-out"},Q=A?{position:"fixed",bottom:"120px",right:"30px",transform:"scale(0.8)",transformOrigin:"bottom right",textAlign:"right",zIndex:100,...G}:{transform:"scale(1)",marginBottom:"3rem",zIndex:10,textAlign:"center",...G},J=A?{width:"80px",height:"80px",fontSize:"2rem",position:"fixed",bottom:"30px",right:"30px",borderRadius:"50%",border:"4px solid #b8860b",background:"radial-gradient(circle, #ffd700 0%, #daa520 100%)",boxShadow:"0 0 0 2px #8b4513, 0 5px 10px rgba(0,0,0,0.3)",zIndex:100,transform:"rotate(-10deg)",...G}:{width:"260px",height:"260px",fontSize:"6rem",borderRadius:"50%",border:"8px solid #b8860b",background:"radial-gradient(circle, #ffd700 0%, #daa520 100%)",boxShadow:"0 0 0 4px #8b4513, 0 10px 20px rgba(0,0,0,0.3)",position:"relative",transform:"rotate(0deg)",zIndex:5,...G},Z={opacity:A?0:1,transition:"opacity 0.5s ease-in-out",pointerEvents:A?"none":"auto"};return c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"var(--panel-padding)",height:"100%",overflow:"hidden"},children:[P.showWeatherWidget&&c.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:20,background:B.color,padding:"8px 12px",borderRadius:"20px",border:"2px solid rgba(0,0,0,0.1)",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"8px",cursor:"help",...Z},"data-tooltip":`${B.name}: ${B.description}`,children:[c.jsx("span",{style:{fontSize:"1.5rem"},children:B.icon}),c.jsxs("div",{style:{textAlign:"left",lineHeight:"1.1"},children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#222"},children:B.name}),c.jsxs("div",{style:{fontSize:"0.7rem",color:"#444"},children:[l(Number(((_=n.weather)==null?void 0:_.timeLeft)||0)).ceil().toString(),"s remaining"]})]})]}),c.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:20,display:"flex",gap:"5px",...Z},children:[c.jsx("button",{onClick:y,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.8,color:"var(--text-color)",transition:"all 0.2s ease"},title:"Leaderboard (Available for all players)",onMouseEnter:x=>{x.currentTarget.style.opacity="1",x.currentTarget.style.transform="scale(1.1)"},onMouseLeave:x=>{x.currentTarget.style.opacity="0.8",x.currentTarget.style.transform="scale(1)"},children:"ðŸ†"}),c.jsx("button",{onClick:m,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Statistics",children:"ðŸ“Š"}),c.jsx("button",{onClick:d,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Kingdom Settings",children:"âš™ï¸"})]}),c.jsxs("div",{style:Q,children:[c.jsx("div",{style:{fontSize:"1rem",color:A?"var(--text-color)":"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",letterSpacing:"2px",textShadow:A?"1px 1px 2px #000":"none"},children:"Royal Treasury"}),c.jsx("div",{style:{fontSize:"3rem",fontFamily:"var(--font-main)",color:"var(--text-color)",textShadow:A?"2px 2px 4px #000":"2px 2px 0px rgba(255, 215, 0, 0.4)"},children:U(n.gold,n.numberFormat)}),c.jsxs("div",{style:{marginTop:"5px",fontSize:"1.1rem",color:A?"#90ee90":"var(--success-color)",fontStyle:"italic",textShadow:A?"1px 1px 2px #000":"none"},children:["+",U(e,n.numberFormat)," gold / sec"]}),c.jsxs("div",{style:{marginTop:"15px",padding:"5px 15px",background:A?"rgba(0,0,0,0.5)":"rgba(103, 58, 183, 0.1)",border:"1px solid rgba(103, 58, 183, 0.3)",borderRadius:"20px",display:"inline-block"},children:[c.jsxs("span",{style:{color:A?"#b39ddb":"#673ab7",fontWeight:"bold"},children:["ðŸ‘‘ Renown: ",U(n.renown,n.numberFormat)]}),!A&&c.jsxs("span",{style:{fontSize:"0.8rem",color:"#673ab7",marginLeft:"5px"},children:["(+",n.renown.times(l(1)).floor().toString(),"% Bonus)"]})]})]}),c.jsxs("div",{style:{position:"relative",marginBottom:A?0:"3rem"},children:[c.jsx("button",{ref:N,style:{...J,display:"flex",alignItems:"center",justifyContent:"center",outline:"none",color:"#5d4037",cursor:"pointer"},onClick:q,onMouseDown:x=>!A&&(x.currentTarget.style.transform="scale(0.96)"),onMouseUp:x=>!A&&(x.currentTarget.style.transform="scale(1)"),onMouseLeave:x=>!A&&(x.currentTarget.style.transform="scale(1)"),children:"ðŸ‘‘"}),!A&&C.map(x=>c.jsx("div",{className:"floating-text",style:{left:x.x,top:x.y},children:x.val},x.id))]}),c.jsxs("div",{style:{display:"flex",gap:"10px",zIndex:10,flexWrap:"wrap",justifyContent:"center",...Z},children:[(((b=n.buildings.castle)==null?void 0:b.gt(l(0)))||n.soldiers.gt(l(0)))&&c.jsx("button",{className:"btn",onClick:s,children:"ðŸ—ºï¸ Conquest"}),n.buildings.castle&&n.buildings.castle.gt(l(0))&&c.jsx("button",{className:"btn",style:{background:"#3e2723",borderColor:"#ffd700"},onClick:v,children:"ðŸ‘‘ Empire"}),((T=n.buildings.tavern)==null?void 0:T.gt(l(0)))&&c.jsx("button",{className:"btn",onClick:o,children:"ðŸº Tavern"}),(n.renown.gt(l(0))||n.gold.gt(l(1e5)))&&c.jsx("button",{className:"btn",style:{background:"#4a148c"},onClick:f,children:"âš–ï¸ Council"}),(n.totalGold.gt(l(5e5))||n.renown.gt(l(0)))&&c.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:a,children:"ðŸ‘‘ Legacy"})]}),!A&&n.event&&n.event.type==="dragon"&&c.jsx("div",{className:"dragon-event",onMouseDown:()=>r(n.event),style:{top:"20%"},children:"ðŸ‰"}),!A&&n.event&&n.event.type==="merchant"&&c.jsxs("div",{style:{position:"absolute",right:"20px",top:"100px",background:"#fff3e0",padding:"10px",border:"2px solid orange",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>r(n.event),children:[c.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ‘³"}),c.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Merchant"}),c.jsx("small",{style:{color:"#444"},children:"Click for gift"})]}),!A&&n.event&&n.event.type==="jester"&&c.jsxs("div",{style:{position:"absolute",left:"20px",top:"100px",background:"#fce4ec",padding:"10px",border:"2px solid pink",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>r(n.event),children:[c.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ¤¡"}),c.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Jester"}),c.jsx("small",{style:{color:"#444"},children:"Risk it all?"})]})]})},pd=({gameState:n})=>{var d;const[e,t]=$.useState("all"),r=()=>{const f=hs.sort((m,y)=>{const v=n.achievements.includes(m.id),A=n.achievements.includes(y.id);return v&&!A?-1:!v&&A?1:0});return e==="all"?f:f.filter(m=>e==="buildings"?m.id.startsWith("build_"):e==="clicks"?m.id.startsWith("clicks_"):e==="gold"?m.id.startsWith("gold_"):e==="soldiers"?m.id.startsWith("soldiers_"):e==="renown"?m.id.startsWith("renown_"):e==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(m.id):e==="artifacts"?["all_artifacts","first_artifact","half_artifacts"].includes(m.id):e==="advisors"?["first_advisor","all_advisors","advisor_upgrade"].includes(m.id):e==="trade"?["first_trade","trade_master"].includes(m.id):e==="secret"?["click_master","idle_master"].includes(m.id):e==="combo"?m.id.startsWith("build_")||["first_advisor","all_advisors","advisor_upgrade"].includes(m.id):!0)},s=[{id:"all",name:"All",icon:"ðŸ†"},{id:"buildings",name:"Buildings",icon:"ðŸ—ï¸"},{id:"clicks",name:"Clicks",icon:"ðŸ‘†"},{id:"gold",name:"Gold",icon:"ðŸ’°"},{id:"soldiers",name:"Army",icon:"âš”ï¸"},{id:"renown",name:"Prestige",icon:"ðŸ‘‘"},{id:"wonders",name:"Wonders",icon:"ðŸŒŸ"},{id:"artifacts",name:"Artifacts",icon:"ðŸ…"},{id:"advisors",name:"Advisors",icon:"ðŸ¤´"},{id:"trade",name:"Trade",icon:"ðŸš¢"},{id:"secret",name:"Secret",icon:"ðŸ”"},{id:"combo",name:"Combo",icon:"âš¡"}],o={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(60px, 1fr))",gap:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},a=f=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${f?"var(--gold-color)":"#ccc"}`,background:f?"#fff8e1":"#eee",borderRadius:"4px",opacity:f?1:.3,cursor:f?"help":"default",position:"relative"});return c.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[c.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),c.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:s.map(f=>c.jsxs("button",{onClick:()=>t(f.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${e===f.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:e===f.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:f.name,children:[c.jsx("span",{style:{marginRight:"2px"},children:f.icon}),c.jsx("span",{style:{display:e===f.id?"inline":"none"},children:f.name})]},f.id))}),c.jsx("div",{style:o,children:r().map(f=>{const m=n.achievements.includes(f.id);return c.jsx("div",{style:a(m),"data-tooltip":m?`${f.name}: ${f.description}`:"Locked",children:c.jsx("div",{style:{fontSize:"1.5rem",filter:m?"none":"grayscale(100%)",opacity:m?1:.2},children:m?f.icon:"â“"})},f.id)})}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px",textAlign:"center"},children:[n.achievements.length," / ",hs.length," Unlocked",e!=="all"&&c.jsxs("span",{children:[" | ",r().filter(f=>n.achievements.includes(f.id)).length," / ",r().length," in ",(d=s.find(f=>f.id===e))==null?void 0:d.name]})]})]})},gd=({gameState:n,onStartCrusade:e,onClose:t})=>{var N;const r=n.conquest.active?fs.find(P=>P.id===n.conquest.crusadeId):null,s=n.advisors.includes("warmaster"),o=n.advisorLevels.warmaster||l(0),a=n.advisors.includes("warmaster")?o.toNumber()*.1:0;let d=1-a;n.weather.current==="windy"&&(d=d*.8);const[f,m]=$.useState(0),[y,v]=$.useState(0),A=r&&n.conquest.startTime&&n.conquest.active,C=A&&n.conquest.startTime?l(Date.now()-l(n.conquest.startTime).toNumber()).dividedBy(l(1e3)).gte(l(r.duration).times(l(d))):!1;console.log("Conquest Debug:",{conquestActive:n.conquest.active,crusadeId:n.conquest.crusadeId,startTime:(N=n.conquest.startTime)==null?void 0:N.toNumber(),activeCrusade:r==null?void 0:r.name,isCrusadeActuallyActive:A,isCrusadeExpired:C,speedMult:d,currentTime:Date.now(),elapsed:n.conquest.startTime?(Date.now()-n.conquest.startTime.toNumber())/1e3:"N/A"});const F=yi.useRef(t);return yi.useEffect(()=>{F.current=t},[t]),$.useEffect(()=>{if(console.log("Timer useEffect:",{isCrusadeActuallyActive:A,isCrusadeExpired:C}),A&&!C){console.log("Setting up interval for:",r==null?void 0:r.name);const P=setInterval(()=>{const q=Date.now(),B=l(n.conquest.startTime).toNumber(),G=l(q-B).dividedBy(l(1e3)),Q=l(r.duration).times(l(d)),J=l(100).min(G.dividedBy(Q).times(l(100)));m(J.toNumber());const Z=tt.max(l(0),Q.minus(G)).ceil();v(Z.toNumber()),console.log("Timer update:",{elapsed:G.toNumber(),duration:Q.toNumber(),progress:J.toNumber(),remaining:Z.toNumber()}),Z.lte(0)&&J.gte(100)&&F.current()},1e3);return()=>clearInterval(P)}else m(0),v(0),console.log("Timer reset - no active crusade")},[A,C,r,n.conquest.startTime,d]),c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"600px"},children:[c.jsx("h2",{children:"War Room"}),c.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[n.artifacts.map(P=>{const q=Sn.find(B=>B.id===P);return c.jsx("div",{"data-tooltip":q==null?void 0:q.description,style:{fontSize:"2rem",width:"3.5rem",height:"3.5rem",display:"flex",justifyContent:"center",alignItems:"center",border:"2px solid gold",borderRadius:"50%",background:"rgba(255, 215, 0, 0.1)",flexShrink:0},children:q==null?void 0:q.icon},P)}),n.artifacts.length===0&&c.jsx("span",{style:{color:"var(--text-secondary)"},children:"No artifacts claimed yet."})]}),A&&!C?c.jsxs("div",{style:{textAlign:"center"},children:[c.jsxs("h3",{children:["Current Crusade: ",r.name]}),c.jsx("div",{style:{width:"100%",height:"20px",background:"#ccc",borderRadius:"10px",overflow:"hidden",margin:"20px 0"},children:c.jsx("div",{style:{width:`${f}%`,height:"100%",background:"var(--accent-color)",transition:"width 1s linear"}})}),s&&c.jsx("div",{style:{color:"var(--success-color)",fontSize:"0.8rem",marginBottom:"5px"},children:"Warmaster Active (Faster & Safer)"}),c.jsxs("div",{children:["Time remaining: ",y,"s"]})]}):c.jsx("div",{style:{textAlign:"center",padding:"20px"},children:c.jsx("div",{style:{color:"var(--text-secondary)",marginBottom:"20px"},children:n.conquest.active?"Previous crusade has completed.":"No active crusades at the moment."})}),(!A||C)&&c.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:fs.map(P=>{var E;const q=n.artifacts.includes(P.rewardArtifactId);let B=n.soldiers.gte(l(P.soldierCost)),G=[];if(P.requiredUnits){for(const[g,ne]of Object.entries(P.requiredUnits))if((n.eliteUnits[g]||l(0)).lt(ne)){B=!1;const Ee=((E=ds.find(Ke=>Ke.id===g))==null?void 0:E.name)||g;G.push(`${ne} ${Ee}`)}}const Q=l(P.duration).times(l(d)),J=P.baseRisk||l(0),Z=a*2,w=J.minus(l(Z)),_=l(1).minus(w).times(l(100)).floor();let b="var(--success-color)";w.gt(l(.1))&&(b="orange"),w.gt(l(.3))&&(b="var(--danger-color)");const T=q?"#f0f4c3":"transparent",x=q?"gold":"var(--border-color)";return c.jsxs("div",{style:{border:`1px solid ${x}`,background:T,padding:"10px",marginBottom:"10px",borderRadius:"4px",textAlign:"left",position:"relative"},children:[q&&c.jsx("div",{style:{position:"absolute",top:5,right:5,fontSize:"1.2rem"},children:"ðŸ†"}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:"30px"},children:[c.jsxs("strong",{children:[P.icon," ",P.name]}),c.jsxs("span",{children:[Q.gte(l(3600))?`${Math.floor(Q.toNumber()/3600)}h `:"",Math.floor(Q.toNumber()%3600/60),"m",Q.toNumber()%60>0&&` ${Math.floor(Q.toNumber()%60)}s`]})]}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:P.description}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"0.85rem"},children:[c.jsxs("div",{children:["Cost: ",c.jsxs("strong",{children:[U(P.soldierCost,n.numberFormat)," Soldiers"]})]}),c.jsxs("div",{style:{color:b,fontWeight:"bold"},children:["Success Chance: ",_.toString(),"%"]})]}),P.requiredUnits&&c.jsxs("div",{style:{fontSize:"0.8rem",marginTop:"5px",color:G.length>0?"var(--danger-color)":"var(--success-color)"},children:["Requires: ",Object.entries(P.requiredUnits).map(([g,ne])=>{var Ke;const ge=((Ke=ds.find($e=>$e.id===g))==null?void 0:Ke.name)||g,Ee=n.eliteUnits[g]||l(0);return`${ge} (${Ee.toString()}/${ne.toString()}) `})]}),w.gt(l(0))&&c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"2px"},children:"Failure refunds 50% soldiers."}),c.jsx("button",{className:"btn",style:{width:"100%",marginTop:"5px",background:q?"#827717":"var(--accent-color)"},disabled:!B,onClick:()=>e(P.id),children:q?"Replay Mission (Critical Chance)":"Start Campaign"})]},P.id)})}),c.jsx("button",{className:"btn",onClick:t,style:{marginTop:"20px"},children:"Close"})]})})},yd=({gameState:n,onGamble:e,onClose:t})=>{const[r,s]=$.useState("coin"),[o,a]=$.useState(10),[d,f]=$.useState(""),[m,y]=$.useState(null),v=()=>{if(n.gold.lt(l(o))){f("Not enough gold!");return}const C=Math.random()>.5;e(o,C),f(C?`Heads! You DOUBLED your money! (+${U(o,n.numberFormat)} Profit)`:`Tails... You lost ${U(o,n.numberFormat)} gold.`),y(null)},A=()=>{if(n.gold.lt(l(o))){f("Not enough gold!");return}const C=Math.floor(Math.random()*6)+1,F=Math.floor(Math.random()*6)+1,N=C+F;y(N);let P=0;if(N===7)f(`Rolled ${N}. A draw! Gold returned.`),e(0,!0);else if(N>7){N>=10?P=2:P=1.5;const q=Math.floor(o*P);e(q,!0),f(`Rolled ${N}! You won ${U(q,n.numberFormat)} gold!`)}else e(o,!1),f(`Rolled ${N}. You lost ${U(o,n.numberFormat)} gold.`)};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{minHeight:"450px"},children:[c.jsx("h2",{style:{borderBottom:"none"},children:"ðŸº The Rusty Tankard"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[c.jsx("button",{className:"btn ",style:{opacity:r==="coin"?1:.6},onClick:()=>s("coin"),children:"Coin Flip"}),c.jsx("button",{className:"btn ",style:{opacity:r==="dice"?1:.6},onClick:()=>s("dice"),children:"High Dice"})]}),c.jsxs("div",{style:{background:"#f9fbe7",padding:"20px",borderRadius:"8px",border:"1px solid #c0ca33"},children:[r==="coin"?c.jsxs("div",{style:{textAlign:"left",background:"rgba(255,255,255,0.5)",padding:"10px",borderRadius:"4px"},children:[c.jsx("strong",{children:"Rules:"}),c.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:[c.jsx("li",{children:"50% Chance to Win."}),c.jsxs("li",{children:["Win: ",c.jsx("strong",{children:"+100% Profit"})," (Doubles your money)."]}),c.jsx("li",{children:"Lose: Lost the bet."})]})]}):c.jsxs("div",{style:{textAlign:"left",background:"rgba(255,255,255,0.5)",padding:"10px",borderRadius:"4px"},children:[c.jsx("strong",{children:"Dice Rules (Roll 2-12):"}),c.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:[c.jsxs("li",{children:[c.jsx("strong",{children:"7:"})," Draw (Bet returned)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"8-9:"})," Win +50% Profit (1.5x)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"10-12:"})," Win +100% Profit (2x)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"2-6:"})," Loss"]})]})]}),c.jsxs("div",{style:{margin:"20px 0"},children:[c.jsx("label",{children:"Bet Amount: "}),c.jsx("input",{type:"number",value:o,onChange:C=>a(Math.max(1,parseInt(C.target.value)||0)),style:{padding:"8px",width:"120px",fontSize:"1rem",border:"1px solid #aaa"}})]}),r==="dice"&&m!==null&&c.jsxs("div",{style:{fontSize:"3rem",margin:"10px"},children:["ðŸŽ² ",m]}),c.jsx("button",{className:"btn",style:{fontSize:"1.2rem",padding:"10px 30px"},onClick:r==="coin"?v:A,children:r==="coin"?"Flip Coin":"Roll Dice"}),d&&c.jsx("div",{style:{marginTop:"15px",fontWeight:"bold",fontSize:"1.1rem",color:d.includes("won")||d.includes("DOUBLED")||d.includes("draw")?"green":"red"},children:d})]}),c.jsx("div",{style:{marginTop:"30px"},children:c.jsx("button",{className:"btn",style:{backgroundColor:"#5d4037"},onClick:t,children:"Leave Tavern"})})]})})},_d=({gameState:n,onPrestige:e,onClose:t})=>{var m;const r=n.advisorLevels.void_scholar||l(0),o=1+(n.advisors.includes("void_scholar")?r.toNumber()*.1:0),a=n.gold.dividedBy(l(1e12)).times(o),d=Math.max(0,Math.min(Math.floor(a.toNumber()),1e4)),f=n.gold.gte(l(1e12));return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[c.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),c.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((m=n.playerProfile)!=null&&m.hasChosenName)&&c.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",c.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),c.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[c.jsx("div",{children:c.jsx("strong",{children:"You will lose:"})}),c.jsxs("ul",{children:[c.jsx("li",{children:"All Gold"}),c.jsx("li",{children:"All Buildings"}),c.jsx("li",{children:"All Gold Upgrades"}),c.jsx("li",{children:"Current Soldiers"})]}),c.jsx("div",{children:c.jsx("strong",{children:"You will keep:"})}),c.jsxs("ul",{children:[c.jsx("li",{children:"Achievements"}),c.jsx("li",{children:"Artifacts"}),c.jsxs("li",{children:["Current Renown (",U(n.renown,n.numberFormat),")"]}),c.jsx("li",{children:"All Renown Upgrades (Permanent)"})]})]}),c.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[c.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["Requirement: 1 Renown per 1,000,000,000,000 Current Gold (",U(n.gold,n.numberFormat),")"]}),"You will gain: ",c.jsxs("strong",{children:[U(d,n.numberFormat)," Renown"]}),c.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["(New Total Bonus: +",U((n.renown.toNumber()+d)*1,n.numberFormat),"%)"]})]}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[c.jsx("button",{className:"btn",style:{background:"#666"},onClick:t,children:"Cancel"}),c.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:e,disabled:!f,children:f?"Abdicate":`Need ${U(l(1e12).minus(n.gold),n.numberFormat)} more Gold`})]})]})})},vd=({gameState:n,onClose:e,onHardReset:t,onSave:r,onOpenChangelog:s,onSetTheme:o,onSetNumberFormat:a,onToggleIdleMode:d,onUpdateInterface:f})=>{var Ke,$e,ee,nt;const[m,y]=yi.useState(!1),v=n.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,layout:{left:1,center:1,right:1},borderWidth:4,customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},A=(Ke=v.layout.left)!=null&&Ke.toNumber?v.layout.left.toNumber():Number(v.layout.left),C=($e=v.layout.center)!=null&&$e.toNumber?v.layout.center.toNumber():Number(v.layout.center),F=(ee=v.layout.right)!=null&&ee.toNumber?v.layout.right.toNumber():Number(v.layout.right),N=(nt=v.borderWidth)!=null&&nt.toNumber?v.borderWidth.toNumber():Number(v.borderWidth),P=v.customColors||{},q=String(P.bg||""),B=String(P.panel||""),G=String(P.text||""),Q=String(P.secondaryText||""),J=String(P.accent||""),Z=String(P.accentHover||""),w=String(P.gold||""),_=String(P.border||""),b=String(P.success||""),T=String(P.danger||""),x=()=>{m?t():y(!0)},E=(X,Ge)=>{f({layout:{...v.layout,[X]:Ge}})},g=(X,Ge)=>{f({customColors:{...v.customColors,[X]:Ge}})},ne={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},ge={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},Ee={width:"100%",marginBottom:"5px"};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",children:[c.jsx("h2",{children:"âš™ï¸ Royal Settings"}),n.playerProfile&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[c.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",n.playerProfile.rulerName," ",n.playerProfile.rulerId]}),c.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),c.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[c.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),c.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:A,onChange:X=>E("left",parseFloat(X.target.value)),style:Ee}),c.jsx("span",{style:{fontSize:"0.8rem"},children:A})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:C,onChange:X=>E("center",parseFloat(X.target.value)),style:Ee}),c.jsx("span",{style:{fontSize:"0.8rem"},children:C})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:F,onChange:X=>E("right",parseFloat(X.target.value)),style:Ee}),c.jsx("span",{style:{fontSize:"0.8rem"},children:F})]})]}),c.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),c.jsxs("div",{style:ge,children:[c.jsx("div",{children:c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[c.jsx("input",{type:"range",min:"1",max:"10",value:N,onChange:X=>f({borderWidth:parseInt(X.target.value)})}),c.jsxs("span",{children:[N,"px"]})]})]}),c.jsxs("div",{style:ge,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),c.jsx("input",{type:"checkbox",checked:v.customColors.enabled,onChange:X=>g("enabled",X.target.checked),style:{transform:"scale(1.5)"}})]}),v.customColors.enabled&&c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",c.jsx("input",{type:"color",value:q,onChange:X=>g("bg",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",c.jsx("input",{type:"color",value:B,onChange:X=>g("panel",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",c.jsx("input",{type:"color",value:_,onChange:X=>g("border",X.target.value),style:{width:"100%"}})]}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",c.jsx("input",{type:"color",value:G,onChange:X=>g("text",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",c.jsx("input",{type:"color",value:Q,onChange:X=>g("secondaryText",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",c.jsx("input",{type:"color",value:w,onChange:X=>g("gold",X.target.value),style:{width:"100%"}})]}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",c.jsx("input",{type:"color",value:J,onChange:X=>g("accent",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",c.jsx("input",{type:"color",value:Z,onChange:X=>g("accentHover",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",c.jsx("input",{type:"color",value:b,onChange:X=>g("success",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",c.jsx("input",{type:"color",value:T,onChange:X=>g("danger",X.target.value),style:{width:"100%"}})]})]}),c.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),c.jsxs("div",{style:{marginBottom:"15px",opacity:v.customColors.enabled?.5:1,pointerEvents:v.customColors.enabled?"none":"auto"},children:[c.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",v.customColors.enabled&&"(Disabled)"]}),c.jsx("div",{style:ne,children:Object.values(_i).map(X=>c.jsx("button",{className:"btn",style:{background:n.theme===X.id?"var(--accent-color)":"var(--panel-bg)",color:n.theme===X.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>o(X.id),children:X.name},X.id))})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),c.jsx("div",{style:ne,children:["small","medium","large"].map(X=>c.jsx("button",{className:"btn",style:{background:v.fontSize===X?"var(--accent-color)":"var(--panel-bg)",color:v.fontSize===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>f({fontSize:X}),children:X},X))})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),c.jsx("div",{style:ne,children:["compact","normal","spacious"].map(X=>c.jsx("button",{className:"btn",style:{background:v.density===X?"var(--accent-color)":"var(--panel-bg)",color:v.density===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>f({density:X}),children:X},X))})]}),c.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),c.jsxs("div",{style:ge,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),c.jsx("button",{className:"btn",style:{background:n.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:d,children:n.idleModeEnabled?"ON":"OFF"})]}),c.jsxs("div",{style:ge,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),c.jsx("button",{className:"btn",style:{background:v.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>f({showFloatingText:!v.showFloatingText}),children:v.showFloatingText?"ON":"OFF"})]}),c.jsxs("div",{style:ge,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),c.jsx("button",{className:"btn",style:{background:v.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>f({showWeatherWidget:!v.showWeatherWidget}),children:v.showWeatherWidget?"ON":"OFF"})]}),c.jsxs("div",{style:ge,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),c.jsx("button",{className:"btn",style:{background:v.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>f({reduceMotion:!v.reduceMotion}),children:v.reduceMotion?"ON":"OFF"})]}),c.jsxs("div",{style:{marginTop:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),c.jsx("div",{style:ne,children:["standard","scientific","plain"].map(X=>c.jsx("button",{className:"btn",style:{background:n.numberFormat===X?"var(--accent-color)":"var(--panel-bg)",color:n.numberFormat===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>a(X),children:X},X))})]})]}),c.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[c.jsx("h3",{children:"System"}),c.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[c.jsx("button",{className:"btn",onClick:r,children:"Force Save"}),c.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:s,children:"Update Logs"}),c.jsx("button",{className:"btn",style:{backgroundColor:m?"red":"#d32f2f"},onClick:x,children:m?"CONFIRM WIPE?":"Hard Reset"})]}),m&&c.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),c.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:e,children:"Return to Game"}),c.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},bd=({onClose:n})=>c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[c.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),c.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:ca.map((e,t)=>c.jsxs("div",{style:{marginBottom:"20px",borderBottom:t<ca.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[c.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",e.version]}),c.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:e.date})]}),c.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:e.changes.map((r,s)=>c.jsx("li",{style:{marginBottom:"3px"},children:r},s))})]},e.version))}),c.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:n,children:"Close Chronicles"})]})}),xd=({gameState:n,onHireAdvisor:e,onClose:t})=>c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{border:"4px double #4a148c",maxWidth:"900px"},children:[c.jsx("h2",{style:{color:"#4a148c",borderBottomColor:"#4a148c"},children:"âš–ï¸ Royal Council"}),c.jsxs("div",{style:{marginBottom:"15px",color:"var(--text-secondary)",fontStyle:"italic"},children:["Hire permanent advisors with Renown. ",c.jsx("br",{}),"These buffs persist across abdications. Advisors can be upgraded for better effects."]}),c.jsxs("div",{style:{background:"rgba(103, 58, 183, 0.1)",padding:"10px",borderRadius:"4px",marginBottom:"20px",fontWeight:"bold",color:"#4a148c"},children:["Available Renown: ",U(n.renown,n.numberFormat)," ðŸ‘‘"]}),c.jsxs("div",{style:{marginBottom:"30px"},children:[c.jsx("h3",{style:{color:"#4a148c",marginBottom:"10px"},children:"ðŸ‘¥ Royal Advisors"}),c.jsx("div",{style:{display:"grid",gap:"10px",maxHeight:"350px",overflowY:"auto"},children:Il.map(r=>{const s=n.advisors.includes(r.id),o=n.advisorLevels[r.id]||l(0),a=Cl(r,o),d=!s&&n.renown.gte(r.cost),f=s&&n.renown.gte(a),m=Pt(r.id,o);return c.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:`2px solid ${s?"#4a148c":"var(--border-color)"}`,background:s?"rgba(237, 231, 246, 0.5)":"var(--panel-bg)",borderRadius:"8px",opacity:s||d?1:.6},children:[c.jsx("div",{style:{fontSize:"2.5rem",marginRight:"15px"},children:r.icon}),c.jsxs("div",{style:{flex:1,textAlign:"left"},children:[c.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:s?"#4a148c":"var(--text-color)"},children:[r.name," ",s&&`(Level ${U(o,n.numberFormat)})`]}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:r.description}),s&&c.jsxs("div",{style:{fontSize:"0.8rem",color:"#4a148c",marginTop:"5px"},children:[r.id==="treasurer"&&`Auto-clicks every ${Math.max(1,5-o.toNumber())} seconds`,r.id==="warmaster"&&`Speed: +${U(m.times(l(100)),n.numberFormat)}%, Safety: +${U(m.times(l(100)),n.numberFormat)}%`,r.id==="guildmaster"&&`Discount: ${U(m.times(l(100)),n.numberFormat)}%`,r.id==="alchemist"&&`Event chance: x${U(m.plus(l(1)),n.numberFormat)}`,(r.id==="chronomancer"||r.id==="time_keeper")&&`Cooldown reduction: ${U(m.times(l(100)),n.numberFormat)}%`,r.id==="void_scholar"&&`Renown bonus: +${U(m.times(l(100)),n.numberFormat)}%`,r.id==="cosmic_mage"&&`Production bonus: +${U(m.times(l(100)),n.numberFormat)}%`]})]}),c.jsx("div",{style:{minWidth:"120px",textAlign:"right"},children:s?c.jsxs("button",{className:"btn",style:{background:f?"#4a148c":"var(--text-secondary)",fontSize:"0.8rem"},disabled:!f,onClick:()=>e(r.id),children:["Upgrade: ",U(a,n.numberFormat)," ðŸ‘‘"]}):c.jsxs("button",{className:"btn",style:{background:d?"#4a148c":"var(--text-secondary)"},disabled:!d,onClick:()=>e(r.id),children:["Hire: ",U(r.cost,n.numberFormat)," ðŸ‘‘"]})})]},r.id)})})]}),c.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037"},onClick:t,children:"Close Council"})]})}),wd=({gameState:n,currentGps:e,onClose:t})=>{var G;const r=Object.values(n.buildings).reduce((Q,J)=>Q.plus(J),l(0)),s=n.upgrades.length,o=rt.length,a=n.achievements.length,d=hs.length;let f="None",m="None",y=-1,v=l(0);_t.forEach((Q,J)=>{const Z=n.buildings[Q.id]||l(0);Z.gt(l(0))&&J>y&&(y=J,f=Q.name),Z.gt(v)&&(v=Z,m=Q.name)});const C=(()=>{let Q=l(1);return rt.filter(J=>J.type==="click"&&n.upgrades.includes(J.id)).forEach(J=>{J.multiplier&&(Q=Q.times(J.multiplier))}),(n.activeDecrees.call_to_arms||l(0)).gt(l(Date.now()))&&(Q=Q.times(l(5))),Q=Q.times(l(1).plus(n.renown.times(l(.01)))),Q})(),[F,N]=$.useState("");$.useEffect(()=>{const Q=()=>{const Z=l(Date.now()).minus(n.startTime),w=Z.dividedBy(l(1e3)),_=w.minus(w.dividedBy(l(60)).floor().times(l(60))).floor(),b=Z.dividedBy(l(6e4)),T=b.minus(b.dividedBy(l(60)).floor().times(l(60))).floor(),x=Z.dividedBy(l(36e5)),E=x.minus(x.dividedBy(l(24)).floor().times(l(24))).floor(),g=Z.dividedBy(l(864e5)).floor();let ne="";g.gt(l(0))&&(ne+=`${g.toString()}d `),E.gt(l(0))&&(ne+=`${E.toString()}h `),ne+=`${T.toString()}m ${_.toString()}s`,N(ne)};Q();const J=setInterval(Q,1e3);return()=>clearInterval(J)},[n.startTime]);const P={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},q={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},B=((G=Tl[n.weather.current])==null?void 0:G.name)||"Unknown";return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"500px"},children:[c.jsx("h2",{children:"ðŸ“Š Royal Records"}),c.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"10px"},children:[c.jsx("h3",{style:q,children:"âš¡ Current Status"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Gold Per Second:"}),c.jsxs("strong",{style:{color:"var(--success-color)"},children:[U(e,n.numberFormat)," / sec"]})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Click Power:"}),c.jsxs("strong",{style:{color:"var(--success-color)"},children:[U(C,n.numberFormat)," / click"]})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Current Weather:"}),c.jsx("strong",{children:B})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Renown Bonus:"}),c.jsxs("strong",{style:{color:"#673ab7"},children:["+",n.renown.times(l(1)).floor().toString(),"%"]})]}),c.jsx("h3",{style:q,children:"â³ Time & Legacy"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Time Played:"}),c.jsx("strong",{children:F})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Kingdom Founded:"}),c.jsx("span",{children:new Date(n.startTime.toNumber()).toLocaleDateString()})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Total Renown:"}),c.jsx("strong",{children:U(n.renown,n.numberFormat)})]}),c.jsx("h3",{style:q,children:"ðŸ’° Economy Summary"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Current Gold:"}),c.jsx("strong",{children:U(n.gold,n.numberFormat)})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Lifetime Gold:"}),c.jsx("strong",{children:U(n.totalGold,n.numberFormat)})]}),c.jsx("h3",{style:q,children:"ðŸ° Dominion"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Total Buildings:"}),c.jsx("strong",{children:U(r,n.numberFormat)})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Highest Tech Building:"}),c.jsx("strong",{children:f})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Most Numerous:"}),c.jsxs("strong",{children:[m," (",U(v,n.numberFormat),")"]})]}),c.jsx("h3",{style:q,children:"ðŸŽ–ï¸ Completion"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Achievements:"}),c.jsxs("span",{children:[a," / ",d," (",Math.floor(a/d*100),"%)"]})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Upgrades:"}),c.jsxs("span",{children:[s," / ",o," (",Math.floor(s/o*100),"%)"]})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Artifacts:"}),c.jsxs("span",{children:[n.artifacts.length," Found"]})]}),c.jsx("h3",{style:q,children:"âš”ï¸ Military & Court"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Standing Army:"}),c.jsxs("strong",{children:[U(n.soldiers,n.numberFormat)," Soldiers"]})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Royal Advisors:"}),c.jsxs("span",{children:[n.advisors.length," Hired"]})]}),c.jsx("h3",{style:q,children:"ðŸ“ˆ Player Stats"}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Manual Clicks:"}),c.jsx("span",{children:U(n.stats.totalClicks,n.numberFormat)})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Dragons Slain:"}),c.jsx("span",{children:U(n.stats.dragonsKilled,n.numberFormat)})]}),c.jsxs("div",{style:P,children:[c.jsx("span",{children:"Tavern Games:"}),c.jsx("span",{children:U(n.stats.tavernGamesPlayed,n.numberFormat)})]})]}),c.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%"},onClick:t,children:"Close Records"})]})})},Ed=({gameState:n,onInvestTrade:e,onBuildWonder:t,onClose:r})=>{const[s,o]=$.useState("trade"),a=(n.wonders.great_pyramid||0)>=3;return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"800px",width:"95%",height:"80vh",display:"flex",flexDirection:"column",padding:"0"},children:[c.jsxs("div",{style:{padding:"20px",background:"#3e2723",color:"#fff"},children:[c.jsx("h2",{style:{margin:0,border:"none",color:"#ffd700"},children:"ðŸ‘‘ Imperial Management"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"15px"},children:[c.jsx("button",{className:"tab-btn",style:{background:s==="trade"?"#ffd700":"rgba(255,255,255,0.1)",color:s==="trade"?"#000":"#fff"},onClick:()=>o("trade"),children:"Trade Routes"}),c.jsx("button",{className:"tab-btn",style:{background:s==="wonders"?"#ffd700":"rgba(255,255,255,0.1)",color:s==="wonders"?"#000":"#fff"},onClick:()=>o("wonders"),children:"Great Wonders"})]})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[s==="trade"&&c.jsx(Td,{gameState:n,onInvestTrade:e,hasPyramid:a}),s==="wonders"&&c.jsx(Ad,{gameState:n,onBuildWonder:t})]}),c.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:c.jsx("button",{className:"btn",onClick:r,children:"Return to Kingdom"})})]})})},Td=({gameState:n,onInvestTrade:e,hasPyramid:t})=>{var F,N,P,q;const[r,s]=$.useState(null),[o,a]=$.useState(0),[d,f]=$.useState(0),[m,y]=$.useState(0),v=n.activeTradeRoutes||[],A=()=>{r&&(e(r.id,o,d,{knight:m}),s(null),a(0),f(0),y(0))},C=B=>{const G=l(d).plus(l(m).times(l(50))),Q=l(Math.max(100,o/100)),J=l(Math.min(.9,G.dividedBy(Q).toNumber()));let Z=B.risk.times(l(1).minus(J));return t&&(Z=Z.times(l(.5))),Z};return c.jsxs("div",{children:[c.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Active Caravans"}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"10px",marginBottom:"30px"},children:[v.length===0&&c.jsx("div",{style:{color:"var(--text-secondary)"},children:"No active trade routes."}),v.map(B=>{var _,b;const G=ms.find(T=>T.id===B.routeId);if(!G)return null;const Q=(_=B.startTime)!=null&&_.toNumber?B.startTime.toNumber():Number(B.startTime),J=(b=B.duration)!=null&&b.toNumber?B.duration.toNumber():Number(B.duration),Z=(Date.now()-Q)/1e3,w=Math.min(100,Z/J*100);return c.jsxs("div",{style:{padding:"10px",border:"1px solid var(--accent-color)",borderRadius:"4px",background:"#fff"},children:[c.jsxs("div",{style:{fontWeight:"bold"},children:[G.icon," ",G.name]}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["Invested: ",U(B.goldInvested,n.numberFormat)]}),c.jsx("div",{style:{width:"100%",height:"10px",background:"#eee",marginTop:"5px",borderRadius:"5px"},children:c.jsx("div",{style:{width:`${w}%`,height:"100%",background:"var(--success-color)",borderRadius:"5px",transition:"width 1s linear"}})}),c.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem"},children:[Math.ceil(J-Z),"s left"]})]},B.id)})]}),c.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Establish New Route"}),r?c.jsxs("div",{style:{padding:"20px",border:"2px solid var(--accent-color)",borderRadius:"8px",background:"#f9fbe7"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[c.jsxs("h4",{style:{margin:0},children:[r.icon," ",r.name]}),c.jsx("button",{className:"btn",style:{background:"#999",padding:"5px 10px",fontSize:"0.8rem"},onClick:()=>s(null),children:"Cancel"})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsxs("label",{style:{display:"block",fontWeight:"bold"},children:["Gold Investment (Max ",U(r.maxInvestment,n.numberFormat),")"]}),c.jsx("input",{type:"range",min:"0",max:Math.min((F=n.gold)!=null&&F.toNumber?n.gold.toNumber():Number(n.gold),(N=r.maxInvestment)!=null&&N.toNumber?r.maxInvestment.toNumber():Number(r.maxInvestment)),value:o,onChange:B=>a(parseInt(B.target.value)),style:{width:"100%"}}),c.jsxs("div",{style:{textAlign:"right"},children:[U(o,n.numberFormat)," G"]})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"15px"},children:[c.jsxs("div",{children:[c.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Soldier Escort"}),c.jsx("input",{type:"number",min:"0",max:(P=n.soldiers)!=null&&P.toNumber?n.soldiers.toNumber():Number(n.soldiers),value:d,onChange:B=>f(parseInt(B.target.value)),style:{width:"100%",padding:"5px"}}),c.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",U(n.soldiers,n.numberFormat)]})]}),c.jsxs("div",{children:[c.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Knight Escort"}),c.jsx("input",{type:"number",min:"0",max:(q=n.eliteUnits.knight)!=null&&q.toNumber?n.eliteUnits.knight.toNumber():Number(n.eliteUnits.knight||0),value:m,onChange:B=>y(parseInt(B.target.value)),style:{width:"100%",padding:"5px"}}),c.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",U(n.eliteUnits.knight||0,n.numberFormat)]})]})]}),c.jsxs("div",{style:{background:"#fff",padding:"10px",borderRadius:"4px",marginBottom:"15px"},children:[c.jsxs("div",{children:[c.jsx("strong",{children:"Projected Return:"})," ",U(l(o).times(r.rewardMultiplier),n.numberFormat)," G"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Duration:"})," ",(()=>{var Q;const B=(Q=r.baseDuration)!=null&&Q.toNumber?r.baseDuration.toNumber():Number(r.baseDuration),G=t?B*.5:B;return Math.ceil(G)/60})()," min"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Risk:"})," ",c.jsxs("span",{style:{color:C(r).gt(l(.3))?"red":"green"},children:[C(r).times(l(100)).toFixed(1),"%"]})]})]}),c.jsx("button",{className:"btn",style:{width:"100%"},disabled:o<=0||d===0&&m===0,onClick:A,children:"Dispatch Caravan"})]}):c.jsx("div",{style:{display:"grid",gap:"10px"},children:ms.map(B=>c.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:"1px solid var(--border-color)",borderRadius:"4px",cursor:"pointer",background:"#fff"},onClick:()=>s(B),children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px"},children:B.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold"},children:B.name}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:B.description}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"green"},children:["Max Profit: ",U(B.rewardMultiplier,n.numberFormat),"x"]})]}),c.jsx("button",{className:"btn",style:{fontSize:"0.8rem"},children:"Select"})]},B.id))})]})},Ad=({gameState:n,onBuildWonder:e})=>{const t=s=>{for(const o of s)if(o.type==="gold"&&n.gold.lt(l(o.amount))||o.type==="soldiers"&&n.soldiers.lt(l(o.amount))||o.type==="renown"&&n.renown.lt(l(o.amount))||["knight","paladin","void_sentinel"].includes(o.type)&&(n.eliteUnits[o.type]||l(0)).lt(l(o.amount)))return!1;return!0},r=s=>s.map((o,a)=>c.jsxs("span",{style:{marginRight:"10px",color:t([o])?"green":"red"},children:[U(o.amount,n.numberFormat)," ",o.type==="gold"?"G":o.type]},a));return c.jsx("div",{style:{display:"grid",gap:"20px"},children:Rl.map(s=>{const o=n.wonders[s.id]||0,a=o>=s.stages.length,d=a?null:s.stages[o],f=d?t(d.cost):!1;return c.jsxs("div",{style:{border:"2px solid var(--accent-color)",borderRadius:"8px",overflow:"hidden"},children:[c.jsxs("div",{style:{background:a?"gold":"#f0f4c3",padding:"15px",display:"flex",alignItems:"center"},children:[c.jsx("div",{style:{fontSize:"3rem",marginRight:"15px"},children:s.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:0,color:"#333"},children:s.name}),c.jsx("div",{style:{fontSize:"0.9rem"},children:s.description}),c.jsxs("div",{style:{marginTop:"5px",fontWeight:"bold",color:"#4a148c"},children:["Bonus: ",s.bonusDescription]})]}),c.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:a?"COMPLETED":`${o} / ${s.stages.length}`})]}),!a&&d&&c.jsxs("div",{style:{padding:"15px",background:"#fff"},children:[c.jsxs("h4",{style:{marginTop:0},children:["Next Stage: ",d.name]}),c.jsx("p",{style:{fontSize:"0.9rem",color:"#666"},children:d.description}),c.jsxs("div",{style:{background:"#eee",padding:"10px",borderRadius:"4px",marginBottom:"15px"},children:[c.jsx("strong",{children:"Requirements: "}),r(d.cost)]}),c.jsx("button",{className:"btn",style:{width:"100%",background:f?"var(--accent-color)":"#999"},disabled:!f,onClick:()=>e(s.id),children:"Construct Stage"})]}),a&&c.jsx("div",{style:{padding:"10px",background:"#fff8e1",textAlign:"center",color:"orange",fontWeight:"bold"},children:"This Wonder stands eternal."})]},s.id)})})},Id=({toasts:n})=>c.jsx("div",{className:"toast-container",children:n.map(e=>c.jsxs("div",{className:`toast ${e.type}`,children:[e.type==="success"&&"âœ…",e.type==="warning"&&"âš ï¸",e.type==="info"&&"â„¹ï¸",e.type==="error"&&"âŒ",c.jsx("span",{children:e.message})]},e.id))}),Cd=()=>{const[n,e]=$.useState(null);if($.useEffect(()=>{const r=a=>{const f=a.target.closest("[data-tooltip]");if(f){const m=f.getAttribute("data-tooltip");m&&e({text:m,x:a.clientX,y:a.clientY})}else e(null)},s=a=>{n&&e(d=>d?{...d,x:a.clientX,y:a.clientY}:null)},o=()=>{e(null)};return document.addEventListener("mouseover",r),document.addEventListener("mousemove",s),document.addEventListener("mouseout",o),()=>{document.removeEventListener("mouseover",r),document.removeEventListener("mousemove",s),document.removeEventListener("mouseout",o)}},[n]),!n)return null;const t={left:n.x+15,top:n.y+15};return n.x+250>window.innerWidth&&(t.left=n.x-260),n.y+100>window.innerHeight&&(t.top=n.y-50),c.jsx("div",{className:"game-tooltip",style:t,children:n.text})},Rd=({gameState:n})=>{const{weather:e,buildings:t,totalGold:r}=n,s=A=>t[A]||0;let o="wilderness";s("palace")>0?o="empire":s("castle")>0||s("market")>0?o="city":(s("peasant")>20||s("field")>10||r>500)&&(o="hamlet");let a="",d="";switch(o){case"wilderness":a="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",d="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":a="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",d="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":a="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",d="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":a="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",d="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const f=e.current;let m="none",y="",v=0;return f==="rainy"?(m="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",y="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",v=1):f==="stormy"?(m="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",y="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",v=1):f==="sunny"?(m="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",y="â˜€ï¸",v=.6):f==="windy"&&(y="ðŸƒ ðŸƒ ðŸƒ",v=.8),c.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:a,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[c.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:v,animation:f==="windy"?"float 3s infinite ease-in-out":"none"},children:y}),m!=="none"&&c.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:m,pointerEvents:"none"}}),c.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:d}),c.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),c.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},Sd=()=>{};var da={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Pd=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],d=n[t++],f=((s&7)<<18|(o&63)<<12|(a&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Pl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,d=a?n[s+1]:0,f=s+2<n.length,m=f?n[s+2]:0,y=o>>2,v=(o&3)<<4|d>>4;let A=(d&15)<<2|m>>6,C=m&63;f||(C=64,a||(A=64)),r.push(t[y],t[v],t[A],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Sl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Pd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],d=s<n.length?t[n.charAt(s)]:0;++s;const m=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||d==null||m==null||v==null)throw new kd;const A=o<<2|d>>4;if(r.push(A),m!==64){const C=d<<4&240|m>>2;if(r.push(C),v!==64){const F=m<<6&192|v;r.push(F)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class kd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Dd=function(n){const e=Sl(n);return Pl.encodeByteArray(e,!0)},gs=function(n){return Dd(n).replace(/\./g,"")},Vd=function(n){try{return Pl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jd=()=>Nd().__FIREBASE_DEFAULTS__,Md=()=>{if(typeof process>"u"||typeof da>"u")return;const n=da.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ld=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Vd(n[1]);return e&&JSON.parse(e)},Bi=()=>{try{return Sd()||jd()||Md()||Ld()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Od=n=>{var e,t;return(t=(e=Bi())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Fd=n=>{const e=Od(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},kl=()=>{var n;return(n=Bi())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ud(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[gs(JSON.stringify(t)),gs(JSON.stringify(a)),""].join(".")}const ur={};function qd(){const n={prod:[],emulator:[]};for(const e of Object.keys(ur))ur[e]?n.emulator.push(e):n.prod.push(e);return n}function $d(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ha=!1;function Gd(n,e){if(typeof window>"u"||typeof document>"u"||!Ui(window.location.host)||ur[n]===e||ur[n]||ha)return;ur[n]=e;function t(A){return`__firebase__banner__${A}`}const r="__firebase__banner",o=qd().prod.length>0;function a(){const A=document.getElementById(r);A&&A.remove()}function d(A){A.style.display="flex",A.style.background="#7faaf0",A.style.position="fixed",A.style.bottom="5px",A.style.left="5px",A.style.padding=".5em",A.style.borderRadius="5px",A.style.alignItems="center"}function f(A,C){A.setAttribute("width","24"),A.setAttribute("id",C),A.setAttribute("height","24"),A.setAttribute("viewBox","0 0 24 24"),A.setAttribute("fill","none"),A.style.marginLeft="-6px"}function m(){const A=document.createElement("span");return A.style.cursor="pointer",A.style.marginLeft="16px",A.style.fontSize="24px",A.innerHTML=" &times;",A.onclick=()=>{ha=!0,a()},A}function y(A,C){A.setAttribute("id",C),A.innerText="Learn more",A.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",A.setAttribute("target","__blank"),A.style.paddingLeft="5px",A.style.textDecoration="underline"}function v(){const A=$d(r),C=t("text"),F=document.getElementById(C)||document.createElement("span"),N=t("learnmore"),P=document.getElementById(N)||document.createElement("a"),q=t("preprendIcon"),B=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(A.created){const G=A.element;d(G),y(P,N);const Q=m();f(B,q),G.append(B,F,P,Q),document.body.appendChild(G)}o?(F.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,F.innerText="Preview backend running in this workspace."),F.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hd(){var e;const n=(e=Bi())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Kd(){return!Hd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qd(){try{return typeof indexedDB=="object"}catch{return!1}}function Yd(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd="FirebaseError";class Ln extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Xd,Object.setPrototypeOf(this,Ln.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dl.prototype.create)}}class Dl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Jd(o,r):"Error",d=`${this.serviceName}: ${a} (${s}).`;return new Ln(s,d,r)}}function Jd(n,e){return n.replace(Zd,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Zd=/\{\$([^}]+)}/g;function ys(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(fa(o)&&fa(a)){if(!ys(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function fa(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(n){return n&&n._delegate?n._delegate:n}class yr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Bd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(nh(e))try{this.getOrInitializeService({instanceIdentifier:rn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=rn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=rn){return this.instances.has(e)}getOptions(e=rn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:th(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=rn){return this.component?this.component.multipleInstances?e:rn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function th(n){return n===rn?void 0:n}function nh(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new eh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(pe||(pe={}));const sh={debug:pe.DEBUG,verbose:pe.VERBOSE,info:pe.INFO,warn:pe.WARN,error:pe.ERROR,silent:pe.SILENT},ih=pe.INFO,oh={[pe.DEBUG]:"log",[pe.VERBOSE]:"log",[pe.INFO]:"info",[pe.WARN]:"warn",[pe.ERROR]:"error"},ah=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=oh[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Vl{constructor(e){this.name=e,this._logLevel=ih,this._logHandler=ah,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pe.DEBUG,...e),this._logHandler(this,pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pe.VERBOSE,...e),this._logHandler(this,pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pe.INFO,...e),this._logHandler(this,pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pe.WARN,...e),this._logHandler(this,pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pe.ERROR,...e),this._logHandler(this,pe.ERROR,...e)}}const lh=(n,e)=>e.some(t=>n instanceof t);let ma,pa;function ch(){return ma||(ma=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function uh(){return pa||(pa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nl=new WeakMap,vi=new WeakMap,jl=new WeakMap,li=new WeakMap,zi=new WeakMap;function dh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Nt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Nl.set(t,n)}).catch(()=>{}),zi.set(e,n),e}function hh(n){if(vi.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});vi.set(n,e)}let bi={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return vi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||jl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Nt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function fh(n){bi=n(bi)}function mh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ci(this),e,...t);return jl.set(r,e.sort?e.sort():[e]),Nt(r)}:uh().includes(n)?function(...e){return n.apply(ci(this),e),Nt(Nl.get(this))}:function(...e){return Nt(n.apply(ci(this),e))}}function ph(n){return typeof n=="function"?mh(n):(n instanceof IDBTransaction&&hh(n),lh(n,ch())?new Proxy(n,bi):n)}function Nt(n){if(n instanceof IDBRequest)return dh(n);if(li.has(n))return li.get(n);const e=ph(n);return e!==n&&(li.set(n,e),zi.set(e,n)),e}const ci=n=>zi.get(n);function gh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),d=Nt(a);return r&&a.addEventListener("upgradeneeded",f=>{r(Nt(a.result),f.oldVersion,f.newVersion,Nt(a.transaction),f)}),t&&a.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),d.then(f=>{o&&f.addEventListener("close",()=>o()),s&&f.addEventListener("versionchange",m=>s(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const yh=["get","getKey","getAll","getAllKeys","count"],_h=["put","add","delete","clear"],ui=new Map;function ga(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ui.get(e))return ui.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=_h.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yh.includes(t)))return;const o=async function(a,...d){const f=this.transaction(a,s?"readwrite":"readonly");let m=f.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[t](...d),s&&f.done]))[0]};return ui.set(e,o),o}fh(n=>({...n,get:(e,t,r)=>ga(e,t)||n.get(e,t,r),has:(e,t)=>!!ga(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bh(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function bh(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const xi="@firebase/app",ya="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt=new Vl("@firebase/app"),xh="@firebase/app-compat",wh="@firebase/analytics-compat",Eh="@firebase/analytics",Th="@firebase/app-check-compat",Ah="@firebase/app-check",Ih="@firebase/auth",Ch="@firebase/auth-compat",Rh="@firebase/database",Sh="@firebase/data-connect",Ph="@firebase/database-compat",kh="@firebase/functions",Dh="@firebase/functions-compat",Vh="@firebase/installations",Nh="@firebase/installations-compat",jh="@firebase/messaging",Mh="@firebase/messaging-compat",Lh="@firebase/performance",Oh="@firebase/performance-compat",Fh="@firebase/remote-config",Bh="@firebase/remote-config-compat",Uh="@firebase/storage",zh="@firebase/storage-compat",qh="@firebase/firestore",$h="@firebase/ai",Gh="@firebase/firestore-compat",Wh="firebase",Hh="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wi="[DEFAULT]",Kh={[xi]:"fire-core",[xh]:"fire-core-compat",[Eh]:"fire-analytics",[wh]:"fire-analytics-compat",[Ah]:"fire-app-check",[Th]:"fire-app-check-compat",[Ih]:"fire-auth",[Ch]:"fire-auth-compat",[Rh]:"fire-rtdb",[Sh]:"fire-data-connect",[Ph]:"fire-rtdb-compat",[kh]:"fire-fn",[Dh]:"fire-fn-compat",[Vh]:"fire-iid",[Nh]:"fire-iid-compat",[jh]:"fire-fcm",[Mh]:"fire-fcm-compat",[Lh]:"fire-perf",[Oh]:"fire-perf-compat",[Fh]:"fire-rc",[Bh]:"fire-rc-compat",[Uh]:"fire-gcs",[zh]:"fire-gcs-compat",[qh]:"fire-fst",[Gh]:"fire-fst-compat",[$h]:"fire-vertex","fire-js":"fire-js",[Wh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s=new Map,Qh=new Map,Ei=new Map;function _a(n,e){try{n.container.addComponent(e)}catch(t){bt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function vs(n){const e=n.name;if(Ei.has(e))return bt.debug(`There were multiple attempts to register component ${e}.`),!1;Ei.set(e,n);for(const t of _s.values())_a(t,n);for(const t of Qh.values())_a(t,n);return!0}function Yh(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Xh(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jh={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},jt=new Dl("app","Firebase",Jh);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new yr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw jt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ef=Hh;function Ml(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:wi,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw jt.create("bad-app-name",{appName:String(s)});if(t||(t=kl()),!t)throw jt.create("no-options");const o=_s.get(s);if(o){if(ys(t,o.options)&&ys(r,o.config))return o;throw jt.create("duplicate-app",{appName:s})}const a=new rh(s);for(const f of Ei.values())a.addComponent(f);const d=new Zh(t,r,a);return _s.set(s,d),d}function tf(n=wi){const e=_s.get(n);if(!e&&n===wi&&kl())return Ml();if(!e)throw jt.create("no-app",{appName:n});return e}function An(n,e,t){let r=Kh[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bt.warn(a.join(" "));return}vs(new yr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nf="firebase-heartbeat-database",rf=1,_r="firebase-heartbeat-store";let di=null;function Ll(){return di||(di=gh(nf,rf,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(_r)}catch(t){console.warn(t)}}}}).catch(n=>{throw jt.create("idb-open",{originalErrorMessage:n.message})})),di}async function sf(n){try{const t=(await Ll()).transaction(_r),r=await t.objectStore(_r).get(Ol(n));return await t.done,r}catch(e){if(e instanceof Ln)bt.warn(e.message);else{const t=jt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});bt.warn(t.message)}}}async function va(n,e){try{const r=(await Ll()).transaction(_r,"readwrite");await r.objectStore(_r).put(e,Ol(n)),await r.done}catch(t){if(t instanceof Ln)bt.warn(t.message);else{const r=jt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});bt.warn(r.message)}}}function Ol(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const of=1024,af=30;class lf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new uf(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=ba();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>af){const a=df(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){bt.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ba(),{heartbeatsToSend:r,unsentEntries:s}=cf(this._heartbeatsCache.heartbeats),o=gs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return bt.warn(t),""}}}function ba(){return new Date().toISOString().substring(0,10)}function cf(n,e=of){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),xa(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),xa(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class uf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qd()?Yd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await sf(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return va(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return va(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function xa(n){return gs(JSON.stringify({version:2,heartbeats:n})).length}function df(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(n){vs(new yr("platform-logger",e=>new vh(e),"PRIVATE")),vs(new yr("heartbeat",e=>new lf(e),"PRIVATE")),An(xi,ya,n),An(xi,ya,"esm2020"),An("fire-js","")}hf("");var ff="firebase",mf="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */An(ff,mf,"app");var wa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mt,Fl;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,_){function b(){}b.prototype=_.prototype,w.F=_.prototype,w.prototype=new b,w.prototype.constructor=w,w.D=function(T,x,E){for(var g=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)g[ne-2]=arguments[ne];return _.prototype[x].apply(T,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,_,b){b||(b=0);const T=Array(16);if(typeof _=="string")for(var x=0;x<16;++x)T[x]=_.charCodeAt(b++)|_.charCodeAt(b++)<<8|_.charCodeAt(b++)<<16|_.charCodeAt(b++)<<24;else for(x=0;x<16;++x)T[x]=_[b++]|_[b++]<<8|_[b++]<<16|_[b++]<<24;_=w.g[0],b=w.g[1],x=w.g[2];let E=w.g[3],g;g=_+(E^b&(x^E))+T[0]+3614090360&4294967295,_=b+(g<<7&4294967295|g>>>25),g=E+(x^_&(b^x))+T[1]+3905402710&4294967295,E=_+(g<<12&4294967295|g>>>20),g=x+(b^E&(_^b))+T[2]+606105819&4294967295,x=E+(g<<17&4294967295|g>>>15),g=b+(_^x&(E^_))+T[3]+3250441966&4294967295,b=x+(g<<22&4294967295|g>>>10),g=_+(E^b&(x^E))+T[4]+4118548399&4294967295,_=b+(g<<7&4294967295|g>>>25),g=E+(x^_&(b^x))+T[5]+1200080426&4294967295,E=_+(g<<12&4294967295|g>>>20),g=x+(b^E&(_^b))+T[6]+2821735955&4294967295,x=E+(g<<17&4294967295|g>>>15),g=b+(_^x&(E^_))+T[7]+4249261313&4294967295,b=x+(g<<22&4294967295|g>>>10),g=_+(E^b&(x^E))+T[8]+1770035416&4294967295,_=b+(g<<7&4294967295|g>>>25),g=E+(x^_&(b^x))+T[9]+2336552879&4294967295,E=_+(g<<12&4294967295|g>>>20),g=x+(b^E&(_^b))+T[10]+4294925233&4294967295,x=E+(g<<17&4294967295|g>>>15),g=b+(_^x&(E^_))+T[11]+2304563134&4294967295,b=x+(g<<22&4294967295|g>>>10),g=_+(E^b&(x^E))+T[12]+1804603682&4294967295,_=b+(g<<7&4294967295|g>>>25),g=E+(x^_&(b^x))+T[13]+4254626195&4294967295,E=_+(g<<12&4294967295|g>>>20),g=x+(b^E&(_^b))+T[14]+2792965006&4294967295,x=E+(g<<17&4294967295|g>>>15),g=b+(_^x&(E^_))+T[15]+1236535329&4294967295,b=x+(g<<22&4294967295|g>>>10),g=_+(x^E&(b^x))+T[1]+4129170786&4294967295,_=b+(g<<5&4294967295|g>>>27),g=E+(b^x&(_^b))+T[6]+3225465664&4294967295,E=_+(g<<9&4294967295|g>>>23),g=x+(_^b&(E^_))+T[11]+643717713&4294967295,x=E+(g<<14&4294967295|g>>>18),g=b+(E^_&(x^E))+T[0]+3921069994&4294967295,b=x+(g<<20&4294967295|g>>>12),g=_+(x^E&(b^x))+T[5]+3593408605&4294967295,_=b+(g<<5&4294967295|g>>>27),g=E+(b^x&(_^b))+T[10]+38016083&4294967295,E=_+(g<<9&4294967295|g>>>23),g=x+(_^b&(E^_))+T[15]+3634488961&4294967295,x=E+(g<<14&4294967295|g>>>18),g=b+(E^_&(x^E))+T[4]+3889429448&4294967295,b=x+(g<<20&4294967295|g>>>12),g=_+(x^E&(b^x))+T[9]+568446438&4294967295,_=b+(g<<5&4294967295|g>>>27),g=E+(b^x&(_^b))+T[14]+3275163606&4294967295,E=_+(g<<9&4294967295|g>>>23),g=x+(_^b&(E^_))+T[3]+4107603335&4294967295,x=E+(g<<14&4294967295|g>>>18),g=b+(E^_&(x^E))+T[8]+1163531501&4294967295,b=x+(g<<20&4294967295|g>>>12),g=_+(x^E&(b^x))+T[13]+2850285829&4294967295,_=b+(g<<5&4294967295|g>>>27),g=E+(b^x&(_^b))+T[2]+4243563512&4294967295,E=_+(g<<9&4294967295|g>>>23),g=x+(_^b&(E^_))+T[7]+1735328473&4294967295,x=E+(g<<14&4294967295|g>>>18),g=b+(E^_&(x^E))+T[12]+2368359562&4294967295,b=x+(g<<20&4294967295|g>>>12),g=_+(b^x^E)+T[5]+4294588738&4294967295,_=b+(g<<4&4294967295|g>>>28),g=E+(_^b^x)+T[8]+2272392833&4294967295,E=_+(g<<11&4294967295|g>>>21),g=x+(E^_^b)+T[11]+1839030562&4294967295,x=E+(g<<16&4294967295|g>>>16),g=b+(x^E^_)+T[14]+4259657740&4294967295,b=x+(g<<23&4294967295|g>>>9),g=_+(b^x^E)+T[1]+2763975236&4294967295,_=b+(g<<4&4294967295|g>>>28),g=E+(_^b^x)+T[4]+1272893353&4294967295,E=_+(g<<11&4294967295|g>>>21),g=x+(E^_^b)+T[7]+4139469664&4294967295,x=E+(g<<16&4294967295|g>>>16),g=b+(x^E^_)+T[10]+3200236656&4294967295,b=x+(g<<23&4294967295|g>>>9),g=_+(b^x^E)+T[13]+681279174&4294967295,_=b+(g<<4&4294967295|g>>>28),g=E+(_^b^x)+T[0]+3936430074&4294967295,E=_+(g<<11&4294967295|g>>>21),g=x+(E^_^b)+T[3]+3572445317&4294967295,x=E+(g<<16&4294967295|g>>>16),g=b+(x^E^_)+T[6]+76029189&4294967295,b=x+(g<<23&4294967295|g>>>9),g=_+(b^x^E)+T[9]+3654602809&4294967295,_=b+(g<<4&4294967295|g>>>28),g=E+(_^b^x)+T[12]+3873151461&4294967295,E=_+(g<<11&4294967295|g>>>21),g=x+(E^_^b)+T[15]+530742520&4294967295,x=E+(g<<16&4294967295|g>>>16),g=b+(x^E^_)+T[2]+3299628645&4294967295,b=x+(g<<23&4294967295|g>>>9),g=_+(x^(b|~E))+T[0]+4096336452&4294967295,_=b+(g<<6&4294967295|g>>>26),g=E+(b^(_|~x))+T[7]+1126891415&4294967295,E=_+(g<<10&4294967295|g>>>22),g=x+(_^(E|~b))+T[14]+2878612391&4294967295,x=E+(g<<15&4294967295|g>>>17),g=b+(E^(x|~_))+T[5]+4237533241&4294967295,b=x+(g<<21&4294967295|g>>>11),g=_+(x^(b|~E))+T[12]+1700485571&4294967295,_=b+(g<<6&4294967295|g>>>26),g=E+(b^(_|~x))+T[3]+2399980690&4294967295,E=_+(g<<10&4294967295|g>>>22),g=x+(_^(E|~b))+T[10]+4293915773&4294967295,x=E+(g<<15&4294967295|g>>>17),g=b+(E^(x|~_))+T[1]+2240044497&4294967295,b=x+(g<<21&4294967295|g>>>11),g=_+(x^(b|~E))+T[8]+1873313359&4294967295,_=b+(g<<6&4294967295|g>>>26),g=E+(b^(_|~x))+T[15]+4264355552&4294967295,E=_+(g<<10&4294967295|g>>>22),g=x+(_^(E|~b))+T[6]+2734768916&4294967295,x=E+(g<<15&4294967295|g>>>17),g=b+(E^(x|~_))+T[13]+1309151649&4294967295,b=x+(g<<21&4294967295|g>>>11),g=_+(x^(b|~E))+T[4]+4149444226&4294967295,_=b+(g<<6&4294967295|g>>>26),g=E+(b^(_|~x))+T[11]+3174756917&4294967295,E=_+(g<<10&4294967295|g>>>22),g=x+(_^(E|~b))+T[2]+718787259&4294967295,x=E+(g<<15&4294967295|g>>>17),g=b+(E^(x|~_))+T[9]+3951481745&4294967295,w.g[0]=w.g[0]+_&4294967295,w.g[1]=w.g[1]+(x+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+x&4294967295,w.g[3]=w.g[3]+E&4294967295}r.prototype.v=function(w,_){_===void 0&&(_=w.length);const b=_-this.blockSize,T=this.C;let x=this.h,E=0;for(;E<_;){if(x==0)for(;E<=b;)s(this,w,E),E+=this.blockSize;if(typeof w=="string"){for(;E<_;)if(T[x++]=w.charCodeAt(E++),x==this.blockSize){s(this,T),x=0;break}}else for(;E<_;)if(T[x++]=w[E++],x==this.blockSize){s(this,T),x=0;break}}this.h=x,this.o+=_},r.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var _=1;_<w.length-8;++_)w[_]=0;_=this.o*8;for(var b=w.length-8;b<w.length;++b)w[b]=_&255,_/=256;for(this.v(w),w=Array(16),_=0,b=0;b<4;++b)for(let T=0;T<32;T+=8)w[_++]=this.g[b]>>>T&255;return w};function o(w,_){var b=d;return Object.prototype.hasOwnProperty.call(b,w)?b[w]:b[w]=_(w)}function a(w,_){this.h=_;const b=[];let T=!0;for(let x=w.length-1;x>=0;x--){const E=w[x]|0;T&&E==_||(b[x]=E,T=!1)}this.g=b}var d={};function f(w){return-128<=w&&w<128?o(w,function(_){return new a([_|0],_<0?-1:0)}):new a([w|0],w<0?-1:0)}function m(w){if(isNaN(w)||!isFinite(w))return v;if(w<0)return P(m(-w));const _=[];let b=1;for(let T=0;w>=b;T++)_[T]=w/b|0,b*=4294967296;return new a(_,0)}function y(w,_){if(w.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(w.charAt(0)=="-")return P(y(w.substring(1),_));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=m(Math.pow(_,8));let T=v;for(let E=0;E<w.length;E+=8){var x=Math.min(8,w.length-E);const g=parseInt(w.substring(E,E+x),_);x<8?(x=m(Math.pow(_,x)),T=T.j(x).add(m(g))):(T=T.j(b),T=T.add(m(g)))}return T}var v=f(0),A=f(1),C=f(16777216);n=a.prototype,n.m=function(){if(N(this))return-P(this).m();let w=0,_=1;for(let b=0;b<this.g.length;b++){const T=this.i(b);w+=(T>=0?T:4294967296+T)*_,_*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(F(this))return"0";if(N(this))return"-"+P(this).toString(w);const _=m(Math.pow(w,6));var b=this;let T="";for(;;){const x=Q(b,_).g;b=q(b,x.j(_));let E=((b.g.length>0?b.g[0]:b.h)>>>0).toString(w);if(b=x,F(b))return E+T;for(;E.length<6;)E="0"+E;T=E+T}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function F(w){if(w.h!=0)return!1;for(let _=0;_<w.g.length;_++)if(w.g[_]!=0)return!1;return!0}function N(w){return w.h==-1}n.l=function(w){return w=q(this,w),N(w)?-1:F(w)?0:1};function P(w){const _=w.g.length,b=[];for(let T=0;T<_;T++)b[T]=~w.g[T];return new a(b,~w.h).add(A)}n.abs=function(){return N(this)?P(this):this},n.add=function(w){const _=Math.max(this.g.length,w.g.length),b=[];let T=0;for(let x=0;x<=_;x++){let E=T+(this.i(x)&65535)+(w.i(x)&65535),g=(E>>>16)+(this.i(x)>>>16)+(w.i(x)>>>16);T=g>>>16,E&=65535,g&=65535,b[x]=g<<16|E}return new a(b,b[b.length-1]&-2147483648?-1:0)};function q(w,_){return w.add(P(_))}n.j=function(w){if(F(this)||F(w))return v;if(N(this))return N(w)?P(this).j(P(w)):P(P(this).j(w));if(N(w))return P(this.j(P(w)));if(this.l(C)<0&&w.l(C)<0)return m(this.m()*w.m());const _=this.g.length+w.g.length,b=[];for(var T=0;T<2*_;T++)b[T]=0;for(T=0;T<this.g.length;T++)for(let x=0;x<w.g.length;x++){const E=this.i(T)>>>16,g=this.i(T)&65535,ne=w.i(x)>>>16,ge=w.i(x)&65535;b[2*T+2*x]+=g*ge,B(b,2*T+2*x),b[2*T+2*x+1]+=E*ge,B(b,2*T+2*x+1),b[2*T+2*x+1]+=g*ne,B(b,2*T+2*x+1),b[2*T+2*x+2]+=E*ne,B(b,2*T+2*x+2)}for(w=0;w<_;w++)b[w]=b[2*w+1]<<16|b[2*w];for(w=_;w<2*_;w++)b[w]=0;return new a(b,0)};function B(w,_){for(;(w[_]&65535)!=w[_];)w[_+1]+=w[_]>>>16,w[_]&=65535,_++}function G(w,_){this.g=w,this.h=_}function Q(w,_){if(F(_))throw Error("division by zero");if(F(w))return new G(v,v);if(N(w))return _=Q(P(w),_),new G(P(_.g),P(_.h));if(N(_))return _=Q(w,P(_)),new G(P(_.g),_.h);if(w.g.length>30){if(N(w)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var b=A,T=_;T.l(w)<=0;)b=J(b),T=J(T);var x=Z(b,1),E=Z(T,1);for(T=Z(T,2),b=Z(b,2);!F(T);){var g=E.add(T);g.l(w)<=0&&(x=x.add(b),E=g),T=Z(T,1),b=Z(b,1)}return _=q(w,x.j(_)),new G(x,_)}for(x=v;w.l(_)>=0;){for(b=Math.max(1,Math.floor(w.m()/_.m())),T=Math.ceil(Math.log(b)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),E=m(b),g=E.j(_);N(g)||g.l(w)>0;)b-=T,E=m(b),g=E.j(_);F(E)&&(E=A),x=x.add(E),w=q(w,g)}return new G(x,w)}n.B=function(w){return Q(this,w).h},n.and=function(w){const _=Math.max(this.g.length,w.g.length),b=[];for(let T=0;T<_;T++)b[T]=this.i(T)&w.i(T);return new a(b,this.h&w.h)},n.or=function(w){const _=Math.max(this.g.length,w.g.length),b=[];for(let T=0;T<_;T++)b[T]=this.i(T)|w.i(T);return new a(b,this.h|w.h)},n.xor=function(w){const _=Math.max(this.g.length,w.g.length),b=[];for(let T=0;T<_;T++)b[T]=this.i(T)^w.i(T);return new a(b,this.h^w.h)};function J(w){const _=w.g.length+1,b=[];for(let T=0;T<_;T++)b[T]=w.i(T)<<1|w.i(T-1)>>>31;return new a(b,w.h)}function Z(w,_){const b=_>>5;_%=32;const T=w.g.length-b,x=[];for(let E=0;E<T;E++)x[E]=_>0?w.i(E+b)>>>_|w.i(E+b+1)<<32-_:w.i(E+b);return new a(x,w.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Fl=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=y,Mt=a}).apply(typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{});var Zr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Bl,ar,Ul,is,Ti,zl,ql,$l;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zr=="object"&&Zr];for(var u=0;u<i.length;++u){var h=i[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(i,u){if(u)e:{var h=r;i=i.split(".");for(var p=0;p<i.length-1;p++){var S=i[p];if(!(S in h))break e;h=h[S]}i=i[i.length-1],p=h[i],u=u(p),u!=p&&u!=null&&e(h,i,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(u){var h=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&h.push([p,u[p]]);return h}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function d(i){var u=typeof i;return u=="object"&&i!=null||u=="function"}function f(i,u,h){return i.call.apply(i.bind,arguments)}function m(i,u,h){return m=f,m.apply(null,arguments)}function y(i,u){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function v(i,u){function h(){}h.prototype=u.prototype,i.Z=u.prototype,i.prototype=new h,i.prototype.constructor=i,i.Ob=function(p,S,k){for(var z=Array(arguments.length-2),le=2;le<arguments.length;le++)z[le-2]=arguments[le];return u.prototype[S].apply(p,z)}}var A=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const u=i.length;if(u>0){const h=Array(u);for(let p=0;p<u;p++)h[p]=i[p];return h}return[]}function F(i,u){for(let p=1;p<arguments.length;p++){const S=arguments[p];var h=typeof S;if(h=h!="object"?h:S?Array.isArray(S)?"array":h:"null",h=="array"||h=="object"&&typeof S.length=="number"){h=i.length||0;const k=S.length||0;i.length=h+k;for(let z=0;z<k;z++)i[h+z]=S[z]}else i.push(S)}}class N{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function P(i){a.setTimeout(()=>{throw i},0)}function q(){var i=w;let u=null;return i.g&&(u=i.g,i.g=i.g.next,i.g||(i.h=null),u.next=null),u}class B{constructor(){this.h=this.g=null}add(u,h){const p=G.get();p.set(u,h),this.h?this.h.next=p:this.g=p,this.h=p}}var G=new N(()=>new Q,i=>i.reset());class Q{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let J,Z=!1,w=new B,_=()=>{const i=Promise.resolve(void 0);J=()=>{i.then(b)}};function b(){for(var i;i=q();){try{i.h.call(i.g)}catch(h){P(h)}var u=G;u.j(i),u.h<100&&(u.h++,i.next=u.g,u.g=i)}Z=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function x(i,u){this.type=i,this.g=this.target=u,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var E=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,u=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};a.addEventListener("test",h,u),a.removeEventListener("test",h,u)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function ne(i,u){x.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,u)}v(ne,x),ne.prototype.init=function(i,u){const h=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=u,u=i.relatedTarget,u||(h=="mouseover"?u=i.fromElement:h=="mouseout"&&(u=i.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&ne.Z.h.call(this)},ne.prototype.h=function(){ne.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ge="closure_listenable_"+(Math.random()*1e6|0),Ee=0;function Ke(i,u,h,p,S){this.listener=i,this.proxy=null,this.src=u,this.type=h,this.capture=!!p,this.ha=S,this.key=++Ee,this.da=this.fa=!1}function $e(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ee(i,u,h){for(const p in i)u.call(h,i[p],p,i)}function nt(i,u){for(const h in i)u.call(void 0,i[h],h,i)}function X(i){const u={};for(const h in i)u[h]=i[h];return u}const Ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Vr(i,u){let h,p;for(let S=1;S<arguments.length;S++){p=arguments[S];for(h in p)i[h]=p[h];for(let k=0;k<Ge.length;k++)h=Ge[k],Object.prototype.hasOwnProperty.call(p,h)&&(i[h]=p[h])}}function Ht(i){this.src=i,this.g={},this.h=0}Ht.prototype.add=function(i,u,h,p,S){const k=i.toString();i=this.g[k],i||(i=this.g[k]=[],this.h++);const z=Kt(i,u,p,S);return z>-1?(u=i[z],h||(u.fa=!1)):(u=new Ke(u,this.src,k,!!p,S),u.fa=h,i.push(u)),u};function hn(i,u){const h=u.type;if(h in i.g){var p=i.g[h],S=Array.prototype.indexOf.call(p,u,void 0),k;(k=S>=0)&&Array.prototype.splice.call(p,S,1),k&&($e(u),i.g[h].length==0&&(delete i.g[h],i.h--))}}function Kt(i,u,h,p){for(let S=0;S<i.length;++S){const k=i[S];if(!k.da&&k.listener==u&&k.capture==!!h&&k.ha==p)return S}return-1}var gt="closure_lm_"+(Math.random()*1e6|0),Qt={};function Et(i,u,h,p,S){if(Array.isArray(u)){for(let k=0;k<u.length;k++)Et(i,u[k],h,p,S);return null}return h=Mr(h),i&&i[ge]?i.J(u,h,d(p)?!!p.capture:!1,S):qn(i,u,h,!1,p,S)}function qn(i,u,h,p,S,k){if(!u)throw Error("Invalid event type");const z=d(S)?!!S.capture:!!S;let le=Gn(i);if(le||(i[gt]=le=new Ht(i)),h=le.add(u,h,p,z,k),h.proxy)return h;if(p=Gs(),h.proxy=p,p.src=i,p.listener=h,i.addEventListener)E||(S=z),S===void 0&&(S=!1),i.addEventListener(u.toString(),p,S);else if(i.attachEvent)i.attachEvent(jr(u.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Gs(){function i(h){return u.call(i.src,i.listener,h)}const u=Ws;return i}function Nr(i,u,h,p,S){if(Array.isArray(u))for(var k=0;k<u.length;k++)Nr(i,u[k],h,p,S);else p=d(p)?!!p.capture:!!p,h=Mr(h),i&&i[ge]?(i=i.i,k=String(u).toString(),k in i.g&&(u=i.g[k],h=Kt(u,h,p,S),h>-1&&($e(u[h]),Array.prototype.splice.call(u,h,1),u.length==0&&(delete i.g[k],i.h--)))):i&&(i=Gn(i))&&(u=i.g[u.toString()],i=-1,u&&(i=Kt(u,h,p,S)),(h=i>-1?u[i]:null)&&$n(h))}function $n(i){if(typeof i!="number"&&i&&!i.da){var u=i.src;if(u&&u[ge])hn(u.i,i);else{var h=i.type,p=i.proxy;u.removeEventListener?u.removeEventListener(h,p,i.capture):u.detachEvent?u.detachEvent(jr(h),p):u.addListener&&u.removeListener&&u.removeListener(p),(h=Gn(u))?(hn(h,i),h.h==0&&(h.src=null,u[gt]=null)):$e(i)}}}function jr(i){return i in Qt?Qt[i]:Qt[i]="on"+i}function Ws(i,u){if(i.da)i=!0;else{u=new ne(u,this);const h=i.listener,p=i.ha||i.src;i.fa&&$n(i),i=h.call(p,u)}return i}function Gn(i){return i=i[gt],i instanceof Ht?i:null}var Wn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Mr(i){return typeof i=="function"?i:(i[Wn]||(i[Wn]=function(u){return i.handleEvent(u)}),i[Wn])}function Ve(){T.call(this),this.i=new Ht(this),this.M=this,this.G=null}v(Ve,T),Ve.prototype[ge]=!0,Ve.prototype.removeEventListener=function(i,u,h,p){Nr(this,i,u,h,p)};function Me(i,u){var h,p=i.G;if(p)for(h=[];p;p=p.G)h.push(p);if(i=i.M,p=u.type||u,typeof u=="string")u=new x(u,i);else if(u instanceof x)u.target=u.target||i;else{var S=u;u=new x(p,i),Vr(u,S)}S=!0;let k,z;if(h)for(z=h.length-1;z>=0;z--)k=u.g=h[z],S=fn(k,p,!0,u)&&S;if(k=u.g=i,S=fn(k,p,!0,u)&&S,S=fn(k,p,!1,u)&&S,h)for(z=0;z<h.length;z++)k=u.g=h[z],S=fn(k,p,!1,u)&&S}Ve.prototype.N=function(){if(Ve.Z.N.call(this),this.i){var i=this.i;for(const u in i.g){const h=i.g[u];for(let p=0;p<h.length;p++)$e(h[p]);delete i.g[u],i.h--}}this.G=null},Ve.prototype.J=function(i,u,h,p){return this.i.add(String(i),u,!1,h,p)},Ve.prototype.K=function(i,u,h,p){return this.i.add(String(i),u,!0,h,p)};function fn(i,u,h,p){if(u=i.i.g[String(u)],!u)return!0;u=u.concat();let S=!0;for(let k=0;k<u.length;++k){const z=u[k];if(z&&!z.da&&z.capture==h){const le=z.listener,Pe=z.ha||z.src;z.fa&&hn(i.i,z),S=le.call(Pe,p)!==!1&&S}}return S&&!p.defaultPrevented}function Hs(i,u){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=m(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(i,u||0)}function Lr(i){i.g=Hs(()=>{i.g=null,i.i&&(i.i=!1,Lr(i))},i.l);const u=i.h;i.h=null,i.m.apply(null,u)}class Ks extends T{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Lr(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yt(i){T.call(this),this.h=i,this.g={}}v(Yt,T);var Or=[];function Fr(i){ee(i.g,function(u,h){this.g.hasOwnProperty(h)&&$n(u)},i),i.g={}}Yt.prototype.N=function(){Yt.Z.N.call(this),Fr(this)},Yt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Hn=a.JSON.stringify,Br=a.JSON.parse,Ur=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Kn(){}function R(){}var I={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function D(){x.call(this,"d")}v(D,x);function L(){x.call(this,"c")}v(L,x);var H={},W=null;function O(){return W=W||new Ve}H.Ia="serverreachability";function ae(i){x.call(this,H.Ia,i)}v(ae,x);function M(i){const u=O();Me(u,new ae(u))}H.STAT_EVENT="statevent";function ce(i,u){x.call(this,H.STAT_EVENT,i),this.stat=u}v(ce,x);function he(i){const u=O();Me(u,new ce(u,i))}H.Ja="timingevent";function se(i,u){x.call(this,H.Ja,i),this.size=u}v(se,x);function fe(i,u){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},u)}function We(){this.g=!0}We.prototype.ua=function(){this.g=!1};function mn(i,u,h,p,S,k){i.info(function(){if(i.g)if(k){var z="",le=k.split("&");for(let ve=0;ve<le.length;ve++){var Pe=le[ve].split("=");if(Pe.length>1){const Ne=Pe[0];Pe=Pe[1];const ct=Ne.split("_");z=ct.length>=2&&ct[1]=="type"?z+(Ne+"="+Pe+"&"):z+(Ne+"=redacted&")}}}else z=null;else z=k;return"XMLHTTP REQ ("+p+") [attempt "+S+"]: "+u+`
`+h+`
`+z})}function Qn(i,u,h,p,S,k,z){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+S+"]: "+u+`
`+h+`
`+k+" "+z})}function ot(i,u,h,p){i.info(function(){return"XMLHTTP TEXT ("+u+"): "+Be(i,h)+(p?" "+p:"")})}function ye(i,u){i.info(function(){return"TIMEOUT: "+u})}We.prototype.info=function(){};function Be(i,u){if(!i.g)return u;if(!u)return null;try{const k=JSON.parse(u);if(k){for(i=0;i<k.length;i++)if(Array.isArray(k[i])){var h=k[i];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var S=p[0];if(S!="noop"&&S!="stop"&&S!="close")for(let z=1;z<p.length;z++)p[z]=""}}}}return Hn(k)}catch{return u}}var Xe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Tt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},pn;function gn(){}v(gn,Kn),gn.prototype.g=function(){return new XMLHttpRequest},pn=new gn;function yt(i){return encodeURIComponent(String(i))}function yn(i){var u=1;i=i.split(":");const h=[];for(;u>0&&i.length;)h.push(i.shift()),u--;return i.length&&h.push(i.join(":")),h}function He(i,u,h,p){this.j=i,this.i=u,this.l=h,this.S=p||1,this.V=new Yt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new at}function at(){this.i=null,this.g="",this.h=!1}var zr={},Xt={};function qr(i,u,h){i.M=1,i.A=Gr(lt(u)),i.u=h,i.R=!0,_n(i,null)}function _n(i,u){i.F=Date.now(),$r(i),i.B=lt(i.A);var h=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),Fo(h.i,"t",p),i.C=0,h=i.j.L,i.h=new at,i.g=ra(i.j,h?u:null,!i.u),i.P>0&&(i.O=new Ks(m(i.Y,i,i.g),i.P)),u=i.V,h=i.g,p=i.ba;var S="readystatechange";Array.isArray(S)||(S&&(Or[0]=S.toString()),S=Or);for(let k=0;k<S.length;k++){const z=Et(h,S[k],p||u.handleEvent,!1,u.h||u);if(!z)break;u.g[z.key]=z}u=i.J?X(i.J):{},i.u?(i.v||(i.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,u)):(i.v="GET",i.g.ea(i.B,i.v,null,u)),M(),mn(i.i,i.v,i.B,i.l,i.S,i.u)}He.prototype.ba=function(i){i=i.target;const u=this.O;u&&Ct(i)==3?u.j():this.Y(i)},He.prototype.Y=function(i){try{if(i==this.g)e:{const le=Ct(this.g),Pe=this.g.ya(),ve=this.g.ca();if(!(le<3)&&(le!=3||this.g&&(this.h.h||this.g.la()||Wo(this.g)))){this.K||le!=4||Pe==7||(Pe==8||ve<=0?M(3):M(2)),Qs(this);var u=this.g.ca();this.X=u;var h=vu(this);if(this.o=u==200,Qn(this.i,this.v,this.B,this.l,this.S,le,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,S=this.g;if((p=S.g?S.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(p)){var k=p;break t}}k=null}if(i=k)ot(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ys(this,i);else{this.o=!1,this.m=3,he(12),Jt(this),Yn(this);break e}}if(this.R){i=!0;let Ne;for(;!this.K&&this.C<h.length;)if(Ne=bu(this,h),Ne==Xt){le==4&&(this.m=4,he(14),i=!1),ot(this.i,this.l,null,"[Incomplete Response]");break}else if(Ne==zr){this.m=4,he(15),ot(this.i,this.l,h,"[Invalid Chunk]"),i=!1;break}else ot(this.i,this.l,Ne,null),Ys(this,Ne);if(Co(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),le!=4||h.length!=0||this.h.h||(this.m=1,he(16),i=!1),this.o=this.o&&i,!i)ot(this.i,this.l,h,"[Invalid Chunked Response]"),Jt(this),Yn(this);else if(h.length>0&&!this.W){this.W=!0;var z=this.j;z.g==this&&z.aa&&!z.P&&(z.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),si(z),z.P=!0,he(11))}}else ot(this.i,this.l,h,null),Ys(this,h);le==4&&Jt(this),this.o&&!this.K&&(le==4?Zo(this.j,this):(this.o=!1,$r(this)))}else Nu(this.g),u==400&&h.indexOf("Unknown SID")>0?(this.m=3,he(12)):(this.m=0,he(13)),Jt(this),Yn(this)}}}catch{}finally{}};function vu(i){if(!Co(i))return i.g.la();const u=Wo(i.g);if(u==="")return"";let h="";const p=u.length,S=Ct(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Jt(i),Yn(i),"";i.h.i=new a.TextDecoder}for(let k=0;k<p;k++)i.h.h=!0,h+=i.h.i.decode(u[k],{stream:!(S&&k==p-1)});return u.length=0,i.h.g+=h,i.C=0,i.h.g}function Co(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function bu(i,u){var h=i.C,p=u.indexOf(`
`,h);return p==-1?Xt:(h=Number(u.substring(h,p)),isNaN(h)?zr:(p+=1,p+h>u.length?Xt:(u=u.slice(p,p+h),i.C=p+h,u)))}He.prototype.cancel=function(){this.K=!0,Jt(this)};function $r(i){i.T=Date.now()+i.H,Ro(i,i.H)}function Ro(i,u){if(i.D!=null)throw Error("WatchDog timer not null");i.D=fe(m(i.aa,i),u)}function Qs(i){i.D&&(a.clearTimeout(i.D),i.D=null)}He.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(ye(this.i,this.B),this.M!=2&&(M(),he(17)),Jt(this),this.m=2,Yn(this)):Ro(this,this.T-i)};function Yn(i){i.j.I==0||i.K||Zo(i.j,i)}function Jt(i){Qs(i);var u=i.O;u&&typeof u.dispose=="function"&&u.dispose(),i.O=null,Fr(i.V),i.g&&(u=i.g,i.g=null,u.abort(),u.dispose())}function Ys(i,u){try{var h=i.j;if(h.I!=0&&(h.g==i||Xs(h.h,i))){if(!i.L&&Xs(h.h,i)&&h.I==3){try{var p=h.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var S=p;if(S[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<i.F)Yr(h),Kr(h);else break e;ri(h),he(18)}}else h.xa=S[1],0<h.xa-h.K&&S[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=fe(m(h.Va,h),6e3));ko(h.h)<=1&&h.ta&&(h.ta=void 0)}else en(h,11)}else if((i.L||h.g==i)&&Yr(h),!g(u))for(S=h.Ba.g.parse(u),u=0;u<S.length;u++){let ve=S[u];const Ne=ve[0];if(!(Ne<=h.K))if(h.K=Ne,ve=ve[1],h.I==2)if(ve[0]=="c"){h.M=ve[1],h.ba=ve[2];const ct=ve[3];ct!=null&&(h.ka=ct,h.j.info("VER="+h.ka));const tn=ve[4];tn!=null&&(h.za=tn,h.j.info("SVER="+h.za));const Rt=ve[5];Rt!=null&&typeof Rt=="number"&&Rt>0&&(p=1.5*Rt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const St=i.g;if(St){const Jr=St.g?St.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Jr){var k=p.h;k.g||Jr.indexOf("spdy")==-1&&Jr.indexOf("quic")==-1&&Jr.indexOf("h2")==-1||(k.j=k.l,k.g=new Set,k.h&&(Js(k,k.h),k.h=null))}if(p.G){const ii=St.g?St.g.getResponseHeader("X-HTTP-Session-Id"):null;ii&&(p.wa=ii,xe(p.J,p.G,ii))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-i.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var z=i;if(p.na=na(p,p.L?p.ba:null,p.W),z.L){Do(p.h,z);var le=z,Pe=p.O;Pe&&(le.H=Pe),le.D&&(Qs(le),$r(le)),p.g=z}else Xo(p);h.i.length>0&&Qr(h)}else ve[0]!="stop"&&ve[0]!="close"||en(h,7);else h.I==3&&(ve[0]=="stop"||ve[0]=="close"?ve[0]=="stop"?en(h,7):ni(h):ve[0]!="noop"&&h.l&&h.l.qa(ve),h.A=0)}}M(4)}catch{}}var xu=class{constructor(i,u){this.g=i,this.map=u}};function So(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Po(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function ko(i){return i.h?1:i.g?i.g.size:0}function Xs(i,u){return i.h?i.h==u:i.g?i.g.has(u):!1}function Js(i,u){i.g?i.g.add(u):i.h=u}function Do(i,u){i.h&&i.h==u?i.h=null:i.g&&i.g.has(u)&&i.g.delete(u)}So.prototype.cancel=function(){if(this.i=Vo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Vo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let u=i.i;for(const h of i.g.values())u=u.concat(h.G);return u}return C(i.i)}var No=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wu(i,u){if(i){i=i.split("&");for(let h=0;h<i.length;h++){const p=i[h].indexOf("=");let S,k=null;p>=0?(S=i[h].substring(0,p),k=i[h].substring(p+1)):S=i[h],u(S,k?decodeURIComponent(k.replace(/\+/g," ")):"")}}}function At(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;i instanceof At?(this.l=i.l,Xn(this,i.j),this.o=i.o,this.g=i.g,Jn(this,i.u),this.h=i.h,Zs(this,Bo(i.i)),this.m=i.m):i&&(u=String(i).match(No))?(this.l=!1,Xn(this,u[1]||"",!0),this.o=Zn(u[2]||""),this.g=Zn(u[3]||"",!0),Jn(this,u[4]),this.h=Zn(u[5]||"",!0),Zs(this,u[6]||"",!0),this.m=Zn(u[7]||"")):(this.l=!1,this.i=new tr(null,this.l))}At.prototype.toString=function(){const i=[];var u=this.j;u&&i.push(er(u,jo,!0),":");var h=this.g;return(h||u=="file")&&(i.push("//"),(u=this.o)&&i.push(er(u,jo,!0),"@"),i.push(yt(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&i.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push(er(h,h.charAt(0)=="/"?Au:Tu,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",er(h,Cu)),i.join("")},At.prototype.resolve=function(i){const u=lt(this);let h=!!i.j;h?Xn(u,i.j):h=!!i.o,h?u.o=i.o:h=!!i.g,h?u.g=i.g:h=i.u!=null;var p=i.h;if(h)Jn(u,i.u);else if(h=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var S=u.h.lastIndexOf("/");S!=-1&&(p=u.h.slice(0,S+1)+p)}if(S=p,S==".."||S==".")p="";else if(S.indexOf("./")!=-1||S.indexOf("/.")!=-1){p=S.lastIndexOf("/",0)==0,S=S.split("/");const k=[];for(let z=0;z<S.length;){const le=S[z++];le=="."?p&&z==S.length&&k.push(""):le==".."?((k.length>1||k.length==1&&k[0]!="")&&k.pop(),p&&z==S.length&&k.push("")):(k.push(le),p=!0)}p=k.join("/")}else p=S}return h?u.h=p:h=i.i.toString()!=="",h?Zs(u,Bo(i.i)):h=!!i.m,h&&(u.m=i.m),u};function lt(i){return new At(i)}function Xn(i,u,h){i.j=h?Zn(u,!0):u,i.j&&(i.j=i.j.replace(/:$/,""))}function Jn(i,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);i.u=u}else i.u=null}function Zs(i,u,h){u instanceof tr?(i.i=u,Ru(i.i,i.l)):(h||(u=er(u,Iu)),i.i=new tr(u,i.l))}function xe(i,u,h){i.i.set(u,h)}function Gr(i){return xe(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function Zn(i,u){return i?u?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function er(i,u,h){return typeof i=="string"?(i=encodeURI(i).replace(u,Eu),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Eu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var jo=/[#\/\?@]/g,Tu=/[#\?:]/g,Au=/[#\?]/g,Iu=/[#\?@]/g,Cu=/#/g;function tr(i,u){this.h=this.g=null,this.i=i||null,this.j=!!u}function Zt(i){i.g||(i.g=new Map,i.h=0,i.i&&wu(i.i,function(u,h){i.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}n=tr.prototype,n.add=function(i,u){Zt(this),this.i=null,i=vn(this,i);let h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(u),this.h+=1,this};function Mo(i,u){Zt(i),u=vn(i,u),i.g.has(u)&&(i.i=null,i.h-=i.g.get(u).length,i.g.delete(u))}function Lo(i,u){return Zt(i),u=vn(i,u),i.g.has(u)}n.forEach=function(i,u){Zt(this),this.g.forEach(function(h,p){h.forEach(function(S){i.call(u,S,p,this)},this)},this)};function Oo(i,u){Zt(i);let h=[];if(typeof u=="string")Lo(i,u)&&(h=h.concat(i.g.get(vn(i,u))));else for(i=Array.from(i.g.values()),u=0;u<i.length;u++)h=h.concat(i[u]);return h}n.set=function(i,u){return Zt(this),this.i=null,i=vn(this,i),Lo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[u]),this.h+=1,this},n.get=function(i,u){return i?(i=Oo(this,i),i.length>0?String(i[0]):u):u};function Fo(i,u,h){Mo(i,u),h.length>0&&(i.i=null,i.g.set(vn(i,u),C(h)),i.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var h=u[p];const S=yt(h);h=Oo(this,h);for(let k=0;k<h.length;k++){let z=S;h[k]!==""&&(z+="="+yt(h[k])),i.push(z)}}return this.i=i.join("&")};function Bo(i){const u=new tr;return u.i=i.i,i.g&&(u.g=new Map(i.g),u.h=i.h),u}function vn(i,u){return u=String(u),i.j&&(u=u.toLowerCase()),u}function Ru(i,u){u&&!i.j&&(Zt(i),i.i=null,i.g.forEach(function(h,p){const S=p.toLowerCase();p!=S&&(Mo(this,p),Fo(this,S,h))},i)),i.j=u}function Su(i,u){const h=new We;if(a.Image){const p=new Image;p.onload=y(It,h,"TestLoadImage: loaded",!0,u,p),p.onerror=y(It,h,"TestLoadImage: error",!1,u,p),p.onabort=y(It,h,"TestLoadImage: abort",!1,u,p),p.ontimeout=y(It,h,"TestLoadImage: timeout",!1,u,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else u(!1)}function Pu(i,u){const h=new We,p=new AbortController,S=setTimeout(()=>{p.abort(),It(h,"TestPingServer: timeout",!1,u)},1e4);fetch(i,{signal:p.signal}).then(k=>{clearTimeout(S),k.ok?It(h,"TestPingServer: ok",!0,u):It(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(S),It(h,"TestPingServer: error",!1,u)})}function It(i,u,h,p,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),p(h)}catch{}}function ku(){this.g=new Ur}function ei(i){this.i=i.Sb||null,this.h=i.ab||!1}v(ei,Kn),ei.prototype.g=function(){return new Wr(this.i,this.h)};function Wr(i,u){Ve.call(this),this.H=i,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(Wr,Ve),n=Wr.prototype,n.open=function(i,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=u,this.readyState=1,rr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(u.body=i),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,nr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,rr(this)),this.g&&(this.readyState=3,rr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Uo(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Uo(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var u=i.value?i.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!i.done}))&&(this.response=this.responseText+=u)}i.done?nr(this):rr(this),this.readyState==3&&Uo(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,nr(this))},n.Na=function(i){this.g&&(this.response=i,nr(this))},n.ga=function(){this.g&&nr(this)};function nr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,rr(i)}n.setRequestHeader=function(i,u){this.A.append(i,u)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=u.next();return i.join(`\r
`)};function rr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Wr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function zo(i){let u="";return ee(i,function(h,p){u+=p,u+=":",u+=h,u+=`\r
`}),u}function ti(i,u,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=zo(h),typeof i=="string"?h!=null&&yt(h):xe(i,u,h))}function Ae(i){Ve.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(Ae,Ve);var Du=/^https?$/i,Vu=["POST","PUT"];n=Ae.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,u,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);u=u?u.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():pn.g(),this.g.onreadystatechange=A(m(this.Ca,this));try{this.B=!0,this.g.open(u,String(i),!0),this.B=!1}catch(k){qo(this,k);return}if(i=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var S in p)h.set(S,p[S]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const k of p.keys())h.set(k,p.get(k));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(k=>k.toLowerCase()=="content-type"),S=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Vu,u,void 0)>=0)||p||S||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[k,z]of h)this.g.setRequestHeader(k,z);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(k){qo(this,k)}};function qo(i,u){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=u,i.o=5,$o(i),Hr(i)}function $o(i){i.A||(i.A=!0,Me(i,"complete"),Me(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Me(this,"complete"),Me(this,"abort"),Hr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hr(this,!0)),Ae.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Go(this):this.Xa())},n.Xa=function(){Go(this)};function Go(i){if(i.h&&typeof o<"u"){if(i.v&&Ct(i)==4)setTimeout(i.Ca.bind(i),0);else if(Me(i,"readystatechange"),Ct(i)==4){i.h=!1;try{const k=i.ca();e:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var h;if(!(h=u)){var p;if(p=k===0){let z=String(i.D).match(No)[1]||null;!z&&a.self&&a.self.location&&(z=a.self.location.protocol.slice(0,-1)),p=!Du.test(z?z.toLowerCase():"")}h=p}if(h)Me(i,"complete"),Me(i,"success");else{i.o=6;try{var S=Ct(i)>2?i.g.statusText:""}catch{S=""}i.l=S+" ["+i.ca()+"]",$o(i)}}finally{Hr(i)}}}}function Hr(i,u){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const h=i.g;i.g=null,u||Me(i,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ct(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Ct(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var u=this.g.responseText;return i&&u.indexOf(i)==0&&(u=u.substring(i.length)),Br(u)}};function Wo(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Nu(i){const u={};i=(i.g&&Ct(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(g(i[p]))continue;var h=yn(i[p]);const S=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const k=u[S]||[];u[S]=k,k.push(h)}nt(u,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function sr(i,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||u}function Ho(i){this.za=0,this.i=[],this.j=new We,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=sr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=sr("baseRetryDelayMs",5e3,i),this.Za=sr("retryDelaySeedMs",1e4,i),this.Ta=sr("forwardChannelMaxRetries",2,i),this.va=sr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new So(i&&i.concurrentRequestLimit),this.Ba=new ku,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ho.prototype,n.ka=8,n.I=1,n.connect=function(i,u,h,p){he(0),this.W=i,this.H=u||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=na(this,null,this.W),Qr(this)};function ni(i){if(Ko(i),i.I==3){var u=i.V++,h=lt(i.J);if(xe(h,"SID",i.M),xe(h,"RID",u),xe(h,"TYPE","terminate"),ir(i,h),u=new He(i,i.j,u),u.M=2,u.A=Gr(lt(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=u.A,h=!0),h||(u.g=ra(u.j,null),u.g.ea(u.A)),u.F=Date.now(),$r(u)}ta(i)}function Kr(i){i.g&&(si(i),i.g.cancel(),i.g=null)}function Ko(i){Kr(i),i.v&&(a.clearTimeout(i.v),i.v=null),Yr(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Qr(i){if(!Po(i.h)&&!i.m){i.m=!0;var u=i.Ea;J||_(),Z||(J(),Z=!0),w.add(u,i),i.D=0}}function ju(i,u){return ko(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=u.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=fe(m(i.Ea,i,u),ea(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const S=new He(this,this.j,i);let k=this.o;if(this.U&&(k?(k=X(k),Vr(k,this.U)):k=this.U),this.u!==null||this.R||(S.J=k,k=null),this.S)e:{for(var u=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=h;break e}if(u===4096||h===this.i.length-1){u=h+1;break e}}u=1e3}else u=1e3;u=Yo(this,S,u),h=lt(this.J),xe(h,"RID",i),xe(h,"CVER",22),this.G&&xe(h,"X-HTTP-Session-Id",this.G),ir(this,h),k&&(this.R?u="headers="+yt(zo(k))+"&"+u:this.u&&ti(h,this.u,k)),Js(this.h,S),this.Ra&&xe(h,"TYPE","init"),this.S?(xe(h,"$req",u),xe(h,"SID","null"),S.U=!0,qr(S,h,null)):qr(S,h,u),this.I=2}}else this.I==3&&(i?Qo(this,i):this.i.length==0||Po(this.h)||Qo(this))};function Qo(i,u){var h;u?h=u.l:h=i.V++;const p=lt(i.J);xe(p,"SID",i.M),xe(p,"RID",h),xe(p,"AID",i.K),ir(i,p),i.u&&i.o&&ti(p,i.u,i.o),h=new He(i,i.j,h,i.D+1),i.u===null&&(h.J=i.o),u&&(i.i=u.G.concat(i.i)),u=Yo(i,h,1e3),h.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Js(i.h,h),qr(h,p,u)}function ir(i,u){i.H&&ee(i.H,function(h,p){xe(u,p,h)}),i.l&&ee({},function(h,p){xe(u,p,h)})}function Yo(i,u,h){h=Math.min(i.i.length,h);const p=i.l?m(i.l.Ka,i.l,i):null;e:{var S=i.i;let le=-1;for(;;){const Pe=["count="+h];le==-1?h>0?(le=S[0].g,Pe.push("ofs="+le)):le=0:Pe.push("ofs="+le);let ve=!0;for(let Ne=0;Ne<h;Ne++){var k=S[Ne].g;const ct=S[Ne].map;if(k-=le,k<0)le=Math.max(0,S[Ne].g-100),ve=!1;else try{k="req"+k+"_"||"";try{var z=ct instanceof Map?ct:Object.entries(ct);for(const[tn,Rt]of z){let St=Rt;d(Rt)&&(St=Hn(Rt)),Pe.push(k+tn+"="+encodeURIComponent(St))}}catch(tn){throw Pe.push(k+"type="+encodeURIComponent("_badmap")),tn}}catch{p&&p(ct)}}if(ve){z=Pe.join("&");break e}}z=void 0}return i=i.i.splice(0,h),u.G=i,z}function Xo(i){if(!i.g&&!i.v){i.Y=1;var u=i.Da;J||_(),Z||(J(),Z=!0),w.add(u,i),i.A=0}}function ri(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=fe(m(i.Da,i),ea(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Jo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=fe(m(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,he(10),Kr(this),Jo(this))};function si(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Jo(i){i.g=new He(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var u=lt(i.na);xe(u,"RID","rpc"),xe(u,"SID",i.M),xe(u,"AID",i.K),xe(u,"CI",i.F?"0":"1"),!i.F&&i.ia&&xe(u,"TO",i.ia),xe(u,"TYPE","xmlhttp"),ir(i,u),i.u&&i.o&&ti(u,i.u,i.o),i.O&&(i.g.H=i.O);var h=i.g;i=i.ba,h.M=1,h.A=Gr(lt(u)),h.u=null,h.R=!0,_n(h,i)}n.Va=function(){this.C!=null&&(this.C=null,Kr(this),ri(this),he(19))};function Yr(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Zo(i,u){var h=null;if(i.g==u){Yr(i),si(i),i.g=null;var p=2}else if(Xs(i.h,u))h=u.G,Do(i.h,u),p=1;else return;if(i.I!=0){if(u.o)if(p==1){h=u.u?u.u.length:0,u=Date.now()-u.F;var S=i.D;p=O(),Me(p,new se(p,h)),Qr(i)}else Xo(i);else if(S=u.m,S==3||S==0&&u.X>0||!(p==1&&ju(i,u)||p==2&&ri(i)))switch(h&&h.length>0&&(u=i.h,u.i=u.i.concat(h)),S){case 1:en(i,5);break;case 4:en(i,10);break;case 3:en(i,6);break;default:en(i,2)}}}function ea(i,u){let h=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(h*=2),h*u}function en(i,u){if(i.j.info("Error code "+u),u==2){var h=m(i.bb,i),p=i.Ua;const S=!p;p=new At(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Xn(p,"https"),Gr(p),S?Su(p.toString(),h):Pu(p.toString(),h)}else he(2);i.I=0,i.l&&i.l.pa(u),ta(i),Ko(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),he(2)):(this.j.info("Failed to ping google.com"),he(1))};function ta(i){if(i.I=0,i.ja=[],i.l){const u=Vo(i.h);(u.length!=0||i.i.length!=0)&&(F(i.ja,u),F(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function na(i,u,h){var p=h instanceof At?lt(h):new At(h);if(p.g!="")u&&(p.g=u+"."+p.g),Jn(p,p.u);else{var S=a.location;p=S.protocol,u=u?u+"."+S.hostname:S.hostname,S=+S.port;const k=new At(null);p&&Xn(k,p),u&&(k.g=u),S&&Jn(k,S),h&&(k.h=h),p=k}return h=i.G,u=i.wa,h&&u&&xe(p,h,u),xe(p,"VER",i.ka),ir(i,p),p}function ra(i,u,h){if(u&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=i.Aa&&!i.ma?new Ae(new ei({ab:h})):new Ae(i.ma),u.Fa(i.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function sa(){}n=sa.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Xr(){}Xr.prototype.g=function(i,u){return new Ye(i,u)};function Ye(i,u){Ve.call(this),this.g=new Ho(u),this.l=i,this.h=u&&u.messageUrlParams||null,i=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(i?i["X-WebChannel-Content-Type"]=u.messageContentType:i={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(i?i["X-WebChannel-Client-Profile"]=u.sa:i={"X-WebChannel-Client-Profile":u.sa}),this.g.U=i,(i=u&&u.Qb)&&!g(i)&&(this.g.u=i),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!g(u)&&(this.g.G=u,i=this.h,i!==null&&u in i&&(i=this.h,u in i&&delete i[u])),this.j=new bn(this)}v(Ye,Ve),Ye.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ye.prototype.close=function(){ni(this.g)},Ye.prototype.o=function(i){var u=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.v&&(h={},h.__data__=Hn(i),i=h);u.i.push(new xu(u.Ya++,i)),u.I==3&&Qr(u)},Ye.prototype.N=function(){this.g.l=null,delete this.j,ni(this.g),delete this.g,Ye.Z.N.call(this)};function ia(i){D.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var u=i.__sm__;if(u){e:{for(const h in u){i=h;break e}i=void 0}(this.i=i)&&(i=this.i,u=u!==null&&i in u?u[i]:void 0),this.data=u}else this.data=i}v(ia,D);function oa(){L.call(this),this.status=1}v(oa,L);function bn(i){this.g=i}v(bn,sa),bn.prototype.ra=function(){Me(this.g,"a")},bn.prototype.qa=function(i){Me(this.g,new ia(i))},bn.prototype.pa=function(i){Me(this.g,new oa)},bn.prototype.oa=function(){Me(this.g,"b")},Xr.prototype.createWebChannel=Xr.prototype.g,Ye.prototype.send=Ye.prototype.o,Ye.prototype.open=Ye.prototype.m,Ye.prototype.close=Ye.prototype.close,$l=function(){return new Xr},ql=function(){return O()},zl=H,Ti={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,is=Xe,Tt.COMPLETE="complete",Ul=Tt,R.EventType=I,I.OPEN="a",I.CLOSE="b",I.ERROR="c",I.MESSAGE="d",Ve.prototype.listen=Ve.prototype.J,ar=R,Ae.prototype.listenOnce=Ae.prototype.K,Ae.prototype.getLastError=Ae.prototype.Ha,Ae.prototype.getLastErrorCode=Ae.prototype.ya,Ae.prototype.getStatus=Ae.prototype.ca,Ae.prototype.getResponseJson=Ae.prototype.La,Ae.prototype.getResponseText=Ae.prototype.la,Ae.prototype.send=Ae.prototype.ea,Ae.prototype.setWithCredentials=Ae.prototype.Fa,Bl=Ae}).apply(typeof Zr<"u"?Zr:typeof self<"u"?self:typeof window<"u"?window:{});const Ea="@firebase/firestore",Ta="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ze.UNAUTHENTICATED=new ze(null),ze.GOOGLE_CREDENTIALS=new ze("google-credentials-uid"),ze.FIRST_PARTY=new ze("first-party-uid"),ze.MOCK_USER=new ze("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let On="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on=new Vl("@firebase/firestore");function xn(){return on.logLevel}function Y(n,...e){if(on.logLevel<=pe.DEBUG){const t=e.map(qi);on.debug(`Firestore (${On}): ${n}`,...t)}}function xt(n,...e){if(on.logLevel<=pe.ERROR){const t=e.map(qi);on.error(`Firestore (${On}): ${n}`,...t)}}function kn(n,...e){if(on.logLevel<=pe.WARN){const t=e.map(qi);on.warn(`Firestore (${On}): ${n}`,...t)}}function qi(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Gl(n,r,t)}function Gl(n,e,t){let r=`FIRESTORE (${On}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw xt(r),new Error(r)}function _e(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Gl(e,s,r)}function oe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class K extends Ln{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ze.UNAUTHENTICATED)))}shutdown(){}}class gf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class yf{constructor(e){this.t=e,this.currentUser=ze.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_e(this.o===void 0,42304);let r=this.i;const s=f=>this.i!==r?(r=this.i,t(f)):Promise.resolve();let o=new Lt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Lt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const f=o;e.enqueueRetryable((async()=>{await f.promise,await s(this.currentUser)}))},d=f=>{Y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((f=>d(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?d(f):(Y("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Lt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(_e(typeof r.accessToken=="string",31837,{l:r}),new Wl(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _e(e===null||typeof e=="string",2055,{h:e}),new ze(e)}}class _f{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ze.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class vf{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new _f(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(ze.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Aa{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Xh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){_e(this.o===void 0,3512);const r=o=>{o.error!=null&&Y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,Y("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{Y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Aa(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(_e(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Aa(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xf(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=xf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function ue(n,e){return n<e?-1:n>e?1:0}function Ai(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return hi(s)===hi(o)?ue(s,o):hi(s)?1:-1}return ue(n.length,e.length)}const wf=55296,Ef=57343;function hi(n){const e=n.charCodeAt(0);return e>=wf&&e<=Ef}function Dn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia="__name__";class ut{constructor(e,t,r){t===void 0?t=0:t>e.length&&re(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&re(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ut.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ut?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=ut.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return ue(e.length,t.length)}static compareSegments(e,t){const r=ut.isNumericId(e),s=ut.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?ut.extractNumericId(e).compare(ut.extractNumericId(t)):Ai(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Mt.fromString(e.substring(4,e.length-2))}}class be extends ut{construct(e,t,r){return new be(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new K(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new be(t)}static emptyPath(){return new be([])}}const Tf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oe extends ut{construct(e,t,r){return new Oe(e,t,r)}static isValidIdentifier(e){return Tf.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ia}static keyField(){return new Oe([Ia])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new K(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const d=e[s];if(d==="\\"){if(s+1===e.length)throw new K(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[s+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new K(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,s+=2}else d==="`"?(a=!a,s++):d!=="."||a?(r+=d,s++):(o(),s++)}if(o(),a)throw new K(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Oe(t)}static emptyPath(){return new Oe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.path=e}static fromPath(e){return new te(be.fromString(e))}static fromName(e){return new te(be.fromString(e).popFirst(5))}static empty(){return new te(be.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&be.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return be.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new be(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hl(n,e,t){if(!t)throw new K(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Af(n,e,t,r){if(e===!0&&r===!0)throw new K(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ca(n){if(!te.isDocumentKey(n))throw new K(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ra(n){if(te.isDocumentKey(n))throw new K(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Kl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ds(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":re(12329,{type:typeof n})}function vr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new K(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ds(n);throw new K(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function If(n,e){if(e<=0)throw new K(V.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(n,e){const t={typeString:n};return e&&(t.value=e),t}function Rr(n,e){if(!Kl(n))throw new K(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new K(V.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sa=-62135596800,Pa=1e6;class we{static now(){return we.fromMillis(Date.now())}static fromDate(e){return we.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Pa);return new we(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new K(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new K(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Sa)throw new K(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new K(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Pa}_compareTo(e){return this.seconds===e.seconds?ue(this.nanoseconds,e.nanoseconds):ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:we._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Rr(e,we._jsonSchema))return new we(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Sa;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}we._jsonSchemaVersion="firestore/timestamp/1.0",we._jsonSchema={type:Se("string",we._jsonSchemaVersion),seconds:Se("number"),nanoseconds:Se("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{static fromTimestamp(e){return new ie(e)}static min(){return new ie(new we(0,0))}static max(){return new ie(new we(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const br=-1;function Cf(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ie.fromTimestamp(r===1e9?new we(t+1,0):new we(t,r));return new Ft(s,te.empty(),e)}function Rf(n){return new Ft(n.readTime,n.key,br)}class Ft{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ft(ie.min(),te.empty(),br)}static max(){return new Ft(ie.max(),te.empty(),br)}}function Sf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=te.comparator(n.documentKey,e.documentKey),t!==0?t:ue(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fn(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==Pf)throw n;Y("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&re(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):j.reject(t)}static resolve(e){return new j(((t,r)=>{t(e)}))}static reject(e){return new j(((t,r)=>{r(e)}))}static waitFor(e){return new j(((t,r)=>{let s=0,o=0,a=!1;e.forEach((d=>{++s,d.next((()=>{++o,a&&o===s&&t()}),(f=>r(f)))})),a=!0,o===s&&t()}))}static or(e){let t=j.resolve(!1);for(const r of e)t=t.next((s=>s?j.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new j(((r,s)=>{const o=e.length,a=new Array(o);let d=0;for(let f=0;f<o;f++){const m=f;t(e[m]).next((y=>{a[m]=y,++d,d===o&&r(a)}),(y=>s(y)))}}))}static doWhile(e,t){return new j(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function Df(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Bn(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Vs.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi=-1;function Ns(n){return n==null}function bs(n){return n===0&&1/n==-1/0}function Vf(n){return typeof n=="number"&&Number.isInteger(n)&&!bs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ql="";function Nf(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ka(e)),e=jf(n.get(t),e);return ka(e)}function jf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Ql:t+="";break;default:t+=o}}return t}function ka(n){return n+Ql+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ln(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Yl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e,t){this.comparator=e,this.root=t||Le.EMPTY}insert(e,t){return new Te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Le.BLACK,null,null))}remove(e){return new Te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Le.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new es(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new es(this.root,e,this.comparator,!1)}getReverseIterator(){return new es(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new es(this.root,e,this.comparator,!0)}}class es{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Le{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Le.RED,this.left=s??Le.EMPTY,this.right=o??Le.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Le(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Le.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Le.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Le.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Le.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw re(43730,{key:this.key,value:this.value});if(this.right.isRed())throw re(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw re(27949);return e+(this.isRed()?0:1)}}Le.EMPTY=null,Le.RED=!0,Le.BLACK=!1;Le.EMPTY=new class{constructor(){this.size=0}get key(){throw re(57766)}get value(){throw re(16141)}get color(){throw re(16727)}get left(){throw re(29726)}get right(){throw re(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Le(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Va(this.data.getIterator())}getIteratorFrom(e){return new Va(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof De)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new De(this.comparator);return t.data=e,t}}class Va{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e){this.fields=e,e.sort(Oe.comparator)}static empty(){return new st([])}unionWith(e){let t=new De(Oe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new st(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Dn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Xl("Invalid base64 string: "+o):o}})(e);return new Fe(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Fe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fe.EMPTY_BYTE_STRING=new Fe("");const Mf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bt(n){if(_e(!!n,39018),typeof n=="string"){let e=0;const t=Mf.exec(n);if(_e(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ie(n.seconds),nanos:Ie(n.nanos)}}function Ie(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ut(n){return typeof n=="string"?Fe.fromBase64String(n):Fe.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl="server_timestamp",Zl="__type__",ec="__previous_value__",tc="__local_write_time__";function Wi(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Zl])==null?void 0:r.stringValue)===Jl}function js(n){const e=n.mapValue.fields[ec];return Wi(e)?js(e):e}function xr(n){const e=Bt(n.mapValue.fields[tc].timestampValue);return new we(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,t,r,s,o,a,d,f,m,y){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=d,this.longPollingOptions=f,this.useFetchStreams=m,this.isUsingEmulator=y}}const xs="(default)";class wr{constructor(e,t){this.projectId=e,this.database=t||xs}static empty(){return new wr("","")}get isDefaultDatabase(){return this.database===xs}isEqual(e){return e instanceof wr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc="__type__",Of="__max__",ts={mapValue:{}},rc="__vector__",ws="value";function zt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Wi(n)?4:Bf(n)?9007199254740991:Ff(n)?10:11:re(28295,{value:n})}function pt(n,e){if(n===e)return!0;const t=zt(n);if(t!==zt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xr(n).isEqual(xr(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=Bt(s.timestampValue),d=Bt(o.timestampValue);return a.seconds===d.seconds&&a.nanos===d.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return Ut(s.bytesValue).isEqual(Ut(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return Ie(s.geoPointValue.latitude)===Ie(o.geoPointValue.latitude)&&Ie(s.geoPointValue.longitude)===Ie(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Ie(s.integerValue)===Ie(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=Ie(s.doubleValue),d=Ie(o.doubleValue);return a===d?bs(a)===bs(d):isNaN(a)&&isNaN(d)}return!1})(n,e);case 9:return Dn(n.arrayValue.values||[],e.arrayValue.values||[],pt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},d=o.mapValue.fields||{};if(Da(a)!==Da(d))return!1;for(const f in a)if(a.hasOwnProperty(f)&&(d[f]===void 0||!pt(a[f],d[f])))return!1;return!0})(n,e);default:return re(52216,{left:n})}}function Er(n,e){return(n.values||[]).find((t=>pt(t,e)))!==void 0}function Vn(n,e){if(n===e)return 0;const t=zt(n),r=zt(e);if(t!==r)return ue(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ue(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const d=Ie(o.integerValue||o.doubleValue),f=Ie(a.integerValue||a.doubleValue);return d<f?-1:d>f?1:d===f?0:isNaN(d)?isNaN(f)?0:-1:1})(n,e);case 3:return Na(n.timestampValue,e.timestampValue);case 4:return Na(xr(n),xr(e));case 5:return Ai(n.stringValue,e.stringValue);case 6:return(function(o,a){const d=Ut(o),f=Ut(a);return d.compareTo(f)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const d=o.split("/"),f=a.split("/");for(let m=0;m<d.length&&m<f.length;m++){const y=ue(d[m],f[m]);if(y!==0)return y}return ue(d.length,f.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const d=ue(Ie(o.latitude),Ie(a.latitude));return d!==0?d:ue(Ie(o.longitude),Ie(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return ja(n.arrayValue,e.arrayValue);case 10:return(function(o,a){var A,C,F,N;const d=o.fields||{},f=a.fields||{},m=(A=d[ws])==null?void 0:A.arrayValue,y=(C=f[ws])==null?void 0:C.arrayValue,v=ue(((F=m==null?void 0:m.values)==null?void 0:F.length)||0,((N=y==null?void 0:y.values)==null?void 0:N.length)||0);return v!==0?v:ja(m,y)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ts.mapValue&&a===ts.mapValue)return 0;if(o===ts.mapValue)return 1;if(a===ts.mapValue)return-1;const d=o.fields||{},f=Object.keys(d),m=a.fields||{},y=Object.keys(m);f.sort(),y.sort();for(let v=0;v<f.length&&v<y.length;++v){const A=Ai(f[v],y[v]);if(A!==0)return A;const C=Vn(d[f[v]],m[y[v]]);if(C!==0)return C}return ue(f.length,y.length)})(n.mapValue,e.mapValue);default:throw re(23264,{he:t})}}function Na(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ue(n,e);const t=Bt(n),r=Bt(e),s=ue(t.seconds,r.seconds);return s!==0?s:ue(t.nanos,r.nanos)}function ja(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Vn(t[s],r[s]);if(o)return o}return ue(t.length,r.length)}function Nn(n){return Ii(n)}function Ii(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Bt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ut(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return te.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=Ii(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Ii(t.fields[a])}`;return s+"}"})(n.mapValue):re(61005,{value:n})}function os(n){switch(zt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=js(n);return e?16+os(e):16;case 5:return 2*n.stringValue.length;case 6:return Ut(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+os(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return ln(r.fields,((o,a)=>{s+=o.length+os(a)})),s})(n.mapValue);default:throw re(13486,{value:n})}}function Ma(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ci(n){return!!n&&"integerValue"in n}function Hi(n){return!!n&&"arrayValue"in n}function La(n){return!!n&&"nullValue"in n}function Oa(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function as(n){return!!n&&"mapValue"in n}function Ff(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[nc])==null?void 0:r.stringValue)===rc}function dr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ln(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=dr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=dr(n.arrayValue.values[t]);return e}return{...n}}function Bf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Of}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e){this.value=e}static empty(){return new Ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!as(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=dr(t)}setAll(e){let t=Oe.emptyPath(),r={},s=[];e.forEach(((a,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,r,s),r={},s=[],t=d.popLast()}a?r[d.lastSegment()]=dr(a):s.push(d.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());as(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];as(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){ln(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new Ze(dr(this.value))}}function sc(n){const e=[];return ln(n.fields,((t,r)=>{const s=new Oe([t]);if(as(r)){const o=sc(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new st(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e,t,r,s,o,a,d){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=d}static newInvalidDocument(e){return new qe(e,0,ie.min(),ie.min(),ie.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,s){return new qe(e,1,t,ie.min(),r,s,0)}static newNoDocument(e,t){return new qe(e,2,t,ie.min(),ie.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new qe(e,3,t,ie.min(),ie.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e,t){this.position=e,this.inclusive=t}}function Fa(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=te.comparator(te.fromName(a.referenceValue),t.key):r=Vn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ba(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!pt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Uf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{}class Re extends ic{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new qf(e,t,r):t==="array-contains"?new Wf(e,r):t==="in"?new Hf(e,r):t==="not-in"?new Kf(e,r):t==="array-contains-any"?new Qf(e,r):new Re(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new $f(e,r):new Gf(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vn(t,this.value)):t!==null&&zt(this.value)===zt(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return re(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class it extends ic{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new it(e,t)}matches(e){return oc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function oc(n){return n.op==="and"}function ac(n){return zf(n)&&oc(n)}function zf(n){for(const e of n.filters)if(e instanceof it)return!1;return!0}function Ri(n){if(n instanceof Re)return n.field.canonicalString()+n.op.toString()+Nn(n.value);if(ac(n))return n.filters.map((e=>Ri(e))).join(",");{const e=n.filters.map((t=>Ri(t))).join(",");return`${n.op}(${e})`}}function lc(n,e){return n instanceof Re?(function(r,s){return s instanceof Re&&r.op===s.op&&r.field.isEqual(s.field)&&pt(r.value,s.value)})(n,e):n instanceof it?(function(r,s){return s instanceof it&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,d)=>o&&lc(a,s.filters[d])),!0):!1})(n,e):void re(19439)}function cc(n){return n instanceof Re?(function(t){return`${t.field.canonicalString()} ${t.op} ${Nn(t.value)}`})(n):n instanceof it?(function(t){return t.op.toString()+" {"+t.getFilters().map(cc).join(" ,")+"}"})(n):"Filter"}class qf extends Re{constructor(e,t,r){super(e,t,r),this.key=te.fromName(r.referenceValue)}matches(e){const t=te.comparator(e.key,this.key);return this.matchesComparison(t)}}class $f extends Re{constructor(e,t){super(e,"in",t),this.keys=uc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Gf extends Re{constructor(e,t){super(e,"not-in",t),this.keys=uc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function uc(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((r=>te.fromName(r.referenceValue)))}class Wf extends Re{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Hi(t)&&Er(t.arrayValue,this.value)}}class Hf extends Re{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Er(this.value.arrayValue,t)}}class Kf extends Re{constructor(e,t){super(e,"not-in",t)}matches(e){if(Er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Er(this.value.arrayValue,t)}}class Qf extends Re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Hi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Er(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,t=null,r=[],s=[],o=null,a=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=d,this.Te=null}}function Ua(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Yf(n,e,t,r,s,o,a)}function Ki(n){const e=oe(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ri(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Ns(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Nn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Nn(r))).join(",")),e.Te=t}return e.Te}function Qi(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Uf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!lc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ba(n.startAt,e.startAt)&&Ba(n.endAt,e.endAt)}function Si(n){return te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t=null,r=[],s=[],o=null,a="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=d,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Xf(n,e,t,r,s,o,a,d){return new Un(n,e,t,r,s,o,a,d)}function dc(n){return new Un(n)}function za(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function hc(n){return n.collectionGroup!==null}function hr(n){const e=oe(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let d=new De(Oe.comparator);return a.filters.forEach((f=>{f.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Tr(o,r))})),t.has(Oe.keyField().canonicalString())||e.Ie.push(new Tr(Oe.keyField(),r))}return e.Ie}function dt(n){const e=oe(n);return e.Ee||(e.Ee=Jf(e,hr(n))),e.Ee}function Jf(n,e){if(n.limitType==="F")return Ua(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Tr(s.field,o)}));const t=n.endAt?new Es(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Es(n.startAt.position,n.startAt.inclusive):null;return Ua(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Pi(n,e){const t=n.filters.concat([e]);return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ts(n,e,t){return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ms(n,e){return Qi(dt(n),dt(e))&&n.limitType===e.limitType}function fc(n){return`${Ki(dt(n))}|lt:${n.limitType}`}function wn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>cc(s))).join(", ")}]`),Ns(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Nn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Nn(s))).join(",")),`Target(${r})`})(dt(n))}; limitType=${n.limitType})`}function Ls(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):te.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of hr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,d,f){const m=Fa(a,d,f);return a.inclusive?m<=0:m<0})(r.startAt,hr(r),s)||r.endAt&&!(function(a,d,f){const m=Fa(a,d,f);return a.inclusive?m>=0:m>0})(r.endAt,hr(r),s))})(n,e)}function Zf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function mc(n){return(e,t)=>{let r=!1;for(const s of hr(n)){const o=em(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function em(n,e,t){const r=n.field.isKeyField()?te.comparator(e.key,t.key):(function(o,a,d){const f=a.data.field(o),m=d.data.field(o);return f!==null&&m!==null?Vn(f,m):re(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return re(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ln(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Yl(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm=new Te(te.comparator);function wt(){return tm}const pc=new Te(te.comparator);function lr(...n){let e=pc;for(const t of n)e=e.insert(t.key,t);return e}function gc(n){let e=pc;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function sn(){return fr()}function yc(){return fr()}function fr(){return new cn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const nm=new Te(te.comparator),rm=new De(te.comparator);function de(...n){let e=rm;for(const t of n)e=e.add(t);return e}const sm=new De(ue);function im(){return sm}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bs(e)?"-0":e}}function _c(n){return{integerValue:""+n}}function om(n,e){return Vf(e)?_c(e):Yi(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(){this._=void 0}}function am(n,e,t){return n instanceof Ar?(function(s,o){const a={fields:{[Zl]:{stringValue:Jl},[tc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Wi(o)&&(o=js(o)),o&&(a.fields[ec]=o),{mapValue:a}})(t,e):n instanceof Ir?bc(n,e):n instanceof Cr?xc(n,e):(function(s,o){const a=vc(s,o),d=qa(a)+qa(s.Ae);return Ci(a)&&Ci(s.Ae)?_c(d):Yi(s.serializer,d)})(n,e)}function lm(n,e,t){return n instanceof Ir?bc(n,e):n instanceof Cr?xc(n,e):t}function vc(n,e){return n instanceof As?(function(r){return Ci(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Ar extends Os{}class Ir extends Os{constructor(e){super(),this.elements=e}}function bc(n,e){const t=wc(e);for(const r of n.elements)t.some((s=>pt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Cr extends Os{constructor(e){super(),this.elements=e}}function xc(n,e){let t=wc(e);for(const r of n.elements)t=t.filter((s=>!pt(s,r)));return{arrayValue:{values:t}}}class As extends Os{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function qa(n){return Ie(n.integerValue||n.doubleValue)}function wc(n){return Hi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){this.field=e,this.transform=t}}function um(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ir&&s instanceof Ir||r instanceof Cr&&s instanceof Cr?Dn(r.elements,s.elements,pt):r instanceof As&&s instanceof As?pt(r.Ae,s.Ae):r instanceof Ar&&s instanceof Ar})(n.transform,e.transform)}class dm{constructor(e,t){this.version=e,this.transformResults=t}}class vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vt}static exists(e){return new vt(void 0,e)}static updateTime(e){return new vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ls(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Fs{}function Ec(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ac(n.key,vt.none()):new Sr(n.key,n.data,vt.none());{const t=n.data,r=Ze.empty();let s=new De(Oe.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new un(n.key,r,new st(s.toArray()),vt.none())}}function hm(n,e,t){n instanceof Sr?(function(s,o,a){const d=s.value.clone(),f=Ga(s.fieldTransforms,o,a.transformResults);d.setAll(f),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()})(n,e,t):n instanceof un?(function(s,o,a){if(!ls(s.precondition,o))return void o.convertToUnknownDocument(a.version);const d=Ga(s.fieldTransforms,o,a.transformResults),f=o.data;f.setAll(Tc(s)),f.setAll(d),o.convertToFoundDocument(a.version,f).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function mr(n,e,t,r){return n instanceof Sr?(function(o,a,d,f){if(!ls(o.precondition,a))return d;const m=o.value.clone(),y=Wa(o.fieldTransforms,f,a);return m.setAll(y),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null})(n,e,t,r):n instanceof un?(function(o,a,d,f){if(!ls(o.precondition,a))return d;const m=Wa(o.fieldTransforms,f,a),y=a.data;return y.setAll(Tc(o)),y.setAll(m),a.convertToFoundDocument(a.version,y).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,e,t,r):(function(o,a,d){return ls(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):d})(n,e,t)}function fm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=vc(r.transform,s||null);o!=null&&(t===null&&(t=Ze.empty()),t.set(r.field,o))}return t||null}function $a(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Dn(r,s,((o,a)=>um(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Sr extends Fs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class un extends Fs{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Tc(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Ga(n,e,t){const r=new Map;_e(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,d=e.data.field(o.field);r.set(o.field,lm(a,d,t[s]))}return r}function Wa(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,am(o,a,e))}return r}class Ac extends Fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mm extends Fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&hm(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=mr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=mr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=yc();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let d=this.applyToLocalView(a,o.mutatedFields);d=t.has(s.key)?null:d;const f=Ec(a,d);f!==null&&r.set(s.key,f),a.isValidDocument()||a.convertToNoDocument(ie.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),de())}isEqual(e){return this.batchId===e.batchId&&Dn(this.mutations,e.mutations,((t,r)=>$a(t,r)))&&Dn(this.baseMutations,e.baseMutations,((t,r)=>$a(t,r)))}}class Xi{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){_e(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return nm})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Xi(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ce,me;function _m(n){switch(n){case V.OK:return re(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return re(15467,{code:n})}}function Ic(n){if(n===void 0)return xt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Ce.OK:return V.OK;case Ce.CANCELLED:return V.CANCELLED;case Ce.UNKNOWN:return V.UNKNOWN;case Ce.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Ce.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Ce.INTERNAL:return V.INTERNAL;case Ce.UNAVAILABLE:return V.UNAVAILABLE;case Ce.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Ce.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Ce.NOT_FOUND:return V.NOT_FOUND;case Ce.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Ce.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Ce.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Ce.ABORTED:return V.ABORTED;case Ce.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Ce.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Ce.DATA_LOSS:return V.DATA_LOSS;default:return re(39323,{code:n})}}(me=Ce||(Ce={}))[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vm(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bm=new Mt([4294967295,4294967295],0);function Ha(n){const e=vm().encode(n),t=new Fl;return t.update(e),new Uint8Array(t.digest())}function Ka(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Mt([t,r],0),new Mt([s,o],0)]}class Ji{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new cr(`Invalid padding: ${t}`);if(r<0)throw new cr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new cr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new cr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Mt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Mt.fromNumber(r)));return s.compare(bm)===1&&(s=new Mt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Ha(e),[r,s]=Ka(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Ji(o,s,t);return r.forEach((d=>a.insert(d))),a}insert(e){if(this.ge===0)return;const t=Ha(e),[r,s]=Ka(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class cr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Pr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Bs(ie.min(),s,new Te(ue),wt(),de())}}class Pr{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Pr(r,t,de(),de(),de())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Cc{constructor(e,t){this.targetId=e,this.Ce=t}}class Rc{constructor(e,t,r=Fe.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Qa{constructor(){this.ve=0,this.Fe=Ya(),this.Me=Fe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=de(),t=de(),r=de();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:re(38017,{changeType:o})}})),new Pr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Ya()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,_e(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class xm{constructor(e){this.Ge=e,this.ze=new Map,this.je=wt(),this.Je=ns(),this.He=ns(),this.Ye=new Te(ue)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:re(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(Si(o))if(r===0){const a=new te(o.path);this.et(t,a,qe.newNoDocument(a,ie.min()))}else _e(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const d=this.ut(e),f=d?this.ct(d,e,a):1;if(f!==0){this.it(t);const m=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,m)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,d;try{a=Ut(r).toUint8Array()}catch(f){if(f instanceof Xl)return kn("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{d=new Ji(a,s,o)}catch(f){return kn(f instanceof cr?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return d.ge===0?null:d}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),d=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const d=this.ot(a);if(d){if(o.current&&Si(d.target)){const f=new te(d.target.path);this.It(f).has(a)||this.Et(a,f)||this.et(a,f,qe.newNoDocument(f,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=de();this.He.forEach(((o,a)=>{let d=!0;a.forEachWhile((f=>{const m=this.ot(f);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Bs(e,t,this.Ye,this.je,r);return this.je=wt(),this.Je=ns(),this.He=ns(),this.Ye=new Te(ue),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Qa,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new De(ue),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new De(ue),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Y("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Qa),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ns(){return new Te(te.comparator)}function Ya(){return new Te(te.comparator)}const wm={asc:"ASCENDING",desc:"DESCENDING"},Em={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Tm={and:"AND",or:"OR"};class Am{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ki(n,e){return n.useProto3Json||Ns(e)?e:{value:e}}function Is(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Sc(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Im(n,e){return Is(n,e.toTimestamp())}function ht(n){return _e(!!n,49232),ie.fromTimestamp((function(t){const r=Bt(t);return new we(r.seconds,r.nanos)})(n))}function Zi(n,e){return Di(n,e).canonicalString()}function Di(n,e){const t=(function(s){return new be(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Pc(n){const e=be.fromString(n);return _e(jc(e),10190,{key:e.toString()}),e}function Vi(n,e){return Zi(n.databaseId,e.path)}function fi(n,e){const t=Pc(e);if(t.get(1)!==n.databaseId.projectId)throw new K(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new K(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new te(Dc(t))}function kc(n,e){return Zi(n.databaseId,e)}function Cm(n){const e=Pc(n);return e.length===4?be.emptyPath():Dc(e)}function Ni(n){return new be(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Dc(n){return _e(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Xa(n,e,t){return{name:Vi(n,e),fields:t.value.mapValue.fields}}function Rm(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:re(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(m,y){return m.useProto3Json?(_e(y===void 0||typeof y=="string",58123),Fe.fromBase64String(y||"")):(_e(y===void 0||y instanceof Buffer||y instanceof Uint8Array,16193),Fe.fromUint8Array(y||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,d=a&&(function(m){const y=m.code===void 0?V.UNKNOWN:Ic(m.code);return new K(y,m.message||"")})(a);t=new Rc(r,s,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=fi(n,r.document.name),o=ht(r.document.updateTime),a=r.document.createTime?ht(r.document.createTime):ie.min(),d=new Ze({mapValue:{fields:r.document.fields}}),f=qe.newFoundDocument(s,o,a,d),m=r.targetIds||[],y=r.removedTargetIds||[];t=new cs(m,y,f.key,f)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=fi(n,r.document),o=r.readTime?ht(r.readTime):ie.min(),a=qe.newNoDocument(s,o),d=r.removedTargetIds||[];t=new cs([],d,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=fi(n,r.document),o=r.removedTargetIds||[];t=new cs([],o,s,null)}else{if(!("filter"in e))return re(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new ym(s,o),d=r.targetId;t=new Cc(d,a)}}return t}function Sm(n,e){let t;if(e instanceof Sr)t={update:Xa(n,e.key,e.value)};else if(e instanceof Ac)t={delete:Vi(n,e.key)};else if(e instanceof un)t={update:Xa(n,e.key,e.data),updateMask:Om(e.fieldMask)};else{if(!(e instanceof mm))return re(16599,{Vt:e.type});t={verify:Vi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const d=a.transform;if(d instanceof Ar)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Ir)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Cr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof As)return{fieldPath:a.field.canonicalString(),increment:d.Ae};throw re(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:Im(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:re(27497)})(n,e.precondition)),t}function Pm(n,e){return n&&n.length>0?(_e(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?ht(s.updateTime):ht(o);return a.isEqual(ie.min())&&(a=ht(o)),new dm(a,s.transformResults||[])})(t,e)))):[]}function km(n,e){return{documents:[kc(n,e.path)]}}function Dm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=kc(n,s);const o=(function(m){if(m.length!==0)return Nc(it.create(m,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(m){if(m.length!==0)return m.map((y=>(function(A){return{field:En(A.field),direction:jm(A.dir)}})(y)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const d=ki(n,e.limit);return d!==null&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:t,parent:s}}function Vm(n){let e=Cm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){_e(r===1,65062);const y=t.from[0];y.allDescendants?s=y.collectionId:e=e.child(y.collectionId)}let o=[];t.where&&(o=(function(v){const A=Vc(v);return A instanceof it&&ac(A)?A.getFilters():[A]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map((A=>(function(F){return new Tr(Tn(F.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(F.direction))})(A)))})(t.orderBy));let d=null;t.limit&&(d=(function(v){let A;return A=typeof v=="object"?v.value:v,Ns(A)?null:A})(t.limit));let f=null;t.startAt&&(f=(function(v){const A=!!v.before,C=v.values||[];return new Es(C,A)})(t.startAt));let m=null;return t.endAt&&(m=(function(v){const A=!v.before,C=v.values||[];return new Es(C,A)})(t.endAt)),Xf(e,s,a,o,d,"F",f,m)}function Nm(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return re(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Vc(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Tn(t.unaryFilter.field);return Re.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Tn(t.unaryFilter.field);return Re.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Tn(t.unaryFilter.field);return Re.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Tn(t.unaryFilter.field);return Re.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return re(61313);default:return re(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Re.create(Tn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return re(58110);default:return re(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return it.create(t.compositeFilter.filters.map((r=>Vc(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return re(1026)}})(t.compositeFilter.op))})(n):re(30097,{filter:n})}function jm(n){return wm[n]}function Mm(n){return Em[n]}function Lm(n){return Tm[n]}function En(n){return{fieldPath:n.canonicalString()}}function Tn(n){return Oe.fromServerFormat(n.fieldPath)}function Nc(n){return n instanceof Re?(function(t){if(t.op==="=="){if(Oa(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NAN"}};if(La(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Oa(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NOT_NAN"}};if(La(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:En(t.field),op:Mm(t.op),value:t.value}}})(n):n instanceof it?(function(t){const r=t.getFilters().map((s=>Nc(s)));return r.length===1?r[0]:{compositeFilter:{op:Lm(t.op),filters:r}}})(n):re(54877,{filter:n})}function Om(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function jc(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,t,r,s,o=ie.min(),a=ie.min(),d=Fe.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=d,this.expectedCount=f}withSequenceNumber(e){return new Vt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Vt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Vt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Vt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e){this.yt=e}}function Bm(n){const e=Vm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ts(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(){this.Cn=new zm}addToCollectionParentIndex(e,t){return this.Cn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Ft.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Ft.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class zm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new De(be.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new De(be.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ja={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mc=41943040;class Qe{static withCacheSize(e){return new Qe(e,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qe.DEFAULT_COLLECTION_PERCENTILE=10,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qe.DEFAULT=new Qe(Mc,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qe.DISABLED=new Qe(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new jn(0)}static cr(){return new jn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Za="LruGarbageCollector",qm=1048576;function el([n,e],[t,r]){const s=ue(n,t);return s===0?ue(e,r):s}class $m{constructor(e){this.Ir=e,this.buffer=new De(el),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();el(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Gm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Y(Za,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bn(t)?Y(Za,"Ignoring IndexedDB error during garbage collection: ",t):await Fn(t)}await this.Vr(3e5)}))}}class Wm{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return j.resolve(Vs.ce);const r=new $m(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Y("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(Ja)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ja):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,d,f,m;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(Y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(e,s)))).next((v=>(r=v,d=Date.now(),this.removeTargets(e,r,t)))).next((v=>(o=v,f=Date.now(),this.removeOrphanedDocuments(e,r)))).next((v=>(m=Date.now(),xn()<=pe.DEBUG&&Y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-y}ms
	Determined least recently used ${s} in `+(d-a)+`ms
	Removed ${o} targets in `+(f-d)+`ms
	Removed ${v} documents in `+(m-f)+`ms
Total Duration: ${m-y}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function Hm(n,e){return new Wm(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(){this.changes=new cn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&mr(r.mutation,s,st.empty(),we.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,de()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=de()){const s=sn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=lr();return o.forEach(((d,f)=>{a=a.insert(d,f.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=sn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,de())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,d)=>{t.set(a,d)}))}))}computeViews(e,t,r,s){let o=wt();const a=fr(),d=(function(){return fr()})();return t.forEach(((f,m)=>{const y=r.get(m.key);s.has(m.key)&&(y===void 0||y.mutation instanceof un)?o=o.insert(m.key,m):y!==void 0?(a.set(m.key,y.mutation.getFieldMask()),mr(y.mutation,m,y.mutation.getFieldMask(),we.now())):a.set(m.key,st.empty())})),this.recalculateAndSaveOverlays(e,o).next((f=>(f.forEach(((m,y)=>a.set(m,y))),t.forEach(((m,y)=>d.set(m,new Qm(y,a.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,t){const r=fr();let s=new Te(((a,d)=>a-d)),o=de();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const d of a)d.keys().forEach((f=>{const m=t.get(f);if(m===null)return;let y=r.get(f)||st.empty();y=d.applyToLocalView(m,y),r.set(f,y);const v=(s.get(d.batchId)||de()).add(f);s=s.insert(d.batchId,v)}))})).next((()=>{const a=[],d=s.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,y=f.value,v=yc();y.forEach((A=>{if(!o.has(A)){const C=Ec(t.get(A),r.get(A));C!==null&&v.set(A,C),o=o.add(A)}})),a.push(this.documentOverlayCache.saveOverlays(e,m,v))}return j.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return te.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):hc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):j.resolve(sn());let d=br,f=o;return a.next((m=>j.forEach(m,((y,v)=>(d<v.largestBatchId&&(d=v.largestBatchId),o.get(y)?j.resolve():this.remoteDocumentCache.getEntry(e,y).next((A=>{f=f.insert(y,A)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,f,m,de()))).next((y=>({batchId:d,changes:gc(y)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next((r=>{let s=lr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=lr();return this.indexManager.getCollectionParents(e,o).next((d=>j.forEach(d,(f=>{const m=(function(v,A){return new Un(A,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,f.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,s).next((y=>{y.forEach(((v,A)=>{a=a.insert(v,A)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((f,m)=>{const y=m.getKey();a.get(y)===null&&(a=a.insert(y,qe.newInvalidDocument(y)))}));let d=lr();return a.forEach(((f,m)=>{const y=o.get(f);y!==void 0&&mr(y.mutation,m,st.empty(),we.now()),Ls(t,m)&&(d=d.insert(f,m))})),d}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return j.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:ht(s.createTime)}})(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Bm(s.bundledQuery),readTime:ht(s.readTime)}})(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(){this.overlays=new Te(te.comparator),this.qr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const r=sn();return j.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),j.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){const s=sn(),o=t.length+1,a=new te(t.child("")),d=this.overlays.getIteratorFrom(a);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===o&&f.largestBatchId>r&&s.set(f.getKey(),f)}return j.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new Te(((m,y)=>m-y));const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let y=o.get(m.largestBatchId);y===null&&(y=sn(),o=o.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const d=sn(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((m,y)=>d.set(m,y))),!(d.size()>=s)););return j.resolve(d)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new gm(t,r));let o=this.qr.get(t);o===void 0&&(o=de(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(){this.sessionToken=Fe.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){this.Qr=new De(je.$r),this.Ur=new De(je.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new je(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new je(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new te(new be([])),r=new je(t,e),s=new je(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new te(new be([])),r=new je(t,e),s=new je(t,e+1);let o=de();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new je(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class je{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return te.comparator(e.key,t.key)||ue(e.Yr,t.Yr)}static Kr(e,t){return ue(e.Yr,t.Yr)||te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new De(je.$r)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new pm(o,t,r,s);this.mutationQueue.push(a);for(const d of s)this.Zr=this.Zr.add(new je(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return j.resolve(a)}lookupMutationBatch(e,t){return j.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return j.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?Gi:this.tr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new je(t,0),s=new je(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const d=this.Xr(a.Yr);o.push(d)})),j.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(ue);return t.forEach((s=>{const o=new je(s,0),a=new je(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(d=>{r=r.add(d.Yr)}))})),j.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;te.isDocumentKey(o)||(o=o.child(""));const a=new je(new te(o),0);let d=new De(ue);return this.Zr.forEachWhile((f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===s&&(d=d.add(f.Yr)),!0)}),a),j.resolve(this.ti(d))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){_e(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return j.forEach(t.mutations,(s=>{const o=new je(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new je(t,0),s=this.Zr.firstAfterOrEqual(r);return j.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e){this.ri=e,this.docs=(function(){return new Te(te.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let r=wt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():qe.newInvalidDocument(s))})),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=wt();const a=t.path,d=new te(a.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(d);for(;f.hasNext();){const{key:m,value:{document:y}}=f.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||Sf(Rf(y),r)<=0||(s.has(y.key)||Ls(t,y))&&(o=o.insert(y.key,y.mutableCopy()))}return j.resolve(o)}getAllFromCollectionGroup(e,t,r,s){re(9500)}ii(e,t){return j.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new np(this)}getSize(e){return j.resolve(this.size)}}class np extends Km{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),j.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e){this.persistence=e,this.si=new cn((t=>Ki(t)),Qi),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.oi=0,this._i=new eo,this.targetCount=0,this.ai=jn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),j.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new jn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Pr(t),j.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,d)=>{d.sequenceNumber<=t&&r.get(d.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),s++)})),j.waitFor(o).next((()=>s))}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),j.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t){this.ui={},this.overlays={},this.ci=new Vs(0),this.li=!1,this.li=!0,this.hi=new Zm,this.referenceDelegate=e(this),this.Pi=new rp(this),this.indexManager=new Um,this.remoteDocumentCache=(function(s){return new tp(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Fm(t),this.Ii=new Xm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Jm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new ep(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Y("MemoryPersistence","Starting transaction:",e);const s=new sp(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return j.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class sp extends kf{constructor(e){super(),this.currentSequenceNumber=e}}class to{constructor(e){this.persistence=e,this.Ri=new eo,this.Vi=null}static mi(e){return new to(e)}get fi(){if(this.Vi)return this.Vi;throw re(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),j.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.fi,(r=>{const s=te.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,ie.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return j.or([()=>j.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Cs{constructor(e,t){this.persistence=e,this.pi=new cn((r=>Nf(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Hm(this,t)}static mi(e,t){return new Cs(e,t)}Ei(){}di(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return j.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?j.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((d=>{d||(r++,o.removeEntry(a,ie.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=os(e.data.value)),t}br(e,t,r){return j.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return j.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=de(),s=de();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new no(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Kd()?8:Df(Wd())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new ip;return this.Ss(e,t,a).next((d=>{if(o.result=d,this.Vs)return this.bs(e,t,a,d.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(xn()<=pe.DEBUG&&Y("QueryEngine","SDK will not create cache indexes for query:",wn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),j.resolve()):(xn()<=pe.DEBUG&&Y("QueryEngine","Query:",wn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(xn()<=pe.DEBUG&&Y("QueryEngine","The SDK decides to create cache indexes for query:",wn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dt(t))):j.resolve())}ys(e,t){if(za(t))return j.resolve(null);let r=dt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ts(t,null,"F"),r=dt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=de(...o);return this.ps.getDocuments(e,a).next((d=>this.indexManager.getMinOffset(e,r).next((f=>{const m=this.Ds(t,d);return this.Cs(t,m,a,f.readTime)?this.ys(e,Ts(t,null,"F")):this.vs(e,m,t,f)}))))})))))}ws(e,t,r,s){return za(t)||s.isEqual(ie.min())?j.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?j.resolve(null):(xn()<=pe.DEBUG&&Y("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),wn(t)),this.vs(e,a,t,Cf(s,br)).next((d=>d)))}))}Ds(e,t){let r=new De(mc(e));return t.forEach(((s,o)=>{Ls(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return xn()<=pe.DEBUG&&Y("QueryEngine","Using full collection scan to execute query:",wn(t)),this.ps.getDocumentsMatchingQuery(e,t,Ft.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ro="LocalStore",ap=3e8;class lp{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Te(ue),this.xs=new cn((o=>Ki(o)),Qi),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ym(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function cp(n,e,t,r){return new lp(n,e,t,r)}async function Oc(n,e){const t=oe(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],d=[];let f=de();for(const m of s){a.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}for(const m of o){d.push(m.batchId);for(const y of m.mutations)f=f.add(y.key)}return t.localDocuments.getDocuments(r,f).next((m=>({Ls:m,removedBatchIds:a,addedBatchIds:d})))}))}))}function up(n,e){const t=oe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,f,m,y){const v=m.batch,A=v.keys();let C=j.resolve();return A.forEach((F=>{C=C.next((()=>y.getEntry(f,F))).next((N=>{const P=m.docVersions.get(F);_e(P!==null,48541),N.version.compareTo(P)<0&&(v.applyToRemoteDocument(N,m),N.isValidDocument()&&(N.setReadTime(m.commitVersion),y.addEntry(N)))}))})),C.next((()=>d.mutationQueue.removeMutationBatch(f,v)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let f=de();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(f=f.add(d.batch.mutations[m].key));return f})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Fc(n){const e=oe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function dp(n,e){const t=oe(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const d=[];e.targetChanges.forEach(((y,v)=>{const A=s.get(v);if(!A)return;d.push(t.Pi.removeMatchingKeys(o,y.removedDocuments,v).next((()=>t.Pi.addMatchingKeys(o,y.addedDocuments,v))));let C=A.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?C=C.withResumeToken(Fe.EMPTY_BYTE_STRING,ie.min()).withLastLimboFreeSnapshotVersion(ie.min()):y.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(y.resumeToken,r)),s=s.insert(v,C),(function(N,P,q){return N.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=ap?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0})(A,C,y)&&d.push(t.Pi.updateTargetData(o,C))}));let f=wt(),m=de();if(e.documentUpdates.forEach((y=>{e.resolvedLimboDocuments.has(y)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(o,y))})),d.push(hp(o,a,e.documentUpdates).next((y=>{f=y.ks,m=y.qs}))),!r.isEqual(ie.min())){const y=t.Pi.getLastRemoteSnapshotVersion(o).next((v=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(y)}return j.waitFor(d).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,f,m))).next((()=>f))})).then((o=>(t.Ms=s,o)))}function hp(n,e,t){let r=de(),s=de();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=wt();return t.forEach(((d,f)=>{const m=o.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(d)),f.isNoDocument()&&f.version.isEqual(ie.min())?(e.removeEntry(d,f.readTime),a=a.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||f.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(f),a=a.insert(d,f)):Y(ro,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)})),{ks:a,qs:s}}))}function fp(n,e){const t=oe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Gi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function mp(n,e){const t=oe(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,j.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new Vt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function ji(n,e,t){const r=oe(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Bn(a))throw a;Y(ro,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function tl(n,e,t){const r=oe(n);let s=ie.min(),o=de();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(f,m,y){const v=oe(f),A=v.xs.get(y);return A!==void 0?j.resolve(v.Ms.get(A)):v.Pi.getTargetData(m,y)})(r,a,dt(e)).next((d=>{if(d)return s=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,d.targetId).next((f=>{o=f}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:ie.min(),t?o:de()))).next((d=>(pp(r,Zf(e),d),{documents:d,Qs:o})))))}function pp(n,e,t){let r=n.Os.get(e)||ie.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class nl{constructor(){this.activeTargetIds=im()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class gp{constructor(){this.Mo=new nl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new nl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl="ConnectivityMonitor";class sl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Y(rl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Y(rl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rs=null;function Mi(){return rs===null?rs=(function(){return 268435456+Math.round(2147483648*Math.random())})():rs++,"0x"+rs.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mi="RestConnection",_p={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vp{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===xs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Mi(),d=this.zo(e,t.toUriEncodedString());Y(mi,`Sending RPC '${e}' ${a}:`,d,r);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,s,o);const{host:m}=new URL(d),y=Ui(m);return this.Jo(e,d,f,r,y).then((v=>(Y(mi,`Received RPC '${e}' ${a}: `,v),v)),(v=>{throw kn(mi,`RPC '${e}' ${a} failed with error: `,v,"url: ",d,"request:",r),v}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+On})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=_p[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ue="WebChannelConnection";class xp extends vp{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Mi();return new Promise(((d,f)=>{const m=new Bl;m.setWithCredentials(!0),m.listenOnce(Ul.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case is.NO_ERROR:const v=m.getResponseJson();Y(Ue,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),d(v);break;case is.TIMEOUT:Y(Ue,`RPC '${e}' ${a} timed out`),f(new K(V.DEADLINE_EXCEEDED,"Request time out"));break;case is.HTTP_ERROR:const A=m.getStatus();if(Y(Ue,`RPC '${e}' ${a} failed with status:`,A,"response text:",m.getResponseText()),A>0){let C=m.getResponseJson();Array.isArray(C)&&(C=C[0]);const F=C==null?void 0:C.error;if(F&&F.status&&F.message){const N=(function(q){const B=q.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(B)>=0?B:V.UNKNOWN})(F.status);f(new K(N,F.message))}else f(new K(V.UNKNOWN,"Server responded with status "+m.getStatus()))}else f(new K(V.UNAVAILABLE,"Connection failed."));break;default:re(9055,{l_:e,streamId:a,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Y(Ue,`RPC '${e}' ${a} completed.`)}}));const y=JSON.stringify(s);Y(Ue,`RPC '${e}' ${a} sending request:`,s),m.send(t,"POST",y,r,15)}))}T_(e,t,r){const s=Mi(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=$l(),d=ql(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,t,r),f.encodeInitMessageHeaders=!0;const y=o.join("");Y(Ue,`Creating RPC '${e}' stream ${s}: ${y}`,f);const v=a.createWebChannel(y,f);this.I_(v);let A=!1,C=!1;const F=new bp({Yo:P=>{C?Y(Ue,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(A||(Y(Ue,`Opening RPC '${e}' stream ${s} transport.`),v.open(),A=!0),Y(Ue,`RPC '${e}' stream ${s} sending:`,P),v.send(P))},Zo:()=>v.close()}),N=(P,q,B)=>{P.listen(q,(G=>{try{B(G)}catch(Q){setTimeout((()=>{throw Q}),0)}}))};return N(v,ar.EventType.OPEN,(()=>{C||(Y(Ue,`RPC '${e}' stream ${s} transport opened.`),F.o_())})),N(v,ar.EventType.CLOSE,(()=>{C||(C=!0,Y(Ue,`RPC '${e}' stream ${s} transport closed`),F.a_(),this.E_(v))})),N(v,ar.EventType.ERROR,(P=>{C||(C=!0,kn(Ue,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),F.a_(new K(V.UNAVAILABLE,"The operation could not be completed")))})),N(v,ar.EventType.MESSAGE,(P=>{var q;if(!C){const B=P.data[0];_e(!!B,16349);const G=B,Q=(G==null?void 0:G.error)||((q=G[0])==null?void 0:q.error);if(Q){Y(Ue,`RPC '${e}' stream ${s} received error:`,Q);const J=Q.status;let Z=(function(b){const T=Ce[b];if(T!==void 0)return Ic(T)})(J),w=Q.message;Z===void 0&&(Z=V.INTERNAL,w="Unknown error status: "+J+" with message "+Q.message),C=!0,F.a_(new K(Z,w)),v.close()}else Y(Ue,`RPC '${e}' stream ${s} received:`,B),F.u_(B)}})),N(d,zl.STAT_EVENT,(P=>{P.stat===Ti.PROXY?Y(Ue,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===Ti.NOPROXY&&Y(Ue,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{F.__()}),0),F}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function pi(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(n){return new Am(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Y("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const il="PersistentStream";class Uc{constructor(e,t,r,s,o,a,d,f){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Bc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(xt(t.toString()),xt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new K(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Y(il,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Y(il,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class wp extends Uc{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Rm(this.serializer,e),r=(function(o){if(!("targetChange"in o))return ie.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?ie.min():a.readTime?ht(a.readTime):ie.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Ni(this.serializer),t.addTarget=(function(o,a){let d;const f=a.target;if(d=Si(f)?{documents:km(o,f)}:{query:Dm(o,f).ft},d.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){d.resumeToken=Sc(o,a.resumeToken);const m=ki(o,a.expectedCount);m!==null&&(d.expectedCount=m)}else if(a.snapshotVersion.compareTo(ie.min())>0){d.readTime=Is(o,a.snapshotVersion.toTimestamp());const m=ki(o,a.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=Nm(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Ni(this.serializer),t.removeTarget=e,this.q_(t)}}class Ep extends Uc{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return _e(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,_e(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){_e(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Pm(e.writeResults,e.commitTime),r=ht(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Ni(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Sm(this.serializer,r)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{}class Ap extends Tp{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new K(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,Di(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new K(V.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,d])=>this.connection.Ho(e,Di(t,r),s,a,d,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new K(V.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Ip{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(xt(t),this.aa=!1):Y("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const an="RemoteStore";class Cp{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{dn(this)&&(Y(an,"Restarting streams for network reachability change."),await(async function(f){const m=oe(f);m.Ea.add(4),await kr(m),m.Ra.set("Unknown"),m.Ea.delete(4),await zs(m)})(this))}))})),this.Ra=new Ip(r,s)}}async function zs(n){if(dn(n))for(const e of n.da)await e(!0)}async function kr(n){for(const e of n.da)await e(!1)}function zc(n,e){const t=oe(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ao(t)?oo(t):zn(t).O_()&&io(t,e))}function so(n,e){const t=oe(n),r=zn(t);t.Ia.delete(e),r.O_()&&qc(t,e),t.Ia.size===0&&(r.O_()?r.L_():dn(t)&&t.Ra.set("Unknown"))}function io(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ie.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zn(n).Y_(e)}function qc(n,e){n.Va.Ue(e),zn(n).Z_(e)}function oo(n){n.Va=new xm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),zn(n).start(),n.Ra.ua()}function ao(n){return dn(n)&&!zn(n).x_()&&n.Ia.size>0}function dn(n){return oe(n).Ea.size===0}function $c(n){n.Va=void 0}async function Rp(n){n.Ra.set("Online")}async function Sp(n){n.Ia.forEach(((e,t)=>{io(n,e)}))}async function Pp(n,e){$c(n),ao(n)?(n.Ra.ha(e),oo(n)):n.Ra.set("Unknown")}async function kp(n,e,t){if(n.Ra.set("Online"),e instanceof Rc&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const d of o.targetIds)s.Ia.has(d)&&(await s.remoteSyncer.rejectListen(d,a),s.Ia.delete(d),s.Va.removeTarget(d))})(n,e)}catch(r){Y(an,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rs(n,r)}else if(e instanceof cs?n.Va.Ze(e):e instanceof Cc?n.Va.st(e):n.Va.tt(e),!t.isEqual(ie.min()))try{const r=await Fc(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const d=o.Va.Tt(a);return d.targetChanges.forEach(((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const y=o.Ia.get(m);y&&o.Ia.set(m,y.withResumeToken(f.resumeToken,a))}})),d.targetMismatches.forEach(((f,m)=>{const y=o.Ia.get(f);if(!y)return;o.Ia.set(f,y.withResumeToken(Fe.EMPTY_BYTE_STRING,y.snapshotVersion)),qc(o,f);const v=new Vt(y.target,f,m,y.sequenceNumber);io(o,v)})),o.remoteSyncer.applyRemoteEvent(d)})(n,t)}catch(r){Y(an,"Failed to raise snapshot:",r),await Rs(n,r)}}async function Rs(n,e,t){if(!Bn(e))throw e;n.Ea.add(1),await kr(n),n.Ra.set("Offline"),t||(t=()=>Fc(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Y(an,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await zs(n)}))}function Gc(n,e){return e().catch((t=>Rs(n,t,e)))}async function qs(n){const e=oe(n),t=qt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Gi;for(;Dp(e);)try{const s=await fp(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Vp(e,s)}catch(s){await Rs(e,s)}Wc(e)&&Hc(e)}function Dp(n){return dn(n)&&n.Ta.length<10}function Vp(n,e){n.Ta.push(e);const t=qt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function Wc(n){return dn(n)&&!qt(n).x_()&&n.Ta.length>0}function Hc(n){qt(n).start()}async function Np(n){qt(n).ra()}async function jp(n){const e=qt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Mp(n,e,t){const r=n.Ta.shift(),s=Xi.from(r,e,t);await Gc(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await qs(n)}async function Lp(n,e){e&&qt(n).X_&&await(async function(r,s){if((function(a){return _m(a)&&a!==V.ABORTED})(s.code)){const o=r.Ta.shift();qt(r).B_(),await Gc(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await qs(r)}})(n,e),Wc(n)&&Hc(n)}async function ol(n,e){const t=oe(n);t.asyncQueue.verifyOperationInProgress(),Y(an,"RemoteStore received new credentials");const r=dn(t);t.Ea.add(3),await kr(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await zs(t)}async function Op(n,e){const t=oe(n);e?(t.Ea.delete(2),await zs(t)):e||(t.Ea.add(2),await kr(t),t.Ra.set("Unknown"))}function zn(n){return n.ma||(n.ma=(function(t,r,s){const o=oe(t);return o.sa(),new wp(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:Rp.bind(null,n),t_:Sp.bind(null,n),r_:Pp.bind(null,n),H_:kp.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ao(n)?oo(n):n.Ra.set("Unknown")):(await n.ma.stop(),$c(n))}))),n.ma}function qt(n){return n.fa||(n.fa=(function(t,r,s){const o=oe(t);return o.sa(),new Ep(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Np.bind(null,n),r_:Lp.bind(null,n),ta:jp.bind(null,n),na:Mp.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await qs(n)):(await n.fa.stop(),n.Ta.length>0&&(Y(an,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,d=new lo(e,t,a,s,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new K(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function co(n,e){if(xt("AsyncQueue",`${e}: ${n}`),Bn(n))return new K(V.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{static emptySet(e){return new In(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||te.comparator(t.key,r.key):(t,r)=>te.comparator(t.key,r.key),this.keyedMap=lr(),this.sortedSet=new Te(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof In)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new In;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(){this.ga=new Te(te.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):re(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Mn{constructor(e,t,r,s,o,a,d,f,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((d=>{a.push({type:0,doc:d})})),new Mn(e,t,In.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ms(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Bp{constructor(){this.queries=ll(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=oe(t),o=s.queries;s.queries=ll(),o.forEach(((a,d)=>{for(const f of d.Sa)f.onError(r)}))})(this,new K(V.ABORTED,"Firestore shutting down"))}}function ll(){return new cn((n=>fc(n)),Ms)}async function Up(n,e){const t=oe(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new Fp,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const d=co(a,`Initialization of query '${wn(e.query)}' failed`);return void e.onError(d)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&uo(t)}async function zp(n,e){const t=oe(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function qp(n,e){const t=oe(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const d of a.Sa)d.Fa(s)&&(r=!0);a.wa=s}}r&&uo(t)}function $p(n,e,t){const r=oe(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function uo(n){n.Ca.forEach((e=>{e.next()}))}var Li,cl;(cl=Li||(Li={})).Ma="default",cl.Cache="cache";class Gp{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Mn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Mn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Li.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e){this.key=e}}class Qc{constructor(e){this.key=e}}class Wp{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=de(),this.mutatedKeys=de(),this.eu=mc(e),this.tu=new In(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new al,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,d=!1;const f=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,m=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((y,v)=>{const A=s.get(y),C=Ls(this.query,v)?v:null,F=!!A&&this.mutatedKeys.has(A.key),N=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let P=!1;A&&C?A.data.isEqual(C.data)?F!==N&&(r.track({type:3,doc:C}),P=!0):this.su(A,C)||(r.track({type:2,doc:C}),P=!0,(f&&this.eu(C,f)>0||m&&this.eu(C,m)<0)&&(d=!0)):!A&&C?(r.track({type:0,doc:C}),P=!0):A&&!C&&(r.track({type:1,doc:A}),P=!0,(f||m)&&(d=!0)),P&&(C?(a=a.add(C),o=N?o.add(y):o.delete(y)):(a=a.delete(y),o=o.delete(y)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const y=this.query.limitType==="F"?a.last():a.first();a=a.delete(y.key),o=o.delete(y.key),r.track({type:1,doc:y})}return{tu:a,iu:r,Cs:d,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((y,v)=>(function(C,F){const N=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return re(20277,{Rt:P})}};return N(C)-N(F)})(y.type,v.type)||this.eu(y.doc,v.doc))),this.ou(r),s=s??!1;const d=t&&!s?this._u():[],f=this.Xa.size===0&&this.current&&!s?1:0,m=f!==this.Za;return this.Za=f,a.length!==0||m?{snapshot:new Mn(this.query,e.tu,o,a,e.mutatedKeys,f===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new al,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=de(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Qc(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new Kc(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=de();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Mn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ho="SyncEngine";class Hp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Kp{constructor(e){this.key=e,this.hu=!1}}class Qp{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new cn((d=>fc(d)),Ms),this.Iu=new Map,this.Eu=new Set,this.du=new Te(te.comparator),this.Au=new Map,this.Ru=new eo,this.Vu={},this.mu=new Map,this.fu=jn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Yp(n,e,t=!0){const r=tu(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Yc(r,e,t,!0),s}async function Xp(n,e){const t=tu(n);await Yc(t,e,!0,!1)}async function Yc(n,e,t,r){const s=await mp(n.localStore,dt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let d;return r&&(d=await Jp(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&zc(n.remoteStore,s),d}async function Jp(n,e,t,r,s){n.pu=(v,A,C)=>(async function(N,P,q,B){let G=P.view.ru(q);G.Cs&&(G=await tl(N.localStore,P.query,!1).then((({documents:w})=>P.view.ru(w,G))));const Q=B&&B.targetChanges.get(P.targetId),J=B&&B.targetMismatches.get(P.targetId)!=null,Z=P.view.applyChanges(G,N.isPrimaryClient,Q,J);return dl(N,P.targetId,Z.au),Z.snapshot})(n,v,A,C);const o=await tl(n.localStore,e,!0),a=new Wp(e,o.Qs),d=a.ru(o.documents),f=Pr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),m=a.applyChanges(d,n.isPrimaryClient,f);dl(n,t,m.au);const y=new Hp(e,t,a);return n.Tu.set(e,y),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),m.snapshot}async function Zp(n,e,t){const r=oe(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Ms(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ji(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&so(r.remoteStore,s.targetId),Oi(r,s.targetId)})).catch(Fn)):(Oi(r,s.targetId),await ji(r.localStore,s.targetId,!0))}async function eg(n,e){const t=oe(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),so(t.remoteStore,r.targetId))}async function tg(n,e,t){const r=lg(n);try{const s=await(function(a,d){const f=oe(a),m=we.now(),y=d.reduce(((C,F)=>C.add(F.key)),de());let v,A;return f.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let F=wt(),N=de();return f.Ns.getEntries(C,y).next((P=>{F=P,F.forEach(((q,B)=>{B.isValidDocument()||(N=N.add(q))}))})).next((()=>f.localDocuments.getOverlayedDocuments(C,F))).next((P=>{v=P;const q=[];for(const B of d){const G=fm(B,v.get(B.key).overlayedDocument);G!=null&&q.push(new un(B.key,G,sc(G.value.mapValue),vt.exists(!0)))}return f.mutationQueue.addMutationBatch(C,m,q,d)})).next((P=>{A=P;const q=P.applyToLocalDocumentSet(v,N);return f.documentOverlayCache.saveOverlays(C,P.batchId,q)}))})).then((()=>({batchId:A.batchId,changes:gc(v)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,d,f){let m=a.Vu[a.currentUser.toKey()];m||(m=new Te(ue)),m=m.insert(d,f),a.Vu[a.currentUser.toKey()]=m})(r,s.batchId,t),await Dr(r,s.changes),await qs(r.remoteStore)}catch(s){const o=co(s,"Failed to persist write");t.reject(o)}}async function Xc(n,e){const t=oe(n);try{const r=await dp(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(_e(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?_e(a.hu,14607):s.removedDocuments.size>0&&(_e(a.hu,42227),a.hu=!1))})),await Dr(t,r,e)}catch(r){await Fn(r)}}function ul(n,e,t){const r=oe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const d=a.view.va(e);d.snapshot&&s.push(d.snapshot)})),(function(a,d){const f=oe(a);f.onlineState=d;let m=!1;f.queries.forEach(((y,v)=>{for(const A of v.Sa)A.va(d)&&(m=!0)})),m&&uo(f)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ng(n,e,t){const r=oe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new Te(te.comparator);a=a.insert(o,qe.newNoDocument(o,ie.min()));const d=de().add(o),f=new Bs(ie.min(),new Map,new Te(ue),a,d);await Xc(r,f),r.du=r.du.remove(o),r.Au.delete(e),fo(r)}else await ji(r.localStore,e,!1).then((()=>Oi(r,e,t))).catch(Fn)}async function rg(n,e){const t=oe(n),r=e.batch.batchId;try{const s=await up(t.localStore,e);Zc(t,r,null),Jc(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Dr(t,s)}catch(s){await Fn(s)}}async function sg(n,e,t){const r=oe(n);try{const s=await(function(a,d){const f=oe(a);return f.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let y;return f.mutationQueue.lookupMutationBatch(m,d).next((v=>(_e(v!==null,37113),y=v.keys(),f.mutationQueue.removeMutationBatch(m,v)))).next((()=>f.mutationQueue.performConsistencyCheck(m))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(m,y,d))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,y))).next((()=>f.localDocuments.getDocuments(m,y)))}))})(r.localStore,e);Zc(r,e,t),Jc(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Dr(r,s)}catch(s){await Fn(s)}}function Jc(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Zc(n,e,t){const r=oe(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Oi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||eu(n,r)}))}function eu(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(so(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),fo(n))}function dl(n,e,t){for(const r of t)r instanceof Kc?(n.Ru.addReference(r.key,e),ig(n,r)):r instanceof Qc?(Y(ho,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||eu(n,r.key)):re(19791,{wu:r})}function ig(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Y(ho,"New document in limbo: "+t),n.Eu.add(r),fo(n))}function fo(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new te(be.fromString(e)),r=n.fu.next();n.Au.set(r,new Kp(t)),n.du=n.du.insert(t,r),zc(n.remoteStore,new Vt(dt(dc(t.path)),r,"TargetPurposeLimboResolution",Vs.ce))}}async function Dr(n,e,t){const r=oe(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,f)=>{a.push(r.pu(f,e,t).then((m=>{var y;if((m||t)&&r.isPrimaryClient){const v=m?!m.fromCache:(y=t==null?void 0:t.targetChanges.get(f.targetId))==null?void 0:y.current;r.sharedClientState.updateQueryState(f.targetId,v?"current":"not-current")}if(m){s.push(m);const v=no.As(f.targetId,m);o.push(v)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(f,m){const y=oe(f);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>j.forEach(m,(A=>j.forEach(A.Es,(C=>y.persistence.referenceDelegate.addReference(v,A.targetId,C))).next((()=>j.forEach(A.ds,(C=>y.persistence.referenceDelegate.removeReference(v,A.targetId,C)))))))))}catch(v){if(!Bn(v))throw v;Y(ro,"Failed to update sequence numbers: "+v)}for(const v of m){const A=v.targetId;if(!v.fromCache){const C=y.Ms.get(A),F=C.snapshotVersion,N=C.withLastLimboFreeSnapshotVersion(F);y.Ms=y.Ms.insert(A,N)}}})(r.localStore,o))}async function og(n,e){const t=oe(n);if(!t.currentUser.isEqual(e)){Y(ho,"User change. New user:",e.toKey());const r=await Oc(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((d=>{d.forEach((f=>{f.reject(new K(V.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Dr(t,r.Ls)}}function ag(n,e){const t=oe(n),r=t.Au.get(e);if(r&&r.hu)return de().add(r.key);{let s=de();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const d=t.Tu.get(a);s=s.unionWith(d.view.nu)}return s}}function tu(n){const e=oe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ag.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ng.bind(null,e),e.Pu.H_=qp.bind(null,e.eventManager),e.Pu.yu=$p.bind(null,e.eventManager),e}function lg(n){const e=oe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sg.bind(null,e),e}class Ss{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Us(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return cp(this.persistence,new op,e.initialUser,this.serializer)}Cu(e){return new Lc(to.mi,this.serializer)}Du(e){return new gp}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ss.provider={build:()=>new Ss};class cg extends Ss{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){_e(this.persistence.referenceDelegate instanceof Cs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Gm(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Qe.withCacheSize(this.cacheSizeBytes):Qe.DEFAULT;return new Lc((r=>Cs.mi(r,t)),this.serializer)}}class Fi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ul(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=og.bind(null,this.syncEngine),await Op(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Bp})()}createDatastore(e){const t=Us(e.databaseInfo.databaseId),r=(function(o){return new xp(o)})(e.databaseInfo);return(function(o,a,d,f){return new Ap(o,a,d,f)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,d){return new Cp(r,s,o,a,d)})(this.localStore,this.datastore,e.asyncQueue,(t=>ul(this.syncEngine,t,0)),(function(){return sl.v()?new sl:new yp})())}createSyncEngine(e,t){return(function(s,o,a,d,f,m,y){const v=new Qp(s,o,a,d,f,m);return y&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const o=oe(s);Y(an,"RemoteStore shutting down."),o.Ea.add(5),await kr(o),o.Aa.shutdown(),o.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Fi.provider={build:()=>new Fi};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):xt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="FirestoreClient";class dg{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ze.UNAUTHENTICATED,this.clientId=$i.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{Y($t,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(Y($t,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=co(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function gi(n,e){n.asyncQueue.verifyOperationInProgress(),Y($t,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Oc(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function hl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await hg(n);Y($t,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>ol(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>ol(e.remoteStore,s))),n._onlineComponents=e}async function hg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Y($t,"Using user provided OfflineComponentProvider");try{await gi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;kn("Error using user provided cache. Falling back to memory cache: "+t),await gi(n,new Ss)}}else Y($t,"Using default OfflineComponentProvider"),await gi(n,new cg(void 0));return n._offlineComponents}async function nu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Y($t,"Using user provided OnlineComponentProvider"),await hl(n,n._uninitializedComponentsProvider._online)):(Y($t,"Using default OnlineComponentProvider"),await hl(n,new Fi))),n._onlineComponents}function fg(n){return nu(n).then((e=>e.syncEngine))}async function mg(n){const e=await nu(n),t=e.eventManager;return t.onListen=Yp.bind(null,e.syncEngine),t.onUnlisten=Zp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Xp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=eg.bind(null,e.syncEngine),t}function pg(n,e,t={}){const r=new Lt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,d,f,m){const y=new ug({next:A=>{y.Nu(),a.enqueueAndForget((()=>zp(o,v))),A.fromCache&&f.source==="server"?m.reject(new K(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(A)},error:A=>m.reject(A)}),v=new Gp(d,y,{includeMetadataChanges:!0,qa:!0});return Up(o,v)})(await mg(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su="firestore.googleapis.com",ml=!0;class pl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new K(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=su,this.ssl=ml}else this.host=e.host,this.ssl=e.ssl??ml;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Mc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qm)throw new K(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Af("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ru(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $s{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new K(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new K(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new pf;switch(r.type){case"firstParty":return new vf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new K(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=fl.get(t);r&&(Y("ComponentProvider","Removing Datastore"),fl.delete(t),r.terminate())})(this),Promise.resolve()}}function gg(n,e,t,r={}){var m;n=vr(n,$s);const s=Ui(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},d=`${e}:${t}`;s&&(Ud(`https://${d}`),Gd("Firestore",!0)),o.host!==su&&o.host!==d&&kn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...o,host:d,ssl:s,emulatorOptions:r};if(!ys(f,a)&&(n._setSettings(f),r.mockUserToken)){let y,v;if(typeof r.mockUserToken=="string")y=r.mockUserToken,v=ze.MOCK_USER;else{y=zd(r.mockUserToken,(m=n._app)==null?void 0:m.options.projectId);const A=r.mockUserToken.sub||r.mockUserToken.user_id;if(!A)throw new K(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new ze(A)}n._authCredentials=new gf(new Wl(y,v))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Wt(this.firestore,e,this._query)}}class ke{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ke(this.firestore,e,this._key)}toJSON(){return{type:ke._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Rr(t,ke._jsonSchema))return new ke(e,r||null,new te(be.fromString(t.referencePath)))}}ke._jsonSchemaVersion="firestore/documentReference/1.0",ke._jsonSchema={type:Se("string",ke._jsonSchemaVersion),referencePath:Se("string")};class Ot extends Wt{constructor(e,t,r){super(e,t,dc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ke(this.firestore,null,new te(e))}withConverter(e){return new Ot(this.firestore,e,this._path)}}function iu(n,e,...t){if(n=Pn(n),Hl("collection","path",e),n instanceof $s){const r=be.fromString(e,...t);return Ra(r),new Ot(n,null,r)}{if(!(n instanceof ke||n instanceof Ot))throw new K(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(be.fromString(e,...t));return Ra(r),new Ot(n.firestore,null,r)}}function gl(n,e,...t){if(n=Pn(n),arguments.length===1&&(e=$i.newId()),Hl("doc","path",e),n instanceof $s){const r=be.fromString(e,...t);return Ca(r),new ke(n,null,new te(r))}{if(!(n instanceof ke||n instanceof Ot))throw new K(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(be.fromString(e,...t));return Ca(r),new ke(n.firestore,n instanceof Ot?n.converter:null,new te(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl="AsyncQueue";class _l{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Bc(this,"async_queue_retry"),this._c=()=>{const r=pi();r&&Y(yl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=pi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=pi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Lt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Bn(e))throw e;Y(yl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,xt("INTERNAL UNHANDLED ERROR: ",vl(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=lo.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&re(47125,{Pc:vl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function vl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class mo extends $s{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new _l,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _l(e),this._firestoreClient=void 0,await e}}}function yg(n,e){const t=typeof n=="object"?n:tf(),r=typeof n=="string"?n:xs,s=Yh(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Fd("firestore");o&&gg(s,...o)}return s}function ou(n){if(n._terminated)throw new K(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||_g(n),n._firestoreClient}function _g(n){var r,s,o;const e=n._freezeSettings(),t=(function(d,f,m,y){return new Lf(d,f,m,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,ru(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator)})(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new dg(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(d){const f=d==null?void 0:d._online.build();return{_offline:d==null?void 0:d._offline.build(f),_online:f}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this._byteString=e}static fromBase64String(e){try{return new et(Fe.fromBase64String(e))}catch(t){throw new K(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new et(Fe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:et._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Rr(e,et._jsonSchema))return et.fromBase64String(e.bytes)}}et._jsonSchemaVersion="firestore/bytes/1.0",et._jsonSchema={type:Se("string",et._jsonSchemaVersion),bytes:Se("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new K(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new K(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new K(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ue(this._lat,e._lat)||ue(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ft._jsonSchemaVersion}}static fromJSON(e){if(Rr(e,ft._jsonSchema))return new ft(e.latitude,e.longitude)}}ft._jsonSchemaVersion="firestore/geoPoint/1.0",ft._jsonSchema={type:Se("string",ft._jsonSchemaVersion),latitude:Se("number"),longitude:Se("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:mt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Rr(e,mt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new mt(e.vectorValues);throw new K(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}mt._jsonSchemaVersion="firestore/vectorValue/1.0",mt._jsonSchema={type:Se("string",mt._jsonSchemaVersion),vectorValues:Se("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vg=/^__.*__$/;class bg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new un(e,this.data,this.fieldMask,t,this.fieldTransforms):new Sr(e,this.data,t,this.fieldTransforms)}}function au(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw re(40011,{Ac:n})}}class yo{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new yo({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ps(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(au(this.Ac)&&vg.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class xg{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Us(e)}Cc(e,t,r,s=!1){return new yo({Ac:e,methodName:t,Dc:r,path:Oe.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lu(n){const e=n._freezeSettings(),t=Us(n._databaseId);return new xg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wg(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);du("Data must be an object, but it was:",a,r);const d=cu(r,a);let f,m;if(o.merge)f=new st(a.fieldMask),m=a.fieldTransforms;else if(o.mergeFields){const y=[];for(const v of o.mergeFields){const A=Tg(e,v,t);if(!a.contains(A))throw new K(V.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Ig(y,A)||y.push(A)}f=new st(y),m=a.fieldTransforms.filter((v=>f.covers(v.field)))}else f=null,m=a.fieldTransforms;return new bg(new Ze(d),f,m)}class _o extends go{_toFieldTransform(e){return new cm(e.path,new Ar)}isEqual(e){return e instanceof _o}}function Eg(n,e,t,r=!1){return vo(t,n.Cc(r?4:3,e))}function vo(n,e){if(uu(n=Pn(n)))return du("Unsupported field value:",e,n),cu(n,e);if(n instanceof go)return(function(r,s){if(!au(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const d of r){let f=vo(d,s.wc(a));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=Pn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return om(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=we.fromDate(r);return{timestampValue:Is(s.serializer,o)}}if(r instanceof we){const o=new we(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Is(s.serializer,o)}}if(r instanceof ft)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof et)return{bytesValue:Sc(s.serializer,r._byteString)};if(r instanceof ke){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Zi(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof mt)return(function(a,d){return{mapValue:{fields:{[nc]:{stringValue:rc},[ws]:{arrayValue:{values:a.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return Yi(d.serializer,m)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Ds(r)}`)})(n,e)}function cu(n,e){const t={};return Yl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ln(n,((r,s)=>{const o=vo(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function uu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof we||n instanceof ft||n instanceof et||n instanceof ke||n instanceof go||n instanceof mt)}function du(n,e,t){if(!uu(t)||!Kl(t)){const r=Ds(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Tg(n,e,t){if((e=Pn(e))instanceof po)return e._internalPath;if(typeof e=="string")return hu(n,e);throw Ps("Field path arguments must be of type string or ",n,!1,void 0,t)}const Ag=new RegExp("[~\\*/\\[\\]]");function hu(n,e,t){if(e.search(Ag)>=0)throw Ps(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new po(...e.split("."))._internalPath}catch{throw Ps(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ps(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(o||a)&&(f+=" (found",o&&(f+=` in field ${r}`),a&&(f+=` in document ${s}`),f+=")"),new K(V.INVALID_ARGUMENT,d+n+f)}function Ig(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ke(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Cg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Cg extends fu{data(){return super.data()}}function bo(n,e){return typeof e=="string"?hu(n,e):e instanceof po?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new K(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xo{}class wo extends xo{}function mu(n,e,...t){let r=[];e instanceof xo&&r.push(e),r=r.concat(t),(function(o){const a=o.filter((f=>f instanceof To)).length,d=o.filter((f=>f instanceof Eo)).length;if(a>1||a>0&&d>0)throw new K(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class Eo extends wo{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Eo(e,t,r)}_apply(e){const t=this._parse(e);return yu(e._query,t),new Wt(e.firestore,e.converter,Pi(e._query,t))}_parse(e){const t=lu(e.firestore);return(function(o,a,d,f,m,y,v){let A;if(m.isKeyField()){if(y==="array-contains"||y==="array-contains-any")throw new K(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if(y==="in"||y==="not-in"){xl(v,y);const F=[];for(const N of v)F.push(bl(f,o,N));A={arrayValue:{values:F}}}else A=bl(f,o,v)}else y!=="in"&&y!=="not-in"&&y!=="array-contains-any"||xl(v,y),A=Eg(d,a,v,y==="in"||y==="not-in");return Re.create(m,y,A)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class To extends xo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new To(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:it.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,o){let a=s;const d=o.getFlattenedFilters();for(const f of d)yu(a,f),a=Pi(a,f)})(e._query,t),new Wt(e.firestore,e.converter,Pi(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ao extends wo{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ao(e,t)}_apply(e){const t=(function(s,o,a){if(s.startAt!==null)throw new K(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new K(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Tr(o,a)})(e._query,this._field,this._direction);return new Wt(e.firestore,e.converter,(function(s,o){const a=s.explicitOrderBy.concat([o]);return new Un(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function pu(n,e="asc"){const t=e,r=bo("orderBy",n);return Ao._create(r,t)}class Io extends wo{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Io(e,t,r)}_apply(e){return new Wt(e.firestore,e.converter,Ts(e._query,this._limit,this._limitType))}}function gu(n){return If("limit",n),Io._create("limit",n,"F")}function bl(n,e,t){if(typeof(t=Pn(t))=="string"){if(t==="")throw new K(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hc(e)&&t.indexOf("/")!==-1)throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(be.fromString(t));if(!te.isDocumentKey(r))throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ma(n,new te(r))}if(t instanceof ke)return Ma(n,t._key);throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ds(t)}.`)}function xl(n,e){if(!Array.isArray(n)||n.length===0)throw new K(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function yu(n,e){const t=(function(s,o){for(const a of s)for(const d of a.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new K(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new K(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Sg{convertValue(e,t="none"){switch(zt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ut(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw re(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ln(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){var r,s,o;const t=(o=(s=(r=e.fields)==null?void 0:r[ws].arrayValue)==null?void 0:s.values)==null?void 0:o.map((a=>Ie(a.doubleValue)));return new mt(t)}convertGeoPoint(e){return new ft(Ie(e.latitude),Ie(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=js(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(xr(e));default:return null}}convertTimestamp(e){const t=Bt(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=be.fromString(e);_e(jc(r),9688,{name:e});const s=new wr(r.get(1),r.get(3)),o=new te(r.popFirst(5));return s.isEqual(t)||xt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pg(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class ss{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Cn extends fu{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new us(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(bo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new K(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Cn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Cn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Cn._jsonSchema={type:Se("string",Cn._jsonSchemaVersion),bundleSource:Se("string","DocumentSnapshot"),bundleName:Se("string"),bundle:Se("string")};class us extends Cn{data(e={}){return super.data(e)}}class Rn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ss(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new us(this._firestore,this._userDataWriter,r.key,r,new ss(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new K(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((d=>{const f=new us(s._firestore,s._userDataWriter,d.doc.key,d.doc,new ss(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);return d.doc,{type:"added",doc:f,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const f=new us(s._firestore,s._userDataWriter,d.doc.key,d.doc,new ss(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);let m=-1,y=-1;return d.type!==0&&(m=a.indexOf(d.doc.key),a=a.delete(d.doc.key)),d.type!==1&&(a=a.add(d.doc),y=a.indexOf(d.doc.key)),{type:kg(d.type),doc:f,oldIndex:m,newIndex:y}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new K(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$i.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function kg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return re(61501,{type:n})}}Rn._jsonSchemaVersion="firestore/querySnapshot/1.0",Rn._jsonSchema={type:Se("string",Rn._jsonSchemaVersion),bundleSource:Se("string","QuerySnapshot"),bundleName:Se("string"),bundle:Se("string")};class Dg extends Sg{constructor(e){super(),this.firestore=e}convertBytes(e){return new et(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ke(this.firestore,null,t)}}function _u(n){n=vr(n,Wt);const e=vr(n.firestore,mo),t=ou(e),r=new Dg(e);return Rg(n._query),pg(t,n._query).then((s=>new Rn(e,r,n,s)))}function wl(n,e,t){n=vr(n,ke);const r=vr(n.firestore,mo),s=Pg(n.converter,e);return Vg(r,[wg(lu(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,vt.none())])}function Vg(n,e){return(function(r,s){const o=new Lt;return r.asyncQueue.enqueueAndForget((async()=>tg(await fg(r),s,o))),o.promise})(ou(n),e)}function El(){return new _o("serverTimestamp")}(function(e,t=!0){(function(s){On=s})(ef),vs(new yr("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),d=new mo(new yf(r.getProvider("auth-internal")),new bf(a,r.getProvider("app-check-internal")),(function(m,y){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new K(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wr(m.options.projectId,y)})(a,s),a);return o={useFetchStreams:t,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),An(Ea,Ta,e),An(Ea,Ta,"esm2020")})();const Ng={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},jg=Ml(Ng),ks=yg(jg);function Mg(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function Lg(){const n=new Date,e=n.getDay(),t=n.getDate()-e+(e===0?-6:1);return new Date(n.setDate(t))}async function Og(n){try{console.log("ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:",{rulerName:n.rulerName,rulerId:n.rulerId,gold:n.gold.toString(),renown:n.renown.toString(),buildings:n.buildings,achievements:n.achievements});const e={...n,period:"alltime"},t={...n,period:"weekly"};console.log("ðŸ“¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² leaderboard_alltime...");const r=gl(ks,"leaderboard_alltime",n.rulerId);await wl(r,{...e,gold:Number(e.gold.toString()),renown:Number(e.renown.toString()),timestamp:El()}),console.log("âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² leaderboard_alltime, ID:",n.rulerId),console.log("ðŸ“¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² leaderboard_weekly...");const s=gl(ks,"leaderboard_weekly",n.rulerId);return await wl(s,{...t,gold:Number(t.gold.toString()),renown:Number(t.renown.toString()),timestamp:El()}),console.log("âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² leaderboard_weekly, ID:",n.rulerId),console.log("ðŸŽ‰ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹!"),{allTimeId:n.rulerId,weeklyId:n.rulerId}}catch(e){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e),e instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.stack)),"code"in e&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",e.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",e.customData)),e}}async function Fg(n=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const e=mu(iu(ks,"leaderboard_alltime"),pu("gold","desc"),gu(n));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const t=await _u(e);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",t.docs.length);const r=t.docs.map(s=>{const o=s.data();return{id:s.id,...o,gold:o.gold instanceof tt?o.gold:new tt(o.gold),renown:o.renown instanceof tt?o.renown:new tt(o.renown),timestamp:o.timestamp}});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",r.length),r}catch(e){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e),e instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.stack)),"code"in e&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",e.code),e}}async function Bg(n=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const e=Lg();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",e.toISOString());const t=mu(iu(ks,"leaderboard_weekly"),pu("gold","desc"),gu(n));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const r=await _u(t);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",r.docs.length);const o=r.docs.map(a=>{const d=a.data();return{id:a.id,...d,gold:d.gold instanceof tt?d.gold:new tt(d.gold),renown:d.renown instanceof tt?d.renown:new tt(d.renown),timestamp:d.timestamp}}).filter(a=>{var m,y;const d=((y=(m=a.timestamp)==null?void 0:m.toDate)==null?void 0:y.call(m))||new Date(a.timestamp),f=d>=e;return f||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",d.toISOString()),f});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",o.length),o}catch(e){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e),e instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",e.stack)),"code"in e&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",e.code),e}}const Ug=({isOpen:n,onClose:e,onConfirm:t,gameState:r})=>{const[s,o]=$.useState(""),[a,d]=$.useState(!1);if(!n)return null;const f=async()=>{if(s.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(s.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}d(!0);try{const y={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:s.trim(),rulerId:Mg(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};t(y),e()}catch{alert("An error occurred while creating profile. Please try again.")}finally{d(!1)}};return c.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:c.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[c.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),c.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",c.jsx("strong",{children:zg(r.gold)})," gold!",c.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),c.jsxs("div",{style:{marginBottom:"24px"},children:[c.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),c.jsx("input",{type:"text",value:s,onChange:m=>o(m.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:m=>m.key==="Enter"&&f()}),c.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[s.length,"/20 characters"]})]}),c.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:c.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),c.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[c.jsx("button",{type:"button",onClick:f,disabled:a||s.trim().length<3,style:{padding:"12px 24px",backgroundColor:a||s.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:a||s.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:a?"Creating profile...":"Ascend the Throne"}),c.jsx("button",{type:"button",onClick:e,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:m=>{m.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:m=>{m.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function zg(n){return n.lt(1e3)?n.toFixed(0):n.lt(1e6)?n.toNumber().toLocaleString():n.toExponential(2)}const qg=({isOpen:n,onClose:e,playerProfile:t,onOpenRulerNameModal:r,gameState:s})=>{const[o,a]=$.useState([]),[d,f]=$.useState([]),[m,y]=$.useState("alltime"),[v,A]=$.useState(!1),[C,F]=$.useState(null),[N,P]=$.useState(0),[q,B]=$.useState(0),G=()=>{const E=localStorage.getItem("leaderboardCache");if(E)try{const{data:g,timestamp:ne}=JSON.parse(E),ge=Date.now(),Ee=3600*1e3;if(ge-ne<Ee&&g&&g.allTime&&g.weekly)return g}catch(g){console.error("Cache parse error:",g)}return null},Q=E=>{const g={data:E,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(g)),B(Date.now())},J=()=>{const E=localStorage.getItem("leaderboardCache");if(E){const{timestamp:g}=JSON.parse(E),ne=Date.now(),ge=3600*1e3;return ne-g<ge}return!1};$.useEffect(()=>{if(n){if(J())try{const E=G();if(E){a(E.allTime),f(E.weekly);const g=JSON.parse(localStorage.getItem("leaderboardCache"));B(g.timestamp);return}}catch(E){console.error("Cache read error:",E)}Z()}},[n]);const Z=async()=>{A(!0),F(null);try{const E=new Promise((ge,Ee)=>setTimeout(()=>Ee(new Error("Loading timeout")),1e4)),[g,ne]=await Promise.all([Promise.race([Fg(50),E]),Promise.race([Bg(50),E])]);a(g),f(ne),Q({allTime:g,weekly:ne}),console.log("Leaderboard data loaded successfully!")}catch(E){console.error("Error loading leaderboard:",E),F("Failed to load leaderboard. Please check your internet connection and try again.")}finally{A(!1)}},w=E=>{switch(E){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${E}`}},_=()=>t?(m==="alltime"?o:d).findIndex(g=>g.rulerId===t.rulerId)+1:-1,b=()=>{const E=m==="alltime"?o:d;if(E.length>0){let g=0;if(E.forEach(ne=>{if(ne.timestamp){let ge=0;typeof ne.timestamp=="object"&&ne.timestamp.toDate?ge=ne.timestamp.toDate().getTime():typeof ne.timestamp=="number"?ge=ne.timestamp:typeof ne.timestamp=="string"&&(ge=new Date(ne.timestamp).getTime()),ge>g&&(g=ge)}}),g>0)return g}return q},T=m==="alltime"?o:d,x=T.length>0;return n?c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[c.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),c.jsx("button",{className:"btn",onClick:e,children:"Close"})]}),!t&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[c.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),c.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[c.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),r&&s&&s.gold&&s.gold.gte(1e7)&&c.jsx("button",{className:"btn",onClick:()=>{e(),r()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),x&&c.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:c.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-b())/6e4)," minutes ago"]})}),v&&c.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),C&&c.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:C}),t&&x&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[c.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",t.rulerName," ",t.rulerId]}),T.length>0&&c.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",_()>0?`#${_()}`:"Not ranked yet"," in ",m==="alltime"?"All Time":"Weekly"]})]}),x&&c.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[c.jsx("button",{onClick:()=>y("alltime"),className:m==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),c.jsx("button",{onClick:()=>y("weekly"),className:m==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),x&&!v&&!C&&c.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:c.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[c.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:c.jsxs("tr",{children:[c.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),c.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),c.jsx("tbody",{children:T.map((E,g)=>c.jsxs("tr",{style:{backgroundColor:(t==null?void 0:t.rulerId)===E.rulerId?"rgba(191, 144, 0, 0.1)":g%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[c.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:w(g+1)}),c.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:c.jsxs("div",{children:[c.jsx("strong",{children:E.rulerName}),c.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:E.rulerId})]})}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:U(E.gold,"standard")}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:U(E.renown,"standard")}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:E.buildings})]},E.id))})]})}),c.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},kt={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,lastBuyAmount:l(1),layout:{left:l(1),center:l(1),right:l(1)},borderWidth:l(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},nn={gold:l(0),totalGold:l(0),startTime:l(Date.now()),lastSaveTime:l(Date.now()),buildings:{},upgrades:[],achievements:[],renown:l(0),soldiers:l(0),eliteUnits:{},artifacts:[],advisors:[],advisorLevels:{},intermediateGoods:{},wonders:{},activeTradeRoutes:[],weather:{current:"clear",timeLeft:l(120)},activeDecrees:{},decreeCooldowns:{},conquest:{active:!1,crusadeId:null,startTime:l(0),soldiersSent:l(0)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!0,interface:kt,stats:{totalClicks:l(0),dragonsKilled:l(0),tavernGamesPlayed:l(0)},playerProfile:null},pr=n=>{if(n==null||typeof n=="string"||typeof n=="number"||typeof n=="boolean")return n;if(Array.isArray(n))return n.map(pr);if(typeof n=="object"&&n.toString&&typeof n.toString=="function"&&(n.hasOwnProperty("mantissa")||n.hasOwnProperty("exponent")))return n.toString();if(typeof n=="object"){const e={};for(const t in n)n.hasOwnProperty(t)&&(e[t]=pr(n[t]));return e}return n},Hg=()=>{var Ur,Kn;const[n,e]=$.useState(()=>{var I,D,L,H,W,O,ae;const R=localStorage.getItem("kingdom_save");if(R)try{const M=JSON.parse(R),ce=M.interface||{},he={...kt,...ce,lastBuyAmount:l(ce.lastBuyAmount??1),layout:{left:l(((I=ce.layout)==null?void 0:I.left)??kt.layout.left),center:l(((D=ce.layout)==null?void 0:D.center)??kt.layout.center),right:l(((L=ce.layout)==null?void 0:L.right)??kt.layout.right)},borderWidth:l(ce.borderWidth??kt.borderWidth),customColors:{...kt.customColors,...ce.customColors||{}}};return{...nn,...M,renown:l(M.renown||0),gold:l(M.gold||0),totalGold:l(M.totalGold||0),startTime:l(M.startTime||Date.now()),lastSaveTime:l(M.lastSaveTime||Date.now()),soldiers:l(M.soldiers||0),buildings:Object.keys(M.buildings||{}).reduce((se,fe)=>(se[fe]=l(M.buildings[fe]),se),{}),stats:{...nn.stats,...M.stats||{},totalClicks:l(((H=M.stats)==null?void 0:H.totalClicks)||0),dragonsKilled:l(((W=M.stats)==null?void 0:W.dragonsKilled)||0),tavernGamesPlayed:l(((O=M.stats)==null?void 0:O.tavernGamesPlayed)||0)},eliteUnits:Object.keys(M.eliteUnits||{}).reduce((se,fe)=>(se[fe]=l(M.eliteUnits[fe]),se),{}),advisors:M.advisors||[],advisorLevels:Object.keys(M.advisorLevels||{}).reduce((se,fe)=>(se[fe]=l(M.advisorLevels[fe]),se),{}),intermediateGoods:Object.keys(M.intermediateGoods||{}).reduce((se,fe)=>{const We=M.intermediateGoods[fe];return se[fe]={level:l(We.level||0),lastClickTime:l(We.lastClickTime||Date.now())},se},{}),wonders:Object.keys(M.wonders||{}).reduce((se,fe)=>(se[fe]=l(M.wonders[fe]),se),{}),activeTradeRoutes:(M.activeTradeRoutes||[]).map(se=>({id:se.id,routeId:se.routeId,startTime:l(Number(se.startTime)||0),duration:l(Number(se.duration)||0),goldInvested:l(se.goldInvested||0),soldiersSent:l(se.soldiersSent||0),eliteSent:Object.keys(se.eliteSent||{}).reduce((fe,We)=>(fe[We]=l(se.eliteSent[We]||0),fe),{})})),weather:M.weather?{...M.weather,timeLeft:l(Number(M.weather.timeLeft)||120)}:nn.weather,conquest:{...nn.conquest,...M.conquest||{},startTime:l(Number((ae=M.conquest)==null?void 0:ae.startTime)||Date.now())},activeDecrees:Object.keys(M.activeDecrees||{}).reduce((se,fe)=>(se[fe]=l(M.activeDecrees[fe]),se),{}),decreeCooldowns:Object.keys(M.decreeCooldowns||{}).reduce((se,fe)=>(se[fe]=l(M.decreeCooldowns[fe]),se),{}),theme:M.theme||"default",numberFormat:M.numberFormat||"standard",idleModeEnabled:M.idleModeEnabled!==void 0?M.idleModeEnabled:!0,interface:he,playerProfile:M.playerProfile?{...M.playerProfile,lastLeaderboardSubmit:M.playerProfile.lastLeaderboardSubmit||0}:null}}catch(M){console.error("Save load failed",M)}return nn}),t=$.useRef(n);$.useEffect(()=>{t.current=n},[n]);const[r,s]=$.useState(!1);$.useEffect(()=>{let R;const I=()=>{s(!1),clearTimeout(R),n.idleModeEnabled&&(R=setTimeout(()=>{s(!0)},2e4))};I();const D=["mousemove","mousedown","keydown","touchstart","scroll"];return D.forEach(L=>window.addEventListener(L,I)),()=>{clearTimeout(R),D.forEach(L=>window.removeEventListener(L,I))}},[n.idleModeEnabled]),$.useEffect(()=>{const R=U(n.gold);document.title=`Gold: ${R} - Kingdom Clicker`},[n.gold]),$.useEffect(()=>{var W;const R=document.documentElement,I=n.interface||kt;if((W=I.customColors)!=null&&W.enabled){const O=I.customColors;R.style.setProperty("--bg-color",O.bg),R.style.setProperty("--panel-bg",O.panel),R.style.setProperty("--text-color",O.text),R.style.setProperty("--text-secondary",O.secondaryText||"#5d4037"),R.style.setProperty("--text-on-accent","#ffffff"),R.style.setProperty("--accent-color",O.accent),R.style.setProperty("--accent-hover",O.accentHover||O.accent),R.style.setProperty("--gold-color",O.gold||"#bf9000"),R.style.setProperty("--border-color",O.border),R.style.setProperty("--success-color",O.success||"#2e7d32"),R.style.setProperty("--danger-color",O.danger||"#c62828"),R.style.setProperty("--bg-image","none")}else{const O=n.theme||"default",ae=_i[O]||_i.default;Object.entries(ae.colors).forEach(([M,ce])=>{R.style.setProperty(M,ce)})}const D={small:"14px",medium:"16px",large:"18px"};R.style.setProperty("--base-font-size",D[I.fontSize]);const L={compact:"8px",normal:"12px",spacious:"20px"},H={compact:"6px",normal:"12px",spacious:"16px"};R.style.setProperty("--panel-padding",L[I.density]),R.style.setProperty("--gap-size",H[I.density]),R.style.setProperty("--custom-border-width",`${I.borderWidth}px`),R.style.setProperty("--col-left",String(I.layout.left)),R.style.setProperty("--col-center",String(I.layout.center)),R.style.setProperty("--col-right",String(I.layout.right)),I.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[n.theme,n.interface]);const[o,a]=$.useState(!1);$.useEffect(()=>{var R;n.gold.gte(l(1e7))&&!((R=n.playerProfile)!=null&&R.hasChosenName)&&!o&&Ee(!0)},[n.gold,n.playerProfile,o]);const[d,f]=$.useState(null),[m,y]=$.useState([]),[v,A]=$.useState("buildings"),[C,F]=$.useState("army"),[N,P]=$.useState(!1),[q,B]=$.useState(!1),[G,Q]=$.useState(!1),[J,Z]=$.useState(!1),[w,_]=$.useState(!1),[b,T]=$.useState(!1),[x,E]=$.useState(!1),[g,ne]=$.useState(!1),[ge,Ee]=$.useState(!1),[Ke,$e]=$.useState(!1),ee=(R,I="info")=>{const D=Date.now().toString()+Math.random();y(L=>[...L,{id:D,message:R,type:I}]),setTimeout(()=>{y(L=>L.filter(H=>H.id!==D))},3e3)};$.useEffect(()=>{const R=I=>I.preventDefault();return document.addEventListener("contextmenu",R),()=>document.removeEventListener("contextmenu",R)},[]),$.useEffect(()=>{var I;const R=Date.now();if(n.lastSaveTime&&l(R).minus(n.lastSaveTime).gt(l(6e4))){const D=l(R).minus(n.lastSaveTime).dividedBy(l(1e3)),L=nt(n),H=(((I=n.wonders)==null?void 0:I.void_gate)||l(0)).gte(l(3)),W=l(H?1:.5),O=L.times(D).times(W).floor();O.gt(l(0))&&(ee(`While you were away, you earned ${U(O,n.numberFormat)} gold! ${H?"(100% Efficiency)":""}`,"success"),e(ae=>({...ae,gold:ae.gold.plus(O),totalGold:ae.totalGold.plus(O)})))}},[]),$.useEffect(()=>{const R=setInterval(()=>{Date.now()%3e4<1e3&&e(I=>{const D={...I,lastSaveTime:l(Date.now())},L=pr(D);return localStorage.setItem("kingdom_save",JSON.stringify(L)),D})},1e3);return()=>clearInterval(R)},[]),$.useEffect(()=>{const R=()=>{const D=t.current,L=pr(D);localStorage.setItem("kingdom_save",JSON.stringify(L))};window.addEventListener("beforeunload",R);const I=()=>{document.visibilityState==="hidden"&&R()};return document.addEventListener("visibilitychange",I),()=>{window.removeEventListener("beforeunload",R),document.removeEventListener("visibilitychange",I)}},[]),$.useEffect(()=>{var I;if(!((I=n.playerProfile)!=null&&I.hasChosenName))return;const R=setInterval(()=>{const D=Date.now(),L=n.playerProfile.lastLeaderboardSubmit||0,H=3600*1e3;D-L>=H&&Og({rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.gold,renown:n.renown,buildings:Object.keys(n.buildings).length,achievements:n.achievements.length,period:"alltime"}).then(()=>{e(W=>({...W,playerProfile:{...W.playerProfile,lastLeaderboardSubmit:Date.now()}})),ee("Leaderboard data submitted successfully!","success")}).catch(W=>{console.error("Auto leaderboard submission failed:",W)})},6e4);return()=>clearInterval(R)},[(Ur=n.playerProfile)==null?void 0:Ur.hasChosenName,(Kn=n.playerProfile)==null?void 0:Kn.lastLeaderboardSubmit,n.gold,n.renown,n.buildings,n.achievements]),$.useRef(0),$.useEffect(()=>{if(n.advisors.includes("treasurer")){const R=n.advisorLevels.treasurer||l(1),I=Math.max(1,5-R.toNumber()+1),D=setInterval(()=>{Ht(!0)},I*1e3);return()=>clearInterval(D)}},[n.advisors,n.advisorLevels]),$.useEffect(()=>{const R=setInterval(()=>{if(!n.event){n.advisors.includes("alchemist");const I=n.advisorLevels.alchemist||l(1),D=.05,L=Pt("alchemist",I),H=D*L.toNumber();if(Math.random()<H){const W=["dragon","merchant","jester"],O=W[Math.floor(Math.random()*W.length)],ae={id:Date.now().toString(),type:O,expiresAt:l(Date.now()).plus(l(O==="dragon"?1e4:3e4)),hp:O==="dragon"?l(10):void 0,maxHp:O==="dragon"?l(10):void 0,reward:l(0)};e(M=>({...M,event:ae}))}}},1e4);return()=>clearInterval(R)},[n.event,n.advisors,n.advisorLevels]);const nt=R=>{var H,W;let I=l(0);const D=((H=R.weather)==null?void 0:H.current)||"clear";_t.forEach(O=>{const ae=R.buildings[O.id]||l(0);let M=O.baseProduction;D==="sunny"?(O.id==="peasant"||O.id==="field")&&(M=M.times(l(1.2))):D==="rainy"?(O.id==="silver_mine"||O.id==="alchemist")&&(M=M.times(l(1.2))):D==="stormy"?(O.id==="blacksmith"&&(M=M.times(l(1.3))),O.id==="field"&&(M=M.times(l(.8)))):D==="windy"&&O.id==="market"&&(M=M.times(l(1.15))),I=I.plus(ae.times(M))});let L=l(1);if(rt.forEach(O=>{if(R.upgrades.includes(O.id)&&(O.type==="global"&&O.multiplier&&(L=L.times(O.multiplier)),O.type==="building"&&O.multiplier&&O.targetId)){const ae=_t.find(M=>M.id===O.targetId);if(ae){const M=R.buildings[O.targetId]||l(0);I=I.plus(M.times(ae.baseProduction).times(O.multiplier.minus(l(1))))}}}),R.upgrades.includes("army_synergy")){const O=R.soldiers.dividedBy(l(1e3)).times(l(.01));L=L.times(l(1).plus(O))}if(R.upgrades.includes("achievement_synergy")){const O=l(R.achievements.length).times(l(.05));L=L.times(l(1).plus(O))}if(R.upgrades.includes("click_synergy")){const O=R.stats.totalClicks.times(l(1e-4));L=L.times(l(1).plus(O))}if(R.advisors.includes("cosmic_mage")){const O=R.advisorLevels.cosmic_mage||l(0),ae=R.advisors.includes("cosmic_mage")?Pt("cosmic_mage",O):l(0),M=l(1).plus(ae);L=L.times(M)}return(((W=R.wonders)==null?void 0:W.sky_citadel)||l(0)).gte(l(3))&&(L=L.times(l(100))),R.artifacts.forEach(O=>{const ae=Sn.find(M=>M.id===O);ae&&(L=L.times(ae.globalMultiplier))}),L=L.times(l(1).plus(R.renown.times(l(.1)))),(R.activeDecrees.royal_feast||l(0)).gt(l(Date.now()))&&(L=L.times(l(2))),I=I.times(L),I},X=nt(n),Ge=$.useRef(X);Ge.current=X,$.useEffect(()=>{const R=setInterval(()=>{e(I=>{const D=Date.now(),L=Ge.current.times(l(ai)).dividedBy(l(1e3));let H=I.totalGold.plus(L),W=I.gold.plus(L),O={...I.weather};const ae=l(ai/1e3);if(O.timeLeft=O.timeLeft.minus(ae),O.timeLeft.lte(l(0))){const ye=["clear","sunny","rainy","stormy","windy"],Be=ye[Math.floor(Math.random()*ye.length)],Xe=l(Math.floor(Math.random()*120)+60);O={current:Be,timeLeft:Xe}}let M=I.event;M&&M.expiresAt&&l(M.expiresAt).lt(l(D))&&(M=null);let ce={...I.intermediateGoods},he=l(0);if(he.gt(0)){const ye=Gs(I),Be=he.times(ye);W=W.plus(Be),H=H.plus(Be)}let se={...I.conquest},fe=[...I.artifacts],We=I.soldiers;if(se.active&&se.crusadeId){const ye=fs.find(Be=>Be.id===se.crusadeId);if(ye){const Be=n.advisorLevels.warmaster||l(0),Xe=n.advisors.includes("warmaster")?Pt("warmaster",Be):l(0);let Tt=l(1).minus(Xe);const pn=Xe.times(l(2));I.weather.current==="windy"&&(Tt=Tt.times(l(.8)));const gn=l(ye.duration).times(l(Tt));if(l((D-l(se.startTime).toNumber())/1e3).gte(gn)){I.advisors.includes("warmaster");const yn=ye.baseRisk.minus(pn),He=Math.random();if(He<yn.toNumber()){const at=(se.soldiersSent||ye.soldierCost).times(l(.5)).floor();We=We.plus(at),ee(`Crusade Failed! Our army retreats. ${U(at,n.numberFormat)} soldiers returned.`,"error")}else if(He>.9){fe.includes(ye.rewardArtifactId)||fe.push(ye.rewardArtifactId);const at=Ge.current.times(l(300));W=W.plus(at),ee(`CRITICAL VICTORY! Found ${ye.name} Artifact and ${U(at.floor(),n.numberFormat)} Gold!`,"success")}else fe.includes(ye.rewardArtifactId)?ee(`Victory! Crusade ${ye.name} complete (Artifact already owned).`,"info"):(fe.push(ye.rewardArtifactId),ee(`Victory! Retrieved Artifact from ${ye.name}`,"success"));se={active:!1,crusadeId:null,startTime:l(0),soldiersSent:l(0)}}}}let mn=[...I.activeTradeRoutes||[]];mn.length,mn=mn.filter(ye=>{var yt,yn;const Be=ms.find(He=>He.id===ye.routeId);if(!Be)return!1;const Xe=(((yt=I.wonders)==null?void 0:yt.great_pyramid)||l(0)).gte(3),Tt=Xe?.5:1,pn=l(ye.duration).times(l(Tt));if(l((D-l(ye.startTime).toNumber())/1e3).gte(pn)){const He=l(ye.soldiersSent).plus(l(((yn=ye.eliteSent)==null?void 0:yn.knight)||0).times(l(50))),at=l(Math.max(100,l(ye.goldInvested).dividedBy(l(100)).toNumber())),zr=l(Math.min(.9,He.dividedBy(at).toNumber()));let Xt=Be.risk.times(l(1).minus(zr));if(Xe&&(Xt=Xt.times(l(.5))),Math.random()>Xt.toNumber()){const _n=l(ye.goldInvested).times(Be.rewardMultiplier);W=W.plus(_n),H=H.plus(_n),ee(`Caravan returned from ${Be.name}! Profit: +${U(_n,I.numberFormat)} Gold`,"success")}else ee(`Caravan to ${Be.name} was raided! Investment lost.`,"error");return!1}return!0});const Qn=[...I.achievements];let ot=null;return hs.forEach(ye=>{Qn.includes(ye.id)||ye.condition({...I,totalGold:H,gold:W},Ge.current)&&(Qn.push(ye.id),ot=ye)}),ot&&(f(ot),setTimeout(()=>f(null),3e3)),{...I,gold:W,totalGold:H,achievements:Qn,event:M,conquest:se,artifacts:fe,soldiers:We,activeTradeRoutes:mn,weather:O,intermediateGoods:ce,advisorLevels:I.advisorLevels}})},ai);return()=>clearInterval(R)},[n.advisors,n.advisorLevels]);const Vr=$.useRef(n.artifacts);$.useEffect(()=>{Vr.current=n.artifacts},[n.artifacts]);const Ht=(R=!1)=>{let I=l(1);if(rt.filter(D=>D.type==="click"&&t.current.upgrades.includes(D.id)).forEach(D=>{D.multiplier&&(I=I.times(D.multiplier))}),(t.current.activeDecrees.call_to_arms||l(0)).gt(l(Date.now()))&&(I=I.times(l(5))),I=I.times(l(1).plus(t.current.renown.times(l(.1)))),t.current.godMode){const L=nt(t.current).times(l(6e3));I=I.plus(L)}e(D=>({...D,gold:D.gold.plus(I),totalGold:D.totalGold.plus(I),stats:{...D.stats,totalClicks:R?D.stats.totalClicks:D.stats.totalClicks.plus(l(1))}}))},[hn,Kt]=$.useState(""),[gt,Qt]=$.useState(null),[Et,qn]=$.useState(null);$.useEffect(()=>{const R=I=>{const D=I.target;if(!(D.tagName==="INPUT"||D.tagName==="TEXTAREA")&&I.key.length===1&&/[a-zA-Z]/.test(I.key)){I.preventDefault(),gt||Qt(Date.now());const L=hn+I.key.toLowerCase();if(Kt(L),L==="godon"||L==="godoff"){const H=Date.now();H-(gt||H)<=7e3&&(L==="godon"?(ee("ðŸ”¥ GOD MODE ACTIVATED! Each click gives +6000 seconds of income!","success"),e(O=>({...O,...O.godMode?{}:{godMode:!0}}))):L==="godoff"&&(ee("ðŸ›‘ GOD MODE DEACTIVATED! Normal clicks restored.","info"),e(O=>{const ae={...O};return delete ae.godMode,ae}))),Kt(""),Qt(null),Et&&(clearTimeout(Et),qn(null))}}};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R),Et&&clearTimeout(Et)}},[hn,gt,Et]),$.useEffect(()=>{if(gt){const R=setTimeout(()=>{Kt(""),Qt(null),qn(null)},7e3);return qn(R),()=>{clearTimeout(R)}}},[gt]);const Gs=R=>{let I=l(1);if(rt.filter(D=>D.type==="click"&&R.upgrades.includes(D.id)).forEach(D=>{D.multiplier&&(I=I.times(D.multiplier))}),(R.activeDecrees.call_to_arms||l(0)).gt(l(Date.now()))&&(I=I.times(l(5))),I=I.times(l(1).plus(R.renown.times(l(.1)))),R.godMode){const L=nt(R).times(l(6e3));I=I.plus(L)}return I},Nr=(R,I)=>{const D=_t.find(M=>M.id===R);if(!D||I<=0)return;const L=n.buildings[R]||l(0),H=n.advisorLevels.guildmaster||l(0),W=n.advisors.includes("guildmaster")?Pt("guildmaster",H):l(0),O=l(1).minus(W),ae=Dt(D.baseCost,L,l(I)).times(O).floor();n.gold.gte(ae)&&e(M=>({...M,gold:M.gold.minus(ae),buildings:{...M.buildings,[R]:(M.buildings[R]||l(0)).plus(l(I))}}))},$n=(R,I)=>{const D=_t.find(O=>O.id===R);if(!D||I<=0)return;const L=n.buildings[R]||l(0),H=l(Math.min(I,L.toNumber()));if(H.lte(l(0)))return;const W=Dt(D.baseCost,L.minus(H),H).times(l(.25)).floor();e(O=>({...O,gold:O.gold.plus(W),buildings:{...O.buildings,[R]:L.minus(H)}}))},jr=R=>{const I=rt.find(D=>D.id===R);I&&(n.upgrades.includes(R)||(I.currency==="renown"?n.renown.gte(I.cost)?(e(D=>({...D,renown:D.renown.minus(I.cost),upgrades:[...D.upgrades,R]})),ee(`Legacy Unlocked: ${I.name}`,"success")):ee(`Not enough Renown! Need ${U(I.cost,n.numberFormat)}`,"error"):n.gold.gte(I.cost)&&e(D=>({...D,gold:D.gold.minus(I.cost),upgrades:[...D.upgrades,R]}))))},Ws=R=>{const I=Je.times(l(R));n.gold.gte(I)&&e(D=>({...D,gold:D.gold.minus(I),soldiers:D.soldiers.plus(I.dividedBy(Je))}))},Gn=(R,I)=>{const D=ds.find(W=>W.id===R);if(!D)return;const L=D.goldCost.times(l(I)),H=D.soldierCost.times(l(I));n.gold.gte(L)&&n.soldiers.gte(H)&&(e(W=>({...W,gold:W.gold.minus(L),soldiers:W.soldiers.minus(H),eliteUnits:{...W.eliteUnits,[R]:(W.eliteUnits[R]||l(0)).plus(l(I))}})),ee(`Trained ${I} ${D.name}!`,"success"))},Wn=R=>{const I=Il.find(H=>H.id===R);if(!I)return;const D=n.advisors.includes(R),L=n.advisorLevels[R]||l(0);if(!D)n.renown.gte(I.cost)?(e(H=>({...H,renown:H.renown.minus(I.cost),advisors:[...H.advisors,R],advisorLevels:{...H.advisorLevels,[R]:l(1)}})),ee(`Hired ${I.name}!`,"success")):ee(`Not enough Renown! Need ${U(I.cost,n.numberFormat)}`,"error");else{const H=Cl(I,L);n.renown.gte(H)?(e(W=>({...W,renown:W.renown.minus(H),advisorLevels:{...W.advisorLevels,[R]:L.plus(l(1))}})),ee(`Upgraded ${I.name} to Level ${L.plus(l(1))}!`,"success")):ee(`Not enough Renown! Need ${U(H,n.numberFormat)}`,"error")}},Mr=R=>{const I=Al.find(ce=>ce.id===R);if(!I)return;const D=Date.now(),L=n.advisorLevels.chronomancer||l(0),H=n.advisorLevels.time_keeper||l(0),W=n.advisors.includes("chronomancer")?Pt("chronomancer",L):l(0),O=n.advisors.includes("time_keeper")?Pt("time_keeper",H):l(0),ae=W.plus(O),M=I.cooldown.times(l(1).minus(ae));if(!(n.decreeCooldowns[R]||l(0)).gt(l(D))&&!(n.activeDecrees[R]||l(0)).gt(l(D))){if(I.unlockCondition&&!I.unlockCondition(n)){ee("Requirement not met!","error");return}I.effectType==="instant_gold"?(e(ce=>({...ce,gold:ce.gold.plus(Ge.current.times(I.value)),totalGold:ce.totalGold.plus(Ge.current.times(I.value)),decreeCooldowns:{...ce.decreeCooldowns,[R]:l(D).plus(M.times(l(1e3)))}})),ee(`Decree Enacted: ${I.name}`,"success")):I.effectType==="add_soldiers"?(e(ce=>({...ce,soldiers:ce.soldiers.plus(I.value),decreeCooldowns:{...ce.decreeCooldowns,[R]:l(D).plus(M.times(l(1e3)))}})),ee(`Decree Enacted: Recruited ${I.value} Soldiers`,"success")):(e(ce=>({...ce,activeDecrees:{...ce.activeDecrees,[R]:l(D).plus(I.duration.times(l(1e3)))},decreeCooldowns:{...ce.decreeCooldowns,[R]:l(D).plus(I.duration.plus(I.cooldown).times(l(1e3)))}})),ee(`Decree Enacted: ${I.name}`,"success"))}},Ve=R=>{if(R.type==="merchant"){const I=Ge.current.times(l(10));e(D=>({...D,gold:D.gold.plus(I),totalGold:D.totalGold.plus(I),event:null})),ee(`The merchant gifted you ${U(I.floor(),n.numberFormat)} gold!`,"success")}else if(R.type==="jester"){const I=n.gold.times(l(.1)),D=Math.random()>.5;e(L=>({...L,gold:D?L.gold.plus(I):L.gold.minus(I),totalGold:D?L.totalGold.plus(I):L.totalGold,event:null})),D?ee(`Jester pays out! +${U(I.floor(),n.numberFormat)}`,"success"):ee(`Jester tricked you! -${U(I.floor(),n.numberFormat)}`,"warning")}else if(R.type==="dragon"){let I=!1;e(D=>{if(!D.event||D.event.type!=="dragon")return D;const L=(D.event.hp||l(1)).minus(l(1));if(L.lte(0)){const H=Ge.current.times(l(30));return I=!0,{...D,gold:D.gold.plus(H),totalGold:D.totalGold.plus(H),event:null,stats:{...D.stats,dragonsKilled:D.stats.dragonsKilled.plus(l(1))}}}return{...D,event:{...D.event,hp:L}}}),I&&ee("Dragon Slain! +Treasury Boost","success")}},Me=(R,I,D,L)=>{const H=ms.find(M=>M.id===R);if(!H)return;const W=l(I),O=l(D);if(n.gold.lt(W)){ee("Not enough gold!","error");return}if(n.soldiers.lt(O)){ee("Not enough soldiers!","error");return}let ae=!0;if(Object.entries(L).forEach(([M,ce])=>{(n.eliteUnits[M]||l(0)).lt(l(ce))&&(ae=!1)}),!ae){ee("Not enough elite units!","error");return}e(M=>{const ce={...M.eliteUnits};return Object.entries(L).forEach(([he,se])=>{ce[he]=(ce[he]||l(0)).minus(l(se))}),{...M,gold:M.gold.minus(W),soldiers:M.soldiers.minus(O),eliteUnits:ce,activeTradeRoutes:[...M.activeTradeRoutes||[],{id:Date.now().toString(),routeId:R,startTime:l(Date.now()),duration:l(H.baseDuration),goldInvested:W,soldiersSent:O,eliteSent:Object.fromEntries(Object.entries(L).map(([he,se])=>[he,l(se)]))}]}}),ee("Caravan Dispatched!","success")},fn=R=>{const I=Rl.find(W=>W.id===R);if(!I)return;const D=n.wonders[R]||l(0);if(D.gte(l(I.stages.length)))return;const L=I.stages[D].cost;let H=!0;for(const W of L)if(W.type==="gold"&&n.gold.lt(l(W.amount))&&(H=!1),W.type==="soldiers"&&n.soldiers.lt(l(W.amount))&&(H=!1),W.type==="renown"&&n.renown.lt(l(W.amount))&&(H=!1),["knight","paladin","void_sentinel"].includes(W.type)){const O=W.type;(n.eliteUnits[O]||l(0)).lt(l(W.amount))&&(H=!1)}if(!H){ee("Resources insufficient for construction!","error");return}e(W=>{let O=W.gold,ae=W.soldiers,M=W.renown,ce={...W.eliteUnits};for(const he of L)if(he.type==="gold"&&(O=O.minus(l(he.amount))),he.type==="soldiers"&&(ae=ae.minus(l(he.amount))),he.type==="renown"&&(M=M.minus(l(he.amount))),["knight","paladin","void_sentinel"].includes(he.type)){const se=he.type;ce[se]=(ce[se]||l(0)).minus(l(he.amount))}return{...W,gold:O,soldiers:ae,renown:M,eliteUnits:ce,wonders:{...W.wonders,[R]:D.plus(l(1))}}}),ee("Wonder Stage Complete!","success")},Hs=R=>{const I=fs.find(D=>D.id===R);if(I){if(I.requiredUnits){for(const[D,L]of Object.entries(I.requiredUnits))if((n.eliteUnits[D]||l(0)).lt(L)){ee("Missing elite units required for this mission.","error");return}}n.soldiers.gte(I.soldierCost)&&(e(D=>({...D,soldiers:D.soldiers.minus(I.soldierCost),conquest:{active:!0,crusadeId:R,startTime:l(Date.now()),soldiersSent:I.soldierCost}})),ee(`Crusade Started: ${I.name}`,"info"))}},Lr=()=>{const R=n.advisorLevels.void_scholar||l(0),I=n.advisors.includes("void_scholar")?Pt("void_scholar",R):l(0),D=l(1).plus(I),L=n.gold.dividedBy(l(1e9)).floor().times(D),H=l(1e4).min(L);H.lte(0)||(e({...nn,renown:n.renown.plus(H),achievements:n.achievements,artifacts:n.artifacts,upgrades:n.upgrades.filter(W=>{const O=rt.find(ae=>ae.id===W);return(O==null?void 0:O.currency)==="renown"}),advisors:n.advisors,advisorLevels:n.advisorLevels,wonders:n.wonders,playerProfile:n.playerProfile,startTime:l(Date.now()),lastSaveTime:l(Date.now()),theme:n.theme,idleModeEnabled:n.idleModeEnabled,interface:n.interface}),Q(!1),ee("Abdication Successful. Long live the new King!","success"))},Ks=()=>{localStorage.removeItem("kingdom_save"),e({...nn,startTime:l(Date.now())}),Z(!1),ee("Game Reset","warning")},Yt=()=>{const I=pr(n);localStorage.setItem("kingdom_save",JSON.stringify(I)),ee("Game Saved","info")},Or=R=>{e(I=>({...I,playerProfile:R})),localStorage.setItem(`playerProfile_${R.id}`,JSON.stringify(R)),ee(`Welcome, ${R.rulerName} ${R.rulerId}!`,"success"),a(!1)},Fr=async()=>{Lr()},Hn=R=>{e(I=>({...I,interface:{...I.interface,lastBuyAmount:R}}))},Br=R=>({flex:R==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:R==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:R==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:r&&n.idleModeEnabled?R==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return c.jsxs("div",{style:{display:"flex",height:"100vh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative"},children:[c.jsx(Id,{toasts:m}),c.jsx(Cd,{}),r&&n.idleModeEnabled&&c.jsx(Rd,{gameState:n}),c.jsxs("div",{style:Br("left"),children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[c.jsx("button",{className:`tab-btn ${v==="buildings"?"active":""}`,onClick:()=>A("buildings"),children:"Estates"}),c.jsx("button",{className:`tab-btn ${v==="upgrades"?"active":""}`,onClick:()=>A("upgrades"),children:"Upgrades"}),c.jsx("button",{className:`tab-btn ${v==="decrees"?"active":""}`,onClick:()=>A("decrees"),children:"Decrees"})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[v==="buildings"&&c.jsx(dd,{gameState:n,onBuyBuilding:Nr,onSellBuilding:$n,onSetBuyAmount:Hn}),v==="upgrades"&&c.jsx(ud,{gameState:n,onBuyUpgrade:jr}),v==="decrees"&&c.jsx(hd,{gameState:n,onActivateDecree:Mr})]})]}),c.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:r&&n.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:c.jsx(md,{gameState:n,gps:X,onClick:()=>Ht(!1),onEventInteract:Ve,onOpenConquest:()=>{(n.buildings.castle||l(0)).gt(0)?P(!0):ee("You need a Castle to lead your army!","warning")},onOpenTavern:()=>B(!0),onOpenPrestige:()=>Q(!0),onOpenSettings:()=>Z(!0),onOpenCouncil:()=>T(!0),onOpenStatistics:()=>E(!0),onOpenLeaderboard:()=>{$e(!0)},onOpenEmpire:()=>{(n.buildings.castle||l(0)).gt(0)?ne(!0):ee("You need a Castle to manage an Empire!","warning")},isIdle:r&&n.idleModeEnabled})}),c.jsxs("div",{style:Br("right"),children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[c.jsx("button",{className:`tab-btn ${C==="army"?"active":""}`,onClick:()=>F("army"),children:"Army"}),c.jsx("button",{className:`tab-btn ${C==="achievements"?"active":""}`,onClick:()=>F("achievements"),children:"Achievements"})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[C==="army"&&c.jsx(fd,{gameState:n,onTrainSoldier:Ws,onTrainElite:Gn}),C==="achievements"&&c.jsx(pd,{gameState:n})]})]}),!(r&&n.idleModeEnabled)&&d&&c.jsxs("div",{className:"achievement-popup",children:[c.jsx("div",{style:{fontSize:"2rem"},children:d.icon}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),c.jsx("div",{style:{color:"var(--accent-color)"},children:d.name})]})]}),N&&c.jsx(gd,{gameState:n,onStartCrusade:Hs,onClose:()=>P(!1)}),g&&c.jsx(Ed,{gameState:n,onInvestTrade:Me,onBuildWonder:fn,onClose:()=>ne(!1)}),q&&c.jsx(yd,{gameState:n,onGamble:(R,I)=>{const D=l(R);e(L=>({...L,gold:I?L.gold.plus(D):L.gold.minus(D),stats:{...L.stats,tavernGamesPlayed:L.stats.tavernGamesPlayed.plus(l(1))}}))},onClose:()=>B(!1)}),G&&c.jsx(_d,{gameState:n,onPrestige:Fr,onClose:()=>Q(!1)}),J&&c.jsx(vd,{gameState:n,onClose:()=>Z(!1),onHardReset:Ks,onSave:Yt,onOpenChangelog:()=>_(!0),onSetTheme:R=>e(I=>({...I,theme:R})),onSetNumberFormat:R=>e(I=>({...I,numberFormat:R})),onToggleIdleMode:()=>e(R=>({...R,idleModeEnabled:!R.idleModeEnabled})),onUpdateInterface:R=>e(I=>({...I,interface:{...I.interface,...R}}))}),x&&c.jsx(wd,{gameState:n,currentGps:X,onClose:()=>E(!1)}),w&&c.jsx(bd,{onClose:()=>_(!1)}),b&&c.jsx(xd,{gameState:n,onHireAdvisor:Wn,onClose:()=>T(!1)}),ge&&c.jsx(Ug,{isOpen:ge,onClose:()=>{Ee(!1),a(!0)},onConfirm:Or,gameState:n}),Ke&&c.jsx(qg,{isOpen:Ke,onClose:()=>$e(!1),playerProfile:n.playerProfile})]})};export{Hg as A,yi as R,c as j};
