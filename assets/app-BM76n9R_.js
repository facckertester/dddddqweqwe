import{r as xt,g as pt}from"./vendor-B--z-fyW.js";import{T as Ae}from"./types-DtGgvffh.js";import{g as ve,A as gt,O as mt,C as ht}from"./ui-DSxSZZSV.js";import{t as o,f as I,T as Ie,B as ye,W as ft,A as tt,N as yt,g as ot,M as ze,P as nt,a as rt,b as st,c as Me,d as De,e as lt,h as Le,i as We,j as $e,U as bt,S as _e}from"./constants-DvQBoasu.js";import{i as vt,g as jt,d as Ye,s as Ve,a as Je,q as it,c as at,o as ct,l as dt,b as ut,e as pe}from"./game-Cwc6eCQa.js";import{I as wt,B as Xe,M as qe,A as Ke}from"./components-BHTa39b_.js";var Be={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze;function St(){if(Ze)return Se;Ze=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function m(d,a,s){var p=null;if(s!==void 0&&(p=""+s),a.key!==void 0&&(p=""+a.key),"key"in a){s={};for(var u in a)u!=="key"&&(s[u]=a[u])}else s=a;return a=s.ref,{$$typeof:t,type:d,key:p,ref:a!==void 0?a:null,props:s}}return Se.Fragment=n,Se.jsx=m,Se.jsxs=m,Se}var Qe;function kt(){return Qe||(Qe=1,Be.exports=St()),Be.exports}var e=kt(),x=xt();const Ct=pt(x),Re=({currentBet:t,maxGold:n,onBetChange:m,numberFormat:d})=>{const[a,s]=x.useState(t===0?"":t.toString());x.useEffect(()=>{var z,c;t===0&&((z=document.activeElement)==null?void 0:z.tagName)!=="INPUT"?s(""):Math.abs(parseFloat(a)-t)>1e-4&&((c=document.activeElement)==null?void 0:c.tagName)!=="INPUT"&&s(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const p=z=>{try{if(z.trim()===""){m(0),s("");return}let c=parseFloat(z);const C=z.toLowerCase().trim(),L={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const A of Object.keys(L))if(C.endsWith(A)){const P=parseFloat(C.slice(0,-A.length));isNaN(P)||(c=P*L[A]);break}(isNaN(c)||c<0)&&(c=0);const j=n.toNumber();isFinite(j)&&c>j?c=j:!isFinite(j)&&o(c).gt(n)&&(c=Number.MAX_VALUE),m(c),c===0?s(""):c>=1e6?s(c.toExponential(2).replace("+","")):s(Math.floor(c).toString())}catch{s(t===0?"":t.toString())}},u=()=>{p(a)},k=z=>{z.key==="Enter"&&(p(a),z.target.blur())},f=z=>{let C=n.times(z).floor().toNumber();isFinite(C)||(C=Number.MAX_VALUE),C<1&&n.gt(0)&&(C=1),m(C),C>=1e6?s(C.toExponential(2).replace("+","")):s(C.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"ðŸ’°"}),e.jsx("input",{type:"text",value:a,onChange:z=>s(z.target.value),onBlur:u,onKeyDown:k,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager..."}),t>0&&e.jsx("button",{onClick:()=>{m(0),s("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>f(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>f(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>f(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>p(Math.floor(t/2).toString()),children:"Â½"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>p((t*2).toString()),children:"x2"})]})]})},me=1500,Tt=({value:t,size:n=50,color:m="#000"})=>{const d=n*.18,a=n*.25,s=n*.5,p=n*.75,u=[];return(t===1||t===3||t===5)&&u.push({cx:s,cy:s}),t>1&&(u.push({cx:a,cy:a}),u.push({cx:p,cy:p})),t>3&&(u.push({cx:p,cy:a}),u.push({cx:a,cy:p})),t===6&&(u.push({cx:a,cy:s}),u.push({cx:p,cy:s})),e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:u.map((k,f)=>e.jsx("circle",{cx:k.cx,cy:k.cy,r:d/2,fill:m},f))})},Nt=({onClose:t})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:20,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #666",paddingBottom:"10px",width:"100%"},children:"ðŸ“œ Rules of the Game"}),e.jsxs("div",{style:{textAlign:"left",fontSize:"0.9rem",lineHeight:"1.6",maxWidth:"400px",overflowY:"auto"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Goal:"})," Reach ",me," points first."]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:"âš€ = 100 | âš„ = 50"}),e.jsx("li",{children:"Triple âš€ = 1000 | Triples = 100 Ã— Value"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Farkle:"})," Roll no points = lose turn score."]})]}),e.jsx("button",{className:"btn",onClick:t,style:{marginTop:"20px",width:"100%"},children:"I Understand"})]}),Rt=({won:t,amount:n,onPlayAgain:m,onLeave:d,numberFormat:a})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸ†":"ðŸ’€"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336"},children:t?"Victory!":"Defeat"}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:I(o(n),a)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:I(o(n),a)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:m,style:{fontSize:"1.2rem",padding:"15px 40px",background:"var(--accent-color)"},children:"Play Again"}),e.jsx("button",{className:"btn",onClick:d,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px"},children:"Leave"})]})]}),Pt=({gameState:t,onGamble:n,onLeave:m})=>{const[d,a]=x.useState(0),[s,p]=x.useState("betting"),[u,k]=x.useState("player"),[f,z]=x.useState(!1),[c,C]=x.useState(null),[L,j]=x.useState({player:0,opponent:0}),[A,P]=x.useState(0),[W,y]=x.useState([]),[F,T]=x.useState(""),[v,J]=x.useState(!1),[O,G]=x.useState(""),q=(R=6)=>Array.from({length:R},(D,S)=>({id:Math.random()+S,value:Math.floor(Math.random()*6)+1,status:"active",animating:!0}));x.useEffect(()=>{if(W.filter(D=>D.animating).length>0){const D=setTimeout(()=>{y(S=>S.map(Z=>Z.animating?{...Z,animating:!1}:Z))},600);return()=>clearTimeout(D)}},[W]);const Y=R=>{let D=0;const S=[0,0,0,0,0,0,0];return R.forEach(Z=>S[Z]++),S[1]>=3?(D+=1e3*Math.pow(2,S[1]-3),S[1]=0):(D+=S[1]*100,S[1]=0),S[5]>=3?(D+=500*Math.pow(2,S[5]-3),S[5]=0):(D+=S[5]*50,S[5]=0),[2,3,4,6].forEach(Z=>{S[Z]>=3&&(D+=Z*100*Math.pow(2,S[Z]-3))}),D},U=R=>{const D=[0,0,0,0,0,0,0];return R.forEach(S=>D[S.value]++),R.map((S,Z)=>S.value===1||S.value===5||D[S.value]>=3?Z:-1).filter(S=>S!==-1)},N=()=>{if(d<=0){T("Please bet something!");return}if(t.gold.lt(o(d))){T("Not enough gold!");return}p("playing"),j({player:0,opponent:0}),C(null),k("player"),w("player")},w=R=>{k(R),P(0),J(!1),y(q(6)),R==="player"?(T(`Your Turn! Target: ${me}`),le(q(6))):T("Opponent's Turn...")};x.useEffect(()=>{let R;return u==="opponent"&&!v&&(R=setTimeout(async()=>{if(s!=="playing"||u!=="opponent"||W.length===0)return;G("Thinking..."),await new Promise(H=>setTimeout(H,1e3));const S=W.filter(H=>H.status==="active").map(H=>H.value);if(Y(S)===0){G("Farkle!"),T("Opponent rolled no points!"),J(!0),await new Promise(H=>setTimeout(H,1500)),Q();return}G("Selecting dice...");const Z=U(W.filter(H=>H.status==="active")),re=[...W];if(Z.length===0){Q();return}const ge=re.filter(H=>H.status==="active");ge.forEach((H,Oe)=>{const Te=[0,0,0,0,0,0,0];ge.forEach(Pe=>Te[Pe.value]++),(H.value===1||H.value===5||Te[H.value]>=3)&&(H.status="selected")}),y(re);const de=re.filter(H=>H.status==="selected").map(H=>H.value),Ce=Y(de);await new Promise(H=>setTimeout(H,1e3));const ue=A+Ce,we=re.filter(H=>H.status==="active").length;L.opponent+ue>=me?(G("Banking for victory!"),await new Promise(H=>setTimeout(H,1e3)),_(ue)):we===0?(G("Hot Dice! Rolling again!"),await new Promise(H=>setTimeout(H,1e3)),V(ue)):ue>=400||we<=2?(G(`Banking ${ue}...`),await new Promise(H=>setTimeout(H,1e3)),_(ue)):(G("Rolling again..."),await new Promise(H=>setTimeout(H,1e3)),V(ue))},500)),()=>clearTimeout(R)},[u,W,A,s,v]);const _=R=>{const D=L.opponent+R;j(S=>({...S,opponent:D})),D>=me?K("opponent"):Q()},V=R=>{P(R),y(D=>D.map(S=>S.status==="selected"?{...S,status:"banked"}:S)),setTimeout(()=>{ne()},500)},Q=()=>{k(R=>R==="player"?"opponent":"player"),w(u==="player"?"opponent":"player")},ne=R=>{y(D=>{let S=D.filter(Z=>Z.status==="active").length;return S===0&&(S=6),q(S)})},se=()=>{const D=W.filter(de=>de.status==="selected").map(de=>de.value),S=Y(D);P(A+S);const Z=W.filter(de=>de.status==="active").length,ge=q(Z===0?6:Z);y(ge),le(ge)},le=(R,D)=>{const S=R.map(re=>re.value);Y(S)===0?(J(!0),T("FARKLE! No points. Turn lost."),setTimeout(Q,2e3)):T("Select dice to keep.")},xe=R=>{u!=="player"||v||y(D=>D.map(S=>S.id===R?{...S,status:S.status==="active"?"selected":"active"}:S))},h=()=>{const R=W.filter(re=>re.status==="selected"),D=Y(R.map(re=>re.value)),S=A+D;if(S<300&&L.player+S<me){T("Must score at least 300 to bank!");return}const Z=L.player+S;j(re=>({...re,player:Z})),Z>=me?K("player"):Q()},K=R=>{p("gameOver");const D=R==="player";n(d,D),T(D?"Victory!":"Defeat!"),C({won:D,amount:d})},je=()=>{C(null),p("betting"),j({player:0,opponent:0}),y([]),T("")},ie=Y(W.filter(R=>R.status==="selected").map(R=>R.value)),ce=ie>0&&(function(){const R=W.filter(D=>D.status==="selected").map(D=>D.value);for(let D=0;D<R.length;D++){const S=[...R];if(S.splice(D,1),Y(S)===ie)return!1}return!0})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
        @keyframes rollIn { 0% { transform: rotate(-360deg) scale(0.2); opacity: 0; } 70% { transform: rotate(10deg) scale(1.1); opacity: 1; } 100% { transform: rotate(0) scale(1); opacity: 1; } }
        .die-roll { animation: rollIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
      `}),f&&e.jsx(Nt,{onClose:()=>z(!1)}),c&&e.jsx(Rt,{won:c.won,amount:c.amount,onPlayAgain:je,onLeave:m,numberFormat:t.numberFormat}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",background:"var(--panel-bg)",padding:"15px 20px",borderBottom:"2px solid var(--border-color)",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"YOU"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:L.player})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-color)"},children:"TARGET"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"1.2rem"},children:me})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"OPPONENT"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:L.opponent})]})]}),e.jsxs("div",{style:{flex:1,overflow:"hidden",background:"var(--bg-color)",display:"flex",flexDirection:"column",justifyContent:"center"},children:[s==="betting"&&e.jsxs("div",{style:{padding:"20px",textAlign:"center",maxWidth:"600px",margin:"0 auto",width:"100%",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:"3rem"},children:"ðŸŽ²"}),e.jsx("h3",{children:"High Stakes Farkle"}),e.jsxs("p",{style:{marginBottom:"auto",color:"var(--text-secondary)"},children:["Winner takes the pot. Race to ",me,"."]})]}),(s==="playing"||s==="gameOver")&&e.jsxs("div",{style:{padding:"10px",textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{marginBottom:"20px",minHeight:"30px",flexShrink:0},children:u==="player"?e.jsxs("div",{style:{padding:"10px",background:"rgba(76, 175, 80, 0.1)",border:"1px solid #4caf50",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#2e7d32",fontWeight:"bold"},children:"YOUR TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:A+ie})]})]}):e.jsxs("div",{style:{padding:"10px",background:"rgba(244, 67, 54, 0.1)",border:"1px solid #ef5350",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#c62828",fontWeight:"bold"},children:"OPPONENT'S TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:A})]}),e.jsx("div",{style:{fontSize:"0.8rem",fontStyle:"italic"},children:O})]})}),e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap",marginBottom:"20px",flex:1,alignContent:"center"},children:W.map(R=>e.jsx("div",{className:R.animating?"die-roll":"",style:{width:"64px",height:"64px",background:R.status==="selected"?"var(--accent-color)":"#fdfdfd",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",cursor:u==="player"?"pointer":"default",border:R.status==="selected"?"2px solid var(--gold-color)":"1px solid #ccc"},onClick:()=>xe(R.id),children:e.jsx(Tt,{value:R.value,size:50,color:R.status==="selected"?"#fff":"#333"})},R.id))}),e.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"10px",fontWeight:"bold",minHeight:"2rem",flexShrink:0},children:F})]})]}),e.jsxs("div",{style:{padding:"15px 20px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",flexShrink:0},children:[s==="betting"&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Re,{currentBet:d,maxGold:t.gold,onBetChange:a,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:N,disabled:d<=0,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:d<=0?.5:1,flexShrink:0,fontWeight:"bold"},children:"START"})]}),(s==="playing"||s==="gameOver")&&e.jsxs("div",{children:[s==="playing"&&u==="player"?e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center"},children:[e.jsxs("button",{className:"btn",onClick:se,disabled:!ce,style:{opacity:ce?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Roll (+",ie,")"]}),e.jsxs("button",{className:"btn",onClick:h,disabled:!ce&&A===0,style:{background:"var(--success-color)",opacity:ce||A>0?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Bank ",A+ie]})]}):e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"15px"},children:"Wait for opponent..."}),e.jsx("div",{style:{position:"absolute",top:"15px",right:"20px"},children:e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.5rem",opacity:.5},onClick:()=>z(!0),children:"â“"})})]})]})]})},Et=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],At=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],Bt=50,It=({won:t,amount:n,winnerName:m,onPlayAgain:d,onLeave:a,numberFormat:s})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸ‡":"ðŸ¢"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#fff",textTransform:"uppercase"},children:t?"Winner!":"Better luck next time"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["Winner: ",e.jsx("strong",{style:{color:"var(--accent-color)"},children:m})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:I(o(n),s)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:I(o(n),s)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:d,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Race Again"}),e.jsx("button",{className:"btn",onClick:a,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),zt=({gameState:t,onGamble:n,onLeave:m})=>{const[d,a]=x.useState([]),[s,p]=x.useState(null),[u,k]=x.useState(0),[f,z]=x.useState("betting"),[c,C]=x.useState(""),[L,j]=x.useState(null),A=x.useRef(null),P=x.useRef([]);x.useEffect(()=>{W()},[]);const W=()=>{const v=[],J=[...Et].sort(()=>.5-Math.random());for(let O=0;O<6;O++){const G=Math.random()*5+5,q=Math.random()*5+5;let U=25-(G+q);U=U+(Math.random()*4-2),U<1.5&&(U=1.5),U>20&&(U=20),v.push({id:O,name:J[O],color:At[O],icon:"ðŸŽ",odds:parseFloat(U.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:G,staminaRating:q})}a(v),p(null),j(null),P.current=[],C("Select a horse and place your bet!")},y=()=>{if(s===null){C("Select a horse first!");return}if(u<=0){C("Place a valid bet!");return}if(t.gold.lt(o(u))){C("Not enough gold!");return}z("racing"),C("And they're off!"),A.current=setInterval(()=>{a(v=>v.map(O=>{if(O.finished)return O;const G=Math.random()<.05?1:0,q=Math.random()<.05?-.5:0,Y=.25,U=O.speedRating/10*.15,N=Math.random()*.2;let w=Y+U+N+G+q,_=O.progress+w;return _>=100&&(_=100,!P.current.includes(O.id))?(P.current.push(O.id),{...O,progress:100,finished:!0,rank:P.current.length}):{...O,progress:_}})),P.current.length===6&&F()},Bt)},F=()=>{A.current&&clearInterval(A.current);const v=P.current[0],J=d.find(G=>G.id===v);if(!J)return;if(z("finished"),v===s){const G=d.find(U=>U.id===s),q=(G==null?void 0:G.odds)||1,Y=Math.floor(u*(q-1));n(Y,!0),j({won:!0,amount:Y,winnerName:J.name})}else n(u,!1),j({won:!1,amount:u,winnerName:J.name})};x.useEffect(()=>()=>{A.current&&clearInterval(A.current)},[]);const T=()=>{z("betting"),k(0),W()};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[L&&e.jsx(It,{won:L.won,amount:L.amount,winnerName:L.winnerName,onPlayAgain:T,onLeave:m,numberFormat:t.numberFormat}),e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:c}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),d.map(v=>e.jsxs("div",{onClick:()=>f==="betting"&&p(v.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:f==="betting"?"pointer":"default",background:s===v.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"rgba(255,255,255,0.4)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:v.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:s===v.id?"#d84315":"var(--text-secondary)",fontWeight:"bold"},children:[v.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${v.progress}% - ${v.progress*.8}px)`,transition:f==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.3))"},children:e.jsx("div",{style:{color:v.color,filter:s===v.id?"drop-shadow(0 0 5px gold)":"none"},children:v.icon})}),v.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5},children:v.rank===1?"ðŸ¥‡":v.rank===2?"ðŸ¥ˆ":v.rank===3?"ðŸ¥‰":`#${v.rank}`})]},v.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[f==="betting"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{flex:1},children:e.jsx(Re,{currentBet:u,maxGold:t.gold,onBetChange:k,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:y,disabled:s===null||u<=0,style:{opacity:s===null||u<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold",flexShrink:0},children:"START"})]}),f==="racing"&&e.jsx("div",{style:{padding:"20px",width:"100%",textAlign:"center",fontStyle:"italic",color:"var(--text-secondary)"},children:"Race in progress..."})]})]})},Mt=({won:t,amount:n,side:m,onPlayAgain:d,onLeave:a,numberFormat:s})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px",animation:"pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:t?"âœ¨":"ðŸ’¸"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336",textTransform:"uppercase",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:t?"Victory!":"Defeat"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["Result: ",e.jsx("strong",{style:{color:"gold",textTransform:"uppercase"},children:m})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:I(o(n),s)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:I(o(n),s)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:d,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Flip Again"}),e.jsx("button",{className:"btn",onClick:a,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),Dt=({gameState:t,onGamble:n,onLeave:m})=>{const[d,a]=x.useState(0),[s,p]=x.useState(null),[u,k]=x.useState(!1),[f,z]=x.useState(0),[c,C]=x.useState(null),[L,j]=x.useState("Select a side and place your wager."),A=()=>{C(null),p(null),j("Select a side and place your wager.")},P=()=>{if(!s){j("Please select Heads or Tails!");return}if(d<=0){j("Please enter a valid bet amount.");return}if(t.gold.lt(o(d))){j("Not enough gold!");return}k(!0),j("Flipping...");const y=Math.random()>.5?"heads":"tails",F=s===y,T=f,J=360*5;let O=T+J;const G=O%360;y==="heads"?O+=360-G:O+=180-G+360,z(O),setTimeout(()=>{k(!1),F?(n(d,!0),j("Victory!")):(n(d,!1),j("Defeat!")),setTimeout(()=>{C({won:F,amount:F?d*2:d,side:y})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),c&&e.jsx(Mt,{won:c.won,amount:c.amount,side:c.side,onPlayAgain:A,onLeave:m,numberFormat:t.numberFormat}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${f}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"ðŸ‘‘"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"40px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:L}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>p("heads"),disabled:u,style:{padding:"10px 20px",border:`3px solid ${s==="heads"?"var(--gold-color)":"transparent"}`,background:s==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px"},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"ðŸ‘‘"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>p("tails"),disabled:u,style:{padding:"10px 20px",border:`3px solid ${s==="tails"?"var(--gold-color)":"transparent"}`,background:s==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px"},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[!u&&e.jsx(Re,{currentBet:d,maxGold:t.gold,onBetChange:a,numberFormat:t.numberFormat}),u&&e.jsx("div",{style:{padding:"10px",fontStyle:"italic"},children:"Flipping..."})]}),e.jsx("button",{className:"btn",onClick:P,disabled:!s||d<=0||u,style:{opacity:!s||d<=0||u?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]})]})},et=({value:t,size:n=80,color:m="#3e2723"})=>{const d=n*.18,a=n*.25,s=n*.5,p=n*.75,u=[];return(t===1||t===3||t===5)&&u.push({cx:s,cy:s}),t>1&&(u.push({cx:a,cy:a}),u.push({cx:p,cy:p})),t>3&&(u.push({cx:p,cy:a}),u.push({cx:a,cy:p})),t===6&&(u.push({cx:a,cy:s}),u.push({cx:p,cy:s})),e.jsx("div",{style:{width:n,height:n,backgroundColor:"#fff",borderRadius:n*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:u.map((k,f)=>e.jsx("circle",{cx:k.cx,cy:k.cy,r:d/2,fill:m},f))})})},Lt=({won:t,amount:n,sum:m,onPlayAgain:d,onLeave:a,numberFormat:s})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸŽ²":"ðŸ“‰"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336",textTransform:"uppercase"},children:t?"You Won!":"You Lost"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["You rolled a ",e.jsx("strong",{style:{color:"var(--accent-color)"},children:m})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:I(o(n),s)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:I(o(n),s)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:d,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Roll Again"}),e.jsx("button",{className:"btn",onClick:a,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),Wt=({gameState:t,onGamble:n,onLeave:m})=>{const[d,a]=x.useState(0),[s,p]=x.useState(!1),[u,k]=x.useState([1,1]),[f,z]=x.useState(null),[c,C]=x.useState("Place your wager and roll!"),L=()=>{if(d<=0){C("Please enter a valid bet amount.");return}if(t.gold.lt(o(d))){C("Not enough gold!");return}p(!0),C("Rolling..."),z(null);let P=0;const W=10,y=setInterval(()=>{k([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),P++,P>=W&&(clearInterval(y),j())},100)},j=()=>{const P=Math.floor(Math.random()*6)+1,W=Math.floor(Math.random()*6)+1,y=P+W;k([P,W]),p(!1);let F=0,T=!1,v="";y===2?(F=10,T=!0,v="Snake Eyes! JACKPOT (x10)!"):y>=3&&y<=6?(F=0,T=!1,v="Low roll... House wins."):y===7?(F=2,T=!0,v="Lucky Seven! (x2)"):y>=8&&y<=11?(F=1.5,T=!0,v="Good roll! (x1.5)"):y===12&&(F=5,T=!0,v="Boxcars! Huge Win (x5)!"),T?(n(Math.floor(d*(F-1)),!0),C(v),z({won:!0,amount:Math.floor(d*(F-1)),sum:y})):(n(d,!1),C(v),z({won:!1,amount:d,sum:y}))},A=()=>{z(null),C("Place your wager and roll!")};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[f&&e.jsx(Lt,{won:f.won,amount:f.amount,sum:f.sum,onPlayAgain:A,onLeave:m,numberFormat:t.numberFormat}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.7)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 7"}),e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Sum 8-11"}),e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"x1.5"})]}),e.jsx("div",{style:{textAlign:"center",color:"#ef5350",borderTop:"1px solid #ccc",marginTop:"5px"},children:"Sum 3-6: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(et,{value:u[0],size:100}),e.jsx(et,{value:u[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:s?"Rolling...":`Sum: ${u[0]+u[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:c})]}),!s&&e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Re,{currentBet:d,maxGold:t.gold,onBetChange:a,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:L,disabled:d<=0,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:d<=0?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]})]})},Ft=({gameState:t,onGamble:n,onClose:m})=>{const[d,a]=x.useState("farkle");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"85vh",maxWidth:"900px",width:"95%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"ðŸº The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:I(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>a("farkle"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="farkle"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="farkle"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="farkle"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Farkle"}),e.jsx("button",{onClick:()=>a("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸ‡ Racing"}),e.jsx("button",{onClick:()=>a("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŸ¡ Coin"}),e.jsx("button",{onClick:()=>a("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[d==="farkle"&&e.jsx(Pt,{gameState:t,onGamble:(s,p)=>n(s,p),onLeave:m}),d==="racing"&&e.jsx(zt,{gameState:t,onGamble:(s,p)=>n(s,p),onLeave:m}),d==="coin"&&e.jsx(Dt,{gameState:t,onGamble:(s,p)=>n(s,p),onLeave:m}),d==="dice"&&e.jsx(Wt,{gameState:t,onGamble:(s,p)=>n(s,p),onLeave:m})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:m,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},Ot=({gameState:t,onPrestige:n,onClose:m})=>{var W;const a=o(1e12),s=t.totalGold;let p=o(0),u=!1,k=a.minus(s);if(s.gte(a)){const y=s.dividedBy(a);p=o(Math.floor(Math.pow(y.toNumber(),.33))).times(1).minus(t.renown),p.lt(0)&&(p=o(0)),u=p.gt(0)}const f=t.renown.plus(p),z=a.times(Math.pow(Math.floor(f.dividedBy(1).toNumber()+1),1/.33)),c=z.minus(s),L=ve(t.renown).minus(o(1)).times(o(100)),A=ve(t.renown.plus(p)).minus(o(1)).times(o(100)),P=Object.values(t.nationalProjects||{}).some(y=>y.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((W=t.playerProfile)!=null&&W.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",I(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),P&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"âš ï¸ WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",I(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",I(s,t.numberFormat)]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current Bonus:"})," +",L.toNumber().toFixed(1),"%"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," ",I(p,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After:"})," ",I(t.renown.plus(p),t.numberFormat)," (+",A.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:I(z,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:c.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",I(c.gt(0)?c:o(0),t.numberFormat)," more)"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:m,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:n,disabled:!u,children:u?"Abdicate":s.lt(a)?`Need ${I(k,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},Gt=({gameState:t,onClose:n,onHardReset:m,onSave:d,onOpenChangelog:a,onSetTheme:s,onSetNumberFormat:p,onToggleIdleMode:u,onUpdateInterface:k})=>{var ne,se,le,xe;const[f,z]=Ct.useState(!1),c=t.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},C=(ne=c.layout.left)!=null&&ne.toNumber?c.layout.left.toNumber():Number(c.layout.left),L=(se=c.layout.center)!=null&&se.toNumber?c.layout.center.toNumber():Number(c.layout.center),j=(le=c.layout.right)!=null&&le.toNumber?c.layout.right.toNumber():Number(c.layout.right),A=(xe=c.borderWidth)!=null&&xe.toNumber?c.borderWidth.toNumber():Number(c.borderWidth),P=c.customColors||{},W=String(P.bg||""),y=String(P.panel||""),F=String(P.text||""),T=String(P.secondaryText||""),v=String(P.accent||""),J=String(P.accentHover||""),O=String(P.gold||""),G=String(P.border||""),q=String(P.success||""),Y=String(P.danger||""),U=()=>{f?m():z(!0)},N=(h,K)=>{k({layout:{...c.layout,[h]:o(K)}})},w=(h,K)=>{k({customColors:{...c.customColors,[h]:K}})},_={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},V={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},Q={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"âš™ï¸ Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:C,onChange:h=>N("left",parseFloat(h.target.value)),style:Q}),e.jsx("span",{style:{fontSize:"0.8rem"},children:C})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:L,onChange:h=>N("center",parseFloat(h.target.value)),style:Q}),e.jsx("span",{style:{fontSize:"0.8rem"},children:L})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:j,onChange:h=>N("right",parseFloat(h.target.value)),style:Q}),e.jsx("span",{style:{fontSize:"0.8rem"},children:j})]})]}),e.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),e.jsxs("div",{style:V,children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"1",max:"10",value:A,onChange:h=>k({borderWidth:o(parseInt(h.target.value))})}),e.jsxs("span",{children:[A,"px"]})]})]}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),e.jsx("input",{type:"checkbox",checked:c.customColors.enabled,onChange:h=>w("enabled",h.target.checked),style:{transform:"scale(1.5)"}})]}),c.customColors.enabled&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",e.jsx("input",{type:"color",value:W,onChange:h=>w("bg",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",e.jsx("input",{type:"color",value:y,onChange:h=>w("panel",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",e.jsx("input",{type:"color",value:G,onChange:h=>w("border",h.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",e.jsx("input",{type:"color",value:F,onChange:h=>w("text",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",e.jsx("input",{type:"color",value:T,onChange:h=>w("secondaryText",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",e.jsx("input",{type:"color",value:O,onChange:h=>w("gold",h.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",e.jsx("input",{type:"color",value:v,onChange:h=>w("accent",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",e.jsx("input",{type:"color",value:J,onChange:h=>w("accentHover",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",e.jsx("input",{type:"color",value:q,onChange:h=>w("success",h.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",e.jsx("input",{type:"color",value:Y,onChange:h=>w("danger",h.target.value),style:{width:"100%"}})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px",opacity:c.customColors.enabled?.5:1,pointerEvents:c.customColors.enabled?"none":"auto"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",c.customColors.enabled&&"(Disabled)"]}),e.jsx("div",{style:_,children:Object.values(Ie).map(h=>e.jsx("button",{className:"btn",style:{background:t.theme===h.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===h.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>s(h.id),children:h.name},h.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),e.jsx("div",{style:_,children:["small","medium","large"].map(h=>e.jsx("button",{className:"btn",style:{background:c.fontSize===h?"var(--accent-color)":"var(--panel-bg)",color:c.fontSize===h?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>k({fontSize:h}),children:h},h))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:_,children:["compact","normal","spacious"].map(h=>e.jsx("button",{className:"btn",style:{background:c.density===h?"var(--accent-color)":"var(--panel-bg)",color:c.density===h?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>k({density:h}),children:h},h))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:u,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:c.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>k({showFloatingText:!c.showFloatingText}),children:c.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:c.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>k({showWeatherWidget:!c.showWeatherWidget}),children:c.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:c.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>k({crownAnimations:!c.crownAnimations}),children:c.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:V,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),e.jsx("button",{className:"btn",style:{background:c.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>k({reduceMotion:!c.reduceMotion}),children:c.reduceMotion?"ON":"OFF"})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:_,children:["standard","scientific","plain"].map(h=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===h?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===h?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>p(h),children:h},h))})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:d,children:"Force Save"}),e.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:a,children:"Update Logs"}),e.jsx("button",{className:"btn",style:{backgroundColor:f?"red":"#d32f2f"},onClick:U,children:f?"CONFIRM WIPE?":"Hard Reset"})]}),f&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:n,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},Ut=({gameState:t,currentGps:n,onClose:m})=>{var W,y;const d=Object.values(t.buildings).reduce((F,T)=>F.plus(T),o(0)),a=t.achievements.length,s=tt.length;let p="None",u="None",k=-1,f=o(0);ye.forEach((F,T)=>{const v=t.buildings[F.id]||o(0);v.gt(o(0))&&T>k&&(k=T,p=F.name),v.gt(f)&&(f=v,u=F.name)});const c=(()=>{let F=o(1);return F=F.times(ve(t.renown)),F})(),[C,L]=x.useState("");x.useEffect(()=>{const F=()=>{const v=o(Date.now()).minus(t.startTime),J=v.dividedBy(o(1e3)),O=J.minus(J.dividedBy(o(60)).floor().times(o(60))).floor(),G=v.dividedBy(o(6e4)),q=G.minus(G.dividedBy(o(60)).floor().times(o(60))).floor(),Y=v.dividedBy(o(36e5)),U=Y.minus(Y.dividedBy(o(24)).floor().times(o(24))).floor(),N=v.dividedBy(o(864e5)).floor();let w="";N.gt(o(0))&&(w+=`${N.toString()}d `),U.gt(o(0))&&(w+=`${U.toString()}h `),w+=`${q.toString()}m ${O.toString()}s`,L(w)};F();const T=setInterval(F,1e3);return()=>clearInterval(T)},[t.startTime]);const j={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},A={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},P=(W=t.weather)!=null&&W.current&&((y=ft[t.weather.current])==null?void 0:y.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"ðŸ“Š Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:A,children:"âš¡ Current Status"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[I(n,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[I(c,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:P})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",ve(t.renown).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:A,children:"â³ Time & Legacy"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:C})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:I(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:A,children:"ðŸ’° Economy Summary"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:I(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:I(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:A,children:"ðŸ° Dominion"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:I(d,t.numberFormat)})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:p})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[u," (",I(f,t.numberFormat),")"]})]}),e.jsx("h3",{style:A,children:"âš”ï¸ Workforce & Court"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[I(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsx("h3",{style:A,children:"ðŸ“ˆ Player Stats"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:I(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:I(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:I(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:A,children:"ðŸŽ–ï¸ Completion"}),e.jsxs("div",{style:j,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[a," / ",s," (",Math.floor(a/s*100),"%)"]})]}),e.jsx("h3",{style:A,children:"ðŸ† Achievements"}),e.jsx(gt,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:m,children:"Close Records"})]})})},Ht=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],$t=({gameState:t,onStartProject:n,onUpgradeClickPower:m,onUpgradeOffline:d,onClose:a})=>{const[s,p]=x.useState("infrastructure");if(!(t.buildings.field||o(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"ðŸ—ï¸ National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"ðŸ”’"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:a,children:"Close"})]})});const f=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:yt.map(c=>{var V,Q,ne,se;const C=t.buildings[c.id]||o(0);if(C.lt(10))return null;const L=t.nationalProjects[c.id]||{level:0,active:!1,startTime:0,endTime:0},j=L.level,A=j>=ze,P=L.active,W=j+1,y=ot(c.id,W),F=lt(W),T=Ht[W]||0,v=C.gte(T),J=t.gold.gte(y.gold),O=t.soldiers.gte(y.laborers),G=!y.carpenter.gt(0)||((V=t.eliteUnits.carpenter)==null?void 0:V.gte(y.carpenter)),q=!y.mason.gt(0)||((Q=t.eliteUnits.mason)==null?void 0:Q.gte(y.mason)),Y=!y.architect.gt(0)||((ne=t.eliteUnits.architect)==null?void 0:ne.gte(y.architect)),U=J&&O&&G&&q&&Y&&v;let N=0,w=0;if(P){const le=Date.now(),xe=L.endTime-L.startTime,h=le-L.startTime;N=Math.min(100,h/xe*100),w=Math.max(0,Math.ceil((L.endTime-le)/1e3))}const _=((se=ye.find(le=>le.id===c.id))==null?void 0:se.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:P?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:P?"var(--accent-color)":"rgba(0,0,0,0.05)",color:P?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:c.name.replace(" Infrastructure","")}),e.jsxs("span",{children:["Lvl ",j," / ",ze]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:P?"#000":"#fff",marginBottom:"10px",fontStyle:"italic"},children:c.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(j*nt*100).toFixed(0),"% Global"]}),P?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${N}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem",color:"#3e2723"},children:["Under Construction... ",Math.floor(w/3600),"h ",Math.floor(w%3600/60),"m"]})]}):A?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"5px"},children:[e.jsxs("span",{style:{color:J?"green":"red"},children:["ðŸ’° ",I(y.gold)," Gold"]}),e.jsxs("span",{style:{color:O?"green":"red"},children:["ðŸ‘· ",I(y.laborers)," Laborers"]}),y.carpenter.gt(0)&&e.jsxs("span",{style:{color:G?"green":"red"},children:["ðŸªš ",I(y.carpenter)," Carpenters"]}),y.mason.gt(0)&&e.jsxs("span",{style:{color:q?"green":"red"},children:["ðŸ§± ",I(y.mason)," Masons"]}),y.architect.gt(0)&&e.jsxs("span",{style:{color:Y?"green":"red"},children:["ðŸ“ ",I(y.architect)," Architects"]}),e.jsxs("span",{style:{color:v?"green":"red"},children:["ðŸ  ",I(o(T))," ",_,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["â³ Duration: ",Math.floor(F/3600),"h ",Math.floor(F%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:U?"var(--accent-color)":"var(--border-color)",cursor:U?"pointer":"not-allowed"},disabled:!U,onClick:()=>n(c.id),children:"Start Project (Units Consumed)"})]})]})]},c.id)})}),z=()=>{const c=t.clickUpgradeLevel||0,C=c>=Me,L=c+1,j=rt(L),A=t.gold.gte(j),P=o(2).pow(Math.min(c,15)),W=Le(c),y=W>0?`${I(P)} + ${(W*100).toFixed(1)}% of GPS`:I(P),F=o(2).pow(Math.min(L,15)),T=Le(L),v=T>0?`${I(F)} + ${(T*100).toFixed(1)}% of GPS`:I(F),J=t.offlineUpgradeLevel||0,O=J>=De,G=J+1,q=st(G),Y=t.renown.gte(q),{efficiency:U,duration:N}=We(J),{efficiency:w,duration:_}=We(G),V=Q=>{const ne=Math.floor(Q/3600),se=Math.floor(Q%3600/60);return ne>0?`${ne}h ${se}m`:`${se}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ‘‘ Royal Scepter"}),e.jsxs("span",{children:["Lvl ",c," / ",Me]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",y]}),C?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",v]}),e.jsxs("div",{style:{color:A?"green":"red",fontWeight:"bold"},children:["ðŸ’° ",I(j)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:A?"var(--accent-color)":"var(--border-color)",cursor:A?"pointer":"not-allowed"},disabled:!A,onClick:m,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ’¤ Offline Production"}),e.jsxs("span",{children:["Lvl ",J," / ",De]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Improve the efficiency of your kingdom while you are away."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(U*100).toFixed(0),"% for ",V(N)]}),O?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(w*100).toFixed(0),"% for ",V(_)]}),e.jsxs("div",{style:{color:Y?"#673ab7":"red",fontWeight:"bold"},children:["ðŸ‘‘ ",I(q)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:Y?"#673ab7":"var(--border-color)",cursor:Y?"pointer":"not-allowed"},disabled:!Y,onClick:d,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ›ï¸ National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:s==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:s==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:s==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>p("infrastructure"),children:"ðŸ—ï¸ Infrastructure"}),e.jsx("button",{className:"btn",style:{background:s==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:s==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:s==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>p("royalScepter"),children:"ðŸ‘‘ Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[s==="infrastructure"&&f(),s==="royalScepter"&&z()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:a,children:"Return to Kingdom"})})]})})},_t=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(n=>e.jsxs("div",{className:`toast ${n.type}`,children:[n.type==="success"&&"âœ…",n.type==="warning"&&"âš ï¸",n.type==="info"&&"â„¹ï¸",n.type==="error"&&"âŒ",e.jsx("span",{children:n.message})]},n.id))}),Yt=()=>{const[t,n]=x.useState(null);if(x.useEffect(()=>{const d=p=>{const k=p.target.closest("[data-tooltip]");if(k){const f=k.getAttribute("data-tooltip");f&&n({text:f,x:p.clientX,y:p.clientY})}else n(null)},a=p=>{t&&n(u=>u?{...u,x:p.clientX,y:p.clientY}:null)},s=()=>{n(null)};return document.addEventListener("mouseover",d),document.addEventListener("mousemove",a),document.addEventListener("mouseout",s),()=>{document.removeEventListener("mouseover",d),document.removeEventListener("mousemove",a),document.removeEventListener("mouseout",s)}},[t]),!t)return null;const m={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(m.left=t.x-260),t.y+100>window.innerHeight&&(m.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:m,children:t.text.split(`
`).map((d,a)=>e.jsx("div",{style:{marginBottom:a===t.text.split(`
`).length-1?0:"4px"},children:d},a))})},Vt={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},Jt=vt(Vt),Ne=jt(Jt);function Xt(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function qt(){const t=new Date,n=t.getDay(),m=t.getDate()-n+(n===0?-6:1);return new Date(t.setDate(m))}async function Kt(t){try{console.log("ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:",{rulerName:t.rulerName,rulerId:t.rulerId,gold:t.gold.toString(),renown:t.renown.toString(),buildings:t.buildings,achievements:t.achievements});const n={...t,period:"alltime"},m={...t,period:"weekly"};console.log("ðŸ“¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² leaderboard_alltime...");const d=Ye(Ne,"leaderboard_alltime",t.rulerId);await Ve(d,{...n,gold:Number(n.gold.toString()),renown:Number(n.renown.toString()),timestamp:Je()}),console.log("âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² leaderboard_alltime, ID:",t.rulerId),console.log("ðŸ“¤ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² leaderboard_weekly...");const a=Ye(Ne,"leaderboard_weekly",t.rulerId);return await Ve(a,{...m,gold:Number(m.gold.toString()),renown:Number(m.renown.toString()),timestamp:Je()}),console.log("âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² leaderboard_weekly, ID:",t.rulerId),console.log("ðŸŽ‰ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹!"),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",n.customData)),n}}async function Zt(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const n=it(at(Ne,"leaderboard_alltime"),ct("gold","desc"),dt(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const m=await ut(n);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",m.docs.length);const d=m.docs.map(a=>{const s=a.data();return{id:a.id,...s,gold:s.gold instanceof pe?s.gold:new pe(s.gold),renown:s.renown instanceof pe?s.renown:new pe(s.renown),timestamp:s.timestamp}});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",d.length),d}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),n}}async function Qt(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const n=qt();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",n.toISOString());const m=it(at(Ne,"leaderboard_weekly"),ct("gold","desc"),dt(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const d=await ut(m);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",d.docs.length);const s=d.docs.map(p=>{const u=p.data();return{id:p.id,...u,gold:u.gold instanceof pe?u.gold:new pe(u.gold),renown:u.renown instanceof pe?u.renown:new pe(u.renown),timestamp:u.timestamp}}).filter(p=>{var f,z;const u=((z=(f=p.timestamp)==null?void 0:f.toDate)==null?void 0:z.call(f))||new Date(p.timestamp),k=u>=n;return k||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",u.toISOString()),k});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",s.length),s}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),n}}const eo=({isOpen:t,onClose:n,onConfirm:m,gameState:d})=>{const[a,s]=x.useState(""),[p,u]=x.useState(!1);if(!t)return null;const k=async()=>{if(a.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(a.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}u(!0);try{const z={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:a.trim(),rulerId:Xt(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};m(z),n()}catch{alert("An error occurred while creating profile. Please try again.")}finally{u(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:to(d.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:a,onChange:f=>s(f.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:f=>f.key==="Enter"&&k()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[a.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:k,disabled:p||a.trim().length<3,style:{padding:"12px 24px",backgroundColor:p||a.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:p||a.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:p?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:n,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:f=>{f.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:f=>{f.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function to(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const oo=({isOpen:t,onClose:n,playerProfile:m,onOpenRulerNameModal:d,gameState:a})=>{const[s,p]=x.useState([]),[u,k]=x.useState([]),[f,z]=x.useState("alltime"),[c,C]=x.useState(!1),[L,j]=x.useState(null),[A,P]=x.useState(0),[W,y]=x.useState(0),F=()=>{const N=localStorage.getItem("leaderboardCache");if(N)try{const{data:w,timestamp:_}=JSON.parse(N),V=Date.now(),Q=3600*1e3;if(V-_<Q&&w&&w.allTime&&w.weekly)return w}catch(w){console.error("Cache parse error:",w)}return null},T=N=>{const w={data:N,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(w)),y(Date.now())},v=()=>{const N=localStorage.getItem("leaderboardCache");if(N){const{timestamp:w}=JSON.parse(N),_=Date.now(),V=3600*1e3;return _-w<V}return!1};x.useEffect(()=>{if(t){if(v())try{const N=F();if(N){p(N.allTime),k(N.weekly);const w=JSON.parse(localStorage.getItem("leaderboardCache"));y(w.timestamp);return}}catch(N){console.error("Cache read error:",N)}J()}},[t]);const J=async()=>{C(!0),j(null);try{const N=new Promise((V,Q)=>setTimeout(()=>Q(new Error("Loading timeout")),1e4)),[w,_]=await Promise.all([Promise.race([Zt(50),N]),Promise.race([Qt(50),N])]);p(w),k(_),T({allTime:w,weekly:_}),console.log("Leaderboard data loaded successfully!")}catch(N){console.error("Error loading leaderboard:",N),j("Failed to load leaderboard. Please check your internet connection and try again.")}finally{C(!1)}},O=N=>{switch(N){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${N}`}},G=()=>m?(f==="alltime"?s:u).findIndex(w=>w.rulerId===m.rulerId)+1:-1,q=()=>{const N=f==="alltime"?s:u;if(N.length>0){let w=0;if(N.forEach(_=>{if(_.timestamp){let V=0;typeof _.timestamp=="object"&&_.timestamp.toDate?V=_.timestamp.toDate().getTime():typeof _.timestamp=="number"?V=_.timestamp:typeof _.timestamp=="string"&&(V=new Date(_.timestamp).getTime()),V>w&&(w=V)}}),w>0)return w}return W},Y=f==="alltime"?s:u,U=Y.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),e.jsx("button",{className:"btn",onClick:n,children:"Close"})]}),!m&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),d&&a&&a.gold&&a.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{n(),d()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),U&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-q())/6e4)," minutes ago"]})}),c&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),L&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:L}),m&&U&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",m.rulerName," ",m.rulerId]}),Y.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",G()>0?`#${G()}`:"Not ranked yet"," in ",f==="alltime"?"All Time":"Weekly"]})]}),U&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>z("alltime"),className:f==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>z("weekly"),className:f==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),U&&!c&&!L&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),e.jsx("tbody",{children:Y.map((N,w)=>e.jsxs("tr",{style:{backgroundColor:(m==null?void 0:m.rulerId)===N.rulerId?"rgba(191, 144, 0, 0.1)":w%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:O(w+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:N.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:N.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:I(N.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:I(N.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:N.buildings})]},N.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},he={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},be={gold:o(0),totalGold:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!0,interface:he,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},ke=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(ke);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const n={};for(const m in t)t.hasOwnProperty(m)&&(n[m]=ke(t[m]));return n}return t},co=()=>{var He;const[t,n]=x.useState(()=>{var l,i,b,B,M,E;const r=localStorage.getItem("kingdom_save");if(r)try{const g=JSON.parse(r),$=g.interface||{},X={...he,...$,lastBuyAmount:o($.lastBuyAmount??1),crownAnimations:$.crownAnimations??!0,layout:{left:o(((l=$.layout)==null?void 0:l.left)??he.layout.left),center:o(((i=$.layout)==null?void 0:i.center)??he.layout.center),right:o(((b=$.layout)==null?void 0:b.right)??he.layout.right)},borderWidth:o($.borderWidth??he.borderWidth),customColors:{...he.customColors,...$.customColors||{}}};return{...be,...g,renown:o(g.renown||0),prestigeCount:g.prestigeCount||0,gold:o(g.gold||0),totalGold:o(g.totalGold||0),startTime:o(g.startTime||Date.now()),lastSaveTime:o(g.lastSaveTime||Date.now()),soldiers:o(g.soldiers||0),buildings:Object.keys(g.buildings||{}).reduce((te,ee)=>(te[ee]=o(g.buildings[ee]),te),{}),stats:{...be.stats,...g.stats||{},totalClicks:o(((B=g.stats)==null?void 0:B.totalClicks)||0),dragonsKilled:o(((M=g.stats)==null?void 0:M.dragonsKilled)||0),tavernGamesPlayed:o(((E=g.stats)==null?void 0:E.tavernGamesPlayed)||0)},eliteUnits:Object.keys(g.eliteUnits||{}).reduce((te,ee)=>(te[ee]=o(g.eliteUnits[ee]),te),{}),nationalProjects:g.nationalProjects||{},clickUpgradeLevel:g.clickUpgradeLevel||0,offlineUpgradeLevel:g.offlineUpgradeLevel||0,weather:g.weather?{...g.weather,timeLeft:o(Number(g.weather.timeLeft)||120)}:be.weather,theme:g.theme||"default",numberFormat:g.numberFormat||"standard",idleModeEnabled:g.idleModeEnabled!==void 0?g.idleModeEnabled:!0,interface:X,playerProfile:g.playerProfile?{...g.playerProfile,lastLeaderboardSubmit:g.playerProfile.lastLeaderboardSubmit||0}:null}}catch(g){console.error("Save load failed",g)}return be}),m=x.useRef(t);x.useEffect(()=>{m.current=t},[t]);const d=x.useRef("");x.useEffect(()=>{const r=l=>{d.current=(d.current+l.key).slice(-20);const i=d.current.toLowerCase();i.endsWith("godon")?(n(b=>({...b,godMode:!0})),K("God Mode Enabled: +99999s per click","success"),d.current=""):i.endsWith("godoff")&&(n(b=>({...b,godMode:!1})),K("God Mode Disabled","info"),d.current="")};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);const[a,s]=x.useState(!1);x.useEffect(()=>{let r;const l=()=>{s(!1),clearTimeout(r),t.idleModeEnabled&&(r=setTimeout(()=>{s(!0)},2e4))};l();const i=["mousemove","mousedown","keydown","touchstart","scroll"];return i.forEach(b=>window.addEventListener(b,l)),()=>{clearTimeout(r),i.forEach(b=>window.removeEventListener(b,l))}},[t.idleModeEnabled]),x.useEffect(()=>{t.event&&s(!1)},[t.event]),x.useEffect(()=>{const r=I(t.gold);document.title=`Gold: ${r} - Kingdom Clicker`},[t.gold]),x.useEffect(()=>{var M;const r=document.documentElement,l=t.interface||he;if((M=l.customColors)!=null&&M.enabled){const E=l.customColors;r.style.setProperty("--bg-color",E.bg),r.style.setProperty("--panel-bg",E.panel),r.style.setProperty("--text-color",E.text),r.style.setProperty("--text-secondary",E.secondaryText||"#5d4037"),r.style.setProperty("--text-on-accent","#ffffff"),r.style.setProperty("--accent-color",E.accent),r.style.setProperty("--accent-hover",E.accentHover||E.accent),r.style.setProperty("--gold-color",E.gold||"#bf9000"),r.style.setProperty("--border-color",E.border),r.style.setProperty("--success-color",E.success||"#2e7d32"),r.style.setProperty("--danger-color",E.danger||"#c62828"),r.style.setProperty("--bg-image","none")}else{const E=t.theme||"default",g=Ie[E]||Ie.default;g&&Object.entries(g.colors).forEach(([$,X])=>{r.style.setProperty($,X)})}const i={small:"14px",medium:"16px",large:"18px"};r.style.setProperty("--base-font-size",i[l.fontSize]);const b={compact:"8px",normal:"12px",spacious:"20px"},B={compact:"6px",normal:"12px",spacious:"16px"};r.style.setProperty("--panel-padding",b[l.density]),r.style.setProperty("--gap-size",B[l.density]),r.style.setProperty("--custom-border-width",`${l.borderWidth}px`),r.style.setProperty("--col-left",String(l.layout.left)),r.style.setProperty("--col-center",String(l.layout.center)),r.style.setProperty("--col-right",String(l.layout.right)),l.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[p,u]=x.useState(!1);x.useEffect(()=>{var r;t.gold.gte(o(1e7))&&!((r=t.playerProfile)!=null&&r.hasChosenName)&&!p&&le(!0)},[t.gold,t.playerProfile,p]);const[k,f]=x.useState(null),[z,c]=x.useState([]),[C,L]=x.useState(null),[j,A]=x.useState("buildings"),[P,W]=x.useState("army"),[y,F]=x.useState(!1),[T,v]=x.useState("throne");x.useEffect(()=>{const r=()=>{F(window.innerWidth<768)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const[J,O]=x.useState(!1),[G,q]=x.useState(!1),[Y,U]=x.useState(!1),[N,w]=x.useState(!1),[_,V]=x.useState(!1),[Q,ne]=x.useState(!1),[se,le]=x.useState(!1),[xe,h]=x.useState(!1),K=(r,l="info")=>{const i=Date.now().toString()+Math.random();c(b=>[...b,{id:i,message:r,type:l}]),setTimeout(()=>{c(b=>b.filter(B=>B.id!==i))},3e3)};x.useEffect(()=>{const r=Date.now();if(t.lastSaveTime&&o(r).minus(t.lastSaveTime).gt(o(6e4))){const l=o(r).minus(t.lastSaveTime).dividedBy(o(1e3)),{efficiency:i,duration:b}=We(t.offlineUpgradeLevel||0),B=o(b),M=pe.min(l,B),g=je(t).times(o(i)).times(M).floor(),$=[];let X={...t.nationalProjects},te=!1;Object.keys(X).forEach(ee=>{var ae;const oe=X[ee];if(oe.active&&oe.endTime&&r>=oe.endTime){X[ee]={...oe,active:!1,level:oe.level+1,startTime:0,endTime:0};const fe=(ae=ye.find(Ee=>Ee.id===ee))==null?void 0:ae.name;fe&&$.push(`${fe} Infrastructure (Lvl ${oe.level+1})`),te=!0}}),(g.gt(o(0))||$.length>0)&&(L({gained:g,effectiveTime:M,totalTime:l,efficiency:i,completedProjects:$}),n(ee=>({...ee,gold:ee.gold.plus(g),totalGold:ee.totalGold.plus(g),nationalProjects:te?X:ee.nationalProjects})))}},[]),x.useEffect(()=>{const r=setInterval(()=>{Date.now()%3e4<1e3&&n(l=>{const i={...l,lastSaveTime:o(Date.now())},b=ke(i);return localStorage.setItem("kingdom_save",JSON.stringify(b)),i})},1e3);return()=>clearInterval(r)},[]),x.useEffect(()=>{const r=()=>{const i=m.current,b=ke(i);localStorage.setItem("kingdom_save",JSON.stringify(b))};window.addEventListener("beforeunload",r);const l=()=>{document.visibilityState==="hidden"&&r()};return document.addEventListener("visibilitychange",l),()=>{window.removeEventListener("beforeunload",r),document.removeEventListener("visibilitychange",l)}},[]),x.useEffect(()=>{var l;if(!((l=t.playerProfile)!=null&&l.hasChosenName))return;const r=setInterval(()=>{var E;const i=m.current,b=Date.now(),B=((E=i.playerProfile)==null?void 0:E.lastLeaderboardSubmit)||0,M=3600*1e3;b-B>=M&&Kt({rulerName:i.playerProfile.rulerName,rulerId:i.playerProfile.rulerId,gold:i.gold,renown:i.renown,buildings:Object.keys(i.buildings).length,achievements:i.achievements.length,period:"alltime"}).then(()=>{n(g=>({...g,playerProfile:{...g.playerProfile,lastLeaderboardSubmit:Date.now()}})),K("Leaderboard data submitted successfully!","success")}).catch(g=>{console.error("Auto leaderboard submission failed:",g)})},6e4);return()=>clearInterval(r)},[(He=t.playerProfile)==null?void 0:He.hasChosenName]),x.useEffect(()=>{const r=setInterval(()=>{if(!t.event&&Math.random()<.05){const b=["dragon","merchant","jester"],B=b[Math.floor(Math.random()*b.length)],M=B==="dragon"?6e5:3e4,E={id:Date.now().toString(),type:B,expiresAt:o(Date.now()).plus(o(M)),hp:B==="dragon"?o(10):void 0,maxHp:B==="dragon"?o(10):void 0,reward:o(0),startTime:B==="dragon"?Date.now():void 0};n(g=>({...g,event:E}))}},1e4);return()=>clearInterval(r)},[t.event]);const je=r=>{var E;let l=o(0);const i=((E=r.weather)==null?void 0:E.current)||"clear";ye.forEach(g=>{const $=r.buildings[g.id]||o(0);let X=g.baseProduction;i==="sunny"?(g.id==="peasant"||g.id==="field"||g.id==="stable"||g.id==="cathedral")&&(X=X.times(o(1.2))):i==="rainy"?(g.id==="silver_mine"||g.id==="alchemist"||g.id==="market"||g.id==="tavern")&&(X=X.times(o(1.2))):i==="stormy"?((g.id==="blacksmith"||g.id==="void_portal")&&(X=X.times(o(1.3))),(g.id==="field"||g.id==="stable")&&(X=X.times(o(.8)))):i==="windy"&&(g.id==="market"||g.id==="castle"||g.id==="time_chamber")&&(X=X.times(o(1.15))),l=l.plus($.times(X))});let b=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(g=>{b+=g.level||0});let B=o(1);const M=o(1).plus(o(b*nt));if(B=B.times(M),B=B.times(ve(r.renown).plus(o(r.achievements.length*.02))),r.event&&r.event.type==="dragon"&&r.event.startTime){const g=Math.floor((Date.now()-r.event.startTime)/1e3),X=1-Math.min(99,g)/100;B=B.times(o(X))}return l=l.times(B),l},ie=je(t),ce=x.useRef(ie);ce.current=ie,x.useEffect(()=>{const r=setInterval(()=>{n(l=>{const i=Date.now(),b=ce.current.times(o(Ae)).dividedBy(o(1e3));let B=l.totalGold.plus(b),M=l.gold.plus(b),E={...l.weather};const g=o(Ae/1e3);if(E.timeLeft=E.timeLeft.minus(g),E.timeLeft.lte(o(0))){const oe=["clear","sunny","rainy","stormy","windy"],ae=oe[Math.floor(Math.random()*oe.length)],fe=o(Math.floor(Math.random()*120)+60);E={current:ae,timeLeft:fe}}let $=l.event;$&&$.expiresAt&&o($.expiresAt).lt(o(i))&&($=null);let X={...l.nationalProjects||{}};Object.keys(X).forEach(oe=>{var fe;const ae=X[oe];ae.active&&ae.endTime&&i>=ae.endTime&&(X[oe]={...ae,active:!1,level:ae.level+1,startTime:0,endTime:0},K(`Project Completed: ${(fe=ye.find(Ee=>Ee.id===oe))==null?void 0:fe.name} Infrastructure Level ${ae.level+1}!`,"success"))});const te=[...l.achievements];let ee=null;return tt.forEach(oe=>{te.includes(oe.id)||oe.condition({...l,totalGold:B,gold:M},ce.current)&&(te.push(oe.id),ee=oe)}),ee&&(f(ee),setTimeout(()=>f(null),3e3)),{...l,gold:M,totalGold:B,achievements:te,event:$,soldiers:l.soldiers,weather:E,nationalProjects:X}})},Ae);return()=>clearInterval(r)},[]);const R=(r="light")=>{if("vibrate"in navigator&&y)switch(r){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},D=(r=!1)=>{r||R("light");const l=S(m.current);n(i=>({...i,gold:i.gold.plus(l),totalGold:i.totalGold.plus(l),stats:{...i.stats,totalClicks:r?i.stats.totalClicks:i.stats.totalClicks.plus(o(1))}}))},S=r=>{const l=ve(r.renown),i=o(1),b=r.clickUpgradeLevel||0,B=Math.min(b,15),M=o(2).pow(B),E=i.times(M),g=je(r),$=Le(b),X=g.times($);let te=E.plus(X);if(te=te.times(l),r.godMode){const ee=g.times(o(99999));te=te.plus(ee)}return te},Z=()=>{const r=t.clickUpgradeLevel||0;if(r>=Me){K("Maximum Royal Scepter level reached!","warning");return}const l=rt(r+1);if(t.gold.lt(l)){K("Not enough gold!","error");return}n(i=>({...i,gold:i.gold.minus(l),clickUpgradeLevel:i.clickUpgradeLevel+1})),K(`Royal Scepter upgraded to level ${r+1}!`,"success")},re=()=>{const r=t.offlineUpgradeLevel||0;if(r>=De){K("Maximum Passive Income level reached!","warning");return}const l=st(r+1);if(t.renown.lt(l)){K("Not enough Renown!","error");return}n(i=>({...i,renown:i.renown.minus(l),offlineUpgradeLevel:i.offlineUpgradeLevel+1})),K(`Passive Income upgraded to level ${r+1}!`,"success")},ge=(r,l)=>{const i=ye.find(M=>M.id===r);if(!i||l<=0)return;const b=t.buildings[r]||o(0),B=$e(i.baseCost,b,o(l)).floor();t.gold.gte(B)&&(R("medium"),n(M=>({...M,gold:M.gold.minus(B),buildings:{...M.buildings,[r]:(M.buildings[r]||o(0)).plus(o(l))}})))},de=(r,l)=>{const i=ye.find(E=>E.id===r);if(!i||l<=0)return;const b=t.buildings[r]||o(0),B=o(Math.min(l,b.toNumber()));if(B.lte(o(0)))return;const M=$e(i.baseCost,b.minus(B),B).times(o(.25)).floor();n(E=>({...E,gold:E.gold.plus(M),buildings:{...E.buildings,[r]:b.minus(B)}}))},Ce=r=>{const l=_e.times(o(r));t.gold.gte(l)&&n(i=>({...i,gold:i.gold.minus(l),soldiers:i.soldiers.plus(l.dividedBy(_e))}))},ue=(r,l)=>{const i=bt.find(M=>M.id===r);if(!i)return;const b=i.goldCost.times(o(l)),B=i.soldierCost.times(o(l));t.gold.gte(b)&&t.soldiers.gte(B)&&n(M=>({...M,gold:M.gold.minus(b),soldiers:M.soldiers.minus(B),eliteUnits:{...M.eliteUnits,[r]:(M.eliteUnits[r]||o(0)).plus(o(l))}}))},we=r=>{if(r.type==="merchant"){const l=ce.current.times(o(10));n(i=>({...i,gold:i.gold.plus(l),totalGold:i.totalGold.plus(l),event:null})),K(`The merchant gifted you ${I(l.floor(),t.numberFormat)} gold!`,"success")}else if(r.type==="jester"){const l=t.gold.times(o(.1)),i=Math.random()>.5;n(b=>({...b,gold:i?b.gold.plus(l):b.gold.minus(l),totalGold:i?b.totalGold.plus(l):b.totalGold,event:null})),i?K(`Jester pays out! +${I(l.floor(),t.numberFormat)}`,"success"):K(`Jester tricked you! -${I(l.floor(),t.numberFormat)}`,"warning")}else if(r.type==="dragon"){let l=!1;n(i=>{if(!i.event||i.event.type!=="dragon")return i;const B=(i.event.hp?i.event.hp:o(10)).minus(o(1));if(B.lte(0)){const M=ce.current.times(o(30));return l=!0,{...i,gold:i.gold.plus(M),totalGold:i.totalGold.plus(M),event:null,stats:{...i.stats,dragonsKilled:i.stats.dragonsKilled.plus(o(1))}}}return{...i,event:{...i.event,hp:B}}}),l&&K("Dragon Slain! +Treasury Boost","success")}},Fe=()=>{const r=o(1),l=o(1e12),i=t.totalGold;if(i.lt(l))return;const b=i.dividedBy(l),M=o(Math.floor(Math.pow(b.toNumber(),.33))).times(r).minus(t.renown);if(M.lte(0))return;const E={...t.nationalProjects};Object.keys(E).forEach(g=>{E[g].active&&(E[g]={...E[g],active:!1,startTime:0,endTime:0})}),n({...be,renown:t.renown.plus(M),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:E,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),q(!1),K("Abdication Successful. Long live the new King!","success")},H=()=>{localStorage.removeItem("kingdom_save"),n({...be,startTime:o(Date.now())}),U(!1),K("Game Reset","warning")},Oe=()=>{const l=ke(t);localStorage.setItem("kingdom_save",JSON.stringify(l)),K("Game Saved","info")},Te=r=>{n(l=>({...l,playerProfile:r})),localStorage.setItem(`playerProfile_${r.id}`,JSON.stringify(r)),K(`Welcome, ${r.rulerName} ${r.rulerId}!`,"success"),u(!1)},Pe=async()=>{Fe()},Ge=r=>{n(l=>({...l,interface:{...l.interface,lastBuyAmount:r}}))},Ue=r=>({flex:r==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:r==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:r==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:a&&t.idleModeEnabled?r==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:y?"column":"row"},children:[e.jsx(_t,{toasts:z}),e.jsx(Yt,{}),a&&t.idleModeEnabled&&e.jsx(wt,{gameState:t}),!y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Ue("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${j==="buildings"?"active":""}`,onClick:()=>A("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:j==="buildings"&&e.jsx(Xe,{gameState:t,onBuyBuilding:ge,onSellBuilding:de,onSetBuyAmount:Ge})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:a&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(qe,{gameState:t,gps:ie,onClick:()=>D(!1),onEventInteract:we,onOpenTavern:()=>O(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>U(!0),onOpenStatistics:()=>V(!0),onOpenLeaderboard:()=>{h(!0)},onOpenEmpire:()=>ne(!0),isIdle:a&&t.idleModeEnabled})}),e.jsxs("div",{style:Ue("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${P==="army"?"active":""}`,onClick:()=>W("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:P==="army"&&e.jsx(Ke,{gameState:t,onTrainSoldier:Ce,onTrainElite:ue})})]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[T==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Xe,{gameState:t,onBuyBuilding:ge,onSellBuilding:de,onSetBuyAmount:Ge})})]}),T==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(qe,{gameState:t,gps:ie,onClick:()=>D(!1),onEventInteract:we,onOpenTavern:()=>O(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>U(!0),onOpenStatistics:()=>V(!0),onOpenLeaderboard:()=>h(!0),onOpenEmpire:()=>ne(!0),isIdle:a&&t.idleModeEnabled})}),T==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Ke,{gameState:t,onTrainSoldier:Ce,onTrainElite:ue})})]}),T==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>ne(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${T==="buildings"?"active":""}`,onClick:()=>{R("light"),v("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:T==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${T==="throne"?"active":""}`,onClick:()=>{R("light"),v("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:T==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${T==="army"?"active":""}`,onClick:()=>{R("light"),v("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:T==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${T==="empire"?"active":""}`,onClick:()=>{R("light"),v("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:T==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),e.jsx("div",{children:"Projects"})]})]})]}),!(a&&t.idleModeEnabled)&&k&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:k.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:k.name})]})]}),C&&e.jsx(mt,{gained:C.gained,effectiveTime:C.effectiveTime,totalTime:C.totalTime,efficiency:C.efficiency,completedProjects:C.completedProjects,numberFormat:t.numberFormat,onClose:()=>L(null)}),Q&&e.jsx($t,{gameState:t,onClose:()=>ne(!1),onStartProject:r=>{var B,M,E,g;const l=((B=t.nationalProjects[r])==null?void 0:B.level)||0;if(l>=ze)return;const i=ot(r,l+1);if(t.gold.lt(i.gold)||t.soldiers.lt(i.laborers)||(M=t.eliteUnits.carpenter)!=null&&M.lt(i.carpenter||0)||(E=t.eliteUnits.mason)!=null&&E.lt(i.mason||0)||(g=t.eliteUnits.architect)!=null&&g.lt(i.architect||0))return;const b=lt(l+1);n($=>({...$,gold:$.gold.minus(i.gold),soldiers:$.soldiers.minus(i.laborers),eliteUnits:{...$.eliteUnits,carpenter:($.eliteUnits.carpenter||o(0)).minus(i.carpenter||0),mason:($.eliteUnits.mason||o(0)).minus(i.mason||0),architect:($.eliteUnits.architect||o(0)).minus(i.architect||0)},nationalProjects:{...$.nationalProjects,[r]:{level:l,active:!0,startTime:Date.now(),endTime:Date.now()+b*1e3}}})),K("Construction started!","info")},onUpgradeClickPower:Z,onUpgradeOffline:re}),J&&e.jsx(Ft,{gameState:t,onGamble:(r,l)=>{const i=o(r);n(b=>({...b,gold:l?b.gold.plus(i):b.gold.minus(i),stats:{...b.stats,tavernGamesPlayed:b.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>O(!1)}),G&&e.jsx(Ot,{gameState:t,onPrestige:Pe,onClose:()=>q(!1)}),Y&&e.jsx(Gt,{gameState:t,onClose:()=>U(!1),onHardReset:H,onSave:Oe,onOpenChangelog:()=>w(!0),onSetTheme:r=>n(l=>({...l,theme:r})),onSetNumberFormat:r=>n(l=>({...l,numberFormat:r})),onToggleIdleMode:()=>n(r=>({...r,idleModeEnabled:!r.idleModeEnabled})),onUpdateInterface:r=>n(l=>({...l,interface:{...l.interface,...r}}))}),_&&e.jsx(Ut,{gameState:t,currentGps:ie,onClose:()=>V(!1)}),N&&e.jsx(ht,{onClose:()=>w(!1)}),se&&e.jsx(eo,{isOpen:se,onClose:()=>{le(!1),u(!0)},onConfirm:Te,gameState:t}),xe&&e.jsx(oo,{isOpen:xe,onClose:()=>h(!1),playerProfile:t.playerProfile})]})};export{co as A,Ct as R,e as j,x as r};
