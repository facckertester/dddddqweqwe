import{r as jt,g as wt}from"./vendor-B--z-fyW.js";import{t as n,f as k,B as ge,P as Ee,g as we,a as Ke,b as kt,U as lt,c as Ve,S as Ie,W as at,d as Re,T as Ge,C as Xe,A as Be,N as St,e as ct,M as Oe,h as dt,i as xt,j as $e,k as ze,l as ut,m as He,n as Fe}from"./core-DMnZE3dc.js";import{a as ue,i as Ct,g as Tt,d as Je,s as Ze,b as Qe,q as pt,c as mt,o as ft,l as gt,e as ht}from"./game-DOhdzVw7.js";var De={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var et;function Nt(){if(et)return Se;et=1;var t=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function a(s,c,r){var d=null;if(r!==void 0&&(d=""+r),c.key!==void 0&&(d=""+c.key),"key"in c){r={};for(var l in c)l!=="key"&&(r[l]=c[l])}else r=c;return c=r.ref,{$$typeof:t,type:s,key:d,ref:c!==void 0?c:null,props:r}}return Se.Fragment=o,Se.jsx=a,Se.jsxs=a,Se}var tt;function Rt(){return tt||(tt=1,De.exports=Nt()),De.exports}var e=Rt(),g=jt();const Bt=wt(g),zt=({gameState:t,building:o,x:a,y:s,visible:c,onHide:r})=>{const d=g.useRef(null),[l,p]=g.useState({x:0,y:0});if(g.useEffect(()=>{if(!c||!d.current)return;const w=d.current.getBoundingClientRect();let v=a+15,N=s-w.height/2;v+w.width>window.innerWidth&&(v=a-w.width-15),N<10&&(N=10),N+w.height>window.innerHeight-10&&(N=window.innerHeight-w.height-10),p({x:v,y:N})},[c,a,s]),!c||!o)return null;const m=t.buildings[o.id]||n(0),y=yt(t,o),x=y.times(m),S=Pt(t),z=S.gt(0)?x.div(S).times(100):n(0),C=Et(o.baseCost,m),E=C.gt(0)?y.div(C):n(0),A=E.gt(0)?C.div(y):n(0);return e.jsxs("div",{ref:d,className:"advanced-tooltip",style:{position:"fixed",left:`${l.x}px`,top:`${l.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"13px",lineHeight:"1.4",width:"280px",minWidth:"280px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:r,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:o.icon}),e.jsx("span",{children:o.name})]}),e.jsxs("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(33, 150, 243, 0.1)",borderRadius:"4px",border:"1px solid rgba(33, 150, 243, 0.3)"},children:[e.jsxs("div",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:["Count: ",k(m,t.numberFormat)]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Each: ",e.jsxs("span",{style:{color:"var(--success-color)"},children:[k(y,t.numberFormat),"/s"]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Total: ",e.jsxs("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:[k(x,t.numberFormat),"/s"]})]})]}),e.jsx("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(76, 175, 80, 0.1)",borderRadius:"4px",border:"1px solid var(--success-color)"},children:e.jsxs("div",{style:{fontWeight:"bold",color:"var(--success-color)",fontSize:"12px"},children:["ðŸ“Š ",k(z,t.numberFormat),"% of total income"]})}),e.jsxs("div",{style:{marginBottom:"6px",padding:"4px",background:"rgba(141, 110, 99, 0.1)",borderRadius:"4px",border:"1px solid var(--accent-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--accent-color)",fontSize:"12px",marginBottom:"2px"},children:"ðŸ’° Economy"}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Next: ",e.jsxs("span",{style:{color:"var(--accent-color)"},children:[k(C,t.numberFormat)," gold"]})]}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Payoff: ",e.jsx("span",{style:{color:"#ff9800"},children:At(A)})]}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Efficiency: ",e.jsxs("span",{style:{color:"var(--success-color)"},children:[k(E.times(100),t.numberFormat)," gold/s per gold"]})]})]}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"8px",borderTop:"1px solid var(--border-color)",paddingTop:"6px"},children:o.description})]})};function yt(t,o){var l;let a=o.baseProduction;const s=((l=t.weather)==null?void 0:l.current)||"clear";s==="sunny"&&(o.id==="peasant"||o.id==="field")?a=a.times(n(1.2)):s==="rainy"&&(o.id==="silver_mine"||o.id==="alchemist")?a=a.times(n(1.2)):s==="stormy"?(o.id==="blacksmith"&&(a=a.times(n(1.3))),o.id==="field"&&(a=a.times(n(.8)))):s==="windy"&&o.id==="market"&&(a=a.times(n(1.15)));let c=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(p=>{c+=p.level||0});const r=1+c*Ee;a=a.times(n(r));const d=fe(t.renown);return a=a.times(d),a}function fe(t){const o=t.toNumber();if(o<=0)return n(1);let a=n(1);o<=100?a=n(1+o*.01):o<=1e3?a=n(2).plus(n(o-100).times(n(.005))):o<=1e4?a=n(2.5).plus(n(o-1e3).times(n(.001))):a=n(10).plus(n(10).times(Math.log10(o)));const s=n(1e3);return ue.min(a,s)}function Pt(t){let o=n(0);return ge.forEach(a=>{const s=t.buildings[a.id]||n(0);if(s.gt(0)){const c=yt(t,a);o=o.plus(c.times(s))}}),o}function Et(t,o){return t.times(n(1.15).pow(o)).floor()}function At(t){if(t.lte(0))return"Instant";const o=t.toNumber(),a=Math.floor(o/31536e3),s=Math.floor(o%31536e3/86400),c=Math.floor(o%86400/3600),r=Math.floor(o%3600/60),d=Math.floor(o%60),l=[];return a>0&&l.push(`${a}y`),s>0&&l.push(`${s}d`),c>0&&l.push(`${c}h`),r>0&&l.push(`${r}m`),(d>0||l.length===0)&&l.push(`${d}s`),l.length>4?l.slice(0,4).join(" "):l.join(" ")}const ot=(t,o=!1,a=!1,s=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:a?"rgba(0,0,0,0.05)":o?"rgba(46, 125, 50, 0.1)":s?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:a?"rgba(0,0,0,0.2)":s?"#7b1fa2":t?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:t&&!a?"pointer":"default",opacity:t&&!a||o?1:.7,transition:"all 0.2s",boxShadow:t&&!a?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:a?"grayscale(1)":"none"}),bt={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},nt=({gameState:t,onBuyBuilding:o,onSellBuilding:a,onSetBuyAmount:s})=>{var A;const[c,r]=g.useState({visible:!1,x:0,y:0,building:null}),d=n(1),l=((A=t.interface)==null?void 0:A.lastBuyAmount)||n(1),[p,m]=g.useState(!1),[y,x]=g.useState(1);g.useEffect(()=>{const h=N=>{N.ctrlKey?x(10):N.shiftKey?x(100):x(1)},w=N=>h(N),v=N=>h(N);return window.addEventListener("keydown",w),window.addEventListener("keyup",v),()=>{window.removeEventListener("keydown",w),window.removeEventListener("keyup",v)}},[]);const S=(h,w)=>{const v=h.currentTarget.getBoundingClientRect();r({visible:!0,x:v.right,y:v.top+v.height/2,building:w})},z=()=>{r({visible:!1,x:0,y:0,building:null})},C=(h,w)=>{var H;let v=w;const N=((H=t.weather)==null?void 0:H.current)||"clear";N==="sunny"&&(h==="peasant"||h==="field")?v=v.times(n(1.2)):N==="rainy"&&(h==="silver_mine"||h==="alchemist")?v=v.times(n(1.2)):N==="stormy"?(h==="blacksmith"&&(v=v.times(n(1.3))),h==="field"&&(v=v.times(n(.8)))):N==="windy"&&h==="market"&&(v=v.times(n(1.15)));let b=n(1),$=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(O=>$+=O.level||0);const _=1+$*.05;b=b.times(n(_));const D=fe(t.renown);return b=b.times(D),v.times(b)};let E=0;return e.jsxs("div",{style:bt,children:[e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[n(1),n(10),n(100),n(500),n(1e3),n(-1)].map(h=>e.jsx("button",{onClick:()=>s(h),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:l.equals(h)?"var(--accent-color)":"var(--panel-bg)",color:l.equals(h)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:h.equals(n(-1))?"Max":`${h.toString()}`},`amount-${h.toString()}`))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[e.jsx("button",{className:"btn",style:{background:p?"var(--panel-bg)":"var(--accent-color)",color:p?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>m(!1),children:"ðŸ›’ Buy Mode"}),e.jsx("button",{className:"btn",style:{background:p?"#e65100":"var(--panel-bg)",color:p?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>m(!0),children:"ðŸ’° Sell Mode (25%)"})]}),e.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),ge.map((h,w)=>{const v=t.buildings[h.id]||n(0),N=t.totalGold.gte(h.baseCost)||v.gt(n(0));if(N||E++,!N&&E>2)return null;if(p){if(v.eq(n(0)))return null;let T;l.equals(n(-1))?T=v:(T=l.times(y),T.gt(v)&&(T=v));const P=we(h.baseCost,v.minus(T),T).times(n(.25)).floor();return C(h.id,h.baseProduction),e.jsxs("div",{style:ot(!0,!1,!1,!1),onClick:()=>a(h.id,T.toNumber()),onMouseEnter:q=>S(q,h),onMouseLeave:z,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:h.icon}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:h.name}),e.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"var(--accent-color)"},children:k(v,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",k(P,t.numberFormat)]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",k(T,t.numberFormat)]})]})]},h.id)}let b=n(0),$=n(0);l.equals(n(-1))?(b=Ke(h.baseCost,v,t.gold.div(d)),b.eq(n(0))?(b=n(1),$=kt(h.baseCost,v).times(d).floor()):$=we(h.baseCost,v,b).times(d).floor()):(b=l,$=we(h.baseCost,v,b).times(d).floor());const _=t.gold.gte($),D=l.equals(n(-1))&&Ke(h.baseCost,v,t.gold.div(d)).eq(n(0));let H=b,O=$,U=_;return l.equals(n(-1))||(H=b.times(y),O=we(h.baseCost,v,H).times(d).floor(),U=t.gold.gte(O)),e.jsxs("div",{style:ot(U&&!D,!1,!N),onClick:()=>{if(!(U&&!D))return;const T=l.equals(n(-1))?b:H;o(h.id,T.toNumber())},onMouseEnter:T=>S(T,h),onMouseLeave:z,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:N?h.icon:"â“"}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:N?h.name:"???"}),e.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"var(--accent-color)"},children:k(v,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsx("div",{style:{color:U&&!D?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:k(l.equals(n(-1))?$:O,t.numberFormat)}),!l.equals(n(-1))&&e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",k(H,t.numberFormat)]})]})]},h.id)}),e.jsx(zt,{gameState:t,building:c.building,x:c.x,y:c.y,visible:c.visible,onHide:z})]})},rt=({gameState:t,onTrainSoldier:o,onTrainElite:a})=>{const[s,c]=g.useState(1);g.useEffect(()=>{const d=p=>{p.ctrlKey&&!p.shiftKey?c(10):p.shiftKey&&!p.ctrlKey?c(100):p.ctrlKey&&p.shiftKey&&c(1e3)},l=()=>c(1);return window.addEventListener("keydown",d),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",l)}},[]);const r=d=>Ve(Ie.times(n(d)),t.renown);return e.jsxs("div",{style:bt,children:[e.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",borderRadius:"4px",marginBottom:"10px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"5px",color:"var(--text-color)"},children:"Construction Workforce"}),e.jsx("div",{style:{fontSize:"2rem",color:"var(--text-color)"},children:k(t.soldiers,t.numberFormat)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"General Laborers Available"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1*s)),onClick:()=>{o(1*s)},"data-tooltip":`Hire 1 laborer - Cost: ${k(r(1*s),t.numberFormat)} Gold`,children:["Hire ",s>1?`${1*s}`:"1"," (",k(r(1*s),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(10*s)),onClick:()=>{o(10*s)},"data-tooltip":`Hire 10 laborers - Cost: ${k(r(10*s),t.numberFormat)} Gold`,children:["Hire ",s>1?`${10*s}`:"10"," (",k(r(10*s),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(100*s)),onClick:()=>{o(100*s)},"data-tooltip":`Hire 100 laborers - Cost: ${k(r(100*s),t.numberFormat)} Gold`,children:["Hire ",s>1?`${100*s}`:"100"," (",k(r(100*s),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e3*s)),onClick:()=>{o(1e3*s)},"data-tooltip":`Hire 1K laborers - Cost: ${k(r(1e3*s),t.numberFormat)} Gold`,children:["Hire ",s>1?`${1e3*s/1e3}K`:"1K"," (",k(r(1e3*s),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e6*s)),onClick:()=>{o(1e6*s)},"data-tooltip":`Hire 1M laborers - Cost: ${k(r(1e6*s),t.numberFormat)} Gold`,children:["Hire ",s>1?`${1e6*s/1e6}M`:"1M"," (",k(r(1e6*s),t.numberFormat)," G)"]})]}),e.jsxs("div",{style:{borderTop:"2px solid var(--border-color)",paddingTop:"15px"},children:[e.jsxs("h3",{style:{fontSize:"1rem",color:"var(--accent-color)",fontWeight:"bold",marginBottom:"10px"},children:["Specialist Guild ",e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",color:"var(--text-secondary)"},children:"(Train from Laborers)"})]}),lt.map(d=>{const l=t.eliteUnits[d.id]||n(0),p=t.buildings[d.id]||n(0),m=Ve(d.goldCost,t.renown),y=t.soldiers.gte(d.soldierCost),x=t.gold.gte(m)&&y;return p.lt(n(1))?null:e.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},"data-tooltip":"",children:[e.jsx("div",{style:{fontSize:"2rem"},children:d.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:"bold",color:"var(--text-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:[d.name," ",e.jsxs("span",{style:{color:"var(--text-secondary)"},children:["x",k(l,t.numberFormat)]})]}),e.jsxs("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},disabled:!x,onClick:()=>a(d.id,s),onMouseEnter:S=>{x||(S.currentTarget.style.cursor="not-allowed")},onMouseLeave:S=>{S.currentTarget.style.cursor="pointer"},"data-tooltip":"",children:["Train ",s>1?`x${s}`:""]})]}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:d.description}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"2px"},children:["Requires ",k(m,t.numberFormat)," Gold and ",k(d.soldierCost,t.numberFormat)," Laborers"]})]})]},d.id)})]})]})},st=({gameState:t,gps:o,onClick:a,onEventInteract:s,onOpenTavern:c,onOpenPrestige:r,onOpenSettings:d,onOpenStatistics:l,onOpenLeaderboard:p,onOpenEmpire:m,isIdle:y})=>{var $,_,D;const[x,S]=g.useState([]),z=g.useRef(null),C=t.interface||{showFloatingText:!0,showWeatherWidget:!0,crownAnimations:!0},E=()=>{let H=0;return t.nationalProjects&&Object.values(t.nationalProjects).forEach(O=>{H+=O.level*Ee}),n(H)},A=H=>{var O;if(C.showFloatingText){const U=(O=z.current)==null?void 0:O.getBoundingClientRect();if(U){const T=H.clientX-U.left+(Math.random()*40-20),P=H.clientY-U.top+(Math.random()*40-20),q=fe(t.renown),X=n(1),J=t.clickUpgradeLevel||0,ae=Math.min(J,15),ne=n(2).pow(ae),ie=X.times(ne),de=Re(J),R=o.times(de);let re=ie.plus(R);if(re=re.times(q),t.godMode){const se=o.times(n(99999));re=re.plus(se)}const Q="+"+k(re,t.numberFormat),ce={id:Date.now(),x:T,y:P,val:Q};S(se=>[...se,ce]),setTimeout(()=>{S(se=>se.filter(W=>W.id!==ce.id))},1e3)}}a(H)},h=at[(($=t.weather)==null?void 0:$.current)||"clear"],w={transition:"all 0.8s ease-in-out"},v=y?{position:"fixed",bottom:"120px",right:"30px",transform:"scale(0.8)",transformOrigin:"bottom right",textAlign:"right",zIndex:100,...w}:{transform:"scale(1)",marginBottom:"3rem",zIndex:10,textAlign:"center",...w},N=y?{width:"80px",height:"80px",fontSize:"2rem",position:"fixed",bottom:"30px",right:"30px",borderRadius:"50%",zIndex:100,...w}:{width:"260px",height:"260px",fontSize:"6rem",borderRadius:"50%",position:"relative",zIndex:5,margin:"0 auto",...w},b={opacity:y?0:1,transition:"opacity 0.5s ease-in-out",pointerEvents:y?"none":"auto"};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"var(--panel-padding)",height:"100%",overflow:"hidden"},children:[C.showWeatherWidget&&e.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:20,background:h.color,padding:"8px 12px",borderRadius:"20px",border:"2px solid rgba(0,0,0,0.1)",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"8px",cursor:"help",...b},"data-tooltip":`${h.name}: ${h.description}`,children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:h.icon}),e.jsxs("div",{style:{textAlign:"left",lineHeight:"1.1"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#222"},children:h.name}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#444"},children:[n(Number(((_=t.weather)==null?void 0:_.timeLeft)||0)).ceil().toString(),"s remaining"]})]})]}),e.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:20,display:"flex",gap:"5px",...b},children:[e.jsx("button",{onClick:p,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.8,color:"var(--text-color)",transition:"all 0.2s ease"},title:"Leaderboard (Available for all players)",children:"ðŸ†"}),e.jsx("button",{onClick:l,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Statistics",children:"ðŸ“Š"}),e.jsx("button",{onClick:d,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Kingdom Settings",children:"âš™ï¸"})]}),e.jsxs("div",{style:v,children:[e.jsx("div",{style:{fontSize:"1rem",color:y?"var(--text-color)":"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",letterSpacing:"2px",textShadow:y?"1px 1px 2px #000":"none"},children:"Royal Treasury"}),e.jsx("div",{style:{fontSize:"3rem",fontFamily:"var(--font-main)",color:"var(--text-color)",textShadow:y?"2px 2px 4px #000":"2px 2px 0px rgba(255, 215, 0, 0.4)"},children:k(t.gold,t.numberFormat)}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"1.1rem",color:y?"#90ee90":"var(--success-color)",fontStyle:"italic",textShadow:y?"1px 1px 2px #000":"none"},children:["+",k(o,t.numberFormat)," gold / sec"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",marginTop:"15px"},children:[e.jsxs("div",{style:{padding:"5px 15px",background:y?"rgba(0,0,0,0.5)":"rgba(103, 58, 183, 0.1)",border:"1px solid rgba(103, 58, 183, 0.3)",borderRadius:"20px",display:"inline-block"},children:[e.jsxs("span",{style:{color:y?"#b39ddb":"#673ab7",fontWeight:"bold"},children:["ðŸ‘‘ Renown: ",k(t.renown,t.numberFormat)]}),!y&&e.jsxs("span",{style:{fontSize:"0.8rem",color:"#673ab7",marginLeft:"5px"},children:["(+",fe(t.renown).minus(n(1)).times(n(100)).floor().toString(),"% Bonus)"]})]}),e.jsx("div",{style:{padding:"5px 15px",background:y?"rgba(0,0,0,0.5)":"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"20px",display:"inline-block"},children:e.jsxs("span",{style:{color:y?"#81c784":"#4caf50",fontWeight:"bold"},children:["ðŸ—ï¸ Projects: +",E().times(n(100)).floor().toString(),"%"]})})]})]}),e.jsxs("div",{style:{position:"relative",marginBottom:y?0:"3rem",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{className:"magnetic-container",children:e.jsx("button",{ref:z,className:`main-button ${y?"idle":""} ${C.crownAnimations?"":"no-animations"}`,style:{...N,display:"flex",alignItems:"center",justifyContent:"center",outline:"none",color:"#5d4037",cursor:"pointer",overflow:"hidden"},onClick:A,children:e.jsx("span",{className:C.crownAnimations?"crown-icon":"",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",lineHeight:1,marginTop:"-10px"},children:"ðŸ‘‘"})})}),!y&&x.map(H=>e.jsx("div",{className:"floating-text",style:{left:H.x,top:H.y},children:H.val},H.id))]}),e.jsxs("div",{style:{display:"flex",gap:"10px",zIndex:10,flexWrap:"wrap",justifyContent:"center",...b},children:[t.buildings.field&&t.buildings.field.gt(n(0))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)",borderColor:"var(--gold-color)"},onClick:m,children:"ðŸ—ï¸ Projects"}),((D=t.buildings.tavern)==null?void 0:D.gt(n(0)))&&e.jsx("button",{className:"btn",onClick:c,children:"ðŸº Tavern"}),(t.totalGold.gt(n(5e5))||t.renown.gt(n(0)))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)"},onClick:r,children:"ðŸ‘‘ Legacy"})]}),!y&&t.event&&t.event.type==="dragon"&&e.jsx("div",{className:"dragon-event",onMouseDown:()=>s(t.event),children:"ðŸ‰"}),!y&&t.event&&t.event.type==="merchant"&&e.jsxs("div",{style:{position:"absolute",right:"20px",top:"100px",background:"#fff3e0",padding:"10px",border:"2px solid orange",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>s(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ‘³"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Merchant"}),e.jsx("small",{style:{color:"#444"},children:"Click for gift"})]}),!y&&t.event&&t.event.type==="jester"&&e.jsxs("div",{style:{position:"absolute",left:"20px",top:"100px",background:"#fce4ec",padding:"10px",border:"2px solid pink",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>s(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ¤¡"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Jester"}),e.jsx("small",{style:{color:"#444"},children:"Risk it all?"})]})]})},Ae=({currentBet:t,maxGold:o,onBetChange:a,numberFormat:s})=>{const[c,r]=g.useState(t===0?"":t.toString());g.useEffect(()=>{var y,x;t===0&&((y=document.activeElement)==null?void 0:y.tagName)!=="INPUT"?r(""):Math.abs(parseFloat(c)-t)>1e-4&&((x=document.activeElement)==null?void 0:x.tagName)!=="INPUT"&&r(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const d=y=>{try{if(y.trim()===""){a(0),r("");return}let x=parseFloat(y);const S=y.toLowerCase().trim(),z={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const E of Object.keys(z))if(S.endsWith(E)){const A=parseFloat(S.slice(0,-E.length));isNaN(A)||(x=A*z[E]);break}(isNaN(x)||x<0)&&(x=0);const C=o.toNumber();isFinite(C)&&x>C?x=C:!isFinite(C)&&n(x).gt(o)&&(x=Number.MAX_VALUE),a(x),x===0?r(""):x>=1e6?r(x.toExponential(2).replace("+","")):r(Math.floor(x).toString())}catch{r(t===0?"":t.toString())}},l=()=>{d(c)},p=y=>{y.key==="Enter"&&(d(c),y.target.blur())},m=y=>{let S=o.times(y).floor().toNumber();isFinite(S)||(S=Number.MAX_VALUE),S<1&&o.gt(0)&&(S=1),a(S),S>=1e6?r(S.toExponential(2).replace("+","")):r(S.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"ðŸ’°"}),e.jsx("input",{type:"text",value:c,onChange:y=>r(y.target.value),onBlur:l,onKeyDown:p,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager..."}),t>0&&e.jsx("button",{onClick:()=>{a(0),r("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>m(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>m(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>m(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d(Math.floor(t/2).toString()),children:"Â½"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d((t*2).toString()),children:"x2"})]})]})},he=1500,Mt=({value:t,size:o=50,color:a="#000"})=>{const s=o*.18,c=o*.25,r=o*.5,d=o*.75,l=[];return(t===1||t===3||t===5)&&l.push({cx:r,cy:r}),t>1&&(l.push({cx:c,cy:c}),l.push({cx:d,cy:d})),t>3&&(l.push({cx:d,cy:c}),l.push({cx:c,cy:d})),t===6&&(l.push({cx:c,cy:r}),l.push({cx:d,cy:r})),e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:l.map((p,m)=>e.jsx("circle",{cx:p.cx,cy:p.cy,r:s/2,fill:a},m))})},Wt=({onClose:t})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:20,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #666",paddingBottom:"10px",width:"100%"},children:"ðŸ“œ Rules of the Game"}),e.jsxs("div",{style:{textAlign:"left",fontSize:"0.9rem",lineHeight:"1.6",maxWidth:"400px",overflowY:"auto"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Goal:"})," Reach ",he," points first."]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:"âš€ = 100 | âš„ = 50"}),e.jsx("li",{children:"Triple âš€ = 1000 | Triples = 100 Ã— Value"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Farkle:"})," Roll no points = lose turn score."]})]}),e.jsx("button",{className:"btn",onClick:t,style:{marginTop:"20px",width:"100%"},children:"I Understand"})]}),Lt=({won:t,amount:o,onPlayAgain:a,onLeave:s,numberFormat:c})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸ†":"ðŸ’€"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336"},children:t?"Victory!":"Defeat"}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:k(n(o),c)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:k(n(o),c)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:a,style:{fontSize:"1.2rem",padding:"15px 40px",background:"var(--accent-color)"},children:"Play Again"}),e.jsx("button",{className:"btn",onClick:s,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px"},children:"Leave"})]})]}),Ft=({gameState:t,onGamble:o,onLeave:a})=>{const[s,c]=g.useState(0),[r,d]=g.useState("betting"),[l,p]=g.useState("player"),[m,y]=g.useState(!1),[x,S]=g.useState(null),[z,C]=g.useState({player:0,opponent:0}),[E,A]=g.useState(0),[h,w]=g.useState([]),[v,N]=g.useState(""),[b,$]=g.useState(!1),[_,D]=g.useState(""),H=(W=6)=>Array.from({length:W},(I,M)=>({id:Math.random()+M,value:Math.floor(Math.random()*6)+1,status:"active",animating:!0}));g.useEffect(()=>{if(h.filter(I=>I.animating).length>0){const I=setTimeout(()=>{w(M=>M.map(Z=>Z.animating?{...Z,animating:!1}:Z))},600);return()=>clearTimeout(I)}},[h]);const O=W=>{let I=0;const M=[0,0,0,0,0,0,0];return W.forEach(Z=>M[Z]++),M[1]>=3?(I+=1e3*Math.pow(2,M[1]-3),M[1]=0):(I+=M[1]*100,M[1]=0),M[5]>=3?(I+=500*Math.pow(2,M[5]-3),M[5]=0):(I+=M[5]*50,M[5]=0),[2,3,4,6].forEach(Z=>{M[Z]>=3&&(I+=Z*100*Math.pow(2,M[Z]-3))}),I},U=W=>{const I=[0,0,0,0,0,0,0];return W.forEach(M=>I[M.value]++),W.map((M,Z)=>M.value===1||M.value===5||I[M.value]>=3?Z:-1).filter(M=>M!==-1)},T=()=>{if(s<=0){N("Please bet something!");return}if(t.gold.lt(n(s))){N("Not enough gold!");return}d("playing"),C({player:0,opponent:0}),S(null),p("player"),P("player")},P=W=>{p(W),A(0),$(!1),w(H(6)),W==="player"?(N(`Your Turn! Target: ${he}`),ie(H(6))):N("Opponent's Turn...")};g.useEffect(()=>{let W;return l==="opponent"&&!b&&(W=setTimeout(async()=>{if(r!=="playing"||l!=="opponent"||h.length===0)return;D("Thinking..."),await new Promise(K=>setTimeout(K,1e3));const M=h.filter(K=>K.status==="active").map(K=>K.value);if(O(M)===0){D("Farkle!"),N("Opponent rolled no points!"),$(!0),await new Promise(K=>setTimeout(K,1500)),J();return}D("Selecting dice...");const Z=U(h.filter(K=>K.status==="active")),le=[...h];if(Z.length===0){J();return}const be=le.filter(K=>K.status==="active");be.forEach((K,_e)=>{const Ne=[0,0,0,0,0,0,0];be.forEach(We=>Ne[We.value]++),(K.value===1||K.value===5||Ne[K.value]>=3)&&(K.status="selected")}),w(le);const pe=le.filter(K=>K.status==="selected").map(K=>K.value),Te=O(pe);await new Promise(K=>setTimeout(K,1e3));const me=E+Te,ke=le.filter(K=>K.status==="active").length;z.opponent+me>=he?(D("Banking for victory!"),await new Promise(K=>setTimeout(K,1e3)),q(me)):ke===0?(D("Hot Dice! Rolling again!"),await new Promise(K=>setTimeout(K,1e3)),X(me)):me>=400||ke<=2?(D(`Banking ${me}...`),await new Promise(K=>setTimeout(K,1e3)),q(me)):(D("Rolling again..."),await new Promise(K=>setTimeout(K,1e3)),X(me))},500)),()=>clearTimeout(W)},[l,h,E,r,b]);const q=W=>{const I=z.opponent+W;C(M=>({...M,opponent:I})),I>=he?re("opponent"):J()},X=W=>{A(W),w(I=>I.map(M=>M.status==="selected"?{...M,status:"banked"}:M)),setTimeout(()=>{ae()},500)},J=()=>{p(W=>W==="player"?"opponent":"player"),P(l==="player"?"opponent":"player")},ae=W=>{w(I=>{let M=I.filter(Z=>Z.status==="active").length;return M===0&&(M=6),H(M)})},ne=()=>{const I=h.filter(pe=>pe.status==="selected").map(pe=>pe.value),M=O(I);A(E+M);const Z=h.filter(pe=>pe.status==="active").length,be=H(Z===0?6:Z);w(be),ie(be)},ie=(W,I)=>{const M=W.map(le=>le.value);O(M)===0?($(!0),N("FARKLE! No points. Turn lost."),setTimeout(J,2e3)):N("Select dice to keep.")},de=W=>{l!=="player"||b||w(I=>I.map(M=>M.id===W?{...M,status:M.status==="active"?"selected":"active"}:M))},R=()=>{const W=h.filter(le=>le.status==="selected"),I=O(W.map(le=>le.value)),M=E+I;if(M<300&&z.player+M<he){N("Must score at least 300 to bank!");return}const Z=z.player+M;C(le=>({...le,player:Z})),Z>=he?re("player"):J()},re=W=>{d("gameOver");const I=W==="player";o(s,I),N(I?"Victory!":"Defeat!"),S({won:I,amount:s})},Q=()=>{S(null),d("betting"),C({player:0,opponent:0}),w([]),N("")},ce=O(h.filter(W=>W.status==="selected").map(W=>W.value)),se=ce>0&&(function(){const W=h.filter(I=>I.status==="selected").map(I=>I.value);for(let I=0;I<W.length;I++){const M=[...W];if(M.splice(I,1),O(M)===ce)return!1}return!0})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
        @keyframes rollIn { 0% { transform: rotate(-360deg) scale(0.2); opacity: 0; } 70% { transform: rotate(10deg) scale(1.1); opacity: 1; } 100% { transform: rotate(0) scale(1); opacity: 1; } }
        .die-roll { animation: rollIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
      `}),m&&e.jsx(Wt,{onClose:()=>y(!1)}),x&&e.jsx(Lt,{won:x.won,amount:x.amount,onPlayAgain:Q,onLeave:a,numberFormat:t.numberFormat}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",background:"var(--panel-bg)",padding:"15px 20px",borderBottom:"2px solid var(--border-color)",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"YOU"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:z.player})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-color)"},children:"TARGET"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"1.2rem"},children:he})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"OPPONENT"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:z.opponent})]})]}),e.jsxs("div",{style:{flex:1,overflow:"hidden",background:"var(--bg-color)",display:"flex",flexDirection:"column",justifyContent:"center"},children:[r==="betting"&&e.jsxs("div",{style:{padding:"20px",textAlign:"center",maxWidth:"600px",margin:"0 auto",width:"100%",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:"3rem"},children:"ðŸŽ²"}),e.jsx("h3",{children:"High Stakes Farkle"}),e.jsxs("p",{style:{marginBottom:"auto",color:"var(--text-secondary)"},children:["Winner takes the pot. Race to ",he,"."]})]}),(r==="playing"||r==="gameOver")&&e.jsxs("div",{style:{padding:"10px",textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{marginBottom:"20px",minHeight:"30px",flexShrink:0},children:l==="player"?e.jsxs("div",{style:{padding:"10px",background:"rgba(76, 175, 80, 0.1)",border:"1px solid #4caf50",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#2e7d32",fontWeight:"bold"},children:"YOUR TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:E+ce})]})]}):e.jsxs("div",{style:{padding:"10px",background:"rgba(244, 67, 54, 0.1)",border:"1px solid #ef5350",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#c62828",fontWeight:"bold"},children:"OPPONENT'S TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:E})]}),e.jsx("div",{style:{fontSize:"0.8rem",fontStyle:"italic"},children:_})]})}),e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap",marginBottom:"20px",flex:1,alignContent:"center"},children:h.map(W=>e.jsx("div",{className:W.animating?"die-roll":"",style:{width:"64px",height:"64px",background:W.status==="selected"?"var(--accent-color)":"#fdfdfd",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",cursor:l==="player"?"pointer":"default",border:W.status==="selected"?"2px solid var(--gold-color)":"1px solid #ccc"},onClick:()=>de(W.id),children:e.jsx(Mt,{value:W.value,size:50,color:W.status==="selected"?"#fff":"#333"})},W.id))}),e.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"10px",fontWeight:"bold",minHeight:"2rem",flexShrink:0},children:v})]})]}),e.jsxs("div",{style:{padding:"15px 20px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",flexShrink:0},children:[r==="betting"&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:s,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:T,disabled:s<=0,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:s<=0?.5:1,flexShrink:0,fontWeight:"bold"},children:"START"})]}),(r==="playing"||r==="gameOver")&&e.jsxs("div",{children:[r==="playing"&&l==="player"?e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center"},children:[e.jsxs("button",{className:"btn",onClick:ne,disabled:!se,style:{opacity:se?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Roll (+",ce,")"]}),e.jsxs("button",{className:"btn",onClick:R,disabled:!se&&E===0,style:{background:"var(--success-color)",opacity:se||E>0?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Bank ",E+ce]})]}):e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"15px"},children:"Wait for opponent..."}),e.jsx("div",{style:{position:"absolute",top:"15px",right:"20px"},children:e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.5rem",opacity:.5},onClick:()=>y(!0),children:"â“"})})]})]})]})},Dt=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],It=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],Gt=50,Ot=({won:t,amount:o,winnerName:a,onPlayAgain:s,onLeave:c,numberFormat:r})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸ‡":"ðŸ¢"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#fff",textTransform:"uppercase"},children:t?"Winner!":"Better luck next time"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["Winner: ",e.jsx("strong",{style:{color:"var(--accent-color)"},children:a})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:k(n(o),r)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:k(n(o),r)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:s,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Race Again"}),e.jsx("button",{className:"btn",onClick:c,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),$t=({gameState:t,onGamble:o,onLeave:a})=>{const[s,c]=g.useState([]),[r,d]=g.useState(null),[l,p]=g.useState(0),[m,y]=g.useState("betting"),[x,S]=g.useState(""),[z,C]=g.useState(null),E=g.useRef(null),A=g.useRef([]);g.useEffect(()=>{h()},[]);const h=()=>{const b=[],$=[...Dt].sort(()=>.5-Math.random());for(let _=0;_<6;_++){const D=Math.random()*5+5,H=Math.random()*5+5;let U=25-(D+H);U=U+(Math.random()*4-2),U<1.5&&(U=1.5),U>20&&(U=20),b.push({id:_,name:$[_],color:It[_],icon:"ðŸŽ",odds:parseFloat(U.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:D,staminaRating:H})}c(b),d(null),C(null),A.current=[],S("Select a horse and place your bet!")},w=()=>{if(r===null){S("Select a horse first!");return}if(l<=0){S("Place a valid bet!");return}if(t.gold.lt(n(l))){S("Not enough gold!");return}y("racing"),S("And they're off!"),E.current=setInterval(()=>{c(b=>b.map(_=>{if(_.finished)return _;const D=Math.random()<.05?1:0,H=Math.random()<.05?-.5:0,O=.25,U=_.speedRating/10*.15,T=Math.random()*.2;let P=O+U+T+D+H,q=_.progress+P;return q>=100&&(q=100,!A.current.includes(_.id))?(A.current.push(_.id),{..._,progress:100,finished:!0,rank:A.current.length}):{..._,progress:q}})),A.current.length===6&&v()},Gt)},v=()=>{E.current&&clearInterval(E.current);const b=A.current[0],$=s.find(D=>D.id===b);if(!$)return;if(y("finished"),b===r){const D=s.find(U=>U.id===r),H=(D==null?void 0:D.odds)||1,O=Math.floor(l*(H-1));o(O,!0),C({won:!0,amount:O,winnerName:$.name})}else o(l,!1),C({won:!1,amount:l,winnerName:$.name})};g.useEffect(()=>()=>{E.current&&clearInterval(E.current)},[]);const N=()=>{y("betting"),p(0),h()};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[z&&e.jsx(Ot,{won:z.won,amount:z.amount,winnerName:z.winnerName,onPlayAgain:N,onLeave:a,numberFormat:t.numberFormat}),e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:x}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),s.map(b=>e.jsxs("div",{onClick:()=>m==="betting"&&d(b.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:m==="betting"?"pointer":"default",background:r===b.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"rgba(255,255,255,0.4)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:b.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:r===b.id?"#d84315":"var(--text-secondary)",fontWeight:"bold"},children:[b.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${b.progress}% - ${b.progress*.8}px)`,transition:m==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.3))"},children:e.jsx("div",{style:{color:b.color,filter:r===b.id?"drop-shadow(0 0 5px gold)":"none"},children:b.icon})}),b.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5},children:b.rank===1?"ðŸ¥‡":b.rank===2?"ðŸ¥ˆ":b.rank===3?"ðŸ¥‰":`#${b.rank}`})]},b.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[m==="betting"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:l,maxGold:t.gold,onBetChange:p,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:w,disabled:r===null||l<=0,style:{opacity:r===null||l<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold",flexShrink:0},children:"START"})]}),m==="racing"&&e.jsx("div",{style:{padding:"20px",width:"100%",textAlign:"center",fontStyle:"italic",color:"var(--text-secondary)"},children:"Race in progress..."})]})]})},Ht=({won:t,amount:o,side:a,onPlayAgain:s,onLeave:c,numberFormat:r})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px",animation:"pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:t?"âœ¨":"ðŸ’¸"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336",textTransform:"uppercase",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:t?"Victory!":"Defeat"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["Result: ",e.jsx("strong",{style:{color:"gold",textTransform:"uppercase"},children:a})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:k(n(o),r)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:k(n(o),r)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:s,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Flip Again"}),e.jsx("button",{className:"btn",onClick:c,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),_t=({gameState:t,onGamble:o,onLeave:a})=>{const[s,c]=g.useState(0),[r,d]=g.useState(null),[l,p]=g.useState(!1),[m,y]=g.useState(0),[x,S]=g.useState(null),[z,C]=g.useState("Select a side and place your wager."),E=()=>{S(null),d(null),C("Select a side and place your wager.")},A=()=>{if(!r){C("Please select Heads or Tails!");return}if(s<=0){C("Please enter a valid bet amount.");return}if(t.gold.lt(n(s))){C("Not enough gold!");return}p(!0),C("Flipping...");const w=Math.random()>.5?"heads":"tails",v=r===w,N=m,$=360*5;let _=N+$;const D=_%360;w==="heads"?_+=360-D:_+=180-D+360,y(_),setTimeout(()=>{p(!1),v?(o(s,!0),C("Victory!")):(o(s,!1),C("Defeat!")),setTimeout(()=>{S({won:v,amount:v?s*2:s,side:w})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),x&&e.jsx(Ht,{won:x.won,amount:x.amount,side:x.side,onPlayAgain:E,onLeave:a,numberFormat:t.numberFormat}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${m}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"ðŸ‘‘"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"40px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:z}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>d("heads"),disabled:l,style:{padding:"10px 20px",border:`3px solid ${r==="heads"?"var(--gold-color)":"transparent"}`,background:r==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px"},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"ðŸ‘‘"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>d("tails"),disabled:l,style:{padding:"10px 20px",border:`3px solid ${r==="tails"?"var(--gold-color)":"transparent"}`,background:r==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px"},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[!l&&e.jsx(Ae,{currentBet:s,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat}),l&&e.jsx("div",{style:{padding:"10px",fontStyle:"italic"},children:"Flipping..."})]}),e.jsx("button",{className:"btn",onClick:A,disabled:!r||s<=0||l,style:{opacity:!r||s<=0||l?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]})]})},it=({value:t,size:o=80,color:a="#3e2723"})=>{const s=o*.18,c=o*.25,r=o*.5,d=o*.75,l=[];return(t===1||t===3||t===5)&&l.push({cx:r,cy:r}),t>1&&(l.push({cx:c,cy:c}),l.push({cx:d,cy:d})),t>3&&(l.push({cx:d,cy:c}),l.push({cx:c,cy:d})),t===6&&(l.push({cx:c,cy:r}),l.push({cx:d,cy:r})),e.jsx("div",{style:{width:o,height:o,backgroundColor:"#fff",borderRadius:o*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:l.map((p,m)=>e.jsx("circle",{cx:p.cx,cy:p.cy,r:s/2,fill:a},m))})})},Ut=({won:t,amount:o,sum:a,onPlayAgain:s,onLeave:c,numberFormat:r})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff",backdropFilter:"blur(5px)"},children:[e.jsx("div",{style:{fontSize:"5rem",marginBottom:"10px"},children:t?"ðŸŽ²":"ðŸ“‰"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:"0 0 10px 0",color:t?"#4caf50":"#f44336",textTransform:"uppercase"},children:t?"You Won!":"You Lost"}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px",textAlign:"center",opacity:.9},children:["You rolled a ",e.jsx("strong",{style:{color:"var(--accent-color)"},children:a})]}),e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"40px",textAlign:"center"},children:t?e.jsxs(e.Fragment,{children:["You won ",e.jsx("strong",{style:{color:"gold"},children:k(n(o),r)})," Gold!"]}):e.jsxs(e.Fragment,{children:["You lost ",e.jsx("strong",{style:{color:"#ef5350"},children:k(n(o),r)})," Gold."]})}),e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("button",{className:"btn",onClick:s,style:{fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px",background:"var(--accent-color)"},children:"Roll Again"}),e.jsx("button",{className:"btn",onClick:c,style:{background:"#5d4037",fontSize:"1.2rem",padding:"15px 40px",minWidth:"160px"},children:"Leave"})]})]}),Yt=({gameState:t,onGamble:o,onLeave:a})=>{const[s,c]=g.useState(0),[r,d]=g.useState(!1),[l,p]=g.useState([1,1]),[m,y]=g.useState(null),[x,S]=g.useState("Place your wager and roll!"),z=()=>{if(s<=0){S("Please enter a valid bet amount.");return}if(t.gold.lt(n(s))){S("Not enough gold!");return}d(!0),S("Rolling..."),y(null);let A=0;const h=10,w=setInterval(()=>{p([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),A++,A>=h&&(clearInterval(w),C())},100)},C=()=>{const A=Math.floor(Math.random()*6)+1,h=Math.floor(Math.random()*6)+1,w=A+h;p([A,h]),d(!1);let v=0,N=!1,b="";w===2?(v=10,N=!0,b="Snake Eyes! JACKPOT (x10)!"):w>=3&&w<=6?(v=0,N=!1,b="Low roll... House wins."):w===7?(v=2,N=!0,b="Lucky Seven! (x2)"):w>=8&&w<=11?(v=1.5,N=!0,b="Good roll! (x1.5)"):w===12&&(v=5,N=!0,b="Boxcars! Huge Win (x5)!"),N?(o(Math.floor(s*(v-1)),!0),S(b),y({won:!0,amount:Math.floor(s*(v-1)),sum:w})):(o(s,!1),S(b),y({won:!1,amount:s,sum:w}))},E=()=>{y(null),S("Place your wager and roll!")};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[m&&e.jsx(Ut,{won:m.won,amount:m.amount,sum:m.sum,onPlayAgain:E,onLeave:a,numberFormat:t.numberFormat}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.7)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{children:"Sum 7"}),e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Sum 8-11"}),e.jsx("span",{style:{color:"#4caf50",fontWeight:"bold"},children:"x1.5"})]}),e.jsx("div",{style:{textAlign:"center",color:"#ef5350",borderTop:"1px solid #ccc",marginTop:"5px"},children:"Sum 3-6: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(it,{value:l[0],size:100}),e.jsx(it,{value:l[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:r?"Rolling...":`Sum: ${l[0]+l[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:x})]}),!r&&e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:s,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:z,disabled:s<=0,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:s<=0?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]})]})},qt=({gameState:t,onGamble:o,onClose:a})=>{const[s,c]=g.useState("farkle");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"85vh",maxWidth:"900px",width:"95%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"ðŸº The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:k(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>c("farkle"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:s==="farkle"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:s==="farkle"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:s==="farkle"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Farkle"}),e.jsx("button",{onClick:()=>c("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:s==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:s==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:s==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸ‡ Racing"}),e.jsx("button",{onClick:()=>c("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:s==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:s==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:s==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŸ¡ Coin"}),e.jsx("button",{onClick:()=>c("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:s==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:s==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:s==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[s==="farkle"&&e.jsx(Ft,{gameState:t,onGamble:(r,d)=>o(r,d),onLeave:a}),s==="racing"&&e.jsx($t,{gameState:t,onGamble:(r,d)=>o(r,d),onLeave:a}),s==="coin"&&e.jsx(_t,{gameState:t,onGamble:(r,d)=>o(r,d),onLeave:a}),s==="dice"&&e.jsx(Yt,{gameState:t,onGamble:(r,d)=>o(r,d),onLeave:a})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:a,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},Kt=({gameState:t,onPrestige:o,onClose:a})=>{var h;const c=n(1e12),r=t.totalGold;let d=n(0),l=!1,p=c.minus(r);if(r.gte(c)){const w=r.dividedBy(c);d=n(Math.floor(Math.pow(w.toNumber(),.33))).times(1).minus(t.renown),d.lt(0)&&(d=n(0)),l=d.gt(0)}const m=t.renown.plus(d),y=c.times(Math.pow(Math.floor(m.dividedBy(1).toNumber()+1),1/.33)),x=y.minus(r),z=fe(t.renown).minus(n(1)).times(n(100)),E=fe(t.renown.plus(d)).minus(n(1)).times(n(100)),A=Object.values(t.nationalProjects||{}).some(w=>w.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((h=t.playerProfile)!=null&&h.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",k(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),A&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"âš ï¸ WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",k(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",k(r,t.numberFormat)]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current Bonus:"})," +",z.toNumber().toFixed(1),"%"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," ",k(d,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After:"})," ",k(t.renown.plus(d),t.numberFormat)," (+",E.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:k(y,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:x.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",k(x.gt(0)?x:n(0),t.numberFormat)," more)"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:a,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:o,disabled:!l,children:l?"Abdicate":r.lt(c)?`Need ${k(p,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},Vt=({gameState:t,onClose:o,onHardReset:a,onSave:s,onOpenChangelog:c,onSetTheme:r,onSetNumberFormat:d,onToggleIdleMode:l,onUpdateInterface:p})=>{var ae,ne,ie,de;const[m,y]=Bt.useState(!1),x=t.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:n(1),center:n(1),right:n(1)},borderWidth:n(4),customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},S=(ae=x.layout.left)!=null&&ae.toNumber?x.layout.left.toNumber():Number(x.layout.left),z=(ne=x.layout.center)!=null&&ne.toNumber?x.layout.center.toNumber():Number(x.layout.center),C=(ie=x.layout.right)!=null&&ie.toNumber?x.layout.right.toNumber():Number(x.layout.right),E=(de=x.borderWidth)!=null&&de.toNumber?x.borderWidth.toNumber():Number(x.borderWidth),A=x.customColors||{},h=String(A.bg||""),w=String(A.panel||""),v=String(A.text||""),N=String(A.secondaryText||""),b=String(A.accent||""),$=String(A.accentHover||""),_=String(A.gold||""),D=String(A.border||""),H=String(A.success||""),O=String(A.danger||""),U=()=>{m?a():y(!0)},T=(R,re)=>{p({layout:{...x.layout,[R]:n(re)}})},P=(R,re)=>{p({customColors:{...x.customColors,[R]:re}})},q={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},X={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},J={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"âš™ï¸ Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:S,onChange:R=>T("left",parseFloat(R.target.value)),style:J}),e.jsx("span",{style:{fontSize:"0.8rem"},children:S})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:z,onChange:R=>T("center",parseFloat(R.target.value)),style:J}),e.jsx("span",{style:{fontSize:"0.8rem"},children:z})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:C,onChange:R=>T("right",parseFloat(R.target.value)),style:J}),e.jsx("span",{style:{fontSize:"0.8rem"},children:C})]})]}),e.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),e.jsxs("div",{style:X,children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"1",max:"10",value:E,onChange:R=>p({borderWidth:n(parseInt(R.target.value))})}),e.jsxs("span",{children:[E,"px"]})]})]}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),e.jsx("input",{type:"checkbox",checked:x.customColors.enabled,onChange:R=>P("enabled",R.target.checked),style:{transform:"scale(1.5)"}})]}),x.customColors.enabled&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",e.jsx("input",{type:"color",value:h,onChange:R=>P("bg",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",e.jsx("input",{type:"color",value:w,onChange:R=>P("panel",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",e.jsx("input",{type:"color",value:D,onChange:R=>P("border",R.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",e.jsx("input",{type:"color",value:v,onChange:R=>P("text",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",e.jsx("input",{type:"color",value:N,onChange:R=>P("secondaryText",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",e.jsx("input",{type:"color",value:_,onChange:R=>P("gold",R.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",e.jsx("input",{type:"color",value:b,onChange:R=>P("accent",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",e.jsx("input",{type:"color",value:$,onChange:R=>P("accentHover",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",e.jsx("input",{type:"color",value:H,onChange:R=>P("success",R.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",e.jsx("input",{type:"color",value:O,onChange:R=>P("danger",R.target.value),style:{width:"100%"}})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px",opacity:x.customColors.enabled?.5:1,pointerEvents:x.customColors.enabled?"none":"auto"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",x.customColors.enabled&&"(Disabled)"]}),e.jsx("div",{style:q,children:Object.values(Ge).map(R=>e.jsx("button",{className:"btn",style:{background:t.theme===R.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===R.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>r(R.id),children:R.name},R.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),e.jsx("div",{style:q,children:["small","medium","large"].map(R=>e.jsx("button",{className:"btn",style:{background:x.fontSize===R?"var(--accent-color)":"var(--panel-bg)",color:x.fontSize===R?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>p({fontSize:R}),children:R},R))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:q,children:["compact","normal","spacious"].map(R=>e.jsx("button",{className:"btn",style:{background:x.density===R?"var(--accent-color)":"var(--panel-bg)",color:x.density===R?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>p({density:R}),children:R},R))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:l,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:x.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>p({showFloatingText:!x.showFloatingText}),children:x.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:x.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>p({showWeatherWidget:!x.showWeatherWidget}),children:x.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:x.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>p({crownAnimations:!x.crownAnimations}),children:x.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:X,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),e.jsx("button",{className:"btn",style:{background:x.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>p({reduceMotion:!x.reduceMotion}),children:x.reduceMotion?"ON":"OFF"})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:q,children:["standard","scientific","plain"].map(R=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===R?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===R?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>d(R),children:R},R))})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:s,children:"Force Save"}),e.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:c,children:"Update Logs"}),e.jsx("button",{className:"btn",style:{backgroundColor:m?"red":"#d32f2f"},onClick:U,children:m?"CONFIRM WIPE?":"Hard Reset"})]}),m&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:o,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},Xt=({onClose:t})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:Xe.map((o,a)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:a<Xe.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",o.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:o.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:o.changes.map((s,c)=>e.jsx("li",{style:{marginBottom:"3px"},children:s},c))})]},o.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),Jt=({gameState:t})=>{var l;const[o,a]=g.useState("all"),s=()=>{const p=Be.sort((m,y)=>{const x=t.achievements.includes(m.id),S=t.achievements.includes(y.id);return x&&!S?-1:!x&&S?1:0});return o==="all"?p:p.filter(m=>o==="buildings"?m.id.startsWith("build_"):o==="clicks"?m.id.startsWith("clicks_"):o==="gold"?m.id.startsWith("gold_"):o==="soldiers"?m.id.startsWith("soldiers_"):o==="renown"?m.id.startsWith("renown_"):o==="dragons"?m.id.startsWith("dragons_"):o==="gambler"?m.id.startsWith("gambler_"):o==="total_builds"?m.id.startsWith("total_builds"):o==="efficiency"?["speed_1m","speed_1b","prestige_master"].includes(m.id):o==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(m.id):o==="trade"?["first_trade","trade_master"].includes(m.id):o==="secret"?["click_master","idle_time_master"].includes(m.id):o==="bonus"?["gold_veteran","production_master","speed_baker","prestige_novice","golden_touch","combo_master"].includes(m.id):o==="combo"?["building_soldier_combo"].includes(m.id):!0)},c=[{id:"all",name:"All",icon:"ðŸ†"},{id:"buildings",name:"Buildings",icon:"ðŸ—ï¸"},{id:"clicks",name:"Clicks",icon:"ðŸ‘†"},{id:"gold",name:"Gold",icon:"ðŸ’°"},{id:"soldiers",name:"Army",icon:"âš”ï¸"},{id:"renown",name:"Prestige",icon:"ðŸ‘‘"},{id:"dragons",name:"Dragons",icon:"ðŸ‰"},{id:"gambler",name:"Tavern",icon:"ðŸŽ²"},{id:"total_builds",name:"Total Buildings",icon:"ðŸ›ï¸"},{id:"efficiency",name:"Efficiency",icon:"âš¡"},{id:"wonders",name:"Wonders",icon:"ðŸŒŸ"},{id:"trade",name:"Trade",icon:"ðŸš¢"},{id:"secret",name:"Secret",icon:"ðŸ”"},{id:"bonus",name:"Bonus",icon:"âœ¨"},{id:"combo",name:"Combo",icon:"âš¡"}],r={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"5px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},d=p=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${p?"var(--gold-color)":"#ccc"}`,background:p?"#fff8e1":"#eee",borderRadius:"4px",opacity:p?1:.3,cursor:p?"help":"default",position:"relative",fontSize:"0.8rem"});return e.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[e.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textAlign:"center"},children:[t.achievements.length," / ",Be.length," Unlocked",o!=="all"&&e.jsxs("span",{children:[" | ",s().filter(p=>t.achievements.includes(p.id)).length," / ",s().length," in ",(l=c.find(p=>p.id===o))==null?void 0:l.name]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:c.map(p=>e.jsxs("button",{onClick:()=>a(p.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${o===p.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:o===p.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:p.name,children:[e.jsx("span",{style:{marginRight:"2px"},children:p.icon}),e.jsx("span",{style:{display:o===p.id?"inline":"none"},children:p.name})]},p.id))}),e.jsx("div",{style:r,children:s().map(p=>{const m=t.achievements.includes(p.id);return e.jsx("div",{style:d(m),"data-tooltip":m?`${p.name}: ${p.description}`:"Locked",children:e.jsx("div",{style:{fontSize:"1rem",filter:m?"none":"grayscale(100%)",opacity:m?1:.2},children:m?p.icon:"â“"})},p.id)})})]})},Zt=({gameState:t,currentGps:o,onClose:a})=>{var h,w;const s=Object.values(t.buildings).reduce((v,N)=>v.plus(N),n(0)),c=t.achievements.length,r=Be.length;let d="None",l="None",p=-1,m=n(0);ge.forEach((v,N)=>{const b=t.buildings[v.id]||n(0);b.gt(n(0))&&N>p&&(p=N,d=v.name),b.gt(m)&&(m=b,l=v.name)});const x=(()=>{let v=n(1);return v=v.times(fe(t.renown)),v})(),[S,z]=g.useState("");g.useEffect(()=>{const v=()=>{const b=n(Date.now()).minus(t.startTime),$=b.dividedBy(n(1e3)),_=$.minus($.dividedBy(n(60)).floor().times(n(60))).floor(),D=b.dividedBy(n(6e4)),H=D.minus(D.dividedBy(n(60)).floor().times(n(60))).floor(),O=b.dividedBy(n(36e5)),U=O.minus(O.dividedBy(n(24)).floor().times(n(24))).floor(),T=b.dividedBy(n(864e5)).floor();let P="";T.gt(n(0))&&(P+=`${T.toString()}d `),U.gt(n(0))&&(P+=`${U.toString()}h `),P+=`${H.toString()}m ${_.toString()}s`,z(P)};v();const N=setInterval(v,1e3);return()=>clearInterval(N)},[t.startTime]);const C={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},E={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},A=(h=t.weather)!=null&&h.current&&((w=at[t.weather.current])==null?void 0:w.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"ðŸ“Š Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:E,children:"âš¡ Current Status"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[k(o,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[k(x,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:A})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",fe(t.renown).minus(n(1)).times(n(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:E,children:"â³ Time & Legacy"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:S})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:k(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:E,children:"ðŸ’° Economy Summary"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:k(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:k(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:E,children:"ðŸ° Dominion"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:k(s,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:d})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[l," (",k(m,t.numberFormat),")"]})]}),e.jsx("h3",{style:E,children:"âš”ï¸ Workforce & Court"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[k(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsx("h3",{style:E,children:"ðŸ“ˆ Player Stats"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:k(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:k(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:k(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:E,children:"ðŸŽ–ï¸ Completion"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[c," / ",r," (",Math.floor(c/r*100),"%)"]})]}),e.jsx("h3",{style:E,children:"ðŸ† Achievements"}),e.jsx(Jt,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:a,children:"Close Records"})]})})},Qt=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],eo=({gameState:t,onStartProject:o,onUpgradeClickPower:a,onUpgradeOffline:s,onClose:c})=>{const[r,d]=g.useState("infrastructure");if(!(t.buildings.field||n(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"ðŸ—ï¸ National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"ðŸ”’"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:c,children:"Close"})]})});const m=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:St.map(x=>{var X,J,ae,ne;const S=t.buildings[x.id]||n(0);if(S.lt(10))return null;const z=t.nationalProjects[x.id]||{level:0,active:!1,startTime:0,endTime:0},C=z.level,E=C>=Oe,A=z.active,h=C+1,w=ct(x.id,h),v=ut(h),N=Qt[h]||0,b=S.gte(N),$=t.gold.gte(w.gold),_=t.soldiers.gte(w.laborers),D=!w.carpenter.gt(0)||((X=t.eliteUnits.carpenter)==null?void 0:X.gte(w.carpenter)),H=!w.mason.gt(0)||((J=t.eliteUnits.mason)==null?void 0:J.gte(w.mason)),O=!w.architect.gt(0)||((ae=t.eliteUnits.architect)==null?void 0:ae.gte(w.architect)),U=$&&_&&D&&H&&O&&b;let T=0,P=0;if(A){const ie=Date.now(),de=z.endTime-z.startTime,R=ie-z.startTime;T=Math.min(100,R/de*100),P=Math.max(0,Math.ceil((z.endTime-ie)/1e3))}const q=((ne=ge.find(ie=>ie.id===x.id))==null?void 0:ne.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:A?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:A?"var(--accent-color)":"rgba(0,0,0,0.05)",color:A?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:x.name.replace(" Infrastructure","")}),e.jsxs("span",{children:["Lvl ",C," / ",Oe]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:A?"#000":"#fff",marginBottom:"10px",fontStyle:"italic"},children:x.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(C*Ee*100).toFixed(0),"% Global"]}),A?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${T}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem",color:"#3e2723"},children:["Under Construction... ",Math.floor(P/3600),"h ",Math.floor(P%3600/60),"m"]})]}):E?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"5px"},children:[e.jsxs("span",{style:{color:$?"green":"red"},children:["ðŸ’° ",k(w.gold)," Gold"]}),e.jsxs("span",{style:{color:_?"green":"red"},children:["ðŸ‘· ",k(w.laborers)," Laborers"]}),w.carpenter.gt(0)&&e.jsxs("span",{style:{color:D?"green":"red"},children:["ðŸªš ",k(w.carpenter)," Carpenters"]}),w.mason.gt(0)&&e.jsxs("span",{style:{color:H?"green":"red"},children:["ðŸ§± ",k(w.mason)," Masons"]}),w.architect.gt(0)&&e.jsxs("span",{style:{color:O?"green":"red"},children:["ðŸ“ ",k(w.architect)," Architects"]}),e.jsxs("span",{style:{color:b?"green":"red"},children:["ðŸ  ",k(n(N))," ",q,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["â³ Duration: ",Math.floor(v/3600),"h ",Math.floor(v%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:U?"var(--accent-color)":"var(--border-color)",cursor:U?"pointer":"not-allowed"},disabled:!U,onClick:()=>o(x.id),children:"Start Project (Units Consumed)"})]})]})]},x.id)})}),y=()=>{const x=t.clickUpgradeLevel||0,S=x>=$e,z=x+1,C=dt(z),E=t.gold.gte(C),A=n(2).pow(Math.min(x,15)),h=Re(x),w=h>0?`${k(A)} + ${(h*100).toFixed(1)}% of GPS`:k(A),v=n(2).pow(Math.min(z,15)),N=Re(z),b=N>0?`${k(v)} + ${(N*100).toFixed(1)}% of GPS`:k(v),$=t.offlineUpgradeLevel||0,_=$>=ze,D=$+1,H=xt(D),O=t.renown.gte(H),{efficiency:U,duration:T}=He($),{efficiency:P,duration:q}=He(D),X=J=>{const ae=Math.floor(J/3600),ne=Math.floor(J%3600/60);return ae>0?`${ae}h ${ne}m`:`${ne}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ‘‘ Royal Scepter"}),e.jsxs("span",{children:["Lvl ",x," / ",$e]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",w]}),S?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",b]}),e.jsxs("div",{style:{color:E?"green":"red",fontWeight:"bold"},children:["ðŸ’° ",k(C)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:E?"var(--accent-color)":"var(--border-color)",cursor:E?"pointer":"not-allowed"},disabled:!E,onClick:a,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ’¤ Offline Production"}),e.jsxs("span",{children:["Lvl ",$," / ",ze]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Improve the efficiency of your kingdom while you are away."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(U*100).toFixed(0),"% for ",X(T)]}),_?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(P*100).toFixed(0),"% for ",X(q)]}),e.jsxs("div",{style:{color:O?"#673ab7":"red",fontWeight:"bold"},children:["ðŸ‘‘ ",k(H)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:O?"#673ab7":"var(--border-color)",cursor:O?"pointer":"not-allowed"},disabled:!O,onClick:s,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ›ï¸ National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:r==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>d("infrastructure"),children:"ðŸ—ï¸ Infrastructure"}),e.jsx("button",{className:"btn",style:{background:r==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>d("royalScepter"),children:"ðŸ‘‘ Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[r==="infrastructure"&&m(),r==="royalScepter"&&y()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:c,children:"Return to Kingdom"})})]})})},to=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(o=>e.jsxs("div",{className:`toast ${o.type}`,children:[o.type==="success"&&"âœ…",o.type==="warning"&&"âš ï¸",o.type==="info"&&"â„¹ï¸",o.type==="error"&&"âŒ",e.jsx("span",{children:o.message})]},o.id))}),oo=()=>{const[t,o]=g.useState(null);if(g.useEffect(()=>{const s=d=>{const p=d.target.closest("[data-tooltip]");if(p){const m=p.getAttribute("data-tooltip");m&&o({text:m,x:d.clientX,y:d.clientY})}else o(null)},c=d=>{t&&o(l=>l?{...l,x:d.clientX,y:d.clientY}:null)},r=()=>{o(null)};return document.addEventListener("mouseover",s),document.addEventListener("mousemove",c),document.addEventListener("mouseout",r),()=>{document.removeEventListener("mouseover",s),document.removeEventListener("mousemove",c),document.removeEventListener("mouseout",r)}},[t]),!t)return null;const a={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(a.left=t.x-260),t.y+100>window.innerHeight&&(a.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:a,children:t.text.split(`
`).map((s,c)=>e.jsx("div",{style:{marginBottom:c===t.text.split(`
`).length-1?0:"4px"},children:s},c))})},no=({gameState:t})=>{const{weather:o,buildings:a,totalGold:s}=t,c=S=>{var z;return((z=a[S])==null?void 0:z.toNumber())||0};let r="wilderness";c("palace")>0?r="empire":c("castle")>0||c("market")>0?r="city":(c("peasant")>20||c("field")>10||s.gt(n(500)))&&(r="hamlet");let d="",l="";switch(r){case"wilderness":d="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",l="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":d="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",l="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":d="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",l="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":d="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",l="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const p=o.current;let m="none",y="",x=0;return p==="rainy"?(m="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",y="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",x=1):p==="stormy"?(m="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",y="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",x=1):p==="sunny"?(m="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",y="â˜€ï¸",x=.6):p==="windy"&&(y="ðŸƒ ðŸƒ ðŸƒ",x=.8),e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:d,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:x,animation:p==="windy"?"float 3s infinite ease-in-out":"none"},children:y}),m!=="none"&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:m,pointerEvents:"none"}}),e.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:l}),e.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),e.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},ro={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},so=Ct(ro),Pe=Tt(so);function io(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function lo(){const t=new Date,o=t.getDay(),a=t.getDate()-o+(o===0?-6:1);return new Date(t.setDate(a))}async function ao(t){try{const o={...t,period:"alltime"},a={...t,period:"weekly"},s=Je(Pe,"leaderboard_alltime",t.rulerId);await Ze(s,{...o,gold:Number(o.gold.toString()),buildings:Number(o.buildings),achievements:Number(o.achievements),renown:Number(o.renown.toString()),timestamp:Qe()});const c=Je(Pe,"leaderboard_weekly",t.rulerId);return await Ze(c,{...a,gold:Number(a.gold.toString()),buildings:Number(a.buildings),achievements:Number(a.achievements),renown:Number(a.renown.toString()),timestamp:Qe()}),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",o.customData)),o}}async function co(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=pt(mt(Pe,"leaderboard_alltime"),ft("gold","desc"),gt(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const a=await ht(o);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",a.docs.length);const s=a.docs.map(c=>{const r=c.data();return{id:c.id,...r,gold:r.gold instanceof ue?r.gold:new ue(r.gold),renown:r.renown instanceof ue?r.renown:new ue(r.renown),timestamp:r.timestamp}});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",s.length),s}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}}async function xo(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=lo();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",o.toISOString());const a=pt(mt(Pe,"leaderboard_weekly"),ft("gold","desc"),gt(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const s=await ht(a);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",s.docs.length);const r=s.docs.map(d=>{const l=d.data();return{id:d.id,...l,gold:l.gold instanceof ue?l.gold:new ue(l.gold),renown:l.renown instanceof ue?l.renown:new ue(l.renown),timestamp:l.timestamp}}).filter(d=>{var m,y;const l=((y=(m=d.timestamp)==null?void 0:m.toDate)==null?void 0:y.call(m))||new Date(d.timestamp),p=l>=o;return p||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",l.toISOString()),p});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",r.length),r}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}}const uo=({isOpen:t,onClose:o,onConfirm:a,gameState:s})=>{const[c,r]=g.useState(""),[d,l]=g.useState(!1);if(!t)return null;const p=async()=>{if(c.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(c.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}l(!0);try{const y={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:c.trim(),rulerId:io(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};a(y),o()}catch{alert("An error occurred while creating profile. Please try again.")}finally{l(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:po(s.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:c,onChange:m=>r(m.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:m=>m.key==="Enter"&&p()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[c.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:p,disabled:d||c.trim().length<3,style:{padding:"12px 24px",backgroundColor:d||c.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:d||c.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:d?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:o,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:m=>{m.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:m=>{m.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function po(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const mo=({isOpen:t,onClose:o,playerProfile:a,onOpenRulerNameModal:s,gameState:c})=>{const[r,d]=g.useState([]),[l,p]=g.useState([]),[m,y]=g.useState("alltime"),[x,S]=g.useState(!1),[z,C]=g.useState(null),[E,A]=g.useState(0),[h,w]=g.useState(0),v=()=>{const T=localStorage.getItem("leaderboardCache");if(T)try{const{data:P,timestamp:q}=JSON.parse(T),X=Date.now(),J=3600*1e3;if(X-q<J&&P&&P.allTime&&P.weekly)return P}catch(P){console.error("Cache parse error:",P)}return null},N=T=>{const P={data:T,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(P)),w(Date.now())},b=()=>{const T=localStorage.getItem("leaderboardCache");if(T){const{timestamp:P}=JSON.parse(T),q=Date.now(),X=3600*1e3;return q-P<X}return!1};g.useEffect(()=>{if(t){if(b())try{const T=v();if(T){d(T.allTime),p(T.weekly);const P=JSON.parse(localStorage.getItem("leaderboardCache"));w(P.timestamp);return}}catch(T){console.error("Cache read error:",T)}$()}},[t]);const $=async()=>{S(!0),C(null);try{const T=new Promise((X,J)=>setTimeout(()=>J(new Error("Loading timeout")),1e4)),[P,q]=await Promise.all([Promise.race([co(50),T]),Promise.race([xo(50),T])]);d(P),p(q),N({allTime:P,weekly:q}),console.log("Leaderboard data loaded successfully!")}catch(T){console.error("Error loading leaderboard:",T),C("Failed to load leaderboard. Please check your internet connection and try again.")}finally{S(!1)}},_=T=>{switch(T){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${T}`}},D=()=>a?(m==="alltime"?r:l).findIndex(P=>P.rulerId===a.rulerId)+1:-1,H=()=>{const T=m==="alltime"?r:l;if(T.length>0){let P=0;if(T.forEach(q=>{if(q.timestamp){let X=0;typeof q.timestamp=="object"&&q.timestamp.toDate?X=q.timestamp.toDate().getTime():typeof q.timestamp=="number"?X=q.timestamp:typeof q.timestamp=="string"&&(X=new Date(q.timestamp).getTime()),X>P&&(P=X)}}),P>0)return P}return h},O=m==="alltime"?r:l,U=O.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),e.jsx("button",{className:"btn",onClick:o,children:"Close"})]}),!a&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),s&&c&&c.gold&&c.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{o(),s()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),U&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-H())/6e4)," minutes ago"]})}),x&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),z&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:z}),a&&U&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",a.rulerName," ",a.rulerId]}),O.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",D()>0?`#${D()}`:"Not ranked yet"," in ",m==="alltime"?"All Time":"Weekly"]})]}),U&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>y("alltime"),className:m==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>y("weekly"),className:m==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),U&&!x&&!z&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),e.jsx("tbody",{children:O.map((T,P)=>e.jsxs("tr",{style:{backgroundColor:(a==null?void 0:a.rulerId)===T.rulerId?"rgba(191, 144, 0, 0.1)":P%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:_(P+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:T.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:T.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:k(T.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:k(T.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:T.buildings})]},T.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},fo=({gained:t,effectiveTime:o,totalTime:a,efficiency:s,completedProjects:c,onClose:r,numberFormat:d})=>{const l=p=>{const m=Math.floor(p/3600),y=Math.floor(p%3600/60),x=Math.floor(p%60),S=[];return m>0&&S.push(`${m}h`),y>0&&S.push(`${y}m`),(x>0||S.length===0)&&S.push(`${x}s`),S.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"ðŸŒ™ Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:l(a.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:l(o.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(s*100).toFixed(0),"%"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",k(t,d)]})]})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"âœ… Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:c.map((p,m)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:p},m))})]})]}),e.jsx("button",{className:"btn",onClick:r,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})},ye={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:n(1),layout:{left:n(1),center:n(1),right:n(1)},borderWidth:n(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},je={gold:n(0),totalGold:n(0),startTime:n(Date.now()),lastSaveTime:n(Date.now()),buildings:{},achievements:[],renown:n(0),prestigeCount:0,soldiers:n(0),eliteUnits:{},nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:n(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!0,interface:ye,stats:{totalClicks:n(0),dragonsKilled:n(0),tavernGamesPlayed:n(0)},playerProfile:null},Ce=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(Ce);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const o={};for(const a in t)t.hasOwnProperty(a)&&(o[a]=Ce(t[a]));return o}return t},bo=()=>{var qe;const[t,o]=g.useState(()=>{var u,f,B,F,G,L;const i=localStorage.getItem("kingdom_save");if(i)try{const j=JSON.parse(i),Y=j.interface||{},V={...ye,...Y,lastBuyAmount:n(Y.lastBuyAmount??1),crownAnimations:Y.crownAnimations??!0,layout:{left:n(((u=Y.layout)==null?void 0:u.left)??ye.layout.left),center:n(((f=Y.layout)==null?void 0:f.center)??ye.layout.center),right:n(((B=Y.layout)==null?void 0:B.right)??ye.layout.right)},borderWidth:n(Y.borderWidth??ye.borderWidth),customColors:{...ye.customColors,...Y.customColors||{}}};return{...je,...j,renown:n(j.renown||0),prestigeCount:j.prestigeCount||0,gold:n(j.gold||0),totalGold:n(j.totalGold||0),startTime:n(j.startTime||Date.now()),lastSaveTime:n(j.lastSaveTime||Date.now()),soldiers:n(j.soldiers||0),buildings:Object.keys(j.buildings||{}).reduce((te,ee)=>(te[ee]=n(j.buildings[ee]),te),{}),stats:{...je.stats,...j.stats||{},totalClicks:n(((F=j.stats)==null?void 0:F.totalClicks)||0),dragonsKilled:n(((G=j.stats)==null?void 0:G.dragonsKilled)||0),tavernGamesPlayed:n(((L=j.stats)==null?void 0:L.tavernGamesPlayed)||0)},eliteUnits:Object.keys(j.eliteUnits||{}).reduce((te,ee)=>(te[ee]=n(j.eliteUnits[ee]),te),{}),nationalProjects:j.nationalProjects||{},clickUpgradeLevel:j.clickUpgradeLevel||0,offlineUpgradeLevel:j.offlineUpgradeLevel||0,weather:j.weather?{...j.weather,timeLeft:n(Number(j.weather.timeLeft)||120)}:je.weather,theme:j.theme||"default",numberFormat:j.numberFormat||"standard",idleModeEnabled:j.idleModeEnabled!==void 0?j.idleModeEnabled:!0,interface:V,playerProfile:j.playerProfile?{...j.playerProfile,lastLeaderboardSubmit:j.playerProfile.lastLeaderboardSubmit||0}:null}}catch(j){console.error("Save load failed",j)}return je}),a=g.useRef(t);g.useEffect(()=>{a.current=t},[t]);const s=g.useRef("");g.useEffect(()=>{const i=u=>{s.current=(s.current+u.key).slice(-20);const f=s.current.toLowerCase();f.endsWith("godon")?(o(B=>({...B,godMode:!0})),Q("God Mode Enabled: +99999s per click","success"),s.current=""):f.endsWith("godoff")&&(o(B=>({...B,godMode:!1})),Q("God Mode Disabled","info"),s.current="")};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]);const c=()=>{const i=localStorage.getItem("kingdom_last_save_time"),u=Date.now();if(i){const f=u-parseInt(i),B=n(f/1e3);if(B.gte(n(60))){const F=n(86400),G=ue.min(B,F),L=.1+t.offlineUpgradeLevel/ze*(.99-.1),Y=ce(t).times(n(L)).times(G).floor();Y.gt(n(0))&&(C({gained:Y,effectiveTime:G,totalTime:B,efficiency:L,completedProjects:[]}),o(V=>({...V,gold:V.gold.plus(Y),totalGold:V.totalGold.plus(Y)})))}}localStorage.setItem("kingdom_last_save_time",u.toString())},[r,d]=g.useState(!1);g.useEffect(()=>{let i;const u=()=>{d(!1),clearTimeout(i),t.idleModeEnabled&&(i=setTimeout(()=>{d(!0)},2e4))};u();const f=["mousemove","mousedown","keydown","touchstart","scroll"];return f.forEach(B=>window.addEventListener(B,u)),()=>{clearTimeout(i),f.forEach(B=>window.removeEventListener(B,u))}},[t.idleModeEnabled]),g.useEffect(()=>{t.event&&d(!1)},[t.event]),g.useEffect(()=>{const i=k(t.gold);document.title=`Gold: ${i} - Kingdom Clicker`},[t.gold]),g.useEffect(()=>{var G;const i=document.documentElement,u=t.interface||ye;if((G=u.customColors)!=null&&G.enabled){const L=u.customColors;i.style.setProperty("--bg-color",L.bg),i.style.setProperty("--panel-bg",L.panel),i.style.setProperty("--text-color",L.text),i.style.setProperty("--text-secondary",L.secondaryText||"#5d4037"),i.style.setProperty("--text-on-accent","#ffffff"),i.style.setProperty("--accent-color",L.accent),i.style.setProperty("--accent-hover",L.accentHover||L.accent),i.style.setProperty("--gold-color",L.gold||"#bf9000"),i.style.setProperty("--border-color",L.border),i.style.setProperty("--success-color",L.success||"#2e7d32"),i.style.setProperty("--danger-color",L.danger||"#c62828"),i.style.setProperty("--bg-image","none")}else{const L=t.theme||"default",j=Ge[L]||Ge.default;j&&Object.entries(j.colors).forEach(([Y,V])=>{i.style.setProperty(Y,V)})}const f={small:"14px",medium:"16px",large:"18px"};i.style.setProperty("--base-font-size",f[u.fontSize]);const B={compact:"8px",normal:"12px",spacious:"20px"},F={compact:"6px",normal:"12px",spacious:"16px"};i.style.setProperty("--panel-padding",B[u.density]),i.style.setProperty("--gap-size",F[u.density]),i.style.setProperty("--custom-border-width",`${u.borderWidth}px`),i.style.setProperty("--col-left",String(u.layout.left)),i.style.setProperty("--col-center",String(u.layout.center)),i.style.setProperty("--col-right",String(u.layout.right)),u.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[l,p]=g.useState(!1);g.useEffect(()=>{var i;t.gold.gte(n(1e7))&&!((i=t.playerProfile)!=null&&i.hasChosenName)&&!l&&de(!0)},[t.gold,t.playerProfile,l]);const[m,y]=g.useState(null),[x,S]=g.useState([]),[z,C]=g.useState(null),[E,A]=g.useState("buildings"),[h,w]=g.useState("army"),[v,N]=g.useState(!1),[b,$]=g.useState("throne");g.useEffect(()=>{const i=()=>{N(window.innerWidth<768)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const[_,D]=g.useState(!1),[H,O]=g.useState(!1),[U,T]=g.useState(!1),[P,q]=g.useState(!1),[X,J]=g.useState(!1),[ae,ne]=g.useState(!1),[ie,de]=g.useState(!1),[R,re]=g.useState(!1),Q=(i,u="info")=>{const f=Date.now().toString()+Math.random();S(B=>[...B,{id:f,message:i,type:u}]),setTimeout(()=>{S(B=>B.filter(F=>F.id!==f))},3e3)};g.useEffect(()=>{const i=Date.now();if(t.lastSaveTime&&n(i).minus(t.lastSaveTime).gt(n(6e4))){const u=n(i).minus(t.lastSaveTime).dividedBy(n(1e3)),{efficiency:f,duration:B}=He(t.offlineUpgradeLevel||0),F=n(B),G=ue.min(u,F),j=ce(t).times(n(f)).times(G).floor(),Y=[];let V={...t.nationalProjects},te=!1;Object.keys(V).forEach(ee=>{var xe;const oe=V[ee];if(oe.active&&oe.endTime&&i>=oe.endTime){V[ee]={...oe,active:!1,level:oe.level+1,startTime:0,endTime:0};const ve=(xe=ge.find(Le=>Le.id===ee))==null?void 0:xe.name;ve&&Y.push(`${ve} Infrastructure (Lvl ${oe.level+1})`),te=!0}}),(j.gt(n(0))||Y.length>0)&&(C({gained:j,effectiveTime:G,totalTime:u,efficiency:f,completedProjects:Y}),o(ee=>({...ee,gold:ee.gold.plus(j),totalGold:ee.totalGold.plus(j),nationalProjects:te?V:ee.nationalProjects})))}},[]),g.useEffect(()=>{const i=setInterval(()=>{Date.now()%3e4<1e3&&o(u=>{const f={...u,lastSaveTime:n(Date.now())},B=Ce(f);return localStorage.setItem("kingdom_save",JSON.stringify(B)),f})},1e3);return()=>clearInterval(i)},[]),g.useEffect(()=>{const i=()=>{const f=a.current,B=Ce(f);localStorage.setItem("kingdom_save",JSON.stringify(B)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",i);const u=()=>{document.visibilityState==="hidden"?i():document.visibilityState==="visible"&&c()};return document.addEventListener("visibilitychange",u),()=>{window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",u)}},[]),g.useEffect(()=>{var u;if(!((u=t.playerProfile)!=null&&u.hasChosenName))return;const i=setInterval(()=>{var L;const f=a.current,B=Date.now(),F=((L=f.playerProfile)==null?void 0:L.lastLeaderboardSubmit)||0,G=3600*1e3;B-F>=G&&ao({rulerName:f.playerProfile.rulerName,rulerId:f.playerProfile.rulerId,gold:f.gold,renown:f.renown,buildings:Object.keys(f.buildings).length,achievements:f.achievements.length,period:"alltime"}).then(()=>{o(j=>({...j,playerProfile:{...j.playerProfile,lastLeaderboardSubmit:Date.now()}})),Q("Leaderboard data submitted successfully!","success")}).catch(j=>{console.error("Auto leaderboard submission failed:",j)})},6e4);return()=>clearInterval(i)},[(qe=t.playerProfile)==null?void 0:qe.hasChosenName]),g.useEffect(()=>{const i=setInterval(()=>{if(!t.event&&Math.random()<.05){const B=["dragon","merchant","jester"],F=B[Math.floor(Math.random()*B.length)],G=F==="dragon"?6e5:3e4,L={id:Date.now().toString(),type:F,expiresAt:n(Date.now()).plus(n(G)),hp:F==="dragon"?n(10):void 0,maxHp:F==="dragon"?n(10):void 0,reward:n(0),startTime:F==="dragon"?Date.now():void 0};o(j=>({...j,event:L}))}},1e4);return()=>clearInterval(i)},[t.event]);const ce=i=>{var L;let u=n(0);const f=((L=i.weather)==null?void 0:L.current)||"clear";ge.forEach(j=>{const Y=i.buildings[j.id]||n(0);let V=j.baseProduction;f==="sunny"?(j.id==="peasant"||j.id==="field"||j.id==="stable"||j.id==="cathedral")&&(V=V.times(n(1.2))):f==="rainy"?(j.id==="silver_mine"||j.id==="alchemist"||j.id==="market"||j.id==="tavern")&&(V=V.times(n(1.2))):f==="stormy"?((j.id==="blacksmith"||j.id==="void_portal")&&(V=V.times(n(1.3))),(j.id==="field"||j.id==="stable")&&(V=V.times(n(.8)))):f==="windy"&&(j.id==="market"||j.id==="castle"||j.id==="time_chamber")&&(V=V.times(n(1.15))),u=u.plus(Y.times(V))});let B=0;i.nationalProjects&&Object.values(i.nationalProjects).forEach(j=>{B+=j.level||0});let F=n(1);const G=n(1).plus(n(B*Ee));if(F=F.times(G),F=F.times(fe(i.renown).plus(n(i.achievements.length*.02))),i.event&&i.event.type==="dragon"&&i.event.startTime){const j=Math.floor((Date.now()-i.event.startTime)/1e3),V=1-Math.min(99,j)/100;F=F.times(n(V))}return u=u.times(F),u},se=ce(t),W=g.useRef(se);W.current=se,g.useEffect(()=>{const i=setInterval(()=>{o(u=>{const f=Date.now(),B=W.current.times(n(Fe)).dividedBy(n(1e3));let F=u.totalGold.plus(B),G=u.gold.plus(B),L={...u.weather};const j=n(Fe/1e3);if(L.timeLeft=L.timeLeft.minus(j),L.timeLeft.lte(n(0))){const oe=["clear","sunny","rainy","stormy","windy"],xe=oe[Math.floor(Math.random()*oe.length)],ve=n(Math.floor(Math.random()*120)+60);L={current:xe,timeLeft:ve}}let Y=u.event;Y&&Y.expiresAt&&n(Y.expiresAt).lt(n(f))&&(Y=null);let V={...u.nationalProjects||{}};Object.keys(V).forEach(oe=>{var ve;const xe=V[oe];xe.active&&xe.endTime&&f>=xe.endTime&&(V[oe]={...xe,active:!1,level:xe.level+1,startTime:0,endTime:0},Q(`Project Completed: ${(ve=ge.find(Le=>Le.id===oe))==null?void 0:ve.name} Infrastructure Level ${xe.level+1}!`,"success"))});const te=[...u.achievements];let ee=null;return Be.forEach(oe=>{te.includes(oe.id)||oe.condition({...u,totalGold:F,gold:G},W.current)&&(te.push(oe.id),ee=oe)}),ee&&(y(ee),setTimeout(()=>y(null),3e3)),{...u,gold:G,totalGold:F,achievements:te,event:Y,soldiers:u.soldiers,weather:L,nationalProjects:V}})},Fe);return()=>clearInterval(i)},[]);const I=(i="light")=>{if("vibrate"in navigator&&v)switch(i){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},M=(i=!1)=>{i||I("light");const u=Z(a.current);o(f=>({...f,gold:f.gold.plus(u),totalGold:f.totalGold.plus(u),stats:{...f.stats,totalClicks:i?f.stats.totalClicks:f.stats.totalClicks.plus(n(1))}}))},Z=i=>{const u=fe(i.renown),f=n(1),B=i.clickUpgradeLevel||0,F=Math.min(B,15),G=n(2).pow(F),L=f.times(G),j=ce(i),Y=Re(B),V=j.times(Y);let te=L.plus(V);if(te=te.times(u),i.godMode){const ee=j.times(n(99999));te=te.plus(ee)}return te},le=()=>{const i=t.clickUpgradeLevel||0;if(i>=$e){Q("Maximum Royal Scepter level reached!","warning");return}const u=dt(i+1);if(t.gold.lt(u)){Q("Not enough gold!","error");return}o(f=>({...f,gold:f.gold.minus(u),clickUpgradeLevel:f.clickUpgradeLevel+1})),Q(`Royal Scepter upgraded to level ${i+1}!`,"success")},be=()=>{const i=t.offlineUpgradeLevel||0;if(i>=ze){Q("Maximum Passive Income level reached!","warning");return}const u=xt(i+1);if(t.renown.lt(u)){Q("Not enough Renown!","error");return}o(f=>({...f,renown:f.renown.minus(u),offlineUpgradeLevel:f.offlineUpgradeLevel+1})),Q(`Passive Income upgraded to level ${i+1}!`,"success")},pe=(i,u)=>{const f=ge.find(G=>G.id===i);if(!f||u<=0)return;const B=t.buildings[i]||n(0),F=we(f.baseCost,B,n(u)).floor();t.gold.gte(F)&&(I("medium"),o(G=>({...G,gold:G.gold.minus(F),buildings:{...G.buildings,[i]:(G.buildings[i]||n(0)).plus(n(u))}})))},Te=(i,u)=>{const f=ge.find(L=>L.id===i);if(!f||u<=0)return;const B=t.buildings[i]||n(0),F=n(Math.min(u,B.toNumber()));if(F.lte(n(0)))return;const G=we(f.baseCost,B.minus(F),F).times(n(.25)).floor();o(L=>({...L,gold:L.gold.plus(G),buildings:{...L.buildings,[i]:B.minus(F)}}))},me=i=>{const u=Ie.times(n(i));t.gold.gte(u)&&o(f=>({...f,gold:f.gold.minus(u),soldiers:f.soldiers.plus(u.dividedBy(Ie))}))},ke=(i,u)=>{const f=lt.find(G=>G.id===i);if(!f)return;const B=f.goldCost.times(n(u)),F=f.soldierCost.times(n(u));t.gold.gte(B)&&t.soldiers.gte(F)&&o(G=>({...G,gold:G.gold.minus(B),soldiers:G.soldiers.minus(F),eliteUnits:{...G.eliteUnits,[i]:(G.eliteUnits[i]||n(0)).plus(n(u))}}))},Me=i=>{if(i.type==="merchant"){const u=W.current.times(n(10));o(f=>({...f,gold:f.gold.plus(u),totalGold:f.totalGold.plus(u),event:null})),Q(`The merchant gifted you ${k(u.floor(),t.numberFormat)} gold!`,"success")}else if(i.type==="jester"){const u=t.gold.times(n(.1)),f=Math.random()>.5;o(B=>({...B,gold:f?B.gold.plus(u):B.gold.minus(u),totalGold:f?B.totalGold.plus(u):B.totalGold,event:null})),f?Q(`Jester pays out! +${k(u.floor(),t.numberFormat)}`,"success"):Q(`Jester tricked you! -${k(u.floor(),t.numberFormat)}`,"warning")}else if(i.type==="dragon"){let u=!1;o(f=>{if(!f.event||f.event.type!=="dragon")return f;const F=(f.event.hp?f.event.hp:n(10)).minus(n(1));if(F.lte(0)){const G=W.current.times(n(30));return u=!0,{...f,gold:f.gold.plus(G),totalGold:f.totalGold.plus(G),event:null,stats:{...f.stats,dragonsKilled:f.stats.dragonsKilled.plus(n(1))}}}return{...f,event:{...f.event,hp:F}}}),u&&Q("Dragon Slain! +Treasury Boost","success")}},K=()=>{const i=n(1),u=n(1e12),f=t.totalGold;if(f.lt(u))return;const B=f.dividedBy(u),G=n(Math.floor(Math.pow(B.toNumber(),.33))).times(i).minus(t.renown);if(G.lte(0))return;const L={...t.nationalProjects};Object.keys(L).forEach(j=>{L[j].active&&(L[j]={...L[j],active:!1,startTime:0,endTime:0})}),o({...je,renown:t.renown.plus(G),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:L,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:n(Date.now()),lastSaveTime:n(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),O(!1),Q("Abdication Successful. Long live the new King!","success")},_e=()=>{localStorage.removeItem("kingdom_save"),o({...je,startTime:n(Date.now())}),T(!1),Q("Game Reset","warning")},Ne=()=>{const u=Ce(t);localStorage.setItem("kingdom_save",JSON.stringify(u)),Q("Game Saved","info")},We=i=>{o(u=>({...u,playerProfile:i})),localStorage.setItem(`playerProfile_${i.id}`,JSON.stringify(i)),Q(`Welcome, ${i.rulerName} ${i.rulerId}!`,"success"),p(!1)},vt=async()=>{K()},Ue=i=>{o(u=>({...u,interface:{...u.interface,lastBuyAmount:i}}))},Ye=i=>({flex:i==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:i==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:i==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:r&&t.idleModeEnabled?i==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:v?"column":"row"},children:[e.jsx(to,{toasts:x}),e.jsx(oo,{}),r&&t.idleModeEnabled&&e.jsx(no,{gameState:t}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Ye("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${E==="buildings"?"active":""}`,onClick:()=>A("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:E==="buildings"&&e.jsx(nt,{gameState:t,onBuyBuilding:pe,onSellBuilding:Te,onSetBuyAmount:Ue})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:r&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(st,{gameState:t,gps:se,onClick:()=>M(!1),onEventInteract:Me,onOpenTavern:()=>D(!0),onOpenPrestige:()=>O(!0),onOpenSettings:()=>T(!0),onOpenStatistics:()=>J(!0),onOpenLeaderboard:()=>{re(!0)},onOpenEmpire:()=>ne(!0),isIdle:r&&t.idleModeEnabled})}),e.jsxs("div",{style:Ye("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${h==="army"?"active":""}`,onClick:()=>w("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:h==="army"&&e.jsx(rt,{gameState:t,onTrainSoldier:me,onTrainElite:ke})})]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[b==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(nt,{gameState:t,onBuyBuilding:pe,onSellBuilding:Te,onSetBuyAmount:Ue})})]}),b==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(st,{gameState:t,gps:se,onClick:()=>M(!1),onEventInteract:Me,onOpenTavern:()=>D(!0),onOpenPrestige:()=>O(!0),onOpenSettings:()=>T(!0),onOpenStatistics:()=>J(!0),onOpenLeaderboard:()=>re(!0),onOpenEmpire:()=>ne(!0),isIdle:r&&t.idleModeEnabled})}),b==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(rt,{gameState:t,onTrainSoldier:me,onTrainElite:ke})})]}),b==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>ne(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${b==="buildings"?"active":""}`,onClick:()=>{I("light"),$("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:b==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${b==="throne"?"active":""}`,onClick:()=>{I("light"),$("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:b==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${b==="army"?"active":""}`,onClick:()=>{I("light"),$("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:b==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${b==="empire"?"active":""}`,onClick:()=>{I("light"),$("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:b==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),e.jsx("div",{children:"Projects"})]})]})]}),!(r&&t.idleModeEnabled)&&m&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:m.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:m.name})]})]}),z&&e.jsx(fo,{gained:z.gained,effectiveTime:z.effectiveTime,totalTime:z.totalTime,efficiency:z.efficiency,completedProjects:z.completedProjects,numberFormat:t.numberFormat,onClose:()=>C(null)}),ae&&e.jsx(eo,{gameState:t,onClose:()=>ne(!1),onStartProject:i=>{var F,G,L,j;const u=((F=t.nationalProjects[i])==null?void 0:F.level)||0;if(u>=Oe)return;const f=ct(i,u+1);if(t.gold.lt(f.gold)||t.soldiers.lt(f.laborers)||(G=t.eliteUnits.carpenter)!=null&&G.lt(f.carpenter||0)||(L=t.eliteUnits.mason)!=null&&L.lt(f.mason||0)||(j=t.eliteUnits.architect)!=null&&j.lt(f.architect||0))return;const B=ut(u+1);o(Y=>({...Y,gold:Y.gold.minus(f.gold),soldiers:Y.soldiers.minus(f.laborers),eliteUnits:{...Y.eliteUnits,carpenter:(Y.eliteUnits.carpenter||n(0)).minus(f.carpenter||0),mason:(Y.eliteUnits.mason||n(0)).minus(f.mason||0),architect:(Y.eliteUnits.architect||n(0)).minus(f.architect||0)},nationalProjects:{...Y.nationalProjects,[i]:{level:u,active:!0,startTime:Date.now(),endTime:Date.now()+B*1e3}}})),Q("Construction started!","info")},onUpgradeClickPower:le,onUpgradeOffline:be}),_&&e.jsx(qt,{gameState:t,onGamble:(i,u)=>{const f=n(i);o(B=>({...B,gold:u?B.gold.plus(f):B.gold.minus(f),stats:{...B.stats,tavernGamesPlayed:B.stats.tavernGamesPlayed.plus(n(1))}}))},onClose:()=>D(!1)}),H&&e.jsx(Kt,{gameState:t,onPrestige:vt,onClose:()=>O(!1)}),U&&e.jsx(Vt,{gameState:t,onClose:()=>T(!1),onHardReset:_e,onSave:Ne,onOpenChangelog:()=>q(!0),onSetTheme:i=>o(u=>({...u,theme:i})),onSetNumberFormat:i=>o(u=>({...u,numberFormat:i})),onToggleIdleMode:()=>o(i=>({...i,idleModeEnabled:!i.idleModeEnabled})),onUpdateInterface:i=>o(u=>({...u,interface:{...u.interface,...i}}))}),X&&e.jsx(Zt,{gameState:t,currentGps:se,onClose:()=>J(!1)}),P&&e.jsx(Xt,{onClose:()=>q(!1)}),ie&&e.jsx(uo,{isOpen:ie,onClose:()=>{de(!1),p(!0)},onConfirm:We,gameState:t}),R&&e.jsx(mo,{isOpen:R,onClose:()=>re(!1),playerProfile:t.playerProfile})]})};export{bo as A,Bt as R,e as j};
