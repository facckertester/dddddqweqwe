var oe=Object.defineProperty,re=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var H=(r,d,a)=>d in r?oe(r,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[d]=a,N=(r,d)=>{for(var a in d||(d={}))le.call(d,a)&&H(r,a,d[a]);if(Z)for(var a of Z(d))ie.call(d,a)&&H(r,a,d[a]);return r},F=(r,d)=>re(r,ne(d));import{r as M,j as o}from"./vendor-react-CUeQczFW.js";import{t as n,B as se,h as z,f as m,i as V,j as ce,N as X,k as I,l as _,m as A,P as $}from"./core-C6hXvPHv.js";import{A as ae}from"./components-ui-DNltbFR6.js";const O=(r,d=!1,a=!1,E=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:a?"rgba(0,0,0,0.05)":d?"rgba(46, 125, 50, 0.1)":E?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:a?"rgba(0,0,0,0.2)":E?"#7b1fa2":r?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:r&&!a?"pointer":"default",opacity:r&&!a||d?1:.7,transition:"all 0.2s",boxShadow:r&&!a?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:a?"grayscale(1)":"none"}),de={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)",position:"relative"},ve=({gameState:r,onBuyBuilding:d,onSellBuilding:a,onSetBuyAmount:E,onStartProject:G,setGameState:Q})=>{var Y;const[B,U]=M.useState({visible:!1,x:0,y:0,building:null}),y=n(1),u=((Y=r.interface)==null?void 0:Y.lastBuyAmount)||n(1),[L,D]=M.useState(!1),[j,q]=M.useState({visible:!1,x:0,y:0,buildingId:null}),[J,k]=M.useState(1);M.useEffect(()=>{const e=i=>{i.ctrlKey?k(10):i.shiftKey?k(100):k(1)},c=i=>e(i),t=i=>e(i);return window.addEventListener("keydown",c),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",t)}},[]);const R=(e,c)=>{const t=e.currentTarget.getBoundingClientRect();U({visible:!0,x:t.right,y:t.top+t.height/2,building:c})},P=()=>{U({visible:!1,x:0,y:0,building:null}),q({visible:!1,x:0,y:0,buildingId:null})},S=(e,c)=>{var l;const t=e.currentTarget.getBoundingClientRect(),i=((l=e.currentTarget.closest(".scrollable-content"))==null?void 0:l.getBoundingClientRect())||document.body.getBoundingClientRect();q({visible:!0,x:t.right-i.left+10,y:t.top-i.top+t.height/2,buildingId:c})},W=()=>{q({visible:!1,x:0,y:0,buildingId:null})},T=e=>{var x;if(!G)return;const c=((x=r.nationalProjects[e])==null?void 0:x.level)||0;if(c>=A)return;const t=I(e,c+1),i=r.buildings[e]||n(0);if(i.lt(10))return;const l=_[c+1]||0;i.lt(l)||r.gold.lt(t.gold)||Q(f=>F(N({},f),{gold:f.gold.minus(t.gold),nationalProjects:F(N({},f.nationalProjects),{[e]:{level:c+1,active:!1,startTime:0,endTime:0}})}))},ee=(e,c)=>{var p;let t=c;const i=((p=r.weather)==null?void 0:p.current)||"clear";i==="sunny"&&(e==="peasant"||e==="field")?t=t.times(n(1.2)):i==="rainy"&&(e==="silver_mine"||e==="alchemist")?t=t.times(n(1.2)):i==="stormy"?(e==="blacksmith"&&(t=t.times(n(1.3))),e==="field"&&(t=t.times(n(.8)))):i==="windy"&&e==="market"&&(t=t.times(n(1.15)));let l=n(1),x=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(g=>x+=g.level||0);const f=1+x*$;l=l.times(n(f));const v=n(1).plus(r.renown.times(.01));return l=l.times(v),t.times(l)},b=(e,c)=>{if(!X.find(C=>C.id===e)||c.lt(10))return"var(--border-color)";const l=(r.nationalProjects[e]||{level:0}).level;if(l>=A)return"var(--gold-color)";const f=l+1,v=I(e,f),p=_[f]||0,g=c.gte(p);return r.gold.gte(v.gold)&&g?"var(--accent-color)":"var(--text-secondary)"},te=(e,c)=>{const t=X.find(C=>C.id===e);if(!t||!G||c.lt(10))return null;const l=(r.nationalProjects[e]||{level:0}).level,x=l>=A,f=l+1,v=I(e,f),p=_[f]||0,g=c.gte(p),h=r.gold.gte(v.gold),s=h&&g;return o.jsxs("div",{style:{padding:"10px",background:"var(--panel-bg)",border:"2px solid var(--accent-color)",borderRadius:"8px",fontSize:"0.8rem",color:"var(--text-color)",minWidth:"200px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[o.jsxs("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"var(--accent-color)"},children:["üèóÔ∏è ",t.name.replace(" Infrastructure","")," - Lvl ",l,"/",A]}),o.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.75rem",color:"var(--text-secondary)"},children:["Current Bonus: +",(l*$*100).toFixed(0),"% Global"]}),x?o.jsx("div",{style:{textAlign:"center",padding:"5px",color:"var(--gold-color)",fontWeight:"bold",fontSize:"0.7rem",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAX LEVEL"}):o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:"0.7rem",marginBottom:"5px"},children:[o.jsxs("div",{style:{color:h?"var(--success-color)":"var(--error-color)"},children:["üí∞ ",m(v.gold)]}),o.jsxs("div",{style:{color:g?"var(--success-color)":"var(--error-color)"},children:["üè† ",p," buildings"]})]}),o.jsx("div",{style:{fontSize:"0.7rem",color:s?"var(--success-color)":"var(--error-color)",textAlign:"center",fontWeight:"bold"},children:s?"Click to upgrade!":"Requirements not met"})]})]})};let K=0;return o.jsxs("div",{style:de,children:[o.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[n(1),n(10),n(100),n(500),n(1e3),n(-1)].map(e=>o.jsx("button",{onClick:()=>E(e),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:u.equals(e)?"var(--accent-color)":"var(--panel-bg)",color:u.equals(e)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:e.equals(n(-1))?"Max":`${e.toString()}`},`amount-${e.toString()}`))}),o.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 ‚Ä¢ Hold Shift: x100"}),o.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[o.jsx("button",{className:"btn",style:{background:L?"var(--panel-bg)":"var(--accent-color)",color:L?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>D(!1),children:"üõí Buy Mode"}),o.jsx("button",{className:"btn",style:{background:L?"#e65100":"var(--panel-bg)",color:L?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>D(!0),children:"üí∞ Sell Mode (25%)"})]}),o.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),se.map((e,c)=>{const t=r.buildings[e.id]||n(0),i=r.totalGold.gte(e.baseCost)||t.gt(n(0));if(i||K++,!i&&K>2)return null;if(L){if(t.eq(n(0)))return null;let s;u.equals(n(-1))?s=t:(s=u.times(J),s.gt(t)&&(s=t));const C=z(e.baseCost,t.minus(s),s).times(n(.25)).floor();return ee(e.id,e.baseProduction),o.jsxs("div",{style:O(!0,!1,!1,!1),onClick:()=>a(e.id,s.toNumber()),onMouseEnter:w=>R(w,e),onMouseLeave:P,children:[t.gte(n(10))&&o.jsx("div",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",width:"28px",height:"28px",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},onMouseEnter:w=>S(w,e.id),onMouseLeave:W,onClick:w=>{w.stopPropagation(),T(e.id)},children:o.jsx("svg",{width:"26",height:"26",viewBox:"0 0 12 12",style:{fill:b(e.id,t),filter:b(e.id,t)==="var(--accent-color)"?"drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))":"drop-shadow(0 0 4px rgba(0, 0, 0, 0.3))"},children:o.jsx("path",{d:"M6 1 L10 8 L7 8 L7 11 L5 11 L5 8 L2 8 Z"})})}),o.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center",position:"relative",marginLeft:t.gte(n(10))?"30px":"10px"},children:e.icon}),o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:e.name}),o.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:m(t,r.numberFormat)})]})}),o.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[o.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",m(C,r.numberFormat)]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",m(s,r.numberFormat)]})]})]},e.id)}let l=n(0),x=n(0);u.equals(n(-1))?(l=V(e.baseCost,t,r.gold.div(y)),l.eq(n(0))?(l=n(1),x=ce(e.baseCost,t).times(y).floor()):x=z(e.baseCost,t,l).times(y).floor()):(l=u,x=z(e.baseCost,t,l).times(y).floor());const f=r.gold.gte(x),v=u.equals(n(-1))&&V(e.baseCost,t,r.gold.div(y)).eq(n(0));let p=l,g=x,h=f;return u.equals(n(-1))||(p=l.times(J),g=z(e.baseCost,t,p).times(y).floor(),h=r.gold.gte(g)),O(h&&!v,!1,!i),i&&e.icon,t.gte(n(10))&&(b(e.id,t),b(e.id,t)),i&&e.name,m(t,r.numberFormat),m(u.equals(n(-1))?x:g,r.numberFormat),!u.equals(n(-1))&&m(p,r.numberFormat),e.id,o.jsxs("div",{style:O(h&&!v,!1,!i),onClick:()=>{if(!(h&&!v))return;const s=u.equals(n(-1))?l:p;d(e.id,s.toNumber())},onMouseEnter:s=>R(s,e),onMouseLeave:P,children:[t.gte(n(10))&&o.jsx("div",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",width:"28px",height:"28px",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},onMouseEnter:s=>S(s,e.id),onMouseLeave:W,onClick:s=>{s.stopPropagation(),T(e.id)},children:o.jsx("svg",{width:"26",height:"26",viewBox:"0 0 12 12",style:{fill:b(e.id,t),filter:b(e.id,t)==="var(--accent-color)"?"drop-shadow(0 0 10px rgba(103, 58, 183, 0.7))":"drop-shadow(0 0 5px rgba(0, 0, 0, 0.5))"},children:o.jsx("path",{d:"M6 1 L10 8 L7 8 L7 11 L5 11 L5 8 L2 8 Z"})})}),o.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center",position:"relative",marginLeft:t.gte(n(10))?"30px":"10px"},children:i?e.icon:"‚ùì"}),o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:i?e.name:"???"}),o.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:m(t,r.numberFormat)})]})}),o.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[o.jsx("div",{style:{color:h&&!v?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:m(u.equals(n(-1))?x:g,r.numberFormat)}),!u.equals(n(-1))&&o.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",m(p,r.numberFormat)]})]})]},e.id)}),o.jsx(ae,{gameState:r,building:B.building,x:B.x,y:B.y,visible:B.visible,onHide:P}),j.visible&&j.buildingId&&o.jsx("div",{style:{position:"absolute",left:j.x,top:j.y-50,zIndex:1e3,pointerEvents:"none"},children:te(j.buildingId,r.buildings[j.buildingId]||n(0))})]})};export{ve as B};
