import{r as Tt,g as Nt}from"./vendor-B--z-fyW.js";import{T as Fe}from"./types-QDLeuxhP.js";import{g as me,A as Qe,C as Et,a as Rt}from"./ui-DkeaSjhf.js";import{t as o,f as y,T as We,A as ct,g as ut,a as te,b as mt,B as be,W as Dt,U as de,c as Te,d as ht,e as At,C as et,h as tt,D as Bt,i as It,S as ot}from"./constants-DWto8SPM.js";import{a as Lt}from"./game-Dc_pgXx_.js";import{I as Mt,B as rt,U as st,D as nt,M as it,A as lt}from"./components-CA3526HW.js";import"firebase/app";import"firebase/firestore";var Pe={exports:{}},ve={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var at;function zt(){if(at)return ve;at=1;var t=Symbol.for("react.transitional.element"),d=Symbol.for("react.fragment");function w(m,c,h){var b=null;if(h!==void 0&&(b=""+h),c.key!==void 0&&(b=""+c.key),"key"in c){h={};for(var v in c)v!=="key"&&(h[v]=c[v])}else h=c;return c=h.ref,{$$typeof:t,type:m,key:b,ref:c!==void 0?c:null,props:h}}return ve.Fragment=d,ve.jsx=w,ve.jsxs=w,ve}var dt;function Ft(){return dt||(dt=1,Pe.exports=zt()),Pe.exports}var e=Ft(),x=Tt();const Pt=Nt(x),Wt=({gameState:t,onGamble:d,onClose:w})=>{const[m,c]=x.useState("coin"),[h,b]=x.useState(10),[v,C]=x.useState(""),[j,O]=x.useState(null),g=()=>{if(t.gold.lt(o(h))){C("Not enough gold!");return}const L=Math.random()>.5;d(h,L),C(L?`Heads! You DOUBLED your money! (+${y(h,t.numberFormat)} Profit)`:`Tails... You lost ${y(h,t.numberFormat)} gold.`),O(null)},H=()=>{if(t.gold.lt(o(h))){C("Not enough gold!");return}const L=Math.floor(Math.random()*6)+1,$=Math.floor(Math.random()*6)+1,P=L+$;O(P);let N=0;if(P===7)C(`Rolled ${P}. A draw! Gold returned.`),d(0,!0);else if(P>7){P>=10?N=2:N=1.5;const I=Math.floor(h*N);d(I,!0),C(`Rolled ${P}! You won ${y(I,t.numberFormat)} gold!`)}else d(h,!1),C(`Rolled ${P}. You lost ${y(h,t.numberFormat)} gold.`)};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{minHeight:"450px"},children:[e.jsx("h2",{style:{borderBottom:"none"},children:"üç∫ The Rusty Tankard"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[e.jsx("button",{className:"btn ",style:{opacity:m==="coin"?1:.6},onClick:()=>c("coin"),children:"Coin Flip"}),e.jsx("button",{className:"btn ",style:{opacity:m==="dice"?1:.6},onClick:()=>c("dice"),children:"High Dice"})]}),e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"20px",borderRadius:"8px",border:"var(--custom-border-width) solid var(--border-color)"},children:[m==="coin"?e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Rules:"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsx("li",{children:"50% Chance to Win."}),e.jsxs("li",{children:["Win: ",e.jsx("strong",{children:"+100% Profit"})," (Doubles your money)."]}),e.jsx("li",{children:"Lose: Lost the bet."})]})]}):e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Dice Rules (Roll 2-12):"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"7:"})," Draw (Bet returned)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"8-9:"})," Win +50% Profit (1.5x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"10-12:"})," Win +100% Profit (2x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"2-6:"})," Loss"]})]})]}),e.jsxs("div",{style:{margin:"20px 0",color:"var(--text-color)"},children:[e.jsx("label",{style:{color:"var(--text-color)"},children:"Bet Amount: "}),e.jsx("input",{type:"number",value:h,onChange:L=>b(Math.max(1,parseInt(L.target.value)||0)),style:{padding:"8px",width:"120px",fontSize:"1rem",border:"var(--custom-border-width) solid var(--border-color)",backgroundColor:"var(--panel-bg)",color:"var(--text-color)"}})]}),m==="dice"&&j!==null&&e.jsxs("div",{style:{fontSize:"3rem",margin:"10px",color:"var(--text-color)"},children:["üé≤ ",j]}),e.jsx("button",{className:"btn",style:{fontSize:"1.2rem",padding:"10px 30px"},onClick:m==="coin"?g:H,children:m==="coin"?"Flip Coin":"Roll Dice"}),v&&e.jsx("div",{style:{marginTop:"15px",fontWeight:"bold",fontSize:"1.1rem",color:v.includes("won")||v.includes("DOUBLED")||v.includes("draw")?"var(--success-color)":"var(--danger-color)"},children:v})]}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx("button",{className:"btn",onClick:w,children:"Leave Tavern"})})]})})},Gt=({gameState:t,onPrestige:d,onClose:w})=>{var $;const m=t.advisorLevels.void_scholar||o(0),h=1+(t.advisors.includes("void_scholar")?m.toNumber()*.1:0),b=o(1e12),v=t.totalGold;let C=o(0),j=!1,O=b.minus(v);if(v.gte(b)){const P=v.dividedBy(b);C=o(Math.floor(Math.pow(P.toNumber(),.33))).times(h),j=C.gt(0)}const g=b.times(Math.pow(Math.floor(C.dividedBy(h).toNumber()+1),3));g.minus(v);const L=me(t.renown.plus(C)).minus(o(1)).times(o(100));return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"üëë Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!(($=t.playerProfile)!=null&&$.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["üí° ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold"}),e.jsx("li",{children:"All Buildings"}),e.jsx("li",{children:"All Gold Upgrades"}),e.jsx("li",{children:"Current Soldiers"})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsx("li",{children:"Artifacts"}),e.jsxs("li",{children:["Current Renown (",y(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"All Renown Upgrades (Permanent)"})]})]}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",y(v,t.numberFormat)]}),e.jsx("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Threshold for first prestige: 1,000,000,000,000 Gold"}),!j&&v.lt(b)&&e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"#cc0000"},children:["Need: ",y(O,t.numberFormat)," more Gold to unlock prestige"]}),j&&e.jsxs(e.Fragment,{children:["You will gain: ",e.jsxs("strong",{children:[y(C,t.numberFormat)," Renown"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["(New Total Renown: ",y(t.renown.plus(C),t.numberFormat),")"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["(Production Bonus: +",L.toNumber().toFixed(1),"%)"]}),C.gt(0)&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"},children:["Next Renown at: ",y(g,t.numberFormat)," total gold"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:w,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:d,disabled:!j,children:j?"Abdicate":v.lt(b)?`Need ${y(O,t.numberFormat)} more Gold to unlock prestige`:"Prestige Unavailable"})]})]})})},Ot=({gameState:t,onClose:d,onHardReset:w,onSave:m,onOpenChangelog:c,onSetTheme:h,onSetNumberFormat:b,onToggleIdleMode:v,onUpdateInterface:C})=>{var we,se,he,xe;const[j,O]=Pt.useState(!1),g=t.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:1,center:1,right:1},borderWidth:4,customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},H=(we=g.layout.left)!=null&&we.toNumber?g.layout.left.toNumber():Number(g.layout.left),L=(se=g.layout.center)!=null&&se.toNumber?g.layout.center.toNumber():Number(g.layout.center),$=(he=g.layout.right)!=null&&he.toNumber?g.layout.right.toNumber():Number(g.layout.right),P=(xe=g.borderWidth)!=null&&xe.toNumber?g.borderWidth.toNumber():Number(g.borderWidth),N=g.customColors||{},I=String(N.bg||""),R=String(N.panel||""),Y=String(N.text||""),B=String(N.secondaryText||""),W=String(N.accent||""),G=String(N.accentHover||""),Q=String(N.gold||""),q=String(N.border||""),K=String(N.success||""),V=String(N.danger||""),X=()=>{j?w():O(!0)},S=(f,ne)=>{C({layout:{...g.layout,[f]:ne}})},T=(f,ne)=>{C({customColors:{...g.customColors,[f]:ne}})},M={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},_={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},Z={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"‚öôÔ∏è Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["üëë Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:H,onChange:f=>S("left",parseFloat(f.target.value)),style:Z}),e.jsx("span",{style:{fontSize:"0.8rem"},children:H})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:L,onChange:f=>S("center",parseFloat(f.target.value)),style:Z}),e.jsx("span",{style:{fontSize:"0.8rem"},children:L})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:$,onChange:f=>S("right",parseFloat(f.target.value)),style:Z}),e.jsx("span",{style:{fontSize:"0.8rem"},children:$})]})]}),e.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),e.jsxs("div",{style:_,children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"1",max:"10",value:P,onChange:f=>C({borderWidth:parseInt(f.target.value)})}),e.jsxs("span",{children:[P,"px"]})]})]}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),e.jsx("input",{type:"checkbox",checked:g.customColors.enabled,onChange:f=>T("enabled",f.target.checked),style:{transform:"scale(1.5)"}})]}),g.customColors.enabled&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",e.jsx("input",{type:"color",value:I,onChange:f=>T("bg",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",e.jsx("input",{type:"color",value:R,onChange:f=>T("panel",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",e.jsx("input",{type:"color",value:q,onChange:f=>T("border",f.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",e.jsx("input",{type:"color",value:Y,onChange:f=>T("text",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",e.jsx("input",{type:"color",value:B,onChange:f=>T("secondaryText",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",e.jsx("input",{type:"color",value:Q,onChange:f=>T("gold",f.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",e.jsx("input",{type:"color",value:W,onChange:f=>T("accent",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",e.jsx("input",{type:"color",value:G,onChange:f=>T("accentHover",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",e.jsx("input",{type:"color",value:K,onChange:f=>T("success",f.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",e.jsx("input",{type:"color",value:V,onChange:f=>T("danger",f.target.value),style:{width:"100%"}})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px",opacity:g.customColors.enabled?.5:1,pointerEvents:g.customColors.enabled?"none":"auto"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",g.customColors.enabled&&"(Disabled)"]}),e.jsx("div",{style:M,children:Object.values(We).map(f=>e.jsx("button",{className:"btn",style:{background:t.theme===f.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===f.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>h(f.id),children:f.name},f.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),e.jsx("div",{style:M,children:["small","medium","large"].map(f=>e.jsx("button",{className:"btn",style:{background:g.fontSize===f?"var(--accent-color)":"var(--panel-bg)",color:g.fontSize===f?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>C({fontSize:f}),children:f},f))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:M,children:["compact","normal","spacious"].map(f=>e.jsx("button",{className:"btn",style:{background:g.density===f?"var(--accent-color)":"var(--panel-bg)",color:g.density===f?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>C({density:f}),children:f},f))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:v,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:g.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>C({showFloatingText:!g.showFloatingText}),children:g.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:g.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>C({showWeatherWidget:!g.showWeatherWidget}),children:g.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:g.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>C({crownAnimations:!g.crownAnimations}),children:g.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:_,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),e.jsx("button",{className:"btn",style:{background:g.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>C({reduceMotion:!g.reduceMotion}),children:g.reduceMotion?"ON":"OFF"})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:M,children:["standard","scientific","plain"].map(f=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===f?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===f?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>b(f),children:f},f))})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:m,children:"Force Save"}),e.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:c,children:"Update Logs"}),e.jsx("button",{className:"btn",style:{backgroundColor:j?"red":"#d32f2f"},onClick:X,children:j?"CONFIRM WIPE?":"Hard Reset"})]}),j&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:d,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},$t=({gameState:t,onHireAdvisor:d,onClose:w})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px double #4a148c",maxWidth:"900px"},children:[e.jsx("h2",{style:{color:"#4a148c",borderBottomColor:"#4a148c"},children:"‚öñÔ∏è Royal Council"}),e.jsxs("div",{style:{marginBottom:"15px",color:"var(--text-secondary)",fontStyle:"italic"},children:["Hire permanent advisors with Renown. ",e.jsx("br",{}),"These buffs persist across abdications. Advisors can be upgraded for better effects."]}),e.jsxs("div",{style:{background:"rgba(103, 58, 183, 0.1)",padding:"10px",borderRadius:"4px",marginBottom:"20px",fontWeight:"bold",color:"#4a148c"},children:["Available Renown: ",y(t.renown,t.numberFormat)," üëë"]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("h3",{style:{color:"#4a148c",marginBottom:"10px"},children:"üë• Royal Advisors"}),e.jsx("div",{style:{display:"grid",gap:"10px",maxHeight:"350px",overflowY:"auto"},children:ct.map(m=>{const c=t.advisors.includes(m.id),h=t.advisorLevels[m.id]||o(0),b=ut(m,h),v=!c&&t.renown.gte(m.cost),C=c&&t.renown.gte(b),j=te(m.id,h);return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:`2px solid ${c?"#4a148c":"var(--border-color)"}`,background:c?"rgba(237, 231, 246, 0.5)":"var(--panel-bg)",borderRadius:"8px",opacity:c||v?1:.6},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginRight:"15px"},children:m.icon}),e.jsxs("div",{style:{flex:1,textAlign:"left"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c?"#4a148c":"var(--text-color)"},children:[m.name," ",c&&`(Level ${y(h,t.numberFormat)})`]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:m.description}),c&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"#4a148c",marginTop:"5px"},children:[m.id==="treasurer"&&`Auto-clicks every ${Math.max(.5,5-(h.toNumber()-1)*.5).toFixed(1)} seconds`,m.id==="warmaster"&&`Speed: +${y(j.times(o(100)),t.numberFormat)}%, Safety: +${y(j.times(o(100)),t.numberFormat)}%`,m.id==="guildmaster"&&`Discount: ${y(j.times(o(100)),t.numberFormat)}%`,m.id==="alchemist"&&`Event chance: x${y(j.plus(o(1)),t.numberFormat)}`,(m.id==="chronomancer"||m.id==="time_keeper")&&`Cooldown reduction: ${y(j.times(o(100)),t.numberFormat)}%`,m.id==="void_scholar"&&`Renown bonus: +${y(j.times(o(100)),t.numberFormat)}%`,m.id==="cosmic_mage"&&`Production bonus: +${y(j.times(o(100)),t.numberFormat)}%`]})]}),e.jsx("div",{style:{minWidth:"120px",textAlign:"right"},children:c?e.jsxs("button",{className:"btn",style:{background:C?"#4a148c":"var(--text-secondary)",fontSize:"0.8rem"},disabled:!C,onClick:()=>d(m.id),children:["Upgrade: ",y(b,t.numberFormat)," üëë"]}):e.jsxs("button",{className:"btn",style:{background:v?"#4a148c":"var(--text-secondary)"},disabled:!v,onClick:()=>d(m.id),children:["Hire: ",y(m.cost,t.numberFormat)," üëë"]})})]},m.id)})})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037"},onClick:w,children:"Close Council"})]})}),_t=({gameState:t,currentGps:d,onClose:w})=>{var Y;const m=Object.values(t.buildings).reduce((B,W)=>B.plus(W),o(0)),c=t.upgrades.length,h=de.length,b=t.achievements.length,v=mt.length;let C="None",j="None",O=-1,g=o(0);be.forEach((B,W)=>{const G=t.buildings[B.id]||o(0);G.gt(o(0))&&W>O&&(O=W,C=B.name),G.gt(g)&&(g=G,j=B.name)});const L=(()=>{let B=o(1);return de.filter(W=>W.type==="click"&&t.upgrades.includes(W.id)).forEach(W=>{W.multiplier&&(B=B.times(W.multiplier))}),(t.activeDecrees.call_to_arms||o(0)).gt(o(Date.now()))&&(B=B.times(o(5))),B=B.times(me(t.renown)),B})(),[$,P]=x.useState("");x.useEffect(()=>{const B=()=>{const G=o(Date.now()).minus(t.startTime),Q=G.dividedBy(o(1e3)),q=Q.minus(Q.dividedBy(o(60)).floor().times(o(60))).floor(),K=G.dividedBy(o(6e4)),V=K.minus(K.dividedBy(o(60)).floor().times(o(60))).floor(),X=G.dividedBy(o(36e5)),S=X.minus(X.dividedBy(o(24)).floor().times(o(24))).floor(),T=G.dividedBy(o(864e5)).floor();let M="";T.gt(o(0))&&(M+=`${T.toString()}d `),S.gt(o(0))&&(M+=`${S.toString()}h `),M+=`${V.toString()}m ${q.toString()}s`,P(M)};B();const W=setInterval(B,1e3);return()=>clearInterval(W)},[t.startTime]);const N={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},I={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},R=((Y=Dt[t.weather.current])==null?void 0:Y.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px"},children:[e.jsx("h2",{children:"üìä Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"10px"},children:[e.jsx("h3",{style:I,children:"‚ö° Current Status"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[y(d,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[y(L,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:R})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",me(t.renown).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:I,children:"‚è≥ Time & Legacy"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:$})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:y(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:I,children:"üí∞ Economy Summary"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:y(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:y(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:I,children:"üè∞ Dominion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:y(m,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:C})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[j," (",y(g,t.numberFormat),")"]})]}),e.jsx("h3",{style:I,children:"üéñÔ∏è Completion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[b," / ",v," (",Math.floor(b/v*100),"%)"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Upgrades:"}),e.jsxs("span",{children:[c," / ",h," (",Math.floor(c/h*100),"%)"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Artifacts:"}),e.jsxs("span",{children:[t.artifacts.length," Found"]})]}),e.jsx("h3",{style:I,children:"‚öîÔ∏è Military & Court"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Standing Army:"}),e.jsxs("strong",{children:[y(t.soldiers,t.numberFormat)," Soldiers"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Royal Advisors:"}),e.jsxs("span",{children:[t.advisors.length," Hired"]})]}),e.jsx("h3",{style:I,children:"üìà Player Stats"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:y(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:y(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:y(t.stats.tavernGamesPlayed,t.numberFormat)})]})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%"},onClick:w,children:"Close Records"})]})})},Ut=({gameState:t,onInvestTrade:d,onBuildWonder:w,onClose:m})=>{const[c,h]=x.useState("trade"),b=(t.wonders.great_pyramid||0)>=3;return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px",width:"95%",height:"80vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"üëë Imperial Management"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"15px"},children:[e.jsx("button",{className:"tab-btn",style:{background:c==="trade"?"var(--gold-color)":"transparent",color:c==="trade"?"var(--text-color)":"var(--text-on-accent)",borderBottom:c==="trade"?"2px solid var(--text-color)":"none"},onClick:()=>h("trade"),children:"Trade Routes"}),e.jsx("button",{className:"tab-btn",style:{background:c==="wonders"?"var(--gold-color)":"transparent",color:c==="wonders"?"var(--text-color)":"var(--text-on-accent)",borderBottom:c==="wonders"?"2px solid var(--text-color)":"none"},onClick:()=>h("wonders"),children:"Great Wonders"})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[c==="trade"&&e.jsx(Ht,{gameState:t,onInvestTrade:d,hasPyramid:b}),c==="wonders"&&e.jsx(Yt,{gameState:t,onBuildWonder:w})]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:m,children:"Return to Kingdom"})})]})})},Ht=({gameState:t,onInvestTrade:d,hasPyramid:w})=>{var $,P,N,I;const[m,c]=x.useState(null),[h,b]=x.useState(0),[v,C]=x.useState(0),[j,O]=x.useState(0),g=t.activeTradeRoutes||[],H=()=>{m&&(d(m.id,h,v,{knight:j}),c(null),b(0),C(0),O(0))},L=R=>{const Y=o(v).plus(o(j).times(o(50))),B=o(Math.max(100,h/100)),W=o(Math.min(.9,Y.dividedBy(B).toNumber()));let G=R.risk.times(o(1).minus(W));return w&&(G=G.times(o(.5))),G};return e.jsxs("div",{children:[e.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Active Caravans"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"10px",marginBottom:"30px"},children:[g.length===0&&e.jsx("div",{style:{color:"var(--text-secondary)"},children:"No active trade routes."}),g.map(R=>{var q,K;const Y=Te.find(V=>V.id===R.routeId);if(!Y)return null;const B=(q=R.startTime)!=null&&q.toNumber?R.startTime.toNumber():Number(R.startTime),W=(K=R.duration)!=null&&K.toNumber?R.duration.toNumber():Number(R.duration),G=(Date.now()-B)/1e3,Q=Math.min(100,G/W*100);return e.jsxs("div",{style:{padding:"10px",border:"1px solid var(--accent-color)",borderRadius:"4px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[Y.icon," ",Y.name]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["Invested: ",y(R.goldInvested,t.numberFormat)]}),e.jsx("div",{style:{width:"100%",height:"10px",background:"var(--bg-color)",marginTop:"5px",borderRadius:"5px"},children:e.jsx("div",{style:{width:`${Q}%`,height:"100%",background:"var(--success-color)",borderRadius:"5px",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem",color:"var(--text-secondary)"},children:[Math.ceil(W-G),"s left"]})]},R.id)})]}),e.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Establish New Route"}),m?e.jsxs("div",{style:{padding:"20px",border:"2px solid var(--accent-color)",borderRadius:"8px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsxs("h4",{style:{margin:0,color:"var(--text-color)"},children:[m.icon," ",m.name]}),e.jsx("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},onClick:()=>c(null),children:"Cancel"})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"block",fontWeight:"bold"},children:["Gold Investment (Max ",y(m.maxInvestment,t.numberFormat),")"]}),e.jsx("input",{type:"range",min:"0",max:Math.min(($=t.gold)!=null&&$.toNumber?t.gold.toNumber():Number(t.gold),(P=m.maxInvestment)!=null&&P.toNumber?m.maxInvestment.toNumber():Number(m.maxInvestment)),value:h,onChange:R=>b(parseInt(R.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{textAlign:"right"},children:[y(h,t.numberFormat)," G"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Soldier Escort"}),e.jsx("input",{type:"number",min:"0",max:(N=t.soldiers)!=null&&N.toNumber?t.soldiers.toNumber():Number(t.soldiers),value:v,onChange:R=>C(parseInt(R.target.value)),style:{width:"100%",padding:"5px"}}),e.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",y(t.soldiers,t.numberFormat)]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Knight Escort"}),e.jsx("input",{type:"number",min:"0",max:(I=t.eliteUnits.knight)!=null&&I.toNumber?t.eliteUnits.knight.toNumber():Number(t.eliteUnits.knight||0),value:j,onChange:R=>O(parseInt(R.target.value)),style:{width:"100%",padding:"5px"}}),e.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",y(t.eliteUnits.knight||0,t.numberFormat)]})]})]}),e.jsxs("div",{style:{background:"#fff",padding:"10px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Projected Return:"})," ",y(o(h).times(m.rewardMultiplier),t.numberFormat)," G"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Duration:"})," ",(()=>{var B;const R=(B=m.baseDuration)!=null&&B.toNumber?m.baseDuration.toNumber():Number(m.baseDuration),Y=w?R*.5:R;return Math.ceil(Y)/60})()," min"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Risk:"})," ",e.jsxs("span",{style:{color:L(m).gt(o(.3))?"red":"green"},children:[L(m).times(o(100)).toFixed(1),"%"]})]})]}),e.jsx("button",{className:"btn",style:{width:"100%"},disabled:h<=0||v===0&&j===0,onClick:H,children:"Dispatch Caravan"})]}):e.jsx("div",{style:{display:"grid",gap:"10px"},children:Te.map(R=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:"1px solid var(--border-color)",borderRadius:"4px",cursor:"pointer",background:"var(--panel-bg)",color:"var(--text-color)"},onClick:()=>c(R),children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px"},children:R.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold"},children:R.name}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:R.description}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--success-color)"},children:["Max Profit: ",y(R.rewardMultiplier,t.numberFormat),"x"]})]}),e.jsx("button",{className:"btn",style:{fontSize:"0.8rem"},children:"Select"})]},R.id))})]})},Yt=({gameState:t,onBuildWonder:d})=>{const w=c=>{for(const h of c)if(h.type==="gold"&&t.gold.lt(o(h.amount))||h.type==="soldiers"&&t.soldiers.lt(o(h.amount))||h.type==="renown"&&t.renown.lt(o(h.amount))||["knight","paladin","void_sentinel"].includes(h.type)&&(t.eliteUnits[h.type]||o(0)).lt(o(h.amount)))return!1;return!0},m=c=>c.map((h,b)=>e.jsxs("span",{style:{marginRight:"10px",color:w([h])?"green":"red"},children:[y(h.amount,t.numberFormat)," ",h.type==="gold"?"G":h.type]},b));return e.jsx("div",{style:{display:"grid",gap:"20px"},children:ht.map(c=>{const h=t.wonders[c.id]||0,b=h>=c.stages.length,v=b?null:c.stages[h],C=v?w(v.cost):!1;return e.jsxs("div",{style:{border:"2px solid var(--accent-color)",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("div",{style:{background:b?"var(--gold-color)":"var(--bg-color)",padding:"15px",display:"flex",alignItems:"center",color:"var(--text-color)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginRight:"15px"},children:c.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{margin:0,color:"var(--text-color)"},children:c.name}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:c.description}),e.jsxs("div",{style:{marginTop:"5px",fontWeight:"bold",color:"var(--accent-color)"},children:["Bonus: ",c.bonusDescription]})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-color)"},children:b?"COMPLETED":`${h} / ${c.stages.length}`})]}),!b&&v&&e.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[e.jsxs("h4",{style:{marginTop:0,color:"var(--text-color)"},children:["Next Stage: ",v.name]}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:v.description}),e.jsxs("div",{style:{background:"var(--bg-color)",padding:"10px",borderRadius:"4px",marginBottom:"15px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Requirements: "}),m(v.cost)]}),e.jsxs("button",{className:"btn",style:{width:"100%",background:C?"var(--accent-color)":"var(--border-color)"},disabled:!C,onClick:()=>d(c.id),children:["Build Stage (",h+1,")"]})]}),b&&e.jsx("div",{style:{padding:"10px",background:"var(--bg-color)",textAlign:"center",color:"var(--gold-color)",fontWeight:"bold"},children:"This Wonder stands eternal."})]},c.id)})})},qt=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(d=>e.jsxs("div",{className:`toast ${d.type}`,children:[d.type==="success"&&"‚úÖ",d.type==="warning"&&"‚ö†Ô∏è",d.type==="info"&&"‚ÑπÔ∏è",d.type==="error"&&"‚ùå",e.jsx("span",{children:d.message})]},d.id))}),Vt=()=>{const[t,d]=x.useState(null);if(x.useEffect(()=>{const m=b=>{const C=b.target.closest("[data-tooltip]");if(C){const j=C.getAttribute("data-tooltip");j&&d({text:j,x:b.clientX,y:b.clientY})}else d(null)},c=b=>{t&&d(v=>v?{...v,x:b.clientX,y:b.clientY}:null)},h=()=>{d(null)};return document.addEventListener("mouseover",m),document.addEventListener("mousemove",c),document.addEventListener("mouseout",h),()=>{document.removeEventListener("mouseover",m),document.removeEventListener("mousemove",c),document.removeEventListener("mouseout",h)}},[t]),!t)return null;const w={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(w.left=t.x-260),t.y+100>window.innerHeight&&(w.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:w,children:t.text})};function Jt(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}async function Kt(t){return console.log("üöÄ Mock: –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥ (production mode)"),{allTimeId:t.rulerId,weeklyId:t.rulerId}}async function Xt(t=100){return console.log("üîç Mock: –ó–∞–≥—Ä—É–∑–∫–∞ all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (production mode)"),[]}async function Zt(t=100){return console.log("üîç Mock: –ó–∞–≥—Ä—É–∑–∫–∞ weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (production mode)"),[]}const Qt=({isOpen:t,onClose:d,onConfirm:w,gameState:m})=>{const[c,h]=x.useState(""),[b,v]=x.useState(!1);if(!t)return null;const C=async()=>{if(c.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(c.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}v(!0);try{const O={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:c.trim(),rulerId:Jt(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};w(O),d()}catch{alert("An error occurred while creating profile. Please try again.")}finally{v(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"üëë Royal Coronation! üëë"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:eo(m.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:c,onChange:j=>h(j.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:j=>j.key==="Enter"&&C()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[c.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"‚ö†Ô∏è Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:C,disabled:b||c.trim().length<3,style:{padding:"12px 24px",backgroundColor:b||c.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:b||c.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:b?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:d,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:j=>{j.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:j=>{j.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function eo(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const to=({isOpen:t,onClose:d,playerProfile:w,onOpenRulerNameModal:m,gameState:c})=>{const[h,b]=x.useState([]),[v,C]=x.useState([]),[j,O]=x.useState("alltime"),[g,H]=x.useState(!1),[L,$]=x.useState(null),[P,N]=x.useState(0),[I,R]=x.useState(0),Y=()=>{const S=localStorage.getItem("leaderboardCache");if(S)try{const{data:T,timestamp:M}=JSON.parse(S),_=Date.now(),Z=3600*1e3;if(_-M<Z&&T&&T.allTime&&T.weekly)return T}catch(T){console.error("Cache parse error:",T)}return null},B=S=>{const T={data:S,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(T)),R(Date.now())},W=()=>{const S=localStorage.getItem("leaderboardCache");if(S){const{timestamp:T}=JSON.parse(S),M=Date.now(),_=3600*1e3;return M-T<_}return!1};x.useEffect(()=>{if(t){if(W())try{const S=Y();if(S){b(S.allTime),C(S.weekly);const T=JSON.parse(localStorage.getItem("leaderboardCache"));R(T.timestamp);return}}catch(S){console.error("Cache read error:",S)}G()}},[t]);const G=async()=>{H(!0),$(null);try{const S=new Promise((_,Z)=>setTimeout(()=>Z(new Error("Loading timeout")),1e4)),[T,M]=await Promise.all([Promise.race([Xt(50),S]),Promise.race([Zt(50),S])]);b(T),C(M),B({allTime:T,weekly:M}),console.log("Leaderboard data loaded successfully!")}catch(S){console.error("Error loading leaderboard:",S),$("Failed to load leaderboard. Please check your internet connection and try again.")}finally{H(!1)}},Q=S=>{switch(S){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`#${S}`}},q=()=>w?(j==="alltime"?h:v).findIndex(T=>T.rulerId===w.rulerId)+1:-1,K=()=>{const S=j==="alltime"?h:v;if(S.length>0){let T=0;if(S.forEach(M=>{if(M.timestamp){let _=0;typeof M.timestamp=="object"&&M.timestamp.toDate?_=M.timestamp.toDate().getTime():typeof M.timestamp=="number"?_=M.timestamp:typeof M.timestamp=="string"&&(_=new Date(M.timestamp).getTime()),_>T&&(T=_)}}),T>0)return T}return I},V=j==="alltime"?h:v,X=V.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"üèÜ Leaderboard üèÜ"}),e.jsx("button",{className:"btn",onClick:d,children:"Close"})]}),!w&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"üëÅ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),m&&c&&c.gold&&c.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{d(),m()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"üëë Choose Ruler Name"})]}),X&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["üìä Data updated ",Math.floor((Date.now()-K())/6e4)," minutes ago"]})}),g&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),L&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:L}),w&&X&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["üëë You are playing as: ",w.rulerName," ",w.rulerId]}),V.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",q()>0?`#${q()}`:"Not ranked yet"," in ",j==="alltime"?"All Time":"Weekly"]})]}),X&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>O("alltime"),className:j==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>O("weekly"),className:j==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),X&&!g&&!L&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),e.jsx("tbody",{children:V.map((S,T)=>e.jsxs("tr",{style:{backgroundColor:(w==null?void 0:w.rulerId)===S.rulerId?"rgba(191, 144, 0, 0.1)":T%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:Q(T+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:S.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:S.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:y(S.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:y(S.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:S.buildings})]},S.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"üí° Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},re={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},ae={gold:o(0),totalGold:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},upgrades:[],achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},artifacts:[],advisors:[],advisorLevels:{},intermediateGoods:{},wonders:{},activeTradeRoutes:[],weather:{current:"clear",timeLeft:o(120)},activeDecrees:{},decreeCooldowns:{},conquest:{active:!1,crusadeId:null,startTime:o(0),soldiersSent:o(0)},event:null,theme:"royal_dawn",numberFormat:"standard",idleModeEnabled:!0,interface:re,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},je=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(je);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const d={};for(const w in t)t.hasOwnProperty(w)&&(d[w]=je(t[w]));return d}return t},mo=()=>{var Ke,Xe;const[t,d]=x.useState(()=>{var r,n,a,p,u,l,A;const s=localStorage.getItem("kingdom_save");if(s)try{const i=JSON.parse(s),D=i.interface||{},U={...re,...D,lastBuyAmount:o(D.lastBuyAmount??1),crownAnimations:D.crownAnimations??!0,layout:{left:o(((r=D.layout)==null?void 0:r.left)??re.layout.left),center:o(((n=D.layout)==null?void 0:n.center)??re.layout.center),right:o(((a=D.layout)==null?void 0:a.right)??re.layout.right)},borderWidth:o(D.borderWidth??re.borderWidth),customColors:{...re.customColors,...D.customColors||{}}};return{...ae,...i,renown:o(i.renown||0),prestigeCount:i.prestigeCount||0,gold:o(i.gold||0),totalGold:o(i.totalGold||0),startTime:o(i.startTime||Date.now()),lastSaveTime:o(i.lastSaveTime||Date.now()),soldiers:o(i.soldiers||0),buildings:Object.keys(i.buildings||{}).reduce((k,z)=>(k[z]=o(i.buildings[z]),k),{}),stats:{...ae.stats,...i.stats||{},totalClicks:o(((p=i.stats)==null?void 0:p.totalClicks)||0),dragonsKilled:o(((u=i.stats)==null?void 0:u.dragonsKilled)||0),tavernGamesPlayed:o(((l=i.stats)==null?void 0:l.tavernGamesPlayed)||0)},eliteUnits:Object.keys(i.eliteUnits||{}).reduce((k,z)=>(k[z]=o(i.eliteUnits[z]),k),{}),advisors:i.advisors||[],advisorLevels:Object.keys(i.advisorLevels||{}).reduce((k,z)=>(k[z]=o(i.advisorLevels[z]),k),{}),intermediateGoods:Object.keys(i.intermediateGoods||{}).reduce((k,z)=>{const ee=i.intermediateGoods[z];return k[z]={level:o(ee.level||0),lastClickTime:o(ee.lastClickTime||Date.now())},k},{}),wonders:Object.keys(i.wonders||{}).reduce((k,z)=>(k[z]=o(i.wonders[z]),k),{}),activeTradeRoutes:(i.activeTradeRoutes||[]).map(k=>({id:k.id,routeId:k.routeId,startTime:o(Number(k.startTime)||0),duration:o(Number(k.duration)||0),goldInvested:o(k.goldInvested||0),soldiersSent:o(k.soldiersSent||0),eliteSent:Object.keys(k.eliteSent||{}).reduce((z,ee)=>(z[ee]=o(k.eliteSent[ee]||0),z),{})})),weather:i.weather?{...i.weather,timeLeft:o(Number(i.weather.timeLeft)||120)}:ae.weather,conquest:{...ae.conquest,...i.conquest||{},startTime:o(Number((A=i.conquest)==null?void 0:A.startTime)||Date.now())},activeDecrees:Object.keys(i.activeDecrees||{}).reduce((k,z)=>(k[z]=o(i.activeDecrees[z]),k),{}),decreeCooldowns:Object.keys(i.decreeCooldowns||{}).reduce((k,z)=>(k[z]=o(i.decreeCooldowns[z]),k),{}),theme:i.theme||"royal_dawn",numberFormat:i.numberFormat||"standard",idleModeEnabled:i.idleModeEnabled!==void 0?i.idleModeEnabled:!0,interface:U,playerProfile:i.playerProfile?{...i.playerProfile,lastLeaderboardSubmit:i.playerProfile.lastLeaderboardSubmit||0}:null}}catch(i){console.error("Save load failed",i)}return ae}),w=x.useRef(t);x.useEffect(()=>{w.current=t},[t]);const[m,c]=x.useState(!1);x.useEffect(()=>{let s;const r=()=>{c(!1),clearTimeout(s),t.idleModeEnabled&&(s=setTimeout(()=>{c(!0)},2e4))};r();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(a=>window.addEventListener(a,r)),()=>{clearTimeout(s),n.forEach(a=>window.removeEventListener(a,r))}},[t.idleModeEnabled]),x.useEffect(()=>{const s=y(t.gold);document.title=`Gold: ${s} - Kingdom Clicker`},[t.gold]),x.useEffect(()=>{var u;const s=document.documentElement,r=t.interface||re;if((u=r.customColors)!=null&&u.enabled){const l=r.customColors;s.style.setProperty("--bg-color",l.bg),s.style.setProperty("--panel-bg",l.panel),s.style.setProperty("--text-color",l.text),s.style.setProperty("--text-secondary",l.secondaryText||"#5d4037"),s.style.setProperty("--text-on-accent","#ffffff"),s.style.setProperty("--accent-color",l.accent),s.style.setProperty("--accent-hover",l.accentHover||l.accent),s.style.setProperty("--gold-color",l.gold||"#bf9000"),s.style.setProperty("--border-color",l.border),s.style.setProperty("--success-color",l.success||"#2e7d32"),s.style.setProperty("--danger-color",l.danger||"#c62828"),s.style.setProperty("--bg-image","none")}else{const l=t.theme||"royal_dawn",A=We[l]||We.royal_dawn;Object.entries(A.colors).forEach(([i,D])=>{s.style.setProperty(i,D)})}const n={small:"14px",medium:"16px",large:"18px"};s.style.setProperty("--base-font-size",n[r.fontSize]);const a={compact:"8px",normal:"12px",spacious:"20px"},p={compact:"6px",normal:"12px",spacious:"16px"};s.style.setProperty("--panel-padding",a[r.density]),s.style.setProperty("--gap-size",p[r.density]),s.style.setProperty("--custom-border-width",`${r.borderWidth}px`),s.style.setProperty("--col-left",String(r.layout.left)),s.style.setProperty("--col-center",String(r.layout.center)),s.style.setProperty("--col-right",String(r.layout.right)),r.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[h,b]=x.useState(!1);x.useEffect(()=>{var s;t.gold.gte(o(1e7))&&!((s=t.playerProfile)!=null&&s.hasChosenName)&&!h&&xe(!0)},[t.gold,t.playerProfile,h]);const[v,C]=x.useState(null),[j,O]=x.useState([]),[g,H]=x.useState("buildings"),[L,$]=x.useState("army"),[P,N]=x.useState(!1),[I,R]=x.useState("throne");x.useEffect(()=>{const s=()=>{N(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const[Y,B]=x.useState(!1),[W,G]=x.useState(!1),[Q,q]=x.useState(!1),[K,V]=x.useState(!1),[X,S]=x.useState(!1),[T,M]=x.useState(!1),[_,Z]=x.useState(!1),[we,se]=x.useState(!1),[he,xe]=x.useState(!1),[f,ne]=x.useState(!1),E=(s,r="info")=>{const n=Date.now().toString()+Math.random();O(a=>[...a,{id:n,message:s,type:r}]),setTimeout(()=>{O(a=>a.filter(p=>p.id!==n))},3e3)};x.useEffect(()=>{const s=r=>r.preventDefault();return document.addEventListener("contextmenu",s),()=>document.removeEventListener("contextmenu",s)},[]),x.useEffect(()=>{const s=Date.now();if(t.lastSaveTime&&o(s).minus(t.lastSaveTime).gt(o(6e4))){const r=o(s).minus(t.lastSaveTime).dividedBy(o(1e3)),n=Ce(t),a=t.advisorLevels.dream_warden||o(0),p=t.advisors.includes("dream_warden")?te("dream_warden",a):o(0),u=Lt.min(p,o(1)),l=n.times(r).times(u).floor();if(l.gt(o(0))){const A=u.gt(0)?` (+${y(u.times(100),t.numberFormat)}% Dream Warden)`:"";E(`While you were away, you earned ${y(l,t.numberFormat)} gold!${A}`,"success"),d(i=>({...i,gold:i.gold.plus(l),totalGold:i.totalGold.plus(l)}))}}},[]),x.useEffect(()=>{const s=setInterval(()=>{Date.now()%3e4<1e3&&d(r=>{const n={...r,lastSaveTime:o(Date.now())},a=je(n);return localStorage.setItem("kingdom_save",JSON.stringify(a)),n})},1e3);return()=>clearInterval(s)},[]),x.useEffect(()=>{const s=()=>{const n=w.current,a=je(n);localStorage.setItem("kingdom_save",JSON.stringify(a))};window.addEventListener("beforeunload",s);const r=()=>{document.visibilityState==="hidden"&&s()};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("beforeunload",s),document.removeEventListener("visibilitychange",r)}},[]),x.useEffect(()=>{var r;if(!((r=t.playerProfile)!=null&&r.hasChosenName))return;const s=setInterval(()=>{const n=Date.now(),a=t.playerProfile.lastLeaderboardSubmit||0,p=3600*1e3;n-a>=p&&Kt({rulerName:t.playerProfile.rulerName,rulerId:t.playerProfile.rulerId,gold:t.gold,renown:t.renown,buildings:Object.keys(t.buildings).length,achievements:t.achievements.length}).then(()=>{d(u=>({...u,playerProfile:{...u.playerProfile,lastLeaderboardSubmit:Date.now()}})),E("Leaderboard data submitted successfully!","success")}).catch(u=>{console.error("Auto leaderboard submission failed:",u)})},6e4);return()=>clearInterval(s)},[(Ke=t.playerProfile)==null?void 0:Ke.hasChosenName,(Xe=t.playerProfile)==null?void 0:Xe.lastLeaderboardSubmit,t.gold,t.renown,t.buildings,t.achievements]),x.useRef(0),x.useEffect(()=>{if(t.advisors.includes("treasurer")){const s=t.advisorLevels.treasurer||o(1),r=Math.max(.5,5-(s.toNumber()-1)*.5),n=setInterval(()=>{Ne(!0)},r*1e3);return()=>clearInterval(n)}},[t.advisors,t.advisorLevels]),x.useEffect(()=>{const s=setInterval(()=>{if(!t.event){t.advisors.includes("alchemist");const r=t.advisorLevels.alchemist||o(1),n=.05,a=te("alchemist",r),p=n*a.toNumber();if(Math.random()<p){const u=["dragon","merchant","jester"],l=u[Math.floor(Math.random()*u.length)],A={id:Date.now().toString(),type:l,expiresAt:o(Date.now()).plus(o(l==="dragon"?1e4:3e4)),hp:l==="dragon"?o(10):void 0,maxHp:l==="dragon"?o(10):void 0,reward:o(0)};d(i=>({...i,event:A}))}}},1e4);return()=>clearInterval(s)},[t.event,t.advisors,t.advisorLevels]);const Ce=s=>{var p,u;let r=o(0);const n=((p=s.weather)==null?void 0:p.current)||"clear";be.forEach(l=>{const A=s.buildings[l.id]||o(0);let i=l.baseProduction;n==="sunny"?(l.id==="peasant"||l.id==="field"||l.id==="stable"||l.id==="cathedral")&&(i=i.times(o(1.2))):n==="rainy"?(l.id==="silver_mine"||l.id==="alchemist"||l.id==="market"||l.id==="tavern")&&(i=i.times(o(1.2))):n==="stormy"?((l.id==="blacksmith"||l.id==="void_portal")&&(i=i.times(o(1.3))),(l.id==="field"||l.id==="stable")&&(i=i.times(o(.8)))):n==="windy"?(l.id==="market"||l.id==="castle"||l.id==="time_chamber")&&(i=i.times(o(1.15))):n==="snowy"?((l.id==="castle"||l.id==="cathedral"||l.id==="palace")&&(i=i.times(o(1.25))),(l.id==="field"||l.id==="stable")&&(i=i.times(o(.85)))):n==="foggy"?((l.id==="alchemist"||l.id==="time_chamber")&&(i=i.times(o(1.15))),(l.id==="market"||l.id==="tavern")&&(i=i.times(o(.9)))):n==="blizzard"?((l.id==="void_portal"||l.id==="astral_rift")&&(i=i.times(o(1.4))),l.id!=="void_portal"&&l.id!=="astral_rift"&&l.id!=="time_chamber"&&(i=i.times(o(.75)))):n==="heatwave"?((l.id==="blacksmith"||l.id==="silver_mine"||l.id==="reality_engine")&&(i=i.times(o(1.35))),(l.id==="stable"||l.id==="cathedral")&&(i=i.times(o(.8)))):n==="mystic"&&(l.id==="alchemist"||l.id==="void_portal"||l.id==="time_chamber"||l.id==="reality_engine")&&(i=i.times(o(1.2))),r=r.plus(A.times(i))});let a=o(1);if(de.forEach(l=>{if(s.upgrades.includes(l.id)&&(l.type==="global"&&l.multiplier&&(a=a.times(l.multiplier)),l.type==="building"&&l.multiplier&&l.targetId)){const A=be.find(i=>i.id===l.targetId);if(A){const i=s.buildings[l.targetId]||o(0);r=r.plus(i.times(A.baseProduction).times(l.multiplier.minus(o(1))))}}}),s.upgrades.includes("army_synergy")){const l=s.soldiers.dividedBy(o(1e3)).times(o(.01));a=a.times(o(1).plus(l))}if(s.upgrades.includes("achievement_synergy")){const l=o(s.achievements.length).times(o(.05));a=a.times(o(1).plus(l))}if(s.upgrades.includes("click_synergy")){const l=s.stats.totalClicks.times(o(1e-4));a=a.times(o(1).plus(l))}if(s.advisors.includes("cosmic_mage")){const l=s.advisorLevels.cosmic_mage||o(0),A=s.advisors.includes("cosmic_mage")?te("cosmic_mage",l):o(0),i=o(1).plus(A);a=a.times(i)}return(((u=s.wonders)==null?void 0:u.sky_citadel)||o(0)).gte(o(3))&&(a=a.times(o(100))),s.artifacts.forEach(l=>{const A=At.find(i=>i.id===l);A&&(a=a.times(A.globalMultiplier))}),a=a.times(me(s.renown).plus(o(s.achievements.length*.02))),(s.activeDecrees.royal_feast||o(0)).gt(o(Date.now()))&&(a=a.times(o(2))),r=r.times(a),r},ge=Ce(t),oe=x.useRef(ge);oe.current=ge,x.useEffect(()=>{const s=setInterval(()=>{d(r=>{const n=Date.now(),a=oe.current.times(o(Fe)).dividedBy(o(1e3));let p=r.totalGold.plus(a),u=r.gold.plus(a),l={...r.weather};const A=o(Fe/1e3);if(l.timeLeft=l.timeLeft.minus(A),l.timeLeft.lte(o(0))){const F=["clear","sunny","rainy","stormy","windy"],J=F[Math.floor(Math.random()*F.length)],ie=o(Math.floor(Math.random()*120)+60);l={current:J,timeLeft:ie}}let i=r.event;i&&i.expiresAt&&o(i.expiresAt).lt(o(n))&&(i=null);let D={...r.intermediateGoods},U=o(0);if(U.gt(0)){const F=gt(r),J=U.times(F);u=u.plus(J),p=p.plus(J)}let k={...r.conquest},z=[...r.artifacts],ee=r.soldiers;if(k.active&&k.crusadeId){const F=et.find(J=>J.id===k.crusadeId);if(F){const J=t.advisorLevels.warmaster||o(0),ie=t.advisors.includes("warmaster")?te("warmaster",J):o(0);let ye=o(1).minus(ie);const Ie=ie.times(o(2));r.weather.current==="windy"&&(ye=ye.times(o(.8)));const Ze=o(F.duration).times(o(ye));if(o((n-o(k.startTime).toNumber())/1e3).gte(Ze)){r.advisors.includes("warmaster");const Se=F.baseRisk.minus(Ie),ue=Math.random();if(ue<Se.toNumber()){const le=(k.soldiersSent||F.soldierCost).times(o(.5)).floor();ee=ee.plus(le),E(`Crusade Failed! Our army retreats. ${y(le,t.numberFormat)} soldiers returned.`,"error")}else if(ue>.9){z.includes(F.rewardArtifactId)||z.push(F.rewardArtifactId);const le=oe.current.times(o(300));u=u.plus(le),E(`CRITICAL VICTORY! Found ${F.name} Artifact and ${y(le.floor(),t.numberFormat)} Gold!`,"success")}else z.includes(F.rewardArtifactId)?E(`Victory! Crusade ${F.name} complete (Artifact already owned).`,"info"):(z.push(F.rewardArtifactId),E(`Victory! Retrieved Artifact from ${F.name}`,"success"));k={active:!1,crusadeId:null,startTime:o(0),soldiersSent:o(0)}}}}let ke=[...r.activeTradeRoutes||[]];ke.length,ke=ke.filter(F=>{var Le,Se;const J=Te.find(ue=>ue.id===F.routeId);if(!J)return!1;const ie=(((Le=r.wonders)==null?void 0:Le.great_pyramid)||o(0)).gte(3),ye=ie?.5:1,Ie=o(F.duration).times(o(ye));if(o((n-o(F.startTime).toNumber())/1e3).gte(Ie)){const ue=o(F.soldiersSent).plus(o(((Se=F.eliteSent)==null?void 0:Se.knight)||0).times(o(50))),le=o(Math.max(100,o(F.goldInvested).dividedBy(o(100)).toNumber())),St=o(Math.min(.9,ue.dividedBy(le).toNumber()));let Me=J.risk.times(o(1).minus(St));if(ie&&(Me=Me.times(o(.5))),Math.random()>Me.toNumber()){const ze=o(F.goldInvested).times(J.rewardMultiplier);u=u.plus(ze),p=p.plus(ze),E(`Caravan returned from ${J.name}! Profit: +${y(ze,r.numberFormat)} Gold`,"success")}else E(`Caravan to ${J.name} was raided! Investment lost.`,"error");return!1}return!0});const Ae=[...r.achievements];let Be=null;return mt.forEach(F=>{Ae.includes(F.id)||F.condition({...r,totalGold:p,gold:u},oe.current)&&(Ae.push(F.id),Be=F)}),Be&&(C(Be),setTimeout(()=>C(null),3e3)),{...r,gold:u,totalGold:p,achievements:Ae,event:i,conquest:k,artifacts:z,soldiers:ee,activeTradeRoutes:ke,weather:l,intermediateGoods:D,advisorLevels:r.advisorLevels}})},Fe);return()=>clearInterval(s)},[t.advisors,t.advisorLevels]);const xt=x.useRef(t.artifacts);x.useEffect(()=>{xt.current=t.artifacts},[t.artifacts]);const ce=(s="light")=>{if("vibrate"in navigator&&P)switch(s){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},Ne=(s=!1)=>{s||ce("light");let r=o(1);if(de.filter(n=>n.type==="click"&&w.current.upgrades.includes(n.id)).forEach(n=>{n.multiplier&&(r=r.times(n.multiplier))}),(w.current.activeDecrees.call_to_arms||o(0)).gt(o(Date.now()))&&(r=r.times(o(5))),r=r.times(me(w.current.renown)),w.current.godMode){const a=Ce(w.current).times(o(6e3));r=r.plus(a)}d(n=>({...n,gold:n.gold.plus(r),totalGold:n.totalGold.plus(r),stats:{...n.stats,totalClicks:s?n.stats.totalClicks:n.stats.totalClicks.plus(o(1))}}))},[Ge,Ee]=x.useState(""),[pe,Re]=x.useState(null),[fe,De]=x.useState(null);x.useEffect(()=>{const s=r=>{const n=r.target;if(!(n.tagName==="INPUT"||n.tagName==="TEXTAREA")&&r.key.length===1&&/[a-zA-Z]/.test(r.key)){r.preventDefault(),pe||Re(Date.now());const a=Ge+r.key.toLowerCase();if(Ee(a),a==="godon"||a==="godoff"){const p=Date.now();p-(pe||p)<=7e3&&(a==="godon"?(E("üî• GOD MODE ACTIVATED! Each click gives +6000 seconds of income!","success"),d(l=>({...l,...l.godMode?{}:{godMode:!0}}))):a==="godoff"&&(E("üõë GOD MODE DEACTIVATED! Normal clicks restored.","info"),d(l=>{const A={...l};return delete A.godMode,A}))),Ee(""),Re(null),fe&&(clearTimeout(fe),De(null))}}};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s),fe&&clearTimeout(fe)}},[Ge,pe,fe]),x.useEffect(()=>{if(pe){const s=setTimeout(()=>{Ee(""),Re(null),De(null)},7e3);return De(s),()=>{clearTimeout(s)}}},[pe]);const gt=s=>{let r=o(1);if(de.filter(n=>n.type==="click"&&s.upgrades.includes(n.id)).forEach(n=>{n.multiplier&&(r=r.times(n.multiplier))}),(s.activeDecrees.call_to_arms||o(0)).gt(o(Date.now()))&&(r=r.times(o(5))),r=r.times(me(s.renown)),s.godMode){const a=Ce(s).times(o(6e3));r=r.plus(a)}return r},Oe=(s,r)=>{const n=be.find(i=>i.id===s);if(!n||r<=0)return;const a=t.buildings[s]||o(0),p=t.advisorLevels.guildmaster||o(0),u=t.advisors.includes("guildmaster")?te("guildmaster",p):o(0),l=o(1).minus(u),A=tt(n.baseCost,a,o(r)).times(l).floor();t.gold.gte(A)&&(ce("medium"),d(i=>({...i,gold:i.gold.minus(A),buildings:{...i.buildings,[s]:(i.buildings[s]||o(0)).plus(o(r))}})))},$e=(s,r)=>{const n=be.find(l=>l.id===s);if(!n||r<=0)return;const a=t.buildings[s]||o(0),p=o(Math.min(r,a.toNumber()));if(p.lte(o(0)))return;const u=tt(n.baseCost,a.minus(p),p).times(o(.25)).floor();d(l=>({...l,gold:l.gold.plus(u),buildings:{...l.buildings,[s]:a.minus(p)}}))},_e=s=>{const r=de.find(n=>n.id===s);r&&(t.upgrades.includes(s)||(r.currency==="renown"?t.renown.gte(r.cost)?(d(n=>({...n,renown:n.renown.minus(r.cost),upgrades:[...n.upgrades,s]})),E(`Legacy Unlocked: ${r.name}`,"success")):E(`Not enough Renown! Need ${y(r.cost,t.numberFormat)}`,"error"):t.gold.gte(r.cost)&&d(n=>({...n,gold:n.gold.minus(r.cost),upgrades:[...n.upgrades,s]}))))},Ue=s=>{const r=ot.times(o(s));t.gold.gte(r)&&d(n=>({...n,gold:n.gold.minus(r),soldiers:n.soldiers.plus(r.dividedBy(ot))}))},He=(s,r)=>{const n=It.find(u=>u.id===s);if(!n)return;const a=n.goldCost.times(o(r)),p=n.soldierCost.times(o(r));t.gold.gte(a)&&t.soldiers.gte(p)&&d(u=>({...u,gold:u.gold.minus(a),soldiers:u.soldiers.minus(p),eliteUnits:{...u.eliteUnits,[s]:(u.eliteUnits[s]||o(0)).plus(o(r))}}))},pt=s=>{const r=ct.find(p=>p.id===s);if(!r)return;const n=t.advisors.includes(s),a=t.advisorLevels[s]||o(0);if(!n)t.renown.gte(r.cost)?(d(p=>({...p,renown:p.renown.minus(r.cost),advisors:[...p.advisors,s],advisorLevels:{...p.advisorLevels,[s]:o(1)}})),E(`Hired ${r.name}!`,"success")):E(`Not enough Renown! Need ${y(r.cost,t.numberFormat)}`,"error");else{const p=ut(r,a);t.renown.gte(p)?(d(u=>({...u,renown:u.renown.minus(p),advisorLevels:{...u.advisorLevels,[s]:a.plus(o(1))}})),E(`Upgraded ${r.name} to Level ${a.plus(o(1))}!`,"success")):E(`Not enough Renown! Need ${y(p,t.numberFormat)}`,"error")}},Ye=s=>{const r=Bt.find(D=>D.id===s);if(!r)return;const n=Date.now(),a=t.advisorLevels.chronomancer||o(0),p=t.advisorLevels.time_keeper||o(0),u=t.advisors.includes("chronomancer")?te("chronomancer",a):o(0),l=t.advisors.includes("time_keeper")?te("time_keeper",p):o(0),A=u.plus(l),i=r.cooldown.times(o(1).minus(A));if(!(t.decreeCooldowns[s]||o(0)).gt(o(n))&&!(t.activeDecrees[s]||o(0)).gt(o(n))){if(r.unlockCondition&&!r.unlockCondition(t)){E("Requirement not met!","error");return}r.effectType==="instant_gold"?(d(D=>({...D,gold:D.gold.plus(oe.current.times(r.value)),totalGold:D.totalGold.plus(oe.current.times(r.value)),decreeCooldowns:{...D.decreeCooldowns,[s]:o(n).plus(i.times(o(1e3)))}})),E(`Decree Enacted: ${r.name}`,"success")):r.effectType==="add_soldiers"?(d(D=>({...D,soldiers:D.soldiers.plus(r.value),decreeCooldowns:{...D.decreeCooldowns,[s]:o(n).plus(i.times(o(1e3)))}})),E(`Decree Enacted: Recruited ${r.value} Soldiers`,"success")):(d(D=>({...D,activeDecrees:{...D.activeDecrees,[s]:o(n).plus(r.duration.times(o(1e3)))},decreeCooldowns:{...D.decreeCooldowns,[s]:o(n).plus(r.duration.plus(r.cooldown).times(o(1e3)))}})),E(`Decree Enacted: ${r.name}`,"success"))}},qe=s=>{if(s.type==="merchant"){const r=oe.current.times(o(10));d(n=>({...n,gold:n.gold.plus(r),totalGold:n.totalGold.plus(r),event:null})),E(`The merchant gifted you ${y(r.floor(),t.numberFormat)} gold!`,"success")}else if(s.type==="jester"){const r=t.gold.times(o(.1)),n=Math.random()>.5;d(a=>({...a,gold:n?a.gold.plus(r):a.gold.minus(r),totalGold:n?a.totalGold.plus(r):a.totalGold,event:null})),n?E(`Jester pays out! +${y(r.floor(),t.numberFormat)}`,"success"):E(`Jester tricked you! -${y(r.floor(),t.numberFormat)}`,"warning")}else if(s.type==="dragon"){let r=!1;d(n=>{if(!n.event||n.event.type!=="dragon")return n;const a=(n.event.hp||o(1)).minus(o(1));if(a.lte(0)){const p=oe.current.times(o(30));return r=!0,{...n,gold:n.gold.plus(p),totalGold:n.totalGold.plus(p),event:null,stats:{...n.stats,dragonsKilled:n.stats.dragonsKilled.plus(o(1))}}}return{...n,event:{...n.event,hp:a}}}),r&&E("Dragon Slain! +Treasury Boost","success")}},ft=(s,r,n,a)=>{const p=Te.find(i=>i.id===s);if(!p)return;const u=o(r),l=o(n);if(t.gold.lt(u)){E("Not enough gold!","error");return}if(t.soldiers.lt(l)){E("Not enough soldiers!","error");return}let A=!0;if(Object.entries(a).forEach(([i,D])=>{(t.eliteUnits[i]||o(0)).lt(o(D))&&(A=!1)}),!A){E("Not enough elite units!","error");return}d(i=>{const D={...i.eliteUnits};return Object.entries(a).forEach(([U,k])=>{D[U]=(D[U]||o(0)).minus(o(k))}),{...i,gold:i.gold.minus(u),soldiers:i.soldiers.minus(l),eliteUnits:D,activeTradeRoutes:[...i.activeTradeRoutes||[],{id:Date.now().toString(),routeId:s,startTime:o(Date.now()),duration:o(p.baseDuration),goldInvested:u,soldiersSent:l,eliteSent:Object.fromEntries(Object.entries(a).map(([U,k])=>[U,o(k)]))}]}}),E("Caravan Dispatched!","success")},yt=s=>{const r=ht.find(u=>u.id===s);if(!r)return;const n=t.wonders[s]||o(0);if(n.gte(o(r.stages.length)))return;const a=r.stages[n].cost;let p=!0;for(const u of a)if(u.type==="gold"&&t.gold.lt(o(u.amount))&&(p=!1),u.type==="soldiers"&&t.soldiers.lt(o(u.amount))&&(p=!1),u.type==="renown"&&t.renown.lt(o(u.amount))&&(p=!1),["knight","paladin","void_sentinel"].includes(u.type)){const l=u.type;(t.eliteUnits[l]||o(0)).lt(o(u.amount))&&(p=!1)}if(!p){E("Resources insufficient for construction!","error");return}d(u=>{let l=u.gold,A=u.soldiers,i=u.renown,D={...u.eliteUnits};for(const U of a)if(U.type==="gold"&&(l=l.minus(o(U.amount))),U.type==="soldiers"&&(A=A.minus(o(U.amount))),U.type==="renown"&&(i=i.minus(o(U.amount))),["knight","paladin","void_sentinel"].includes(U.type)){const k=U.type;D[k]=(D[k]||o(0)).minus(o(U.amount))}return{...u,gold:l,soldiers:A,renown:i,eliteUnits:D,wonders:{...u.wonders,[s]:n.plus(o(1))}}}),E("Wonder Stage Complete!","success")},vt=s=>{const r=et.find(n=>n.id===s);if(r){if(r.requiredUnits){for(const[n,a]of Object.entries(r.requiredUnits))if((t.eliteUnits[n]||o(0)).lt(a)){E("Missing elite units required for this mission.","error");return}}t.soldiers.gte(r.soldierCost)&&(d(n=>({...n,soldiers:n.soldiers.minus(r.soldierCost),conquest:{active:!0,crusadeId:s,startTime:o(Date.now()),soldiersSent:r.soldierCost}})),E(`Crusade Started: ${r.name}`,"info"))}},bt=()=>{const s=t.advisorLevels.void_scholar||o(0),r=t.advisors.includes("void_scholar")?te("void_scholar",s):o(0),n=o(1).plus(r),a=o(1e12),p=t.totalGold;if(p.lt(a))return;const u=p.dividedBy(a),l=o(Math.floor(Math.pow(u.toNumber(),.5))).times(n);l.lte(0)||(d({...ae,renown:t.renown.plus(l),prestigeCount:t.prestigeCount+1,achievements:t.achievements,artifacts:t.artifacts,upgrades:t.upgrades.filter(A=>{const i=de.find(D=>D.id===A);return(i==null?void 0:i.currency)==="renown"}),advisors:t.advisors,advisorLevels:t.advisorLevels,wonders:t.wonders,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),q(!1),E("Abdication Successful. Long live the new King!","success"))},jt=()=>{localStorage.removeItem("kingdom_save"),d({...ae,startTime:o(Date.now())}),V(!1),E("Game Reset","warning")},wt=()=>{const r=je(t);localStorage.setItem("kingdom_save",JSON.stringify(r)),E("Game Saved","info")},Ct=s=>{d(r=>({...r,playerProfile:s})),localStorage.setItem(`playerProfile_${s.id}`,JSON.stringify(s)),E(`Welcome, ${s.rulerName} ${s.rulerId}!`,"success"),b(!1)},kt=async()=>{bt()},Ve=s=>{d(r=>({...r,interface:{...r.interface,lastBuyAmount:s}}))},Je=s=>({flex:s==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:s==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:s==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:m&&t.idleModeEnabled?s==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:P?"column":"row"},children:[e.jsx(qt,{toasts:j}),e.jsx(Vt,{}),m&&t.idleModeEnabled&&e.jsx(Mt,{gameState:t}),!P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Je("left"),children:[e.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[e.jsx("button",{className:`tab-btn ${g==="buildings"?"active":""}`,onClick:()=>H("buildings"),children:"Estates"}),e.jsx("button",{className:`tab-btn ${g==="upgrades"?"active":""}`,onClick:()=>H("upgrades"),children:"Upgrades"}),e.jsx("button",{className:`tab-btn ${g==="decrees"?"active":""}`,onClick:()=>H("decrees"),children:"Decrees"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[g==="buildings"&&e.jsx(rt,{gameState:t,onBuyBuilding:Oe,onSellBuilding:$e,onSetBuyAmount:Ve}),g==="upgrades"&&e.jsx(st,{gameState:t,onBuyUpgrade:_e}),g==="decrees"&&e.jsx(nt,{gameState:t,onActivateDecree:Ye})]})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:m&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(it,{gameState:t,gps:ge,onClick:()=>Ne(!1),onEventInteract:qe,onOpenConquest:()=>{(t.buildings.castle||o(0)).gt(0)?B(!0):E("You need a Castle to lead your army!","warning")},onOpenTavern:()=>G(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>V(!0),onOpenCouncil:()=>M(!0),onOpenStatistics:()=>Z(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>{(t.buildings.castle||o(0)).gt(0)?se(!0):E("You need a Castle to manage an Empire!","warning")},isIdle:m&&t.idleModeEnabled})}),e.jsxs("div",{style:Je("right"),children:[e.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[e.jsx("button",{className:`tab-btn ${L==="army"?"active":""}`,onClick:()=>$("army"),children:"Army"}),e.jsx("button",{className:`tab-btn ${L==="achievements"?"active":""}`,onClick:()=>$("achievements"),children:"Achievements"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[L==="army"&&e.jsx(lt,{gameState:t,onTrainSoldier:Ue,onTrainElite:He}),L==="achievements"&&e.jsx(Qe,{gameState:t})]})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[I==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsx("button",{className:`tab-btn ${g==="buildings"?"active":""}`,onClick:()=>H("buildings"),children:"Estates"}),e.jsx("button",{className:`tab-btn ${g==="upgrades"?"active":""}`,onClick:()=>H("upgrades"),children:"Upgrades"}),e.jsx("button",{className:`tab-btn ${g==="decrees"?"active":""}`,onClick:()=>H("decrees"),children:"Decrees"})]}),e.jsxs("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[g==="buildings"&&e.jsx(rt,{gameState:t,onBuyBuilding:Oe,onSellBuilding:$e,onSetBuyAmount:Ve}),g==="upgrades"&&e.jsx(st,{gameState:t,onBuyUpgrade:_e}),g==="decrees"&&e.jsx(nt,{gameState:t,onActivateDecree:Ye})]})]}),I==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(it,{gameState:t,gps:ge,onClick:()=>Ne(!1),onEventInteract:qe,onOpenConquest:()=>{(t.buildings.castle||o(0)).gt(0)?B(!0):E("You need a Castle to lead your army!","warning")},onOpenTavern:()=>G(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>V(!0),onOpenCouncil:()=>M(!0),onOpenStatistics:()=>Z(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>{(t.buildings.castle||o(0)).gt(0)?se(!0):E("You need a Castle to manage an Empire!","warning")},isIdle:m&&t.idleModeEnabled})}),I==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsx("button",{className:`tab-btn ${L==="army"?"active":""}`,onClick:()=>$("army"),children:"Army"}),e.jsx("button",{className:`tab-btn ${L==="achievements"?"active":""}`,onClick:()=>$("achievements"),children:"Achievements"})]}),e.jsxs("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[L==="army"&&e.jsx(lt,{gameState:t,onTrainSoldier:Ue,onTrainElite:He}),L==="achievements"&&e.jsx(Qe,{gameState:t})]})]}),I==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"üè∞ Empire Management"}),e.jsx("p",{children:"Manage your conquests and trade routes here."}),e.jsx("button",{className:"btn",onClick:()=>B(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"‚öîÔ∏è Conquests"}),e.jsx("button",{className:"btn",onClick:()=>se(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"üåç Trade Empire"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${I==="buildings"?"active":""}`,onClick:()=>{ce("light"),R("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèòÔ∏è"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${I==="throne"?"active":""}`,onClick:()=>{ce("light"),R("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üëë"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${I==="army"?"active":""}`,onClick:()=>{ce("light"),R("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"‚öîÔ∏è"}),e.jsx("div",{children:"Army"})]}),e.jsxs("button",{className:`mobile-nav-btn ${I==="empire"?"active":""}`,onClick:()=>{ce("light"),R("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üó∫Ô∏è"}),e.jsx("div",{children:"Empire"})]})]})]}),!(m&&t.idleModeEnabled)&&v&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:v.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:v.name})]})]}),Y&&e.jsx(Et,{gameState:t,onStartCrusade:vt,onClose:()=>B(!1)}),we&&e.jsx(Ut,{gameState:t,onInvestTrade:ft,onBuildWonder:yt,onClose:()=>se(!1)}),W&&e.jsx(Wt,{gameState:t,onGamble:(s,r)=>{const n=o(s);d(a=>({...a,gold:r?a.gold.plus(n):a.gold.minus(n),stats:{...a.stats,tavernGamesPlayed:a.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>G(!1)}),Q&&e.jsx(Gt,{gameState:t,onPrestige:kt,onClose:()=>q(!1)}),K&&e.jsx(Ot,{gameState:t,onClose:()=>V(!1),onHardReset:jt,onSave:wt,onOpenChangelog:()=>S(!0),onSetTheme:s=>d(r=>({...r,theme:s})),onSetNumberFormat:s=>d(r=>({...r,numberFormat:s})),onToggleIdleMode:()=>d(s=>({...s,idleModeEnabled:!s.idleModeEnabled})),onUpdateInterface:s=>d(r=>({...r,interface:{...r.interface,...s}}))}),_&&e.jsx(_t,{gameState:t,currentGps:ge,onClose:()=>Z(!1)}),X&&e.jsx(Rt,{onClose:()=>S(!1)}),T&&e.jsx($t,{gameState:t,onHireAdvisor:pt,onClose:()=>M(!1)}),he&&e.jsx(Qt,{isOpen:he,onClose:()=>{xe(!1),b(!0)},onConfirm:Ct,gameState:t}),f&&e.jsx(to,{isOpen:f,onClose:()=>ne(!1),playerProfile:t.playerProfile})]})};export{mo as A,Pt as R,e as j,x as r};
