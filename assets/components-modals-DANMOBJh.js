var ge=Object.defineProperty,he=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var X=(t,o,l)=>o in t?ge(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,I=(t,o)=>{for(var l in o||(o={}))me.call(o,l)&&X(t,l,o[l]);if(q)for(var l of q(o))fe.call(o,l)&&X(t,l,o[l]);return t},L=(t,o)=>he(t,ue(o));var G=(t,o,l)=>new Promise((a,d)=>{var r=y=>{try{s(l.next(y))}catch(i){d(i)}},c=y=>{try{s(l.throw(y))}catch(i){d(i)}},s=y=>y.done?a(y.value):Promise.resolve(y.value).then(r,c);s((l=l.apply(t,o)).next())});import{r as N,j as e,R as O}from"./vendor-react-CUeQczFW.js";import{t as m,f as w,T as be,C as K,B as se,W as ye,A as ve,N as je,a as we,M as J,P as ke,b as Se,c as Ce,d as Z,e as H,h as Ne,g as Q,i as ee}from"./core-uFyQeYSz.js";import{g as $}from"./components-ui-crbNLD7e.js";import{A as Re}from"./components-achievements-DCFXKO6C.js";import{i as Te,g as Be,a as Ae,d as te,s as oe,b as re,c as We,q as ie,e as le,o as ae,l as de,f as ce}from"./vendor-firebase-DifxhTMo.js";import{a as D}from"./vendor-DdgGw12P.js";const U=({currentBet:t,maxGold:o,onBetChange:l,numberFormat:a})=>{const[d,r]=N.useState(t===0?"":t.toString());N.useEffect(()=>{var f,n;t===0&&((f=document.activeElement)==null?void 0:f.tagName)!=="INPUT"?r(""):Math.abs(parseFloat(d)-t)>1e-4&&((n=document.activeElement)==null?void 0:n.tagName)!=="INPUT"&&r(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const c=f=>{try{if(f.trim()===""){l(0),r("");return}let n=parseFloat(f);const v=f.toLowerCase().trim(),g={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const S of Object.keys(g))if(v.endsWith(S)){const x=parseFloat(v.slice(0,-S.length));isNaN(x)||(n=x*g[S]);break}(isNaN(n)||n<0)&&(n=0);const p=o.toNumber();isFinite(p)&&n>p?n=p:!isFinite(p)&&m(n).gt(o)&&(n=Number.MAX_VALUE),l(n),n===0?r(""):n>=1e6?r(n.toExponential(2).replace("+","")):r(Math.floor(n).toString())}catch(n){r(t===0?"":t.toString())}},s=()=>{c(d)},y=f=>{f.key==="Enter"&&(c(d),f.target.blur())},i=f=>{let v=o.times(f).floor().toNumber();isFinite(v)||(v=Number.MAX_VALUE),v<1&&o.gt(0)&&(v=1),l(v),v>=1e6?r(v.toExponential(2).replace("+","")):r(v.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"ðŸ’°"}),e.jsx("input",{type:"text",value:d,onChange:f=>r(f.target.value),onBlur:s,onKeyDown:y,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager (100, 1k, 2.5m, 1b, 2e13)..."}),t>0&&e.jsx("button",{onClick:()=>{l(0),r("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>i(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>i(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>i(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>c(Math.floor(t/2).toString()),children:"Â½"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>c((t*2).toString()),children:"x2"})]})]})},ze=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],Fe=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],Me=50,Ee=({gameState:t,onGamble:o,onLeave:l})=>{const[a,d]=N.useState([]),[r,c]=N.useState(null),[s,y]=N.useState(0),[i,f]=N.useState("betting"),[n,v]=N.useState(""),[g,p]=N.useState(null),S=N.useRef(null),x=N.useRef([]);N.useEffect(()=>{k()},[]);const k=()=>{const h=[],u=[...ze].sort(()=>.5-Math.random());for(let A=0;A<6;A++){const M=Math.random()*5+5,j=Math.random()*5+5;let z=25-(M+j);z=z+(Math.random()*4-2),z<1.5&&(z=1.5),z>20&&(z=20),h.push({id:A,name:u[A],color:Fe[A],icon:"ðŸŽ",odds:parseFloat(z.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:M,staminaRating:j})}d(h),c(null),p(null),x.current=[],v("Select a horse and place your bet!")},T=()=>{if(r===null){v("Select a horse first!");return}if(s<=0){v("Place a valid bet!");return}if(t.gold.lt(m(s))){v("Not enough gold!");return}f("racing"),v("And they're off!");let h=0;const u=400;S.current=setInterval(()=>{h++,d(A=>A.map(j=>{if(j.finished)return j;const W=Math.random()<.05?1:0,z=Math.random()<.05?-.5:0,b=.15,R=j.speedRating/10*.15,F=Math.random()*.2;let E=b+R+F+W+z,P=j.progress+E;return P>=100&&(P=100,!x.current.includes(j.id))?(x.current.push(j.id),L(I({},j),{progress:100,finished:!0,rank:x.current.length})):L(I({},j),{progress:P})}).slice(0,6)),(x.current.length===6||h>=u)&&(x.current.length<6&&d(A=>(A.filter(j=>!j.finished).sort((j,W)=>W.progress-j.progress).forEach(j=>{x.current.includes(j.id)||x.current.push(j.id)}),A.map(j=>{const W=x.current.indexOf(j.id);return W!==-1?L(I({},j),{rank:W+1,finished:!0,progress:100}):j}))),C())},Me)},C=()=>{S.current&&clearInterval(S.current);const h=a.map(j=>{const W=x.current.indexOf(j.id);return W!==-1?L(I({},j),{rank:W+1,finished:!0}):j});d(h);const u=x.current[0],A=h.find(j=>j.id===u);if(!A)return;if(f("finished"),u===r){const j=h.find(b=>b.id===r),W=(j==null?void 0:j.odds)||1,z=Math.max(1,Math.floor(s*(W-1)));o(z,!0),p({won:!0,amount:z,winnerName:A.name})}else o(s,!1),p({won:!1,amount:s,winnerName:A.name})};N.useEffect(()=>()=>{S.current&&clearInterval(S.current)},[]);const B=()=>{f("betting"),y(0),k()};return g&&(g.won,g.won,g.won,g.won,g.won,g.winnerName,g.won?(e.Fragment,w(m(g.amount),t.numberFormat)):(e.Fragment,w(m(g.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:n}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),a.map(h=>e.jsxs("div",{onClick:()=>i==="betting"&&c(h.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:i==="betting"?"pointer":"default",background:r===h.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid var(--border-color)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"var(--panel-bg)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--text-color)"},children:h.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:r===h.id?"var(--accent-color)":"var(--text-secondary)",fontWeight:"bold"},children:[h.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${h.progress}% - ${h.progress*.8}px)`,transition:i==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:r===h.id?"drop-shadow(0 0 5px gold)":"drop-shadow(0 2px 2px rgba(0,0,0,0.3))",color:h.color},children:e.jsx("div",{style:{fontSize:"2rem"},children:h.icon})}),h.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5,color:"#000",textShadow:"0 0 2px rgba(0,0,0,0.3)"},children:h.rank===1?"ðŸ¥‡":h.rank===2?"ðŸ¥ˆ":h.rank===3?"ðŸ¥‰":h.rank?`#${h.rank}`:"?"})]},h.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(U,{currentBet:s,maxGold:t.gold,onBetChange:y,numberFormat:t.numberFormat})}),e.jsxs("div",{style:{flexShrink:0},children:[i==="betting"&&e.jsx("button",{className:"btn",onClick:T,disabled:r===null||s<=0,style:{opacity:r===null||s<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"START"}),i==="finished"&&e.jsx("button",{className:"btn",onClick:B,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"RACE AGAIN"}),i==="racing"&&e.jsx("div",{style:{width:"100%",height:"60px"}})]})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),g?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:g.won?"ðŸ‡":"ðŸ¢"}),e.jsx("span",{style:{color:g.won?"#4caf50":"#f44336",marginRight:"10px"},children:g.won?"Winner!":"Better luck next time"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Winner: ",g.winnerName]}),e.jsxs("span",{style:{color:g.won?"gold":"#ef5350"},children:[g.won?"+":"-",w(m(g.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Ie=({gameState:t,onGamble:o,onLeave:l})=>{const[a,d]=N.useState(0),[r,c]=N.useState(null),[s,y]=N.useState(!1),[i,f]=N.useState(0),[n,v]=N.useState(null),[g,p]=N.useState("Select a side and place your wager.");n&&(n.won,n.won,n.won,n.won,n.won,n.side,n.won?(e.Fragment,w(m(n.amount),t.numberFormat)):(e.Fragment,w(m(n.amount),t.numberFormat)));const S=()=>{if(!r){p("Please select Heads or Tails!");return}if(a<=0){p("Please enter a valid bet amount.");return}if(t.gold.lt(m(a))){p("Not enough gold!");return}y(!0),p("");const k=Math.random()>.5?"heads":"tails",T=r===k,C=i,h=360*5;let u=C+h;const A=u%360;k==="heads"?u+=360-A:u+=180-A+360,f(u),setTimeout(()=>{y(!1),T?(o(a,!0),p("Victory!")):(o(a,!1),p("Defeat!")),setTimeout(()=>{v({won:T,amount:a,side:k})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${i}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"ðŸ‘‘"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"20px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:g}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>c("heads"),disabled:s,style:{padding:"10px 20px",border:`3px solid ${r==="heads"?"var(--gold-color)":"transparent"}`,background:r==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:s?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:s?"none":"scale(1)",boxShadow:s?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:s?.6:1},onMouseEnter:x=>{!s&&r!=="heads"&&(x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",x.currentTarget.style.border="3px solid var(--accent-color)",x.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:x=>{!s&&r!=="heads"&&(x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",x.currentTarget.style.border="3px solid transparent",x.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"ðŸ‘‘"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>c("tails"),disabled:s,style:{padding:"10px 20px",border:`3px solid ${r==="tails"?"var(--gold-color)":"transparent"}`,background:r==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:s?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:s?"none":"scale(1)",boxShadow:s?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:s?.6:1},onMouseEnter:x=>{!s&&r!=="tails"&&(x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",x.currentTarget.style.border="3px solid var(--accent-color)",x.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:x=>{!s&&r!=="tails"&&(x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",x.currentTarget.style.border="3px solid transparent",x.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(U,{currentBet:a,maxGold:t.gold,onBetChange:d,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:S,disabled:!r||a<=0||s,style:{opacity:!r||a<=0||s?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:n.won?"âœ¨":"ðŸ’¸"}),e.jsx("span",{style:{color:n.won?"#4caf50":"#f44336",marginRight:"10px"},children:n.won?"Victory!":"Defeat!"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Result: ",n.side]}),e.jsxs("span",{style:{color:n.won?"gold":"#ef5350"},children:[n.won?"+":"-",w(m(n.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},ne=({value:t,size:o=80,color:l="#3e2723"})=>{const a=o*.18,d=o*.25,r=o*.5,c=o*.75,s=[];return(t===1||t===3||t===5)&&s.push({cx:r,cy:r}),t>1&&(s.push({cx:d,cy:d}),s.push({cx:c,cy:c})),t>3&&(s.push({cx:c,cy:d}),s.push({cx:d,cy:c})),t===6&&(s.push({cx:d,cy:r}),s.push({cx:c,cy:r})),e.jsx("div",{style:{width:o,height:o,backgroundColor:"#fff",borderRadius:o*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:s.map((y,i)=>e.jsx("circle",{cx:y.cx,cy:y.cy,r:a/2,fill:l},i))})})},Le=({gameState:t,onGamble:o,onLeave:l})=>{const[a,d]=N.useState(0),[r,c]=N.useState(!1),[s,y]=N.useState([1,1]),[i,f]=N.useState(null),[n,v]=N.useState("Place your wager and roll!"),g=()=>{if(a<=0){v("Please enter a valid bet amount.");return}if(t.gold.lt(m(a))){v("Not enough gold!");return}c(!0),v("Rolling..."),f(null);let S=0;const x=10,k=setInterval(()=>{y([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),S++,S>=x&&(clearInterval(k),p())},100)},p=()=>{const S=Math.floor(Math.random()*6)+1,x=Math.floor(Math.random()*6)+1,k=S+x;y([S,x]),c(!1);let T=0,C=!1,B="";if(k===2?(T=10,C=!0,B="Snake Eyes! JACKPOT (x10)!"):k>=3&&k<=6?(T=0,C=!1,B="Low roll... House wins."):k===7?(T=2,C=!0,B="Lucky Seven! (x2)"):k>=8&&k<=11?(T=1.5,C=!0,B="Good roll! (x1.5)"):k===12&&(T=5,C=!0,B="Boxcars! Huge Win (x5)!"),C){const h=Math.max(1,Math.floor(a*(T-1)));o(h,!0),v(B),f({won:!0,amount:h,sum:k})}else o(a,!1),v(B),f({won:!1,amount:a,sum:k})};return i&&(i.won,i.won,i.won,i.won,i.won,i.sum,i.won?(e.Fragment,w(m(i.amount),t.numberFormat)):(e.Fragment,w(m(i.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 7"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 8-11"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x1.5"})]}),e.jsx("div",{style:{textAlign:"center",color:"var(--danger-color)",borderTop:"1px solid var(--border-color)",marginTop:"5px"},children:"Sum 3-6: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(ne,{value:s[0],size:100}),e.jsx(ne,{value:s[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:r?"":`Sum: ${s[0]+s[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:n})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(U,{currentBet:a,maxGold:t.gold,onBetChange:d,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:g,disabled:a<=0||r,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:a<=0||r?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),i?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:i.won?"ðŸŽ²":"ðŸ“‰"}),e.jsx("span",{style:{color:i.won?"#4caf50":"#f44336",marginRight:"10px"},children:i.won?"You Won!":"You Lost"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Rolled: ",i.sum]}),e.jsxs("span",{style:{color:i.won?"gold":"#ef5350"},children:[i.won?"+":"-",w(m(i.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Qe=({gameState:t,onGamble:o,onClose:l})=>{const[a,d]=N.useState("racing");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"95vh",maxWidth:"1000px",width:"98%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"ðŸº The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:w(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>d("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:a==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:a==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:a==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸ‡ Racing"}),e.jsx("button",{onClick:()=>d("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:a==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:a==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:a==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŸ¡ Coin"}),e.jsx("button",{onClick:()=>d("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:a==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:a==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:a==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[a==="racing"&&e.jsx(Ee,{gameState:t,onGamble:(r,c)=>o(r,c),onLeave:l}),a==="coin"&&e.jsx(Ie,{gameState:t,onGamble:(r,c)=>o(r,c),onLeave:l}),a==="dice"&&e.jsx(Le,{gameState:t,onGamble:(r,c)=>o(r,c),onLeave:l})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:l,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},et=({gameState:t,onPrestige:o,onClose:l})=>{var k;const d=m(1e12),r=t.totalGold;let c=m(0),s=!1,y=d.minus(r);if(r.gte(d)){const T=r.dividedBy(d);c=m(Math.floor(Math.pow(T.toNumber(),.33))).times(1).minus(t.renown),c.lt(0)&&(c=m(0)),s=c.gt(0)}const i=t.renown.plus(c),f=d.times(Math.pow(Math.floor(i.dividedBy(1).toNumber()+1),1/.33)),n=f.minus(r),g=$(t.renown).minus(m(1)).times(m(100)),S=$(t.renown.plus(c)).minus(m(1)).times(m(100)),x=Object.values(t.nationalProjects||{}).some(T=>T==null?void 0:T.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[!((k=t.playerProfile)!=null&&k.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",w(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),x&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"âš ï¸ WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",w(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",w(r,t.numberFormat)]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current Bonus:"})," +",g.toNumber().toFixed(1),"%"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," ",w(c,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After:"})," ",w(t.renown.plus(c),t.numberFormat)," (+",S.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:w(f,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:n.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",w(n.gt(0)?n:m(0),t.numberFormat)," more)"]})]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:l,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:o,disabled:!s,children:s?"Abdicate":r.lt(d)?`Need ${w(y,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},tt=({gameState:t,onClose:o,onHardReset:l,onSave:a,onSetTheme:d,onSetNumberFormat:r,onToggleIdleMode:c,onUpdateInterface:s,onOpenPromoCodes:y})=>{var C,B,h;const[i,f]=O.useState(!1),n=t.interface||{density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:m(1),center:m(1),right:m(1)}},v=(C=n.layout.left)!=null&&C.toNumber?n.layout.left.toNumber():Number(n.layout.left),g=(B=n.layout.center)!=null&&B.toNumber?n.layout.center.toNumber():Number(n.layout.center),p=(h=n.layout.right)!=null&&h.toNumber?n.layout.right.toNumber():Number(n.layout.right),S=()=>{i?l():f(!0)},x=(u,A)=>{s({layout:L(I({},n.layout),{[u]:m(A)})})},k={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},T={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"âš™ï¸ Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px",flex:1,overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:v,onChange:u=>x("left",parseFloat(u.target.value)),style:T}),e.jsx("span",{style:{fontSize:"0.8rem"},children:v})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:g,onChange:u=>x("center",parseFloat(u.target.value)),style:T}),e.jsx("span",{style:{fontSize:"0.8rem"},children:g})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:p,onChange:u=>x("right",parseFloat(u.target.value)),style:T}),e.jsx("span",{style:{fontSize:"0.8rem"},children:p})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Preset Themes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"5px",justifyContent:"center"},children:Object.values(be).map(u=>e.jsx("button",{className:"btn",style:{background:t.theme===u.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===u.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",minWidth:"120px",textAlign:"center"},onClick:()=>d(u.id),children:u.name},u.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["compact","normal","spacious"].map(u=>e.jsx("button",{className:"btn",style:{background:n.density===u?"var(--accent-color)":"var(--panel-bg)",color:n.density===u?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",textTransform:"capitalize",minWidth:"120px",textAlign:"center",padding:"5px 10px"},onClick:()=>s({density:u}),children:u},u))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["standard","scientific","plain"].map(u=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===u?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===u?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",textTransform:"capitalize",minWidth:"120px",textAlign:"center"},onClick:()=>r(u),children:u},u))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:k,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive. Wait 30 seconds after enabling."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:c,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:k,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:n.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({showFloatingText:!n.showFloatingText}),children:n.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:k,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:n.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({showWeatherWidget:!n.showWeatherWidget}),children:n.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:k,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:n.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({crownAnimations:!n.crownAnimations}),children:n.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:k,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Enable visual effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:n.reduceMotion?"#9e9e9e":"var(--success-color)",minWidth:"60px"},onClick:()=>s({reduceMotion:!n.reduceMotion}),children:n.reduceMotion?"OFF":"ON"})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px",flexShrink:0},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:a,children:"Force Save"}),e.jsx("button",{className:"btn",onClick:y,style:{background:"#9c27b0"},children:"Promo Codes"}),e.jsx("button",{className:"btn",style:{backgroundColor:i?"red":"#d32f2f"},onClick:S,children:i?"CONFIRM WIPE?":"Hard Reset"})]}),i&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%",flexShrink:0},onClick:o,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px",flexShrink:0},children:"v2.3.0 - Kingdom Clicker"})]})})},ot=({onClose:t})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:K.map((o,l)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:l<K.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",o.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:o.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:o.changes.map((a,d)=>e.jsx("li",{style:{marginBottom:"3px"},children:a},d))})]},o.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),rt=({gameState:t,currentGps:o,onClose:l})=>{var k,T;const a=Object.values(t.buildings).reduce((C,B)=>C.plus(B),m(0)),d=t.achievements.length,r=ve.length;let c="None",s="None",y=-1,i=m(0);se.forEach((C,B)=>{const h=t.buildings[C.id]||m(0);h.gt(m(0))&&B>y&&(y=B,c=C.name),h.gt(i)&&(i=h,s=C.name)});const n=(()=>{let C=m(1);return C=C.times($(t.totalRenownEarned)),C})(),[v,g]=N.useState("");N.useEffect(()=>{const C=()=>{const h=m(Date.now()).minus(t.startTime),u=h.dividedBy(m(1e3)),A=u.minus(u.dividedBy(m(60)).floor().times(m(60))).floor(),M=h.dividedBy(m(6e4)),j=M.minus(M.dividedBy(m(60)).floor().times(m(60))).floor(),W=h.dividedBy(m(36e5)),z=W.minus(W.dividedBy(m(24)).floor().times(m(24))).floor(),b=h.dividedBy(m(864e5)).floor();let R="";b.gt(m(0))&&(R+=`${b.toString()}d `),z.gt(m(0))&&(R+=`${z.toString()}h `),R+=`${j.toString()}m ${A.toString()}s`,g(R)};C();const B=setInterval(C,1e3);return()=>clearInterval(B)},[t.startTime]);const p={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},S={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},x=(k=t.weather)!=null&&k.current&&((T=ye[t.weather.current])==null?void 0:T.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"ðŸ“Š Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:S,children:"âš¡ Current Status"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(o,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(n,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:x})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Current Renown:"}),e.jsx("strong",{style:{color:"#673ab7"},children:w(t.renown,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Total Renown Earned:"}),e.jsx("strong",{style:{color:"#9575cd"},children:w(t.totalRenownEarned,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#9575cd"},children:["+",$(t.totalRenownEarned).minus(m(1)).times(m(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:S,children:"â³ Time & Legacy"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:v})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:w(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:S,children:"ðŸ’° Economy Summary"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:w(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:w(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:S,children:"ðŸ° Dominion"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:w(a,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:c})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[s," (",w(i,t.numberFormat),")"]})]}),e.jsx("h3",{style:S,children:"ðŸ“ˆ Player Stats"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:w(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:w(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:w(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:S,children:"ðŸŽ–ï¸ Completion"}),e.jsxs("div",{style:p,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[d," / ",r," (",Math.floor(d/r*100),"%)"]})]}),e.jsx("h3",{style:S,children:"ðŸ† Achievements"}),e.jsx(Re,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:l,children:"Close Records"})]})})},De=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],nt=({gameState:t,onStartProject:o,onUpgradeClickPower:l,onUpgradeOffline:a,onClose:d})=>{const[r,c]=N.useState("infrastructure");if(!(t.buildings.field||m(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"ðŸ—ï¸ National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"ðŸ”’"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:d,children:"Close"})]})});const i=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:je.map(n=>{var z;const v=t.buildings[n.id]||m(0);if(v.lt(10))return null;const g=t.nationalProjects[n.id]||{level:0,active:!1,startTime:0,endTime:0},p=g.level,S=p>=J,x=g.active,k=p+1,T=we(n.id,k),C=Ne(k),B=De[k]||0,h=v.gte(B),u=t.gold.gte(T.gold),A=u&&h;let M=0,j=0;if(x){const b=Date.now(),R=g.endTime-g.startTime,F=b-g.startTime;M=Math.min(100,F/R*100),j=Math.max(0,Math.ceil((g.endTime-b)/1e3))}const W=((z=se.find(b=>b.id===n.id))==null?void 0:z.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:x?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:x?"var(--accent-color)":"rgba(0,0,0,0.05)",color:x?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:n.name.replace(" Infrastructure","")}),e.jsxs("span",{children:["Lvl ",p," / ",J]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-color)",marginBottom:"10px",fontStyle:"italic"},children:n.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(p*ke*100).toFixed(0),"% Global"]}),x?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${M}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem",color:"#3e2723"},children:["Under Construction... ",Math.floor(j/3600),"h ",Math.floor(j%3600/60),"m"]})]}):S?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"5px"},children:[e.jsxs("span",{style:{color:u?"green":"red"},children:["ðŸ’° ",w(T.gold)," Gold"]}),e.jsxs("span",{style:{color:h?"green":"red"},children:["ðŸ  ",w(m(B))," ",W,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["â³ Duration: ",Math.floor(C/3600),"h ",Math.floor(C%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:A?"var(--accent-color)":"var(--border-color)",cursor:A?"pointer":"not-allowed"},disabled:!A,onClick:()=>o(n.id),children:"Start Project (Units Consumed)"})]})]})]},n.id)})}),f=()=>{const n=t.clickUpgradeLevel||0,v=n>=Z,g=n+1,p=Se(g),S=t.gold.gte(p),x=m(2).pow(Math.min(n,15)),k=Q(n),T=k>0?`${w(x)} + ${(k*100).toFixed(1)}% of GPS`:w(x),C=m(2).pow(Math.min(g,15)),B=Q(g),h=B>0?`${w(C)} + ${(B*100).toFixed(1)}% of GPS`:w(C),u=t.offlineUpgradeLevel||0,A=u>=H,M=u+1,j=Ce(M),W=t.renown.gte(j),{efficiency:z,duration:b}=ee(u),{efficiency:R,duration:F}=ee(M),E=P=>{const _=Math.floor(P/3600),V=Math.floor(P%3600/60);return _>0?`${_}h ${V}m`:`${V}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ‘‘ Royal Scepter"}),e.jsxs("span",{children:["Lvl ",n," / ",Z]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",T]}),v?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",h]}),e.jsxs("div",{style:{color:S?"green":"red",fontWeight:"bold"},children:["ðŸ’° ",w(p)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:S?"var(--accent-color)":"var(--border-color)",cursor:S?"pointer":"not-allowed"},disabled:!S,onClick:l,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ’¤ Offline Production"}),e.jsxs("span",{children:["Lvl ",u," / ",H]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:["Improve the efficiency of your kingdom while you are away.",e.jsx("br",{}),"â±ï¸ Higher levels increase both efficiency % and maximum production time."]}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(z*100).toFixed(0),"% for ",E(b)]}),!A&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{width:"100%",height:"8px",background:"#ccc",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u/H*100}%`,height:"100%",background:"var(--success-color)",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"2px"},children:[H-u," levels to max"]})]}),A?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(R*100).toFixed(0),"% for ",E(F)]}),e.jsxs("div",{style:{color:W?"#673ab7":"red",fontWeight:"bold"},children:["ðŸ‘‘ ",w(j)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:W?"#673ab7":"var(--border-color)",cursor:W?"pointer":"not-allowed"},disabled:!W,onClick:a,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ›ï¸ National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:r==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>c("infrastructure"),children:"ðŸ—ï¸ Infrastructure"}),e.jsx("button",{className:"btn",style:{background:r==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>c("royalScepter"),children:"ðŸ‘‘ Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[r==="infrastructure"&&i(),r==="royalScepter"&&f()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:d,children:"Return to Kingdom"})})]})})},Pe={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},xe=Te(Pe),Y=Be(xe),pe=Ae(xe);function st(){return G(this,null,function*(){try{const t=yield We(pe);return console.log("âœ… Anonymous authentication successful:",t.user.uid),t.user}catch(t){throw console.error("âŒ Authentication error:",t),t}})}function Ge(){return pe.currentUser}function Oe(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function He(){const t=new Date,o=t.getDay(),l=t.getDate()-o+(o===0?-6:1);return new Date(t.setDate(l))}function it(t){return G(this,null,function*(){try{const o=Ge();if(!o)throw new Error("User not authenticated. Please call initializeAuth() first.");const l=L(I({},t),{period:"alltime"}),a=L(I({},t),{period:"weekly"}),d=te(Y,"leaderboard_alltime",t.rulerId),r=L(I({},l),{gold:Number(l.gold.toString()),achievements:Number(l.achievements),renown:Number(l.renown.toString()),totalClicks:Number(l.totalClicks.toString()),timestamp:oe(),userId:o.uid});l.buildings!==void 0&&(r.buildings=Number(l.buildings)),yield re(d,r);const c=te(Y,"leaderboard_weekly",t.rulerId),s=L(I({},a),{gold:Number(a.gold.toString()),achievements:Number(a.achievements),renown:Number(a.renown.toString()),totalClicks:Number(a.totalClicks.toString()),timestamp:oe(),userId:o.uid});return a.buildings!==void 0&&(s.buildings=Number(a.buildings)),yield re(c,s),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",o.customData)),o}})}function $e(t=100){return G(this,null,function*(){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=ie(le(Y,"leaderboard_alltime"),ae("gold","desc"),de(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const l=yield ce(o);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",l.docs.length);const a=l.docs.map(d=>{const r=d.data();return L(I({id:d.id},r),{gold:r.gold instanceof D?r.gold:new D(r.gold),renown:r.renown instanceof D?r.renown:new D(r.renown),totalClicks:r.totalClicks instanceof D?r.totalClicks:new D(r.totalClicks),timestamp:r.timestamp})});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",a.length),a}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}})}function Ye(t=100){return G(this,null,function*(){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=He();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",o.toISOString());const l=ie(le(Y,"leaderboard_weekly"),ae("gold","desc"),de(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const a=yield ce(l);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",a.docs.length);const r=a.docs.map(c=>{const s=c.data();return L(I({id:c.id},s),{gold:s.gold instanceof D?s.gold:new D(s.gold),renown:s.renown instanceof D?s.renown:new D(s.renown),totalClicks:s.totalClicks instanceof D?s.totalClicks:new D(s.totalClicks),timestamp:s.timestamp})}).filter(c=>{var i,f;const s=((f=(i=c.timestamp)==null?void 0:i.toDate)==null?void 0:f.call(i))||new Date(c.timestamp),y=s>=o;return y||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",s.toISOString()),y});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",r.length),r}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}})}const lt=({isOpen:t,onClose:o,onConfirm:l,gameState:a})=>{const[d,r]=N.useState(""),[c,s]=N.useState(!1);if(!t)return null;const y=()=>G(null,null,function*(){if(d.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(d.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}s(!0);try{const f={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:d.trim(),rulerId:Oe(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0,usedPromoCodes:[]};l(f),o()}catch(i){alert("An error occurred while creating profile. Please try again.")}finally{s(!1)}});return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:Ue(a.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:d,onChange:i=>r(i.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:i=>i.key==="Enter"&&y()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[d.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:y,disabled:c||d.trim().length<3,style:{padding:"12px 24px",backgroundColor:c||d.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:c||d.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:c?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:o,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:i=>{i.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:i=>{i.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function Ue(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const at=({isOpen:t,onClose:o,playerProfile:l,onOpenRulerNameModal:a,gameState:d})=>{const[r,c]=N.useState([]),[s,y]=N.useState([]),[i,f]=N.useState("alltime"),[n,v]=N.useState(!1),[g,p]=N.useState(null),[S,x]=N.useState(0),[k,T]=N.useState(0),C=()=>{const b=localStorage.getItem("leaderboardCache");if(b)try{const{data:R,timestamp:F}=JSON.parse(b),E=Date.now(),P=3600*1e3;if(E-F<P&&R&&R.allTime&&R.weekly)return R}catch(R){console.error("Cache parse error:",R)}return null},B=b=>{const R={data:b,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(R)),T(Date.now())},h=()=>{const b=localStorage.getItem("leaderboardCache");if(b){const{timestamp:R}=JSON.parse(b),F=Date.now(),E=3600*1e3;return F-R<E}return!1};N.useEffect(()=>{if(t){if(h())try{const b=C();if(b){c(b.allTime),y(b.weekly);const R=JSON.parse(localStorage.getItem("leaderboardCache"));T(R.timestamp);return}}catch(b){console.error("Cache read error:",b)}u()}},[t]);const u=()=>G(null,null,function*(){v(!0),p(null);try{const b=new Promise((E,P)=>setTimeout(()=>P(new Error("Loading timeout")),1e4)),[R,F]=yield Promise.all([Promise.race([$e(50),b]),Promise.race([Ye(50),b])]);c(R),y(F),B({allTime:R,weekly:F})}catch(b){console.error("Error loading leaderboard:",b),p("Failed to load leaderboard. Please check your internet connection and try again.")}finally{v(!1)}}),A=b=>{switch(b){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${b}`}},M=()=>l?(i==="alltime"?r:s).findIndex(R=>R.rulerId===l.rulerId)+1:-1,j=()=>{const b=i==="alltime"?r:s;if(b.length>0){let R=0;if(b.forEach(F=>{if(F.timestamp){let E=0;typeof F.timestamp=="object"&&F.timestamp.toDate?E=F.timestamp.toDate().getTime():typeof F.timestamp=="number"?E=F.timestamp:typeof F.timestamp=="string"&&(E=new Date(F.timestamp).getTime()),E>R&&(R=E)}}),R>0)return R}return k},W=i==="alltime"?r:s,z=W.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),e.jsx("button",{className:"btn",onClick:o,children:"Close"})]}),!l&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),a&&d&&d.gold&&d.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{o(),a()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),z&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-j())/6e4)," minutes ago"]})}),n&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),g&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:g}),l&&z&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",l.rulerName," ",l.rulerId]}),W.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",M()>0?`#${M()}`:"Not ranked yet"," in ",i==="alltime"?"All Time":"Weekly"]})]}),z&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>f("alltime"),className:i==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>f("weekly"),className:i==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),z&&!n&&!g&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Clicks"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Achievements"})]})}),e.jsx("tbody",{children:W.map((b,R)=>e.jsxs("tr",{style:{backgroundColor:(l==null?void 0:l.rulerId)===b.rulerId?"rgba(191, 144, 0, 0.1)":R%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:A(R+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:b.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:b.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:w(b.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:w(b.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:w(b.totalClicks,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:b.achievements})]},b.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},dt=({gained:t,effectiveTime:o,totalTime:l,efficiency:a,completedProjects:d,currentLevel:r,maxDuration:c,onClose:s,numberFormat:y})=>{const i=f=>{const n=Math.floor(f/3600),v=Math.floor(f%3600/60),g=Math.floor(f%60),p=[];return n>0&&p.push(`${n}h`),v>0&&p.push(`${v}m`),(g>0||p.length===0)&&p.push(`${g}s`),p.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"ðŸŒ™ Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:i(l.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:i(o.toNumber())})]}),o.toNumber()<l.toNumber()&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic",marginBottom:"5px",textAlign:"center"},children:["âš ï¸ Production time limited by upgrade level (max ",i(c),")"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(a*100).toFixed(0),"% (Level ",r,"/20)"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",w(t,y)]})]})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"âœ… Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:d.map((f,n)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:f},n))})]})]}),e.jsx("button",{className:"btn",onClick:s,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})},ct=({gameState:t,onClose:o,onRedeemPromoCode:l,onBackToSettings:a})=>{const[d,r]=O.useState(""),[c,s]=O.useState(""),[y,i]=O.useState("info"),[f,n]=O.useState(!1),v=B=>G(null,null,function*(){if(B.preventDefault(),!d.trim()){s("Please enter a promo code"),i("error");return}n(!0),s("");try{yield l(d),r(""),s("Promo code redeemed successfully!"),i("success")}catch(h){s("Error redeeming promo code"),i("error")}finally{n(!1)}}),g={position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},p={backgroundColor:"#2c2416",border:"3px solid #8b7355",borderRadius:"12px",padding:"30px",maxWidth:"500px",width:"100%",color:"#f4e4c1",fontFamily:"Georgia, serif",boxShadow:"0 0 30px rgba(0, 0, 0, 0.8)",maxHeight:"80vh",overflowY:"auto"},S={textAlign:"center",fontSize:"2rem",marginBottom:"20px",color:"#d4af37",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)"},x={width:"100%",padding:"12px",fontSize:"1rem",backgroundColor:"#1a1611",border:"2px solid #8b7355",borderRadius:"6px",color:"#f4e4c1",fontFamily:"Georgia, serif",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"15px"},k={background:"#9c27b0",color:"white",border:"none",padding:"12px 24px",fontSize:"1rem",borderRadius:"6px",cursor:"pointer",fontFamily:"Georgia, serif",fontWeight:"bold",width:"100%",marginBottom:"10px",opacity:f?.7:1},T={background:"#5d4037",color:"white",border:"none",padding:"12px 24px",fontSize:"1rem",borderRadius:"6px",cursor:"pointer",fontFamily:"Georgia, serif",width:"100%"},C={padding:"10px",borderRadius:"6px",marginBottom:"15px",textAlign:"center",fontSize:"0.9rem",backgroundColor:y==="success"?"#2e7d32":y==="error"?"#c62828":"#1565c0",border:`1px solid ${y==="success"?"#4caf50":y==="error"?"#f44336":"#2196f3"}`};return e.jsx("div",{style:g,onClick:o,children:e.jsxs("div",{style:p,onClick:B=>B.stopPropagation(),children:[e.jsx("h2",{style:S,children:"ðŸŽ« Promo Codes"}),e.jsxs("form",{onSubmit:v,children:[e.jsx("input",{type:"text",value:d,onChange:B=>r(B.target.value),placeholder:"Enter promo code...",style:x,maxLength:50,disabled:f}),e.jsx("button",{type:"submit",style:k,disabled:f,children:f?"Redeeming...":"Redeem Code"})]}),c&&e.jsx("div",{style:C,children:c}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#8b7355",textAlign:"center",marginBottom:"20px",fontStyle:"italic"},children:"Enter promotional codes to receive special rewards!"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px"},children:[a&&e.jsx("button",{style:L(I({},T),{background:"#666"}),onClick:a,children:"Back to Settings"}),e.jsx("button",{style:L(I({},T),{flex:"1"}),onClick:o,children:"Close"})]})]})})};export{ot as C,nt as E,at as L,dt as O,et as P,lt as R,tt as S,Qe as T,ct as a,rt as b,st as i,it as s};
