var tt=Object.defineProperty,ot=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var Pe=(t,c,v)=>c in t?tt(t,c,{enumerable:!0,configurable:!0,writable:!0,value:v}):t[c]=v,a=(t,c)=>{for(var v in c||(c={}))rt.call(c,v)&&Pe(t,v,c[v]);if(Se)for(var v of Se(c))lt.call(c,v)&&Pe(t,v,c[v]);return t},d=(t,c)=>ot(t,nt(c));var st=(t,c)=>()=>(c||t((c={exports:{}}).exports,c),c.exports);var Z=(t,c,v)=>new Promise((M,b)=>{var w=C=>{try{L(v.next(C))}catch(k){b(k)}},j=C=>{try{L(v.throw(C))}catch(k){b(k)}},L=C=>C.done?M(C.value):Promise.resolve(C.value).then(w,j);L((v=v.apply(t,c)).next())});import{j as l,r as g,a as it,R as at}from"./vendor-react-CUeQczFW.js";import{t as r,f as z,T as Ee,i as Ce,B as H,P as ct,m as le,A as dt,M as ut,a as ft,j as je,e as mt,c as gt,d as ht,b as pt,h as yt,g as vt}from"./core-CeROzvKA.js";import{g as Te,T as bt,G as wt}from"./components-ui-Czi4ozDg.js";import{B as ke,W as Me}from"./components-store-BxU3SK4k.js";import{M as Le}from"./components-main-zU1Way5r.js";import{s as xt,O as St,E as Pt,T as Et,P as Ct,S as jt,a as Tt,b as kt,C as Mt,R as Lt,L as It,c as Dt,u as Ot}from"./components-modals-Yg98zg9C.js";import{P as Nt}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-DhCH9Wl7.js";import"./vendor-firebase-IMiYFFvY.js";var At=st(ee=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))M(b);new MutationObserver(b=>{for(const w of b)if(w.type==="childList")for(const j of w.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&M(j)}).observe(document,{childList:!0,subtree:!0});function v(b){const w={};return b.integrity&&(w.integrity=b.integrity),b.referrerPolicy&&(w.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?w.credentials="include":b.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function M(b){if(b.ep)return;b.ep=!0;const w=v(b);fetch(b.href,w)}})();const Bt=({gameState:t})=>{const{weather:c,buildings:v,totalGold:M}=t,b=J=>{var O;return((O=v[J])==null?void 0:O.toNumber())||0};let w="wilderness";b("palace")>0?w="empire":b("castle")>0||b("market")>0?w="city":(b("peasant")>20||b("field")>10||M.gt(r(500)))&&(w="hamlet");let j="",L="";switch(w){case"wilderness":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",L="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",L="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":j="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",L="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":j="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",L="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const C=c.current;let k="none",N="",G=0;return C==="rainy"?(k="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",N="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",G=1):C==="stormy"?(k="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",N="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",G=1):C==="sunny"?(k="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",N="â˜€ï¸",G=.6):C==="windy"&&(N="ðŸƒ ðŸƒ ðŸƒ",G=.8),l.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:j,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[l.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:G,animation:C==="windy"?"float 3s infinite ease-in-out":"none"},children:N}),k!=="none"&&l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:k,pointerEvents:"none"}}),l.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:L}),l.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),l.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},B={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:r(1),layout:{left:r(1),center:r(1),right:r(1)},borderWidth:r(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},_={gold:r(0),totalGold:r(0),totalRenownEarned:r(0),startTime:r(Date.now()),lastSaveTime:r(Date.now()),buildings:{},achievements:[],renown:r(0),prestigeCount:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:r(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:B,stats:{totalClicks:r(0),dragonsKilled:r(0),tavernGamesPlayed:r(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1},U=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(U);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const c={};for(const v in t)t.hasOwnProperty(v)&&(c[v]=U(t[v]));return c}return t},Gt=()=>{var be,we;const[t,c]=g.useState(()=>{var o,n,s,i,u,h,f,P,y,E,x,S,T;const e=localStorage.getItem("kingdom_save");if(e)try{const m=JSON.parse(e);if((o=m.playerProfile)!=null&&o.id){const W=localStorage.getItem(`playerProfile_${m.playerProfile.id}`);W&&(m.playerProfile=JSON.parse(W))}const D=m.interface||{},et=d(a(a({},B),D),{lastBuyAmount:r((n=D.lastBuyAmount)!=null?n:1),crownAnimations:(s=D.crownAnimations)!=null?s:!0,layout:{left:r((u=(i=D.layout)==null?void 0:i.left)!=null?u:B.layout.left),center:r((f=(h=D.layout)==null?void 0:h.center)!=null?f:B.layout.center),right:r((y=(P=D.layout)==null?void 0:P.right)!=null?y:B.layout.right)},borderWidth:r((E=D.borderWidth)!=null?E:B.borderWidth),customColors:a(a({},B.customColors),D.customColors||{})});return d(a(a({},_),m),{renown:r(m.renown||0),totalRenownEarned:r(m.totalRenownEarned||0),prestigeCount:m.prestigeCount||0,gold:r(m.gold||0),totalGold:r(m.totalGold||0),startTime:r(m.startTime||Date.now()),lastSaveTime:r(m.lastSaveTime||Date.now()),buildings:Object.keys(m.buildings||{}).reduce((W,xe)=>(W[xe]=r(m.buildings[xe]),W),{}),stats:d(a(a({},_.stats),m.stats||{}),{totalClicks:r(((x=m.stats)==null?void 0:x.totalClicks)||0),dragonsKilled:r(((S=m.stats)==null?void 0:S.dragonsKilled)||0),tavernGamesPlayed:r(((T=m.stats)==null?void 0:T.tavernGamesPlayed)||0)}),nationalProjects:m.nationalProjects||{},clickUpgradeLevel:m.clickUpgradeLevel||0,offlineUpgradeLevel:m.offlineUpgradeLevel||0,weather:m.weather?d(a({},m.weather),{timeLeft:r(Number(m.weather.timeLeft)||120)}):_.weather,theme:m.theme||"default",numberFormat:m.numberFormat||"standard",idleModeEnabled:m.idleModeEnabled!==void 0?m.idleModeEnabled:!1,interface:et,playerProfile:m.playerProfile?d(a({},m.playerProfile),{lastLeaderboardSubmit:m.playerProfile.lastLeaderboardSubmit||0}):null,isDeveloperWifeBlessingObtained:m.isDeveloperWifeBlessingObtained||!1,globalIncomeMultiplier:m.globalIncomeMultiplier||1})}catch(m){console.error("Save load failed",m)}return _}),v=g.useRef(t);g.useEffect(()=>{v.current=t},[t]);const M=g.useRef("");g.useEffect(()=>{const e=o=>{M.current=(M.current+o.key).slice(-20);const n=M.current.toLowerCase();n.endsWith("godon")?(c(s=>d(a({},s),{godMode:!0})),p("God Mode Enabled: +99999s per click","success"),M.current=""):n.endsWith("godoff")&&(c(s=>d(a({},s),{godMode:!1})),p("God Mode Disabled","info"),M.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const b=()=>{X(null);const e=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(e){const n=o-parseInt(e),s=r(n/1e3);if(s.gte(r(60))){const i=t.offlineUpgradeLevel||0,{efficiency:u,duration:h}=Ce(i),f=r(h),P=s.lt(f)?s:f,E=Q(t).times(r(u)).times(P).floor();E.gt(r(0))&&(X({gained:E,effectiveTime:P,totalTime:s,efficiency:u,completedProjects:[],currentLevel:i,maxDuration:h}),c(x=>d(a({},x),{gold:x.gold.plus(E),totalGold:x.totalGold.plus(E)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[w,j]=g.useState(!1);g.useEffect(()=>{let e;const o=()=>{j(!1),clearTimeout(e),t.idleModeEnabled&&(e=setTimeout(()=>{j(!0)},2e4))};o();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(s=>window.addEventListener(s,o)),()=>{clearTimeout(e),n.forEach(s=>window.removeEventListener(s,o))}},[t.idleModeEnabled]),g.useEffect(()=>{t.event&&j(!1)},[t.event]),g.useEffect(()=>{const e=z(t.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[t.gold]),g.useEffect(()=>{const e=document.documentElement,o=t.interface||B,n=t.theme||"default",s=Ee[n]||Ee.default;s&&Object.entries(s.colors).forEach(([h,f])=>{e.style.setProperty(h,f)});const i={compact:"8px",normal:"12px",spacious:"20px"},u={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",i[o.density]),e.style.setProperty("--gap-size",u[o.density]),e.style.setProperty("--col-left",String(o.layout.left)),e.style.setProperty("--col-center",String(o.layout.center)),e.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[L,C]=g.useState(!1);g.useEffect(()=>{var e;t.gold.gte(r(1e7))&&!((e=t.playerProfile)!=null&&e.hasChosenName)&&!L&&ce(!0)},[t.gold,t.playerProfile,L]);const[k,N]=g.useState(null),[G,J]=g.useState([]),[O,X]=g.useState(null),[se,De]=g.useState("buildings"),[ie,Oe]=g.useState("army"),[K,Ne]=g.useState(!1),[I,V]=g.useState("throne");g.useEffect(()=>{const e=()=>{Ne(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[Be,te]=g.useState(!1),[Ge,Y]=g.useState(!1),[Re,R]=g.useState(!1),[Ae,_e]=g.useState(!1),[Ue,oe]=g.useState(!1),[Fe,q]=g.useState(!1),[ae,ce]=g.useState(!1),[de,ne]=g.useState(!1),[$e,re]=g.useState(!1),[ue,fe]=g.useState(!1),p=(e,o="info")=>{const n=Date.now().toString()+Math.random();J(s=>[...s,{id:n,message:e,type:o}]),setTimeout(()=>{J(s=>s.filter(i=>i.id!==n))},3e3)};g.useEffect(()=>{const e=Date.now();if(t.lastSaveTime&&r(e).minus(t.lastSaveTime).gt(r(6e4))){const o=r(e).minus(t.lastSaveTime).dividedBy(r(1e3)),{efficiency:n,duration:s}=Ce(t.offlineUpgradeLevel||0),i=r(s),u=o.lt(i)?o:i,f=Q(t).times(r(n)).times(u).floor(),P=[];let y=a({},t.nationalProjects),E=!1;Object.keys(y).forEach(x=>{var T;const S=y[x];if(S.active&&S.endTime&&e>=S.endTime){y[x]=d(a({},S),{active:!1,level:S.level+1,startTime:0,endTime:0});const m=(T=H.find(D=>D.id===x))==null?void 0:T.name;m&&P.push(`${m} Infrastructure (Lvl ${S.level+1})`),E=!0}}),(f.gt(r(0))||P.length>0)&&(X(x=>x||{gained:f,effectiveTime:u,totalTime:o,efficiency:n,completedProjects:P,currentLevel:t.offlineUpgradeLevel||0,maxDuration:s}),c(x=>d(a({},x),{gold:x.gold.plus(f),totalGold:x.totalGold.plus(f),nationalProjects:E?y:x.nationalProjects})))}},[]),g.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&c(o=>{const n=d(a({},o),{lastSaveTime:r(Date.now())}),s=U(n);return localStorage.setItem("kingdom_save",JSON.stringify(s)),n})},1e3);return()=>clearInterval(e)},[]),g.useEffect(()=>{const e=()=>{const n=v.current,s=U(n);localStorage.setItem("kingdom_save",JSON.stringify(s)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const o=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&b()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",o)}},[]),g.useEffect(()=>{var o;if(!((o=t.playerProfile)!=null&&o.hasChosenName))return;const e=setInterval(()=>{var h;const n=v.current,s=Date.now(),i=((h=n.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,u=3600*1e3;s-i>=u&&xt({rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.totalGold,renown:n.totalRenownEarned,achievements:n.achievements.length,totalClicks:n.stats.totalClicks,period:"alltime"}).then(()=>{c(f=>d(a({},f),{playerProfile:d(a({},f.playerProfile),{lastLeaderboardSubmit:Date.now()})})),p("Leaderboard data submitted successfully!","success")}).catch(f=>{console.error("Auto leaderboard submission failed:",f)})},6e4);return()=>clearInterval(e)},[(be=t.playerProfile)==null?void 0:be.hasChosenName]),g.useEffect(()=>{const e=setInterval(()=>{if(!t.event&&Math.random()<.05){const s=["dragon","merchant","jester"],i=s[Math.floor(Math.random()*s.length)],u=i==="dragon"?6e5:3e4,h={id:Date.now().toString(),type:i,expiresAt:r(Date.now()).plus(r(u)),hp:i==="dragon"?r(10):void 0,maxHp:i==="dragon"?r(10):void 0,reward:r(0),startTime:i==="dragon"?Date.now():void 0};c(f=>d(a({},f),{event:h}))}},1e4);return()=>clearInterval(e)},[t.event]);const Q=e=>{var h;let o=r(0);const n=((h=e.weather)==null?void 0:h.current)||"clear";H.forEach(f=>{const P=e.buildings[f.id]||r(0);let y=f.baseProduction;n==="sunny"?(f.id==="peasant"||f.id==="field"||f.id==="stable"||f.id==="cathedral")&&(y=y.times(r(1.2))):n==="rainy"?(f.id==="silver_mine"||f.id==="alchemist"||f.id==="market"||f.id==="tavern")&&(y=y.times(r(1.2))):n==="stormy"?((f.id==="blacksmith"||f.id==="void_portal")&&(y=y.times(r(1.3))),(f.id==="field"||f.id==="stable")&&(y=y.times(r(.8)))):n==="windy"&&(f.id==="market"||f.id==="castle"||f.id==="time_chamber")&&(y=y.times(r(1.15))),o=o.plus(P.times(y))});let s=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(f=>{s+=f.level||0});let i=r(1);const u=r(1).plus(r(s*ct));if(i=i.times(u),i=i.times(Te(e.totalRenownEarned).plus(r(e.achievements.length*.02))),e.globalIncomeMultiplier&&(i=i.times(r(e.globalIncomeMultiplier))),e.event&&e.event.type==="dragon"&&e.event.startTime){const f=Math.floor((Date.now()-e.event.startTime)/1e3),y=1-Math.min(99,f)/100;i=i.times(r(y))}return o=o.times(i),o},F=Q(t),$=g.useRef(F);$.current=F,g.useEffect(()=>{const e=setInterval(()=>{c(o=>{const n=Date.now(),s=$.current.times(r(le)).dividedBy(r(1e3));let i=o.totalGold.plus(s),u=o.gold.plus(s),h=a({},o.weather);const f=r(le/1e3);if(h.timeLeft=h.timeLeft.minus(f),h.timeLeft.lte(r(0))){const S=["clear","sunny","rainy","stormy","windy"],T=S[Math.floor(Math.random()*S.length)],m=r(Math.floor(Math.random()*120)+60);h={current:T,timeLeft:m}}let P=o.event;P&&P.expiresAt&&r(P.expiresAt).lt(r(n))&&(P=null);let y=a({},o.nationalProjects||{});Object.keys(y).forEach(S=>{var m;const T=y[S];T.active&&T.endTime&&n>=T.endTime&&(y[S]=d(a({},T),{active:!1,level:T.level+1,startTime:0,endTime:0}),p(`Project Completed: ${(m=H.find(D=>D.id===S))==null?void 0:m.name} Infrastructure Level ${T.level+1}!`,"success"))});const E=[...o.achievements];let x=null;return dt.forEach(S=>{E.includes(S.id)||S.condition(d(a({},o),{totalGold:i,gold:u}),$.current)&&(E.push(S.id),x=S)}),x&&(N(x),setTimeout(()=>N(null),3e3)),d(a({},o),{gold:u,totalGold:i,achievements:E,event:P,weather:h,nationalProjects:y})})},le);return()=>clearInterval(e)},[]);const A=(e="light")=>{if("vibrate"in navigator&&K)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},me=(e=!1)=>{if(e||A("light"),!e&&!t.isDeveloperWifeBlessingObtained&&t.totalGold.gte(r(1e12))&&Math.random()<1e-6){c(s=>d(a({},s),{globalIncomeMultiplier:(s.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...s.achievements,"developer_wife_blessing"])]})),p("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const o=We(v.current);c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),stats:d(a({},n.stats),{totalClicks:e?n.stats.totalClicks:n.stats.totalClicks.plus(r(1))})}))},We=e=>{const o=Te(e.totalRenownEarned),n=r(1),s=e.clickUpgradeLevel||0,i=Math.min(s,15),u=r(2).pow(i),h=n.times(u),f=Q(e),P=vt(s),y=f.times(P);let E=h.plus(y);if(E=E.times(o),e.godMode){const x=f.times(r(99999));E=E.plus(x)}return E},ze=()=>{const e=t.clickUpgradeLevel||0;if(e>=ht){p("Maximum Royal Scepter level reached!","warning");return}const o=pt(e+1);if(t.gold.lt(o)){p("Not enough gold!","error");return}c(n=>d(a({},n),{gold:n.gold.minus(o),clickUpgradeLevel:n.clickUpgradeLevel+1})),p(`Royal Scepter upgraded to level ${e+1}!`,"success")},He=()=>{const e=t.offlineUpgradeLevel||0;if(e>=mt){p("Maximum Passive Income level reached!","warning");return}const o=gt(e+1);if(t.renown.lt(o)){p("Not enough Renown!","error");return}c(n=>d(a({},n),{renown:n.renown.minus(o),offlineUpgradeLevel:n.offlineUpgradeLevel+1})),p(`Passive Income upgraded to level ${e+1}!`,"success")},ge=(e,o)=>{const n=H.find(u=>u.id===e);if(!n||o<=0)return;const s=t.buildings[e]||r(0),i=je(n.baseCost,s,r(o)).floor();t.gold.gte(i)&&(A("medium"),c(u=>d(a({},u),{gold:u.gold.minus(i),buildings:d(a({},u.buildings),{[e]:(u.buildings[e]||r(0)).plus(r(o))})})))},he=(e,o)=>{const n=H.find(h=>h.id===e);if(!n||o<=0)return;const s=t.buildings[e]||r(0),i=r(Math.min(o,s.toNumber()));if(i.lte(r(0)))return;const u=je(n.baseCost,s.minus(i),i).times(r(.25)).floor();c(h=>d(a({},h),{gold:h.gold.plus(u),buildings:d(a({},h.buildings),{[e]:s.minus(i)})}))},pe=e=>{if(e.type==="merchant"){const o=$.current.times(r(10));c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),event:null})),p(`The merchant gifted you ${z(o.floor(),t.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const o=t.gold.times(r(.1)),n=Math.random()>.5;c(s=>d(a({},s),{gold:n?s.gold.plus(o):s.gold.minus(o),totalGold:n?s.totalGold.plus(o):s.totalGold,event:null})),n?p(`Jester pays out! +${z(o.floor(),t.numberFormat)}`,"success"):p(`Jester tricked you! -${z(o.floor(),t.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let o=!1;c(n=>{if(!n.event||n.event.type!=="dragon")return n;const i=r(n.event.hp||10).minus(r(1));if(i.lte(0)){const u=$.current.times(r(30));return o=!0,d(a({},n),{gold:n.gold.plus(u),totalGold:n.totalGold.plus(u),event:null,stats:d(a({},n.stats),{dragonsKilled:n.stats.dragonsKilled.plus(r(1))})})}return d(a({},n),{event:d(a({},n.event),{hp:i})})}),o&&p("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),p("Error interacting with dragon","error")}},Je=()=>{const e=r(1),o=r(1e12),n=t.totalGold;if(n.lt(o))return;const s=n.dividedBy(o),u=r(Math.floor(Math.pow(s.toNumber(),.33))).times(e).minus(t.renown);if(u.lte(0))return;const h=a({},t.nationalProjects);Object.keys(h).forEach(f=>{h[f].active&&(h[f]=d(a({},h[f]),{active:!1,startTime:0,endTime:0}))}),c(d(a({},_),{renown:t.renown.plus(u),totalRenownEarned:t.totalRenownEarned.plus(u),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:h,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:r(Date.now()),lastSaveTime:r(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface})),Y(!1),p("Abdication Successful. Long live the new King!","success")},Xe=()=>{localStorage.removeItem("kingdom_save"),c(d(a({},_),{startTime:r(Date.now())})),R(!1),p("Game Reset","warning")},Ke=()=>{const o=U(t);localStorage.setItem("kingdom_save",JSON.stringify(o)),p("Game Saved","info")},Ve=()=>{c(e=>{const o=a({},e.nationalProjects);return Object.keys(o).forEach(n=>{o[n].active&&(o[n]=d(a({},o[n]),{endTime:Date.now()+5e3}))}),d(a({},e),{nationalProjects:o})}),p("Projects sped up to 5 seconds!","success")};window.speedUpProjects=Ve;const Ye=e=>{c(o=>d(a({},o),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),p(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),C(!1)},qe=()=>Z(null,null,function*(){Je()}),Qe=e=>Z(null,null,function*(){var o;if(!((o=t.playerProfile)!=null&&o.id)){p("Error: Player profile not found","error");return}try{yield Ot(t.playerProfile.id,e);const n=d(a({},t.playerProfile),{rulerName:e});c(u=>d(a({},u),{playerProfile:n}));const s=d(a({},t),{playerProfile:n}),i=U(s);localStorage.setItem("kingdom_save",JSON.stringify(i)),p(`Name successfully changed to "${e}"!`,"success")}catch(n){console.error("Error changing name:",n),p("Failed to change name. Please try again.","error")}}),Ze=e=>Z(null,null,function*(){var s;const o=((s=t.playerProfile)==null?void 0:s.id)||"default_player",n=yield Nt.redeemPromoCode(o,e);if(!n){p("Invalid or expired promo code!","error");return}switch(n.type){case"gold":c(i=>d(a({},i),{gold:i.gold.plus(r(n.value)),totalGold:i.totalGold.plus(r(n.value))})),p(`Received ${z(r(n.value))} gold!`,"success");break;case"betaTester":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:n.icon||"ðŸ§ª",specialTitle:n.title||"Beta Tester",isBetaTester:!0}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],e],specialIcon:n.icon||"â­",specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p(`Special icon unlocked: ${n.icon}!`,"success");break;case"title":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],e],specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p(`Special title unlocked: ${n.title}!`,"success");break;default:p("Promo code redeemed!","success")}}),ye=e=>{c(o=>d(a({},o),{interface:d(a({},o.interface),{lastBuyAmount:e})}))},ve=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:w&&t.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return l.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:K?"column":"row"},children:[l.jsx(bt,{toasts:G}),l.jsx(wt,{}),w&&t.idleModeEnabled&&l.jsx(Bt,{gameState:t}),!K&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:ve("left"),children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:l.jsx("button",{className:`tab-btn ${se==="buildings"?"active":""}`,onClick:()=>De("buildings"),children:"Estates"})}),l.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:se==="buildings"&&l.jsx(ke,{gameState:t,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),l.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:w&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:l.jsx(Le,{gameState:t,gps:F,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>Y(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>q(!0),isIdle:w&&t.idleModeEnabled})}),l.jsxs("div",{style:ve("right"),children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:l.jsx("button",{className:`tab-btn ${ie==="army"?"active":""}`,onClick:()=>Oe("army"),children:"Future"})}),l.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:ie==="army"&&l.jsx(Me,{gameState:t})})]})]}),K&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[I==="buildings"&&l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:l.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsx(ke,{gameState:t,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),I==="throne"&&l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:l.jsx(Le,{gameState:t,gps:F,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>Y(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>ne(!0),onOpenEmpire:()=>q(!0),isIdle:w&&t.idleModeEnabled})}),I==="army"&&l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:l.jsx("button",{className:"tab-btn active",children:"Future"})}),l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsx(Me,{gameState:t})})]}),I==="empire"&&l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[l.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),l.jsx("p",{children:"Construct massive infrastructure to boost global production."}),l.jsx("button",{className:"btn",onClick:()=>q(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[l.jsxs("button",{className:`mobile-nav-btn ${I==="buildings"?"active":""}`,onClick:()=>{A("light"),V("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),l.jsx("div",{children:"Estates"})]}),l.jsxs("button",{className:`mobile-nav-btn ${I==="throne"?"active":""}`,onClick:()=>{A("light"),V("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),l.jsx("div",{children:"Throne"})]}),l.jsxs("button",{className:`mobile-nav-btn ${I==="army"?"active":""}`,onClick:()=>{A("light"),V("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),l.jsx("div",{children:"Future"})]}),l.jsxs("button",{className:`mobile-nav-btn ${I==="empire"?"active":""}`,onClick:()=>{A("light"),V("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),l.jsx("div",{children:"Projects"})]})]})]}),!(w&&t.idleModeEnabled)&&k&&l.jsxs("div",{className:"achievement-popup",children:[l.jsx("div",{style:{fontSize:"2rem"},children:k.icon}),l.jsxs("div",{children:[l.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),l.jsx("div",{style:{color:"var(--accent-color)"},children:k.name})]})]}),O&&l.jsx(St,{gained:O.gained,effectiveTime:O.effectiveTime,totalTime:O.totalTime,efficiency:O.efficiency,completedProjects:O.completedProjects,currentLevel:O.currentLevel,maxDuration:O.maxDuration,numberFormat:t.numberFormat,onClose:()=>X(null)}),Fe&&l.jsx(Pt,{gameState:t,onClose:()=>q(!1),onStartProject:e=>{var i;const o=((i=t.nationalProjects[e])==null?void 0:i.level)||0;if(o>=ut)return;const n=ft(e,o+1);if(t.gold.lt(n.gold))return;const s=yt(o+1);c(u=>d(a({},u),{gold:u.gold.minus(n.gold),nationalProjects:d(a({},u.nationalProjects),{[e]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+s*1e3}})})),p("Construction started!","info")},onUpgradeClickPower:ze,onUpgradeOffline:He}),Be&&l.jsx(Et,{gameState:t,onGamble:(e,o)=>{const n=r(e);c(s=>d(a({},s),{gold:o?s.gold.plus(n):s.gold.minus(n).max(0),stats:d(a({},s.stats),{tavernGamesPlayed:s.stats.tavernGamesPlayed.plus(r(1))})}))},onClose:()=>te(!1)}),Ge&&l.jsx(Ct,{gameState:t,onPrestige:qe,onClose:()=>Y(!1)}),Re&&l.jsx(jt,{gameState:t,onClose:()=>R(!1),onHardReset:Xe,onSave:Ke,onSetTheme:e=>c(o=>d(a({},o),{theme:e})),onSetNumberFormat:e=>c(o=>d(a({},o),{numberFormat:e})),onToggleIdleMode:()=>c(e=>d(a({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>c(o=>d(a({},o),{interface:a(a({},o.interface),e)})),onOpenPromoCodes:()=>{R(!1),re(!0)},onChangeName:()=>fe(!0)}),$e&&l.jsx(Tt,{gameState:t,onClose:()=>re(!1),onRedeemPromoCode:Ze,onBackToSettings:()=>{re(!1),R(!0)}}),Ue&&l.jsx(kt,{gameState:t,currentGps:F,onClose:()=>oe(!1)}),Ae&&l.jsx(Mt,{onClose:()=>_e(!1)}),ae&&l.jsx(Lt,{isOpen:ae,onClose:()=>{ce(!1),C(!0)},onConfirm:Ye,gameState:t}),de&&l.jsx(It,{isOpen:de,onClose:()=>ne(!1),playerProfile:t.playerProfile}),ue&&l.jsx(Dt,{isOpen:ue,onClose:()=>fe(!1),onConfirm:Qe,currentName:((we=t.playerProfile)==null?void 0:we.rulerName)||""})]})},Ie=document.getElementById("root");if(!Ie)throw new Error("Could not find root element to mount to");const Rt=it.createRoot(Ie);Rt.render(l.jsx(at.StrictMode,{children:l.jsx(Gt,{})}))});export default At();
