var it=Object.defineProperty,at=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var dt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var ke=(t,d,w)=>d in t?it(t,d,{enumerable:!0,configurable:!0,writable:!0,value:w}):t[d]=w,s=(t,d)=>{for(var w in d||(d={}))dt.call(d,w)&&ke(t,w,d[w]);if(je)for(var w of je(d))ut.call(d,w)&&ke(t,w,d[w]);return t},a=(t,d)=>at(t,ct(d));var ft=(t,d)=>()=>(d||t((d={exports:{}}).exports,d),d.exports);var ne=(t,d,w)=>new Promise((G,P)=>{var S=j=>{try{D(w.next(j))}catch(I){P(I)}},L=j=>{try{D(w.throw(j))}catch(I){P(I)}},D=j=>j.done?G(j.value):Promise.resolve(j.value).then(S,L);D((w=w.apply(t,d)).next())});import{j as i,r as h,a as mt,R as gt}from"./vendor-react-CUeQczFW.js";import{t as n,f as V,T as Le,j as Me,B as z,P as pt,g as Ie,p as de,A as ht,k as yt,l as ue,M as vt,b as bt,m as Ge,i as wt,d as xt,e as Pt,c as St,q as Ct,a as Et}from"./core-BLe5j-6i.js";import{g as De,T as Tt,G as jt}from"./components-ui-BeL8qPGz.js";import{B as Oe,P as Be}from"./components-store-Bf5EGLgG.js";import{M as Ne}from"./components-main-Jw6b0Csf.js";import{s as Re,a as re,O as kt,E as Lt,T as Mt,P as It,S as Gt,b as Dt,c as Ot,C as Bt,R as Nt,L as Rt,d as At,u as _t}from"./components-modals-DEENK7VM.js";import{P as Ut}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-Cx03PYNb.js";import"./vendor-firebase-IMiYFFvY.js";var zt=ft(le=>{(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))G(P);new MutationObserver(P=>{for(const S of P)if(S.type==="childList")for(const L of S.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&G(L)}).observe(document,{childList:!0,subtree:!0});function w(P){const S={};return P.integrity&&(S.integrity=P.integrity),P.referrerPolicy&&(S.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?S.credentials="include":P.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function G(P){if(P.ep)return;P.ep=!0;const S=w(P);fetch(P.href,S)}})();const Ft=({gameState:t})=>{const{weather:d,buildings:w,totalGold:G}=t,P=Y=>{var B;return((B=w[Y])==null?void 0:B.toNumber())||0};let S="wilderness";P("palace")>0?S="empire":P("castle")>0||P("market")>0?S="city":(P("peasant")>20||P("field")>10||G.gt(n(500)))&&(S="hamlet");let L="",D="";switch(S){case"wilderness":L="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",D="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":L="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",D="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":L="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",D="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":L="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",D="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const j=d.current;let I="none",R="",_=0;return j==="rainy"?(I="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",R="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",_=1):j==="stormy"?(I="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",R="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",_=1):j==="sunny"?(I="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",R="â˜€ï¸",_=.6):j==="windy"&&(R="ðŸƒ ðŸƒ ðŸƒ",_=.8),i.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:L,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[i.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:_,animation:j==="windy"?"float 3s infinite ease-in-out":"none"},children:R}),I!=="none"&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:I,pointerEvents:"none"}}),i.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:D}),i.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),i.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},A={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:n(1),layout:{left:n(1),center:n(1),right:n(1)},borderWidth:n(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},U={gold:n(0),totalGold:n(0),totalRenownEarned:n(0),startTime:n(Date.now()),lastSaveTime:n(Date.now()),buildings:{},achievements:[],renown:n(0),prestigeCount:0,darkMatterGold:n(0),infiniteTowerLevel:0,portalProgress:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:n(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:A,stats:{totalClicks:n(0),dragonsKilled:n(0),tavernGamesPlayed:n(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1},H=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(H);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const d={};for(const w in t)t.hasOwnProperty(w)&&(d[w]=H(t[w]));return d}return t},Wt=()=>{var Ee,Te;const[t,d]=h.useState(()=>{var o,r,l,c,f,p,g,x,m,E,y,T,N;const e=localStorage.getItem("kingdom_save");if(e)try{const u=JSON.parse(e);if((o=u.playerProfile)!=null&&o.id){const v=localStorage.getItem(`playerProfile_${u.playerProfile.id}`);v&&(u.playerProfile=JSON.parse(v))}const C=u.interface||{},M=a(s(s({},A),C),{lastBuyAmount:n((r=C.lastBuyAmount)!=null?r:1),crownAnimations:(l=C.crownAnimations)!=null?l:!0,layout:{left:n((f=(c=C.layout)==null?void 0:c.left)!=null?f:A.layout.left),center:n((g=(p=C.layout)==null?void 0:p.center)!=null?g:A.layout.center),right:n((m=(x=C.layout)==null?void 0:x.right)!=null?m:A.layout.right)},borderWidth:n((E=C.borderWidth)!=null?E:A.borderWidth),customColors:s(s({},A.customColors),C.customColors||{})});return a(s(s({},U),u),{renown:n(u.renown||0),totalRenownEarned:n(u.totalRenownEarned||0),prestigeCount:u.prestigeCount||0,gold:n(u.gold||0),totalGold:n(u.totalGold||0),startTime:n(u.startTime||Date.now()),lastSaveTime:n(u.lastSaveTime||Date.now()),darkMatterGold:n(u.darkMatterGold||0),infiniteTowerLevel:u.infiniteTowerLevel||0,portalProgress:u.portalProgress||0,buildings:Object.keys(u.buildings||{}).reduce((v,k)=>(v[k]=n(u.buildings[k]),v),{}),stats:a(s(s({},U.stats),u.stats||{}),{totalClicks:n(((y=u.stats)==null?void 0:y.totalClicks)||0),dragonsKilled:n(((T=u.stats)==null?void 0:T.dragonsKilled)||0),tavernGamesPlayed:n(((N=u.stats)==null?void 0:N.tavernGamesPlayed)||0)}),nationalProjects:u.nationalProjects||{},clickUpgradeLevel:u.clickUpgradeLevel||0,offlineUpgradeLevel:u.offlineUpgradeLevel||0,interface:M,playerProfile:u.playerProfile?a(s({},u.playerProfile),{lastLeaderboardSubmit:u.playerProfile.lastLeaderboardSubmit||0}):null,globalIncomeMultiplier:u.globalIncomeMultiplier||1,isDeveloperWifeBlessingObtained:u.isDeveloperWifeBlessingObtained||!1})}catch(u){console.error("Save load failed",u)}return U}),w=h.useRef(t);h.useEffect(()=>{w.current=t},[t]);const G=h.useRef("");h.useEffect(()=>{const e=o=>{G.current=(G.current+o.key).slice(-20);const r=G.current.toLowerCase();r.endsWith("godon")?(d(l=>a(s({},l),{godMode:!0})),b("God Mode Enabled: +99999s per click","success"),G.current=""):r.endsWith("godoff")&&(d(l=>a(s({},l),{godMode:!1})),b("God Mode Disabled","info"),G.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const P=()=>{q(null);const e=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(e){const r=o-parseInt(e),l=n(r/1e3);if(l.gte(n(60))){const c=t.offlineUpgradeLevel||0,{efficiency:f,duration:p}=Me(c),g=n(p),x=l.lt(g)?l:g,E=J(t).times(n(f)).times(x).floor();E.gt(n(0))&&(q({gained:E,effectiveTime:x,totalTime:l,efficiency:f,completedProjects:[],currentLevel:c,maxDuration:p}),d(y=>a(s({},y),{gold:y.gold.plus(E),totalGold:y.totalGold.plus(E)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[S,L]=h.useState(!1);h.useEffect(()=>{let e;const o=()=>{L(!1),clearTimeout(e),t.idleModeEnabled&&(e=setTimeout(()=>{L(!0)},2e4))};o();const r=["mousemove","mousedown","keydown","touchstart","scroll"];return r.forEach(l=>window.addEventListener(l,o)),()=>{clearTimeout(e),r.forEach(l=>window.removeEventListener(l,o))}},[t.idleModeEnabled]),h.useEffect(()=>{t.event&&L(!1)},[t.event]),h.useEffect(()=>{const e=V(t.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[t.gold]),h.useEffect(()=>{const e=document.documentElement,o=t.interface||A,r=t.theme||"default",l=Le[r]||Le.default;l&&Object.entries(l.colors).forEach(([p,g])=>{e.style.setProperty(p,g)});const c={compact:"8px",normal:"12px",spacious:"20px"},f={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",c[o.density]),e.style.setProperty("--gap-size",f[o.density]),e.style.setProperty("--col-left",String(o.layout.left)),e.style.setProperty("--col-center",String(o.layout.center)),e.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[D,j]=h.useState(!1);h.useEffect(()=>{var e;t.gold.gte(n(1e7))&&!((e=t.playerProfile)!=null&&e.hasChosenName)&&!D&&pe(!0)},[t.gold,t.playerProfile,D]);const[I,R]=h.useState(null),[_,Y]=h.useState([]),[B,q]=h.useState(null),[fe,_e]=h.useState("buildings"),[me,Ue]=h.useState("army"),[Q,Fe]=h.useState(!1),[O,Z]=h.useState("throne");h.useEffect(()=>{const e=()=>{Fe(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[We,se]=h.useState(!1),[$e,ee]=h.useState(!1),[ze,F]=h.useState(!1),[He,Je]=h.useState(!1),[Ke,ie]=h.useState(!1),[Xe,te]=h.useState(!1),[ge,pe]=h.useState(!1),[he,ae]=h.useState(!1),[Ve,ce]=h.useState(!1),[ye,ve]=h.useState(!1),b=(e,o="info")=>{const r=Date.now().toString()+Math.random();Y(l=>[...l,{id:r,message:e,type:o}]),setTimeout(()=>{Y(l=>l.filter(c=>c.id!==r))},3e3)};h.useEffect(()=>{const e=Date.now();if(t.lastSaveTime&&n(e).minus(t.lastSaveTime).gt(n(6e4))){const o=n(e).minus(t.lastSaveTime).dividedBy(n(1e3)),{efficiency:r,duration:l}=Me(t.offlineUpgradeLevel||0),c=n(l),f=o.lt(c)?o:c,g=J(t).times(n(r)).times(f).floor(),x=[];let m=s({},t.nationalProjects),E=!1;Object.keys(m).forEach(y=>{var N;const T=m[y];if(T.active&&T.endTime&&e>=T.endTime){m[y]=a(s({},T),{active:!1,level:T.level+1,startTime:0,endTime:0});const u=(N=z.find(C=>C.id===y))==null?void 0:N.name;u&&x.push(`${u} Infrastructure (Lvl ${T.level+1})`),E=!0}}),(g.gt(n(0))||x.length>0)&&(q(y=>y||{gained:g,effectiveTime:f,totalTime:o,efficiency:r,completedProjects:x,currentLevel:t.offlineUpgradeLevel||0,maxDuration:l}),d(y=>a(s({},y),{gold:y.gold.plus(g),totalGold:y.totalGold.plus(g),nationalProjects:E?m:y.nationalProjects})))}},[]),h.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&d(o=>{const r=a(s({},o),{lastSaveTime:n(Date.now())}),l=H(r);return localStorage.setItem("kingdom_save",JSON.stringify(l)),r})},1e3);return()=>clearInterval(e)},[]),h.useEffect(()=>{const e=()=>{const r=w.current,l=H(r);localStorage.setItem("kingdom_save",JSON.stringify(l)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const o=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&P()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",o)}},[]),h.useEffect(()=>{var r;if(!((r=t.playerProfile)!=null&&r.hasChosenName))return;(()=>{var p;const l=Date.now(),c=((p=t.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,f=3600*1e3;if(l-c>=f){const g={rulerName:t.playerProfile.rulerName,rulerId:t.playerProfile.rulerId,gold:t.totalGold,renown:t.totalRenownEarned,achievements:t.achievements.length,totalClicks:t.stats.totalClicks};Promise.all([re(a(s({},g),{period:"alltime"})),re(a(s({},g),{period:"weekly"})),Re(t,t.playerProfile.rulerId,t.playerProfile.rulerName)]).then(()=>{d(x=>a(s({},x),{playerProfile:a(s({},x.playerProfile),{lastLeaderboardSubmit:Date.now()})})),b("Leaderboard data synced on load!","success")}).catch(x=>{console.error("Initial leaderboard submission failed:",x)})}})();const o=setInterval(()=>{var g;const l=w.current,c=Date.now(),f=((g=l.playerProfile)==null?void 0:g.lastLeaderboardSubmit)||0,p=3600*1e3;if(c-f>=p){Re(l,l.playerProfile.rulerId,l.playerProfile.rulerName).catch(m=>{console.error("Failed to save player stats:",m)});const x={rulerName:l.playerProfile.rulerName,rulerId:l.playerProfile.rulerId,gold:l.totalGold,renown:l.totalRenownEarned,achievements:l.achievements.length,totalClicks:l.stats.totalClicks};Promise.all([re(a(s({},x),{period:"alltime"})),re(a(s({},x),{period:"weekly"}))]).then(()=>{d(m=>a(s({},m),{playerProfile:a(s({},m.playerProfile),{lastLeaderboardSubmit:Date.now()})})),b("Leaderboard data submitted successfully!","success")}).catch(m=>{console.error("Auto leaderboard submission failed:",m)})}},6e4);return()=>clearInterval(o)},[(Ee=t.playerProfile)==null?void 0:Ee.hasChosenName]),h.useEffect(()=>{const e=setInterval(()=>{if(!t.event&&Math.random()<.05){const l=["dragon","merchant","jester"],c=l[Math.floor(Math.random()*l.length)],f=c==="dragon"?6e5:3e4,p={id:Date.now().toString(),type:c,expiresAt:n(Date.now()).plus(n(f)),hp:c==="dragon"?n(10):void 0,maxHp:c==="dragon"?n(10):void 0,reward:n(0),startTime:c==="dragon"?Date.now():void 0};d(g=>a(s({},g),{event:p}))}},1e4);return()=>clearInterval(e)},[t.event]);const J=e=>{var x;let o=n(0);const r=((x=e.weather)==null?void 0:x.current)||"clear";z.forEach(m=>{const E=e.buildings[m.id]||n(0);let y=m.baseProduction;o=o.plus(E.times(y))});const l=De(e.totalRenownEarned);l.gt(n(1))&&(o=o.times(l));let c=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(m=>{c+=m.level||0});const f=n(1).plus(n(c*pt));o=o.times(f);const p=Ie(e.infiniteTowerLevel||0);o=o.times(p),n(1),z.forEach(m=>{const E=e.buildings[m.id]||n(0);if(E.gt(0)){let y=n(1);r==="sunny"?(m.id==="peasant"||m.id==="field"||m.id==="stable"||m.id==="cathedral")&&(y=n(1.2)):r==="rainy"?(m.id==="silver_mine"||m.id==="alchemist"||m.id==="market"||m.id==="tavern")&&(y=n(1.2)):r==="stormy"?((m.id==="blacksmith"||m.id==="void_portal")&&(y=n(1.3)),(m.id==="field"||m.id==="stable")&&(y=n(.8))):r==="windy"&&(m.id==="market"||m.id==="castle"||m.id==="time_chamber")&&(y=n(1.15));const T=E.times(m.baseProduction);if(l.gt(n(1))){const N=T.times(l).times(f).times(y.minus(n(1)));o=o.plus(N)}else{const N=T.times(f).times(y.minus(n(1)));o=o.plus(N)}}});const g=n(1).plus(n(e.achievements.length*.02));if(o=o.times(g),e.globalIncomeMultiplier&&(o=o.times(n(e.globalIncomeMultiplier))),e.event&&e.event.type==="dragon"&&e.event.startTime){const m=Math.floor((Date.now()-e.event.startTime)/1e3),y=1-Math.min(99,m)/100;o=o.times(n(y))}return o},K=J(t),X=h.useRef(K);X.current=K,h.useEffect(()=>{const e=setInterval(()=>{d(o=>{const r=Date.now(),l=X.current.times(n(de)).dividedBy(n(1e3));let c=o.totalGold.plus(l),f=o.gold.plus(l),p=s({},o.weather);const g=n(de/1e3);if(p.timeLeft=n(p.timeLeft||0).minus(g),p.timeLeft.lte(n(0))){const C=["clear","sunny","rainy","stormy","windy"],M=C[Math.floor(Math.random()*C.length)],$=n(Math.floor(Math.random()*120)+60);p={current:M,timeLeft:$}}let x=o.event;x&&x.expiresAt&&n(x.expiresAt).lt(n(r))&&(x=null);let m=s({},o.nationalProjects||{});Object.keys(m).forEach(C=>{var $;const M=m[C];M.active&&M.endTime&&r>=M.endTime&&(m[C]=a(s({},M),{active:!1,level:M.level+1,startTime:0,endTime:0}),b(`Project Completed: ${($=z.find(v=>v.id===C))==null?void 0:$.name} Infrastructure Level ${M.level+1}!`,"success"))});const E=[...o.achievements];let y=null;ht.forEach(C=>{E.includes(C.id)||C.condition(a(s({},o),{totalGold:c,gold:f}),X.current)&&(E.push(C.id),y=C)}),y&&(R(y),setTimeout(()=>R(null),3e3));const T=yt(c),N=(o.infiniteTowerLevel||0)>0?Array.from({length:o.infiniteTowerLevel},(C,M)=>ue(M)).reduce((C,M)=>C.plus(M),n(0)):n(0),u=T.minus(N);return a(s({},o),{gold:f,totalGold:c,darkMatterGold:u,achievements:E,event:x,weather:p,nationalProjects:m})})},de);return()=>clearInterval(e)},[]);const W=(e="light")=>{if("vibrate"in navigator&&Q)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},be=(e=!1)=>{if(e||W("light"),!e&&!t.isDeveloperWifeBlessingObtained&&t.totalGold.gte(n(1e12))&&Math.random()<1e-6){d(l=>a(s({},l),{globalIncomeMultiplier:(l.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...l.achievements,"developer_wife_blessing"])]})),b("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const o=Ye(w.current);d(r=>a(s({},r),{gold:r.gold.plus(o),totalGold:r.totalGold.plus(o),stats:a(s({},r.stats),{totalClicks:e?r.stats.totalClicks:r.stats.totalClicks.plus(n(1))})}))},Ye=e=>{const o=n(1),r=e.clickUpgradeLevel||0,l=Math.min(r,15),c=n(2).pow(l),f=o.times(c),p=De(e.totalRenownEarned);let g=f;p.gt(n(1))&&(g=f.times(p));const x=Ie(e.infiniteTowerLevel||0);g=g.times(x);const m=Et(r);if(m>0){const T=J(e).times(m);g=g.plus(T)}const E=n(1).plus(n(e.achievements.length*.02));if(g=g.times(E),e.globalIncomeMultiplier&&(g=g.times(n(e.globalIncomeMultiplier))),e.godMode){const T=J(e).times(n(99999));g=g.plus(T)}return g},qe=()=>{const e=t.clickUpgradeLevel||0;if(e>=Pt){b("Maximum Royal Scepter level reached!","warning");return}const o=St(e+1);if(t.gold.lt(o)){b("Not enough gold!","error");return}d(r=>a(s({},r),{gold:r.gold.minus(o),clickUpgradeLevel:r.clickUpgradeLevel+1})),b(`Royal Scepter upgraded to level ${e+1}!`,"success")},Qe=()=>{const e=t.offlineUpgradeLevel||0;if(e>=wt){b("Maximum Passive Income level reached!","warning");return}const o=xt(e+1);if(t.renown.lt(o)){b("Not enough Renown!","error");return}d(r=>a(s({},r),{renown:r.renown.minus(o),offlineUpgradeLevel:r.offlineUpgradeLevel+1})),b(`Passive Income upgraded to level ${e+1}!`,"success")},we=(e,o)=>{const r=z.find(f=>f.id===e);if(!r||o<=0)return;const l=t.buildings[e]||n(0),c=Ge(r.baseCost,l,n(o)).floor();t.gold.gte(c)&&(W("medium"),d(f=>a(s({},f),{gold:f.gold.minus(c),buildings:a(s({},f.buildings),{[e]:(f.buildings[e]||n(0)).plus(n(o))})})))},xe=(e,o)=>{const r=z.find(p=>p.id===e);if(!r||o<=0)return;const l=t.buildings[e]||n(0),c=n(Math.min(o,l.toNumber()));if(c.lte(n(0)))return;const f=Ge(r.baseCost,l.minus(c),c).times(n(.25)).floor();d(p=>a(s({},p),{gold:p.gold.plus(f),buildings:a(s({},p.buildings),{[e]:l.minus(c)})}))},Pe=e=>{if(e.type==="merchant"){const o=X.current.times(n(10));d(r=>a(s({},r),{gold:r.gold.plus(o),totalGold:r.totalGold.plus(o),event:null})),b(`The merchant gifted you ${V(o.floor(),t.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const o=t.gold.times(n(.1)),r=Math.random()>.5;d(l=>a(s({},l),{gold:r?l.gold.plus(o):l.gold.minus(o),totalGold:r?l.totalGold.plus(o):l.totalGold,event:null})),r?b(`Jester pays out! +${V(o.floor(),t.numberFormat)}`,"success"):b(`Jester tricked you! -${V(o.floor(),t.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let o=!1;d(r=>{if(!r.event||r.event.type!=="dragon")return r;const c=n(r.event.hp||10).minus(n(1));if(c.lte(0)){const f=X.current.times(n(30));return o=!0,a(s({},r),{gold:r.gold.plus(f),totalGold:r.totalGold.plus(f),event:null,stats:a(s({},r.stats),{dragonsKilled:r.stats.dragonsKilled.plus(n(1))})})}return a(s({},r),{event:a(s({},r.event),{hp:c})})}),o&&b("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),b("Error interacting with dragon","error")}},Ze=()=>{const e=n(1),o=n(1e12),r=t.totalGold;if(r.lt(o))return;const l=r.dividedBy(o),f=n(Math.floor(Math.pow(l.toNumber(),.33))).times(e).minus(t.renown);if(f.lte(0))return;const p=s({},t.nationalProjects);Object.keys(p).forEach(g=>{p[g].active&&(p[g]=a(s({},p[g]),{active:!1,startTime:0,endTime:0}))}),d(a(s({},U),{renown:t.renown.plus(f),totalRenownEarned:t.totalRenownEarned.plus(f),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:p,offlineUpgradeLevel:t.offlineUpgradeLevel,darkMatterGold:t.darkMatterGold,infiniteTowerLevel:t.infiniteTowerLevel,playerProfile:t.playerProfile,startTime:n(Date.now()),lastSaveTime:n(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface})),ee(!1),b("Abdication Successful. Long live the new King!","success")},et=()=>{localStorage.removeItem("kingdom_save"),d(a(s({},U),{startTime:n(Date.now())})),F(!1),b("Game Reset","warning")},tt=()=>{const o=H(t);localStorage.setItem("kingdom_save",JSON.stringify(o)),b("Game Saved","info")},ot=()=>{d(e=>{const o=s({},e.nationalProjects);return Object.keys(o).forEach(r=>{o[r].active&&(o[r]=a(s({},o[r]),{endTime:Date.now()+5e3}))}),a(s({},e),{nationalProjects:o})}),b("Projects sped up to 5 seconds!","success")};window.speedUpProjects=ot;const nt=e=>{d(o=>a(s({},o),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),b(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),j(!1)},rt=()=>ne(null,null,function*(){Ze()}),lt=e=>ne(null,null,function*(){var o;if(!((o=t.playerProfile)!=null&&o.id)){b("Error: Player profile not found","error");return}try{yield _t(t.playerProfile.id,e);const r=a(s({},t.playerProfile),{rulerName:e});d(f=>a(s({},f),{playerProfile:r}));const l=a(s({},t),{playerProfile:r}),c=H(l);localStorage.setItem("kingdom_save",JSON.stringify(c)),b(`Name successfully changed to "${e}"!`,"success")}catch(r){console.error("Error changing name:",r),b("Failed to change name. Please try again.","error")}}),st=e=>ne(null,null,function*(){var l;const o=((l=t.playerProfile)==null?void 0:l.id)||"default_player",r=yield Ut.redeemPromoCode(o,e);if(!r){b("Invalid or expired promo code!","error");return}switch(r.type){case"gold":d(c=>a(s({},c),{gold:c.gold.plus(n(r.value)),totalGold:c.totalGold.plus(n(r.value))})),b(`Received ${V(n(r.value))} gold!`,"success");break;case"betaTester":d(c=>{const f=c.playerProfile?a(s({},c.playerProfile),{usedPromoCodes:[...c.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:r.icon||"ðŸ§ª",specialTitle:r.title||"Beta Tester",isBetaTester:!0}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(s({},c),{playerProfile:f})}),b("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":d(c=>{const f=c.playerProfile?a(s({},c.playerProfile),{usedPromoCodes:[...c.playerProfile.usedPromoCodes||[],e],specialIcon:r.icon||"â­",specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(s({},c),{playerProfile:f})}),b(`Special icon unlocked: ${r.icon}!`,"success");break;case"title":d(c=>{const f=c.playerProfile?a(s({},c.playerProfile),{usedPromoCodes:[...c.playerProfile.usedPromoCodes||[],e],specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),a(s({},c),{playerProfile:f})}),b(`Special title unlocked: ${r.title}!`,"success");break;default:b("Promo code redeemed!","success")}}),Se=e=>{d(o=>a(s({},o),{interface:a(s({},o.interface),{lastBuyAmount:e})}))},Ce=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:S&&t.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return i.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:Q?"column":"row"},children:[i.jsx(Tt,{toasts:_}),i.jsx(jt,{}),S&&t.idleModeEnabled&&i.jsx(Ft,{gameState:t}),!Q&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:Ce("left"),children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:i.jsx("button",{className:`tab-btn ${fe==="buildings"?"active":""}`,onClick:()=>_e("buildings"),children:"Estates"})}),i.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:fe==="buildings"&&i.jsx(Oe,{gameState:t,onBuyBuilding:we,onSellBuilding:xe,onSetBuyAmount:Se})})]}),i.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:S&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:i.jsx(Ne,{gameState:t,gps:K,onClick:()=>be(!1),onEventInteract:Pe,onOpenTavern:()=>se(!0),onOpenPrestige:()=>ee(!0),onOpenSettings:()=>F(!0),onOpenStatistics:()=>ie(!0),onOpenLeaderboard:()=>{ae(!0)},onOpenEmpire:()=>te(!0),isIdle:S&&t.idleModeEnabled})}),i.jsxs("div",{style:Ce("right"),children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:i.jsx("button",{className:`tab-btn ${me==="army"?"active":""}`,onClick:()=>Ue("army"),children:"Future"})}),i.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"var(--accent-color) transparent"},children:me==="army"&&i.jsx(Be,{gameState:t,onBuyTowerFloor:()=>{const e=ue(t.infiniteTowerLevel||0);t.darkMatterGold.gte(e)&&(d(o=>a(s({},o),{darkMatterGold:o.darkMatterGold.minus(e),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]})]}),Q&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[O==="buildings"&&i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:i.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx(Oe,{gameState:t,onBuyBuilding:we,onSellBuilding:xe,onSetBuyAmount:Se})})]}),O==="throne"&&i.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:i.jsx(Ne,{gameState:t,gps:K,onClick:()=>be(!1),onEventInteract:Pe,onOpenTavern:()=>se(!0),onOpenPrestige:()=>ee(!0),onOpenSettings:()=>F(!0),onOpenStatistics:()=>ie(!0),onOpenLeaderboard:()=>ae(!0),onOpenEmpire:()=>te(!0),isIdle:S&&t.idleModeEnabled})}),O==="army"&&i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:i.jsx("button",{className:"tab-btn active",children:"Future"})}),i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx(Be,{gameState:t,onBuyTowerFloor:()=>{const e=ue(t.infiniteTowerLevel||0);t.darkMatterGold.gte(e)&&(d(o=>a(s({},o),{darkMatterGold:o.darkMatterGold.minus(e),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]}),O==="empire"&&i.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[i.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),i.jsx("p",{children:"Construct massive infrastructure to boost global production."}),i.jsx("button",{className:"btn",onClick:()=>te(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[i.jsxs("button",{className:`mobile-nav-btn ${O==="buildings"?"active":""}`,onClick:()=>{W("light"),Z("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),i.jsx("div",{children:"Estates"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="throne"?"active":""}`,onClick:()=>{W("light"),Z("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),i.jsx("div",{children:"Throne"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="army"?"active":""}`,onClick:()=>{W("light"),Z("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),i.jsx("div",{children:"Future"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="empire"?"active":""}`,onClick:()=>{W("light"),Z("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),i.jsx("div",{children:"Projects"})]})]})]}),!(S&&t.idleModeEnabled)&&I&&i.jsxs("div",{className:"achievement-popup",children:[i.jsx("div",{style:{fontSize:"2rem"},children:I.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),i.jsx("div",{style:{color:"var(--accent-color)"},children:I.name})]})]}),B&&i.jsx(kt,{gained:B.gained,effectiveTime:B.effectiveTime,totalTime:B.totalTime,efficiency:B.efficiency,completedProjects:B.completedProjects,currentLevel:B.currentLevel,maxDuration:B.maxDuration,numberFormat:t.numberFormat,onClose:()=>q(null)}),Xe&&i.jsx(Lt,{gameState:t,onClose:()=>te(!1),onStartProject:e=>{var c;const o=((c=t.nationalProjects[e])==null?void 0:c.level)||0;if(o>=vt)return;const r=bt(e,o+1);if(t.gold.lt(r.gold))return;const l=Ct();d(f=>a(s({},f),{gold:f.gold.minus(r.gold),nationalProjects:a(s({},f.nationalProjects),{[e]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+l*1e3}})})),b("Construction started!","info")},onUpgradeClickPower:qe,onUpgradeOffline:Qe}),We&&i.jsx(Mt,{gameState:t,onGamble:(e,o)=>{const r=n(e);d(l=>a(s({},l),{gold:o?l.gold.plus(r):l.gold.minus(r).max(0),stats:a(s({},l.stats),{tavernGamesPlayed:l.stats.tavernGamesPlayed.plus(n(1))})}))},onClose:()=>se(!1)}),$e&&i.jsx(It,{gameState:t,onPrestige:rt,onClose:()=>ee(!1)}),ze&&i.jsx(Gt,{gameState:t,onClose:()=>F(!1),onHardReset:et,onSave:tt,onSetTheme:e=>d(o=>a(s({},o),{theme:e})),onSetNumberFormat:e=>d(o=>a(s({},o),{numberFormat:e})),onToggleIdleMode:()=>d(e=>a(s({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>d(o=>a(s({},o),{interface:s(s({},o.interface),e)})),onOpenPromoCodes:()=>{F(!1),ce(!0)},onChangeName:()=>ve(!0)}),Ve&&i.jsx(Dt,{gameState:t,onClose:()=>ce(!1),onRedeemPromoCode:st,onBackToSettings:()=>{ce(!1),F(!0)}}),Ke&&i.jsx(Ot,{gameState:t,currentGps:K,onClose:()=>ie(!1)}),He&&i.jsx(Bt,{onClose:()=>Je(!1)}),ge&&i.jsx(Nt,{isOpen:ge,onClose:()=>{pe(!1),j(!0)},onConfirm:nt,gameState:t}),he&&i.jsx(Rt,{isOpen:he,onClose:()=>ae(!1),playerProfile:t.playerProfile,gameState:t,addToast:b}),ye&&i.jsx(At,{isOpen:ye,onClose:()=>ve(!1),onConfirm:lt,currentName:((Te=t.playerProfile)==null?void 0:Te.rulerName)||""})]})},Ae=document.getElementById("root");if(!Ae)throw new Error("Could not find root element to mount to");const $t=mt.createRoot(Ae);$t.render(i.jsx(gt.StrictMode,{children:i.jsx(Wt,{})}))});export default zt();
