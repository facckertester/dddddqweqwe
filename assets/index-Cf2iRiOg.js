var lt=Object.defineProperty,st=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var je=(n,c,w)=>c in n?lt(n,c,{enumerable:!0,configurable:!0,writable:!0,value:w}):n[c]=w,l=(n,c)=>{for(var w in c||(c={}))at.call(c,w)&&je(n,w,c[w]);if(Ee)for(var w of Ee(c))ct.call(c,w)&&je(n,w,c[w]);return n},d=(n,c)=>st(n,it(c));var dt=(n,c)=>()=>(c||n((c={exports:{}}).exports,c),c.exports);var ne=(n,c,w)=>new Promise((G,x)=>{var P=j=>{try{D(w.next(j))}catch(I){x(I)}},M=j=>{try{D(w.throw(j))}catch(I){x(I)}},D=j=>j.done?G(j.value):Promise.resolve(j.value).then(P,M);D((w=w.apply(n,c)).next())});import{j as i,r as p,a as ut,R as ft}from"./vendor-react-CUeQczFW.js";import{t as o,f as V,T as ke,j as Me,B as z,P as mt,g as Le,p as ce,A as gt,k as pt,l as de,M as ht,b as yt,m as Ie,i as vt,d as bt,e as wt,c as xt,q as Pt,a as St}from"./core-BLe5j-6i.js";import{g as Ge,T as Ct,G as Tt}from"./components-ui-pystH6UY.js";import{B as De,P as Oe}from"./components-store-DqROwTUv.js";import{M as Be}from"./components-main-Cu7GXSz9.js";import{s as Et,a as jt,O as kt,E as Mt,T as Lt,P as It,S as Gt,b as Dt,c as Ot,C as Bt,R as Nt,L as Rt,d as At,u as _t}from"./components-modals-Cc918Qrf.js";import{P as Ut}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-Cx03PYNb.js";import"./vendor-firebase-IMiYFFvY.js";var zt=dt(re=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))G(x);new MutationObserver(x=>{for(const P of x)if(P.type==="childList")for(const M of P.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&G(M)}).observe(document,{childList:!0,subtree:!0});function w(x){const P={};return x.integrity&&(P.integrity=x.integrity),x.referrerPolicy&&(P.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?P.credentials="include":x.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function G(x){if(x.ep)return;x.ep=!0;const P=w(x);fetch(x.href,P)}})();const Ft=({gameState:n})=>{const{weather:c,buildings:w,totalGold:G}=n,x=Y=>{var B;return((B=w[Y])==null?void 0:B.toNumber())||0};let P="wilderness";x("palace")>0?P="empire":x("castle")>0||x("market")>0?P="city":(x("peasant")>20||x("field")>10||G.gt(o(500)))&&(P="hamlet");let M="",D="";switch(P){case"wilderness":M="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",D="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":M="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",D="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":M="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",D="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":M="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",D="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const j=c.current;let I="none",R="",_=0;return j==="rainy"?(I="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",R="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",_=1):j==="stormy"?(I="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",R="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",_=1):j==="sunny"?(I="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",R="â˜€ï¸",_=.6):j==="windy"&&(R="ðŸƒ ðŸƒ ðŸƒ",_=.8),i.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:M,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[i.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:_,animation:j==="windy"?"float 3s infinite ease-in-out":"none"},children:R}),I!=="none"&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:I,pointerEvents:"none"}}),i.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:D}),i.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),i.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},A={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},U={gold:o(0),totalGold:o(0),totalRenownEarned:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,darkMatterGold:o(0),infiniteTowerLevel:0,portalProgress:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:A,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1},H=n=>{if(n==null||typeof n=="string"||typeof n=="number"||typeof n=="boolean")return n;if(Array.isArray(n))return n.map(H);if(typeof n=="object"&&n.toString&&typeof n.toString=="function"&&(n.hasOwnProperty("mantissa")||n.hasOwnProperty("exponent")))return n.toString();if(typeof n=="object"){const c={};for(const w in n)n.hasOwnProperty(w)&&(c[w]=H(n[w]));return c}return n},Wt=()=>{var Ce,Te;const[n,c]=p.useState(()=>{var t,r,s,a,f,h,m,T,g,C,y,E,N;const e=localStorage.getItem("kingdom_save");if(e)try{const u=JSON.parse(e);if((t=u.playerProfile)!=null&&t.id){const v=localStorage.getItem(`playerProfile_${u.playerProfile.id}`);v&&(u.playerProfile=JSON.parse(v))}const S=u.interface||{},L=d(l(l({},A),S),{lastBuyAmount:o((r=S.lastBuyAmount)!=null?r:1),crownAnimations:(s=S.crownAnimations)!=null?s:!0,layout:{left:o((f=(a=S.layout)==null?void 0:a.left)!=null?f:A.layout.left),center:o((m=(h=S.layout)==null?void 0:h.center)!=null?m:A.layout.center),right:o((g=(T=S.layout)==null?void 0:T.right)!=null?g:A.layout.right)},borderWidth:o((C=S.borderWidth)!=null?C:A.borderWidth),customColors:l(l({},A.customColors),S.customColors||{})});return d(l(l({},U),u),{renown:o(u.renown||0),totalRenownEarned:o(u.totalRenownEarned||0),prestigeCount:u.prestigeCount||0,gold:o(u.gold||0),totalGold:o(u.totalGold||0),startTime:o(u.startTime||Date.now()),lastSaveTime:o(u.lastSaveTime||Date.now()),darkMatterGold:o(u.darkMatterGold||0),infiniteTowerLevel:u.infiniteTowerLevel||0,portalProgress:u.portalProgress||0,buildings:Object.keys(u.buildings||{}).reduce((v,k)=>(v[k]=o(u.buildings[k]),v),{}),stats:d(l(l({},U.stats),u.stats||{}),{totalClicks:o(((y=u.stats)==null?void 0:y.totalClicks)||0),dragonsKilled:o(((E=u.stats)==null?void 0:E.dragonsKilled)||0),tavernGamesPlayed:o(((N=u.stats)==null?void 0:N.tavernGamesPlayed)||0)}),nationalProjects:u.nationalProjects||{},clickUpgradeLevel:u.clickUpgradeLevel||0,offlineUpgradeLevel:u.offlineUpgradeLevel||0,interface:L,playerProfile:u.playerProfile?d(l({},u.playerProfile),{lastLeaderboardSubmit:u.playerProfile.lastLeaderboardSubmit||0}):null,globalIncomeMultiplier:u.globalIncomeMultiplier||1,isDeveloperWifeBlessingObtained:u.isDeveloperWifeBlessingObtained||!1})}catch(u){console.error("Save load failed",u)}return U}),w=p.useRef(n);p.useEffect(()=>{w.current=n},[n]);const G=p.useRef("");p.useEffect(()=>{const e=t=>{G.current=(G.current+t.key).slice(-20);const r=G.current.toLowerCase();r.endsWith("godon")?(c(s=>d(l({},s),{godMode:!0})),b("God Mode Enabled: +99999s per click","success"),G.current=""):r.endsWith("godoff")&&(c(s=>d(l({},s),{godMode:!1})),b("God Mode Disabled","info"),G.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const x=()=>{q(null);const e=localStorage.getItem("kingdom_last_save_time"),t=Date.now();if(e){const r=t-parseInt(e),s=o(r/1e3);if(s.gte(o(60))){const a=n.offlineUpgradeLevel||0,{efficiency:f,duration:h}=Me(a),m=o(h),T=s.lt(m)?s:m,C=J(n).times(o(f)).times(T).floor();C.gt(o(0))&&(q({gained:C,effectiveTime:T,totalTime:s,efficiency:f,completedProjects:[],currentLevel:a,maxDuration:h}),c(y=>d(l({},y),{gold:y.gold.plus(C),totalGold:y.totalGold.plus(C)})))}}localStorage.setItem("kingdom_last_save_time",t.toString())},[P,M]=p.useState(!1);p.useEffect(()=>{let e;const t=()=>{M(!1),clearTimeout(e),n.idleModeEnabled&&(e=setTimeout(()=>{M(!0)},2e4))};t();const r=["mousemove","mousedown","keydown","touchstart","scroll"];return r.forEach(s=>window.addEventListener(s,t)),()=>{clearTimeout(e),r.forEach(s=>window.removeEventListener(s,t))}},[n.idleModeEnabled]),p.useEffect(()=>{n.event&&M(!1)},[n.event]),p.useEffect(()=>{const e=V(n.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[n.gold]),p.useEffect(()=>{const e=document.documentElement,t=n.interface||A,r=n.theme||"default",s=ke[r]||ke.default;s&&Object.entries(s.colors).forEach(([h,m])=>{e.style.setProperty(h,m)});const a={compact:"8px",normal:"12px",spacious:"20px"},f={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",a[t.density]),e.style.setProperty("--gap-size",f[t.density]),e.style.setProperty("--col-left",String(t.layout.left)),e.style.setProperty("--col-center",String(t.layout.center)),e.style.setProperty("--col-right",String(t.layout.right)),t.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[n.theme,n.interface]);const[D,j]=p.useState(!1);p.useEffect(()=>{var e;n.gold.gte(o(1e7))&&!((e=n.playerProfile)!=null&&e.hasChosenName)&&!D&&ge(!0)},[n.gold,n.playerProfile,D]);const[I,R]=p.useState(null),[_,Y]=p.useState([]),[B,q]=p.useState(null),[ue,Re]=p.useState("buildings"),[fe,Ae]=p.useState("army"),[Q,_e]=p.useState(!1),[O,Z]=p.useState("throne");p.useEffect(()=>{const e=()=>{_e(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[Ue,le]=p.useState(!1),[Fe,ee]=p.useState(!1),[We,F]=p.useState(!1),[$e,ze]=p.useState(!1),[He,se]=p.useState(!1),[Je,te]=p.useState(!1),[me,ge]=p.useState(!1),[pe,ie]=p.useState(!1),[Ke,ae]=p.useState(!1),[he,ye]=p.useState(!1),b=(e,t="info")=>{const r=Date.now().toString()+Math.random();Y(s=>[...s,{id:r,message:e,type:t}]),setTimeout(()=>{Y(s=>s.filter(a=>a.id!==r))},3e3)};p.useEffect(()=>{const e=Date.now();if(n.lastSaveTime&&o(e).minus(n.lastSaveTime).gt(o(6e4))){const t=o(e).minus(n.lastSaveTime).dividedBy(o(1e3)),{efficiency:r,duration:s}=Me(n.offlineUpgradeLevel||0),a=o(s),f=t.lt(a)?t:a,m=J(n).times(o(r)).times(f).floor(),T=[];let g=l({},n.nationalProjects),C=!1;Object.keys(g).forEach(y=>{var N;const E=g[y];if(E.active&&E.endTime&&e>=E.endTime){g[y]=d(l({},E),{active:!1,level:E.level+1,startTime:0,endTime:0});const u=(N=z.find(S=>S.id===y))==null?void 0:N.name;u&&T.push(`${u} Infrastructure (Lvl ${E.level+1})`),C=!0}}),(m.gt(o(0))||T.length>0)&&(q(y=>y||{gained:m,effectiveTime:f,totalTime:t,efficiency:r,completedProjects:T,currentLevel:n.offlineUpgradeLevel||0,maxDuration:s}),c(y=>d(l({},y),{gold:y.gold.plus(m),totalGold:y.totalGold.plus(m),nationalProjects:C?g:y.nationalProjects})))}},[]),p.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&c(t=>{const r=d(l({},t),{lastSaveTime:o(Date.now())}),s=H(r);return localStorage.setItem("kingdom_save",JSON.stringify(s)),r})},1e3);return()=>clearInterval(e)},[]),p.useEffect(()=>{const e=()=>{const r=w.current,s=H(r);localStorage.setItem("kingdom_save",JSON.stringify(s)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const t=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&x()};return document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[]),p.useEffect(()=>{var t;if(!((t=n.playerProfile)!=null&&t.hasChosenName))return;const e=setInterval(()=>{var h;const r=w.current,s=Date.now(),a=((h=r.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,f=3600*1e3;s-a>=f&&(Et(r,r.playerProfile.rulerId,r.playerProfile.rulerName).catch(m=>{console.error("Failed to save player stats:",m)}),jt({rulerName:r.playerProfile.rulerName,rulerId:r.playerProfile.rulerId,gold:r.totalGold,renown:r.totalRenownEarned,achievements:r.achievements.length,totalClicks:r.stats.totalClicks,period:"alltime"}).then(()=>{c(m=>d(l({},m),{playerProfile:d(l({},m.playerProfile),{lastLeaderboardSubmit:Date.now()})})),b("Leaderboard data submitted successfully!","success")}).catch(m=>{console.error("Auto leaderboard submission failed:",m)}))},6e4);return()=>clearInterval(e)},[(Ce=n.playerProfile)==null?void 0:Ce.hasChosenName]),p.useEffect(()=>{const e=setInterval(()=>{if(!n.event&&Math.random()<.05){const s=["dragon","merchant","jester"],a=s[Math.floor(Math.random()*s.length)],f=a==="dragon"?6e5:3e4,h={id:Date.now().toString(),type:a,expiresAt:o(Date.now()).plus(o(f)),hp:a==="dragon"?o(10):void 0,maxHp:a==="dragon"?o(10):void 0,reward:o(0),startTime:a==="dragon"?Date.now():void 0};c(m=>d(l({},m),{event:h}))}},1e4);return()=>clearInterval(e)},[n.event]);const J=e=>{var T;let t=o(0);const r=((T=e.weather)==null?void 0:T.current)||"clear";z.forEach(g=>{const C=e.buildings[g.id]||o(0);let y=g.baseProduction;t=t.plus(C.times(y))});const s=Ge(e.totalRenownEarned);s.gt(o(1))&&(t=t.times(s));let a=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(g=>{a+=g.level||0});const f=o(1).plus(o(a*mt));t=t.times(f);const h=Le(e.infiniteTowerLevel||0);t=t.times(h),o(1),z.forEach(g=>{const C=e.buildings[g.id]||o(0);if(C.gt(0)){let y=o(1);r==="sunny"?(g.id==="peasant"||g.id==="field"||g.id==="stable"||g.id==="cathedral")&&(y=o(1.2)):r==="rainy"?(g.id==="silver_mine"||g.id==="alchemist"||g.id==="market"||g.id==="tavern")&&(y=o(1.2)):r==="stormy"?((g.id==="blacksmith"||g.id==="void_portal")&&(y=o(1.3)),(g.id==="field"||g.id==="stable")&&(y=o(.8))):r==="windy"&&(g.id==="market"||g.id==="castle"||g.id==="time_chamber")&&(y=o(1.15));const E=C.times(g.baseProduction);if(s.gt(o(1))){const N=E.times(s).times(f).times(y.minus(o(1)));t=t.plus(N)}else{const N=E.times(f).times(y.minus(o(1)));t=t.plus(N)}}});const m=o(1).plus(o(e.achievements.length*.02));if(t=t.times(m),e.globalIncomeMultiplier&&(t=t.times(o(e.globalIncomeMultiplier))),e.event&&e.event.type==="dragon"&&e.event.startTime){const g=Math.floor((Date.now()-e.event.startTime)/1e3),y=1-Math.min(99,g)/100;t=t.times(o(y))}return t},K=J(n),X=p.useRef(K);X.current=K,p.useEffect(()=>{const e=setInterval(()=>{c(t=>{const r=Date.now(),s=X.current.times(o(ce)).dividedBy(o(1e3));let a=t.totalGold.plus(s),f=t.gold.plus(s),h=l({},t.weather);const m=o(ce/1e3);if(h.timeLeft=o(h.timeLeft||0).minus(m),h.timeLeft.lte(o(0))){const S=["clear","sunny","rainy","stormy","windy"],L=S[Math.floor(Math.random()*S.length)],$=o(Math.floor(Math.random()*120)+60);h={current:L,timeLeft:$}}let T=t.event;T&&T.expiresAt&&o(T.expiresAt).lt(o(r))&&(T=null);let g=l({},t.nationalProjects||{});Object.keys(g).forEach(S=>{var $;const L=g[S];L.active&&L.endTime&&r>=L.endTime&&(g[S]=d(l({},L),{active:!1,level:L.level+1,startTime:0,endTime:0}),b(`Project Completed: ${($=z.find(v=>v.id===S))==null?void 0:$.name} Infrastructure Level ${L.level+1}!`,"success"))});const C=[...t.achievements];let y=null;gt.forEach(S=>{C.includes(S.id)||S.condition(d(l({},t),{totalGold:a,gold:f}),X.current)&&(C.push(S.id),y=S)}),y&&(R(y),setTimeout(()=>R(null),3e3));const E=pt(a),N=(t.infiniteTowerLevel||0)>0?Array.from({length:t.infiniteTowerLevel},(S,L)=>de(L)).reduce((S,L)=>S.plus(L),o(0)):o(0),u=E.minus(N);return d(l({},t),{gold:f,totalGold:a,darkMatterGold:u,achievements:C,event:T,weather:h,nationalProjects:g})})},ce);return()=>clearInterval(e)},[]);const W=(e="light")=>{if("vibrate"in navigator&&Q)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},ve=(e=!1)=>{if(e||W("light"),!e&&!n.isDeveloperWifeBlessingObtained&&n.totalGold.gte(o(1e12))&&Math.random()<1e-6){c(s=>d(l({},s),{globalIncomeMultiplier:(s.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...s.achievements,"developer_wife_blessing"])]})),b("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const t=Xe(w.current);c(r=>d(l({},r),{gold:r.gold.plus(t),totalGold:r.totalGold.plus(t),stats:d(l({},r.stats),{totalClicks:e?r.stats.totalClicks:r.stats.totalClicks.plus(o(1))})}))},Xe=e=>{const t=o(1),r=e.clickUpgradeLevel||0,s=Math.min(r,15),a=o(2).pow(s),f=t.times(a),h=Ge(e.totalRenownEarned);let m=f;h.gt(o(1))&&(m=f.times(h));const T=Le(e.infiniteTowerLevel||0);m=m.times(T);const g=St(r);if(g>0){const E=J(e).times(g);m=m.plus(E)}const C=o(1).plus(o(e.achievements.length*.02));if(m=m.times(C),e.globalIncomeMultiplier&&(m=m.times(o(e.globalIncomeMultiplier))),e.godMode){const E=J(e).times(o(99999));m=m.plus(E)}return m},Ve=()=>{const e=n.clickUpgradeLevel||0;if(e>=wt){b("Maximum Royal Scepter level reached!","warning");return}const t=xt(e+1);if(n.gold.lt(t)){b("Not enough gold!","error");return}c(r=>d(l({},r),{gold:r.gold.minus(t),clickUpgradeLevel:r.clickUpgradeLevel+1})),b(`Royal Scepter upgraded to level ${e+1}!`,"success")},Ye=()=>{const e=n.offlineUpgradeLevel||0;if(e>=vt){b("Maximum Passive Income level reached!","warning");return}const t=bt(e+1);if(n.renown.lt(t)){b("Not enough Renown!","error");return}c(r=>d(l({},r),{renown:r.renown.minus(t),offlineUpgradeLevel:r.offlineUpgradeLevel+1})),b(`Passive Income upgraded to level ${e+1}!`,"success")},be=(e,t)=>{const r=z.find(f=>f.id===e);if(!r||t<=0)return;const s=n.buildings[e]||o(0),a=Ie(r.baseCost,s,o(t)).floor();n.gold.gte(a)&&(W("medium"),c(f=>d(l({},f),{gold:f.gold.minus(a),buildings:d(l({},f.buildings),{[e]:(f.buildings[e]||o(0)).plus(o(t))})})))},we=(e,t)=>{const r=z.find(h=>h.id===e);if(!r||t<=0)return;const s=n.buildings[e]||o(0),a=o(Math.min(t,s.toNumber()));if(a.lte(o(0)))return;const f=Ie(r.baseCost,s.minus(a),a).times(o(.25)).floor();c(h=>d(l({},h),{gold:h.gold.plus(f),buildings:d(l({},h.buildings),{[e]:s.minus(a)})}))},xe=e=>{if(e.type==="merchant"){const t=X.current.times(o(10));c(r=>d(l({},r),{gold:r.gold.plus(t),totalGold:r.totalGold.plus(t),event:null})),b(`The merchant gifted you ${V(t.floor(),n.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const t=n.gold.times(o(.1)),r=Math.random()>.5;c(s=>d(l({},s),{gold:r?s.gold.plus(t):s.gold.minus(t),totalGold:r?s.totalGold.plus(t):s.totalGold,event:null})),r?b(`Jester pays out! +${V(t.floor(),n.numberFormat)}`,"success"):b(`Jester tricked you! -${V(t.floor(),n.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let t=!1;c(r=>{if(!r.event||r.event.type!=="dragon")return r;const a=o(r.event.hp||10).minus(o(1));if(a.lte(0)){const f=X.current.times(o(30));return t=!0,d(l({},r),{gold:r.gold.plus(f),totalGold:r.totalGold.plus(f),event:null,stats:d(l({},r.stats),{dragonsKilled:r.stats.dragonsKilled.plus(o(1))})})}return d(l({},r),{event:d(l({},r.event),{hp:a})})}),t&&b("Dragon Slain! +Treasury Boost","success")}catch(t){console.error("Error handling dragon interaction:",t),b("Error interacting with dragon","error")}},qe=()=>{const e=o(1),t=o(1e12),r=n.totalGold;if(r.lt(t))return;const s=r.dividedBy(t),f=o(Math.floor(Math.pow(s.toNumber(),.33))).times(e).minus(n.renown);if(f.lte(0))return;const h=l({},n.nationalProjects);Object.keys(h).forEach(m=>{h[m].active&&(h[m]=d(l({},h[m]),{active:!1,startTime:0,endTime:0}))}),c(d(l({},U),{renown:n.renown.plus(f),totalRenownEarned:n.totalRenownEarned.plus(f),prestigeCount:n.prestigeCount+1,totalGold:n.totalGold,achievements:n.achievements,nationalProjects:h,offlineUpgradeLevel:n.offlineUpgradeLevel,darkMatterGold:n.darkMatterGold,infiniteTowerLevel:n.infiniteTowerLevel,playerProfile:n.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:n.theme,idleModeEnabled:n.idleModeEnabled,interface:n.interface})),ee(!1),b("Abdication Successful. Long live the new King!","success")},Qe=()=>{localStorage.removeItem("kingdom_save"),c(d(l({},U),{startTime:o(Date.now())})),F(!1),b("Game Reset","warning")},Ze=()=>{const t=H(n);localStorage.setItem("kingdom_save",JSON.stringify(t)),b("Game Saved","info")},et=()=>{c(e=>{const t=l({},e.nationalProjects);return Object.keys(t).forEach(r=>{t[r].active&&(t[r]=d(l({},t[r]),{endTime:Date.now()+5e3}))}),d(l({},e),{nationalProjects:t})}),b("Projects sped up to 5 seconds!","success")};window.speedUpProjects=et;const tt=e=>{c(t=>d(l({},t),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),b(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),j(!1)},ot=()=>ne(null,null,function*(){qe()}),nt=e=>ne(null,null,function*(){var t;if(!((t=n.playerProfile)!=null&&t.id)){b("Error: Player profile not found","error");return}try{yield _t(n.playerProfile.id,e);const r=d(l({},n.playerProfile),{rulerName:e});c(f=>d(l({},f),{playerProfile:r}));const s=d(l({},n),{playerProfile:r}),a=H(s);localStorage.setItem("kingdom_save",JSON.stringify(a)),b(`Name successfully changed to "${e}"!`,"success")}catch(r){console.error("Error changing name:",r),b("Failed to change name. Please try again.","error")}}),rt=e=>ne(null,null,function*(){var s;const t=((s=n.playerProfile)==null?void 0:s.id)||"default_player",r=yield Ut.redeemPromoCode(t,e);if(!r){b("Invalid or expired promo code!","error");return}switch(r.type){case"gold":c(a=>d(l({},a),{gold:a.gold.plus(o(r.value)),totalGold:a.totalGold.plus(o(r.value))})),b(`Received ${V(o(r.value))} gold!`,"success");break;case"betaTester":c(a=>{const f=a.playerProfile?d(l({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:r.icon||"ðŸ§ª",specialTitle:r.title||"Beta Tester",isBetaTester:!0}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),d(l({},a),{playerProfile:f})}),b("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":c(a=>{const f=a.playerProfile?d(l({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],e],specialIcon:r.icon||"â­",specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),d(l({},a),{playerProfile:f})}),b(`Special icon unlocked: ${r.icon}!`,"success");break;case"title":c(a=>{const f=a.playerProfile?d(l({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],e],specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),d(l({},a),{playerProfile:f})}),b(`Special title unlocked: ${r.title}!`,"success");break;default:b("Promo code redeemed!","success")}}),Pe=e=>{c(t=>d(l({},t),{interface:d(l({},t.interface),{lastBuyAmount:e})}))},Se=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:P&&n.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return i.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:Q?"column":"row"},children:[i.jsx(Ct,{toasts:_}),i.jsx(Tt,{}),P&&n.idleModeEnabled&&i.jsx(Ft,{gameState:n}),!Q&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:Se("left"),children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:i.jsx("button",{className:`tab-btn ${ue==="buildings"?"active":""}`,onClick:()=>Re("buildings"),children:"Estates"})}),i.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:ue==="buildings"&&i.jsx(De,{gameState:n,onBuyBuilding:be,onSellBuilding:we,onSetBuyAmount:Pe})})]}),i.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:P&&n.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:i.jsx(Be,{gameState:n,gps:K,onClick:()=>ve(!1),onEventInteract:xe,onOpenTavern:()=>le(!0),onOpenPrestige:()=>ee(!0),onOpenSettings:()=>F(!0),onOpenStatistics:()=>se(!0),onOpenLeaderboard:()=>{ie(!0)},onOpenEmpire:()=>te(!0),isIdle:P&&n.idleModeEnabled})}),i.jsxs("div",{style:Se("right"),children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:i.jsx("button",{className:`tab-btn ${fe==="army"?"active":""}`,onClick:()=>Ae("army"),children:"Future"})}),i.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"var(--accent-color) transparent"},children:fe==="army"&&i.jsx(Oe,{gameState:n,onBuyTowerFloor:()=>{const e=de(n.infiniteTowerLevel||0);n.darkMatterGold.gte(e)&&(c(t=>d(l({},t),{darkMatterGold:t.darkMatterGold.minus(e),infiniteTowerLevel:(t.infiniteTowerLevel||0)+1})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]})]}),Q&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[O==="buildings"&&i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:i.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx(De,{gameState:n,onBuyBuilding:be,onSellBuilding:we,onSetBuyAmount:Pe})})]}),O==="throne"&&i.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:i.jsx(Be,{gameState:n,gps:K,onClick:()=>ve(!1),onEventInteract:xe,onOpenTavern:()=>le(!0),onOpenPrestige:()=>ee(!0),onOpenSettings:()=>F(!0),onOpenStatistics:()=>se(!0),onOpenLeaderboard:()=>ie(!0),onOpenEmpire:()=>te(!0),isIdle:P&&n.idleModeEnabled})}),O==="army"&&i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[i.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:i.jsx("button",{className:"tab-btn active",children:"Future"})}),i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsx(Oe,{gameState:n,onBuyTowerFloor:()=>{const e=de(n.infiniteTowerLevel||0);n.darkMatterGold.gte(e)&&(c(t=>d(l({},t),{darkMatterGold:t.darkMatterGold.minus(e),infiniteTowerLevel:(t.infiniteTowerLevel||0)+1})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]}),O==="empire"&&i.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:i.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:i.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[i.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),i.jsx("p",{children:"Construct massive infrastructure to boost global production."}),i.jsx("button",{className:"btn",onClick:()=>te(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[i.jsxs("button",{className:`mobile-nav-btn ${O==="buildings"?"active":""}`,onClick:()=>{W("light"),Z("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),i.jsx("div",{children:"Estates"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="throne"?"active":""}`,onClick:()=>{W("light"),Z("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),i.jsx("div",{children:"Throne"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="army"?"active":""}`,onClick:()=>{W("light"),Z("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),i.jsx("div",{children:"Future"})]}),i.jsxs("button",{className:`mobile-nav-btn ${O==="empire"?"active":""}`,onClick:()=>{W("light"),Z("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[i.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),i.jsx("div",{children:"Projects"})]})]})]}),!(P&&n.idleModeEnabled)&&I&&i.jsxs("div",{className:"achievement-popup",children:[i.jsx("div",{style:{fontSize:"2rem"},children:I.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),i.jsx("div",{style:{color:"var(--accent-color)"},children:I.name})]})]}),B&&i.jsx(kt,{gained:B.gained,effectiveTime:B.effectiveTime,totalTime:B.totalTime,efficiency:B.efficiency,completedProjects:B.completedProjects,currentLevel:B.currentLevel,maxDuration:B.maxDuration,numberFormat:n.numberFormat,onClose:()=>q(null)}),Je&&i.jsx(Mt,{gameState:n,onClose:()=>te(!1),onStartProject:e=>{var a;const t=((a=n.nationalProjects[e])==null?void 0:a.level)||0;if(t>=ht)return;const r=yt(e,t+1);if(n.gold.lt(r.gold))return;const s=Pt();c(f=>d(l({},f),{gold:f.gold.minus(r.gold),nationalProjects:d(l({},f.nationalProjects),{[e]:{level:t,active:!0,startTime:Date.now(),endTime:Date.now()+s*1e3}})})),b("Construction started!","info")},onUpgradeClickPower:Ve,onUpgradeOffline:Ye}),Ue&&i.jsx(Lt,{gameState:n,onGamble:(e,t)=>{const r=o(e);c(s=>d(l({},s),{gold:t?s.gold.plus(r):s.gold.minus(r).max(0),stats:d(l({},s.stats),{tavernGamesPlayed:s.stats.tavernGamesPlayed.plus(o(1))})}))},onClose:()=>le(!1)}),Fe&&i.jsx(It,{gameState:n,onPrestige:ot,onClose:()=>ee(!1)}),We&&i.jsx(Gt,{gameState:n,onClose:()=>F(!1),onHardReset:Qe,onSave:Ze,onSetTheme:e=>c(t=>d(l({},t),{theme:e})),onSetNumberFormat:e=>c(t=>d(l({},t),{numberFormat:e})),onToggleIdleMode:()=>c(e=>d(l({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>c(t=>d(l({},t),{interface:l(l({},t.interface),e)})),onOpenPromoCodes:()=>{F(!1),ae(!0)},onChangeName:()=>ye(!0)}),Ke&&i.jsx(Dt,{gameState:n,onClose:()=>ae(!1),onRedeemPromoCode:rt,onBackToSettings:()=>{ae(!1),F(!0)}}),He&&i.jsx(Ot,{gameState:n,currentGps:K,onClose:()=>se(!1)}),$e&&i.jsx(Bt,{onClose:()=>ze(!1)}),me&&i.jsx(Nt,{isOpen:me,onClose:()=>{ge(!1),j(!0)},onConfirm:tt,gameState:n}),pe&&i.jsx(Rt,{isOpen:pe,onClose:()=>ie(!1),playerProfile:n.playerProfile,gameState:n}),he&&i.jsx(At,{isOpen:he,onClose:()=>ye(!1),onConfirm:nt,currentName:((Te=n.playerProfile)==null?void 0:Te.rulerName)||""})]})},Ne=document.getElementById("root");if(!Ne)throw new Error("Could not find root element to mount to");const $t=ut.createRoot(Ne);$t.render(i.jsx(ft.StrictMode,{children:i.jsx(Wt,{})}))});export default zt();
