var tt=Object.defineProperty,ot=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var Pe=(t,c,v)=>c in t?tt(t,c,{enumerable:!0,configurable:!0,writable:!0,value:v}):t[c]=v,a=(t,c)=>{for(var v in c||(c={}))rt.call(c,v)&&Pe(t,v,c[v]);if(Se)for(var v of Se(c))st.call(c,v)&&Pe(t,v,c[v]);return t},d=(t,c)=>ot(t,nt(c));var lt=(t,c)=>()=>(c||t((c={exports:{}}).exports,c),c.exports);var Z=(t,c,v)=>new Promise((L,b)=>{var x=C=>{try{M(v.next(C))}catch(k){b(k)}},j=C=>{try{M(v.throw(C))}catch(k){b(k)}},M=C=>C.done?L(C.value):Promise.resolve(C.value).then(x,j);M((v=v.apply(t,c)).next())});import{j as s,r as g,a as at,R as it}from"./vendor-react-CUeQczFW.js";import{t as r,f as W,T as Ee,i as Ce,B as H,P as ct,m as se,A as dt,M as ut,a as ft,j as je,e as mt,c as gt,d as ht,b as pt,h as yt,g as vt}from"./core-uFyQeYSz.js";import{g as Te,T as bt,G as xt}from"./components-ui-crbNLD7e.js";import{B as ke,W as Le}from"./components-store-Dd054QoF.js";import{M as Me}from"./components-main-CkOgjXq3.js";import{s as wt,O as St,E as Pt,T as Et,P as Ct,S as jt,a as Tt,b as kt,C as Lt,R as Mt,L as It,c as Nt,u as Dt}from"./components-modals-CVufujjR.js";import{P as Ot}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-DCFXKO6C.js";import"./vendor-firebase-IMiYFFvY.js";var At=lt(ee=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))L(b);new MutationObserver(b=>{for(const x of b)if(x.type==="childList")for(const j of x.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&L(j)}).observe(document,{childList:!0,subtree:!0});function v(b){const x={};return b.integrity&&(x.integrity=b.integrity),b.referrerPolicy&&(x.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?x.credentials="include":b.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function L(b){if(b.ep)return;b.ep=!0;const x=v(b);fetch(b.href,x)}})();const Bt=({gameState:t})=>{const{weather:c,buildings:v,totalGold:L}=t,b=J=>{var D;return((D=v[J])==null?void 0:D.toNumber())||0};let x="wilderness";b("palace")>0?x="empire":b("castle")>0||b("market")>0?x="city":(b("peasant")>20||b("field")>10||L.gt(r(500)))&&(x="hamlet");let j="",M="";switch(x){case"wilderness":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",M="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",M="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":j="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",M="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":j="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",M="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const C=c.current;let k="none",O="",G=0;return C==="rainy"?(k="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",O="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",G=1):C==="stormy"?(k="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",O="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",G=1):C==="sunny"?(k="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",O="â˜€ï¸",G=.6):C==="windy"&&(O="ðŸƒ ðŸƒ ðŸƒ",G=.8),s.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:j,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[s.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:G,animation:C==="windy"?"float 3s infinite ease-in-out":"none"},children:O}),k!=="none"&&s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:k,pointerEvents:"none"}}),s.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:M}),s.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),s.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},B={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:r(1),layout:{left:r(1),center:r(1),right:r(1)},borderWidth:r(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},_={gold:r(0),totalGold:r(0),totalRenownEarned:r(0),startTime:r(Date.now()),lastSaveTime:r(Date.now()),buildings:{},achievements:[],renown:r(0),prestigeCount:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:r(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:B,stats:{totalClicks:r(0),dragonsKilled:r(0),tavernGamesPlayed:r(0)},playerProfile:null},U=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(U);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const c={};for(const v in t)t.hasOwnProperty(v)&&(c[v]=U(t[v]));return c}return t},Gt=()=>{var be,xe;const[t,c]=g.useState(()=>{var o,n,l,i,u,h,f,P,y,E,w,S,T;const e=localStorage.getItem("kingdom_save");if(e)try{const m=JSON.parse(e);if((o=m.playerProfile)!=null&&o.id){const z=localStorage.getItem(`playerProfile_${m.playerProfile.id}`);z&&(m.playerProfile=JSON.parse(z))}const N=m.interface||{},et=d(a(a({},B),N),{lastBuyAmount:r((n=N.lastBuyAmount)!=null?n:1),crownAnimations:(l=N.crownAnimations)!=null?l:!0,layout:{left:r((u=(i=N.layout)==null?void 0:i.left)!=null?u:B.layout.left),center:r((f=(h=N.layout)==null?void 0:h.center)!=null?f:B.layout.center),right:r((y=(P=N.layout)==null?void 0:P.right)!=null?y:B.layout.right)},borderWidth:r((E=N.borderWidth)!=null?E:B.borderWidth),customColors:a(a({},B.customColors),N.customColors||{})});return d(a(a({},_),m),{renown:r(m.renown||0),totalRenownEarned:r(m.totalRenownEarned||0),prestigeCount:m.prestigeCount||0,gold:r(m.gold||0),totalGold:r(m.totalGold||0),startTime:r(m.startTime||Date.now()),lastSaveTime:r(m.lastSaveTime||Date.now()),buildings:Object.keys(m.buildings||{}).reduce((z,we)=>(z[we]=r(m.buildings[we]),z),{}),stats:d(a(a({},_.stats),m.stats||{}),{totalClicks:r(((w=m.stats)==null?void 0:w.totalClicks)||0),dragonsKilled:r(((S=m.stats)==null?void 0:S.dragonsKilled)||0),tavernGamesPlayed:r(((T=m.stats)==null?void 0:T.tavernGamesPlayed)||0)}),nationalProjects:m.nationalProjects||{},clickUpgradeLevel:m.clickUpgradeLevel||0,offlineUpgradeLevel:m.offlineUpgradeLevel||0,weather:m.weather?d(a({},m.weather),{timeLeft:r(Number(m.weather.timeLeft)||120)}):_.weather,theme:m.theme||"default",numberFormat:m.numberFormat||"standard",idleModeEnabled:m.idleModeEnabled!==void 0?m.idleModeEnabled:!1,interface:et,playerProfile:m.playerProfile?d(a({},m.playerProfile),{lastLeaderboardSubmit:m.playerProfile.lastLeaderboardSubmit||0}):null})}catch(m){console.error("Save load failed",m)}return _}),v=g.useRef(t);g.useEffect(()=>{v.current=t},[t]);const L=g.useRef("");g.useEffect(()=>{const e=o=>{L.current=(L.current+o.key).slice(-20);const n=L.current.toLowerCase();n.endsWith("godon")?(c(l=>d(a({},l),{godMode:!0})),p("God Mode Enabled: +99999s per click","success"),L.current=""):n.endsWith("godoff")&&(c(l=>d(a({},l),{godMode:!1})),p("God Mode Disabled","info"),L.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const b=()=>{X(null);const e=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(e){const n=o-parseInt(e),l=r(n/1e3);if(l.gte(r(60))){const i=t.offlineUpgradeLevel||0,{efficiency:u,duration:h}=Ce(i),f=r(h),P=l.lt(f)?l:f,E=Q(t).times(r(u)).times(P).floor();E.gt(r(0))&&(X({gained:E,effectiveTime:P,totalTime:l,efficiency:u,completedProjects:[],currentLevel:i,maxDuration:h}),c(w=>d(a({},w),{gold:w.gold.plus(E),totalGold:w.totalGold.plus(E)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[x,j]=g.useState(!1);g.useEffect(()=>{let e;const o=()=>{j(!1),clearTimeout(e),t.idleModeEnabled&&(e=setTimeout(()=>{j(!0)},2e4))};o();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(l=>window.addEventListener(l,o)),()=>{clearTimeout(e),n.forEach(l=>window.removeEventListener(l,o))}},[t.idleModeEnabled]),g.useEffect(()=>{t.event&&j(!1)},[t.event]),g.useEffect(()=>{const e=W(t.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[t.gold]),g.useEffect(()=>{const e=document.documentElement,o=t.interface||B,n=t.theme||"default",l=Ee[n]||Ee.default;l&&Object.entries(l.colors).forEach(([h,f])=>{e.style.setProperty(h,f)});const i={compact:"8px",normal:"12px",spacious:"20px"},u={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",i[o.density]),e.style.setProperty("--gap-size",u[o.density]),e.style.setProperty("--col-left",String(o.layout.left)),e.style.setProperty("--col-center",String(o.layout.center)),e.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[M,C]=g.useState(!1);g.useEffect(()=>{var e;t.gold.gte(r(1e7))&&!((e=t.playerProfile)!=null&&e.hasChosenName)&&!M&&ce(!0)},[t.gold,t.playerProfile,M]);const[k,O]=g.useState(null),[G,J]=g.useState([]),[D,X]=g.useState(null),[le,Ne]=g.useState("buildings"),[ae,De]=g.useState("army"),[K,Oe]=g.useState(!1),[I,V]=g.useState("throne");g.useEffect(()=>{const e=()=>{Oe(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[Be,te]=g.useState(!1),[Ge,Y]=g.useState(!1),[Re,R]=g.useState(!1),[Ae,_e]=g.useState(!1),[Ue,oe]=g.useState(!1),[Fe,q]=g.useState(!1),[ie,ce]=g.useState(!1),[de,ne]=g.useState(!1),[$e,re]=g.useState(!1),[ue,fe]=g.useState(!1),p=(e,o="info")=>{const n=Date.now().toString()+Math.random();J(l=>[...l,{id:n,message:e,type:o}]),setTimeout(()=>{J(l=>l.filter(i=>i.id!==n))},3e3)};g.useEffect(()=>{const e=Date.now();if(t.lastSaveTime&&r(e).minus(t.lastSaveTime).gt(r(6e4))){const o=r(e).minus(t.lastSaveTime).dividedBy(r(1e3)),{efficiency:n,duration:l}=Ce(t.offlineUpgradeLevel||0),i=r(l),u=o.lt(i)?o:i,f=Q(t).times(r(n)).times(u).floor(),P=[];let y=a({},t.nationalProjects),E=!1;Object.keys(y).forEach(w=>{var T;const S=y[w];if(S.active&&S.endTime&&e>=S.endTime){y[w]=d(a({},S),{active:!1,level:S.level+1,startTime:0,endTime:0});const m=(T=H.find(N=>N.id===w))==null?void 0:T.name;m&&P.push(`${m} Infrastructure (Lvl ${S.level+1})`),E=!0}}),(f.gt(r(0))||P.length>0)&&(X(w=>w||{gained:f,effectiveTime:u,totalTime:o,efficiency:n,completedProjects:P,currentLevel:t.offlineUpgradeLevel||0,maxDuration:l}),c(w=>d(a({},w),{gold:w.gold.plus(f),totalGold:w.totalGold.plus(f),nationalProjects:E?y:w.nationalProjects})))}},[]),g.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&c(o=>{const n=d(a({},o),{lastSaveTime:r(Date.now())}),l=U(n);return localStorage.setItem("kingdom_save",JSON.stringify(l)),n})},1e3);return()=>clearInterval(e)},[]),g.useEffect(()=>{const e=()=>{const n=v.current,l=U(n);localStorage.setItem("kingdom_save",JSON.stringify(l)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const o=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&b()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",o)}},[]),g.useEffect(()=>{var o;if(!((o=t.playerProfile)!=null&&o.hasChosenName))return;const e=setInterval(()=>{var h;const n=v.current,l=Date.now(),i=((h=n.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,u=3600*1e3;l-i>=u&&wt({rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.totalGold,renown:n.totalRenownEarned,achievements:n.achievements.length,totalClicks:n.stats.totalClicks,period:"alltime"}).then(()=>{c(f=>d(a({},f),{playerProfile:d(a({},f.playerProfile),{lastLeaderboardSubmit:Date.now()})})),p("Leaderboard data submitted successfully!","success")}).catch(f=>{console.error("Auto leaderboard submission failed:",f)})},6e4);return()=>clearInterval(e)},[(be=t.playerProfile)==null?void 0:be.hasChosenName]),g.useEffect(()=>{const e=setInterval(()=>{if(!t.event&&Math.random()<.05){const l=["dragon","merchant","jester"],i=l[Math.floor(Math.random()*l.length)],u=i==="dragon"?6e5:3e4,h={id:Date.now().toString(),type:i,expiresAt:r(Date.now()).plus(r(u)),hp:i==="dragon"?r(10):void 0,maxHp:i==="dragon"?r(10):void 0,reward:r(0),startTime:i==="dragon"?Date.now():void 0};c(f=>d(a({},f),{event:h}))}},1e4);return()=>clearInterval(e)},[t.event]);const Q=e=>{var h;let o=r(0);const n=((h=e.weather)==null?void 0:h.current)||"clear";H.forEach(f=>{const P=e.buildings[f.id]||r(0);let y=f.baseProduction;n==="sunny"?(f.id==="peasant"||f.id==="field"||f.id==="stable"||f.id==="cathedral")&&(y=y.times(r(1.2))):n==="rainy"?(f.id==="silver_mine"||f.id==="alchemist"||f.id==="market"||f.id==="tavern")&&(y=y.times(r(1.2))):n==="stormy"?((f.id==="blacksmith"||f.id==="void_portal")&&(y=y.times(r(1.3))),(f.id==="field"||f.id==="stable")&&(y=y.times(r(.8)))):n==="windy"&&(f.id==="market"||f.id==="castle"||f.id==="time_chamber")&&(y=y.times(r(1.15))),o=o.plus(P.times(y))});let l=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(f=>{l+=f.level||0});let i=r(1);const u=r(1).plus(r(l*ct));if(i=i.times(u),i=i.times(Te(e.totalRenownEarned).plus(r(e.achievements.length*.02))),e.event&&e.event.type==="dragon"&&e.event.startTime){const f=Math.floor((Date.now()-e.event.startTime)/1e3),y=1-Math.min(99,f)/100;i=i.times(r(y))}return o=o.times(i),o},F=Q(t),$=g.useRef(F);$.current=F,g.useEffect(()=>{const e=setInterval(()=>{c(o=>{const n=Date.now(),l=$.current.times(r(se)).dividedBy(r(1e3));let i=o.totalGold.plus(l),u=o.gold.plus(l),h=a({},o.weather);const f=r(se/1e3);if(h.timeLeft=h.timeLeft.minus(f),h.timeLeft.lte(r(0))){const S=["clear","sunny","rainy","stormy","windy"],T=S[Math.floor(Math.random()*S.length)],m=r(Math.floor(Math.random()*120)+60);h={current:T,timeLeft:m}}let P=o.event;P&&P.expiresAt&&r(P.expiresAt).lt(r(n))&&(P=null);let y=a({},o.nationalProjects||{});Object.keys(y).forEach(S=>{var m;const T=y[S];T.active&&T.endTime&&n>=T.endTime&&(y[S]=d(a({},T),{active:!1,level:T.level+1,startTime:0,endTime:0}),p(`Project Completed: ${(m=H.find(N=>N.id===S))==null?void 0:m.name} Infrastructure Level ${T.level+1}!`,"success"))});const E=[...o.achievements];let w=null;return dt.forEach(S=>{E.includes(S.id)||S.condition(d(a({},o),{totalGold:i,gold:u}),$.current)&&(E.push(S.id),w=S)}),w&&(O(w),setTimeout(()=>O(null),3e3)),d(a({},o),{gold:u,totalGold:i,achievements:E,event:P,weather:h,nationalProjects:y})})},se);return()=>clearInterval(e)},[]);const A=(e="light")=>{if("vibrate"in navigator&&K)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},me=(e=!1)=>{e||A("light");const o=ze(v.current);c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),stats:d(a({},n.stats),{totalClicks:e?n.stats.totalClicks:n.stats.totalClicks.plus(r(1))})}))},ze=e=>{const o=Te(e.totalRenownEarned),n=r(1),l=e.clickUpgradeLevel||0,i=Math.min(l,15),u=r(2).pow(i),h=n.times(u),f=Q(e),P=vt(l),y=f.times(P);let E=h.plus(y);if(E=E.times(o),e.godMode){const w=f.times(r(99999));E=E.plus(w)}return E},We=()=>{const e=t.clickUpgradeLevel||0;if(e>=ht){p("Maximum Royal Scepter level reached!","warning");return}const o=pt(e+1);if(t.gold.lt(o)){p("Not enough gold!","error");return}c(n=>d(a({},n),{gold:n.gold.minus(o),clickUpgradeLevel:n.clickUpgradeLevel+1})),p(`Royal Scepter upgraded to level ${e+1}!`,"success")},He=()=>{const e=t.offlineUpgradeLevel||0;if(e>=mt){p("Maximum Passive Income level reached!","warning");return}const o=gt(e+1);if(t.renown.lt(o)){p("Not enough Renown!","error");return}c(n=>d(a({},n),{renown:n.renown.minus(o),offlineUpgradeLevel:n.offlineUpgradeLevel+1})),p(`Passive Income upgraded to level ${e+1}!`,"success")},ge=(e,o)=>{const n=H.find(u=>u.id===e);if(!n||o<=0)return;const l=t.buildings[e]||r(0),i=je(n.baseCost,l,r(o)).floor();t.gold.gte(i)&&(A("medium"),c(u=>d(a({},u),{gold:u.gold.minus(i),buildings:d(a({},u.buildings),{[e]:(u.buildings[e]||r(0)).plus(r(o))})})))},he=(e,o)=>{const n=H.find(h=>h.id===e);if(!n||o<=0)return;const l=t.buildings[e]||r(0),i=r(Math.min(o,l.toNumber()));if(i.lte(r(0)))return;const u=je(n.baseCost,l.minus(i),i).times(r(.25)).floor();c(h=>d(a({},h),{gold:h.gold.plus(u),buildings:d(a({},h.buildings),{[e]:l.minus(i)})}))},pe=e=>{if(e.type==="merchant"){const o=$.current.times(r(10));c(n=>d(a({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),event:null})),p(`The merchant gifted you ${W(o.floor(),t.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const o=t.gold.times(r(.1)),n=Math.random()>.5;c(l=>d(a({},l),{gold:n?l.gold.plus(o):l.gold.minus(o),totalGold:n?l.totalGold.plus(o):l.totalGold,event:null})),n?p(`Jester pays out! +${W(o.floor(),t.numberFormat)}`,"success"):p(`Jester tricked you! -${W(o.floor(),t.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let o=!1;c(n=>{if(!n.event||n.event.type!=="dragon")return n;const i=r(n.event.hp||10).minus(r(1));if(i.lte(0)){const u=$.current.times(r(30));return o=!0,d(a({},n),{gold:n.gold.plus(u),totalGold:n.totalGold.plus(u),event:null,stats:d(a({},n.stats),{dragonsKilled:n.stats.dragonsKilled.plus(r(1))})})}return d(a({},n),{event:d(a({},n.event),{hp:i})})}),o&&p("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),p("Error interacting with dragon","error")}},Je=()=>{const e=r(1),o=r(1e12),n=t.totalGold;if(n.lt(o))return;const l=n.dividedBy(o),u=r(Math.floor(Math.pow(l.toNumber(),.33))).times(e).minus(t.renown);if(u.lte(0))return;const h=a({},t.nationalProjects);Object.keys(h).forEach(f=>{h[f].active&&(h[f]=d(a({},h[f]),{active:!1,startTime:0,endTime:0}))}),c(d(a({},_),{renown:t.renown.plus(u),totalRenownEarned:t.totalRenownEarned.plus(u),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:h,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:r(Date.now()),lastSaveTime:r(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface})),Y(!1),p("Abdication Successful. Long live the new King!","success")},Xe=()=>{localStorage.removeItem("kingdom_save"),c(d(a({},_),{startTime:r(Date.now())})),R(!1),p("Game Reset","warning")},Ke=()=>{const o=U(t);localStorage.setItem("kingdom_save",JSON.stringify(o)),p("Game Saved","info")},Ve=()=>{c(e=>{const o=a({},e.nationalProjects);return Object.keys(o).forEach(n=>{o[n].active&&(o[n]=d(a({},o[n]),{endTime:Date.now()+5e3}))}),d(a({},e),{nationalProjects:o})}),p("Projects sped up to 5 seconds!","success")};window.speedUpProjects=Ve;const Ye=e=>{c(o=>d(a({},o),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),p(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),C(!1)},qe=()=>Z(null,null,function*(){Je()}),Qe=e=>Z(null,null,function*(){var o;if(!((o=t.playerProfile)!=null&&o.id)){p("Error: Player profile not found","error");return}try{yield Dt(t.playerProfile.id,e);const n=d(a({},t.playerProfile),{rulerName:e});c(u=>d(a({},u),{playerProfile:n}));const l=d(a({},t),{playerProfile:n}),i=U(l);localStorage.setItem("kingdom_save",JSON.stringify(i)),p(`Name successfully changed to "${e}"!`,"success")}catch(n){console.error("Error changing name:",n),p("Failed to change name. Please try again.","error")}}),Ze=e=>Z(null,null,function*(){var l;const o=((l=t.playerProfile)==null?void 0:l.id)||"default_player",n=yield Ot.redeemPromoCode(o,e);if(!n){p("Invalid or expired promo code!","error");return}switch(n.type){case"gold":c(i=>d(a({},i),{gold:i.gold.plus(r(n.value)),totalGold:i.totalGold.plus(r(n.value))})),p(`Received ${W(r(n.value))} gold!`,"success");break;case"betaTester":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:n.icon||"ðŸ§ª",specialTitle:n.title||"Beta Tester",isBetaTester:!0}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],e],specialIcon:n.icon||"â­",specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p(`Special icon unlocked: ${n.icon}!`,"success");break;case"title":c(i=>{const u=i.playerProfile?d(a({},i.playerProfile),{usedPromoCodes:[...i.playerProfile.usedPromoCodes||[],e],specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(u)),d(a({},i),{playerProfile:u})}),p(`Special title unlocked: ${n.title}!`,"success");break;default:p("Promo code redeemed!","success")}}),ye=e=>{c(o=>d(a({},o),{interface:d(a({},o.interface),{lastBuyAmount:e})}))},ve=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:x&&t.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return s.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:K?"column":"row"},children:[s.jsx(bt,{toasts:G}),s.jsx(xt,{}),x&&t.idleModeEnabled&&s.jsx(Bt,{gameState:t}),!K&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:ve("left"),children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:s.jsx("button",{className:`tab-btn ${le==="buildings"?"active":""}`,onClick:()=>Ne("buildings"),children:"Estates"})}),s.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:le==="buildings"&&s.jsx(ke,{gameState:t,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),s.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:x&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:s.jsx(Me,{gameState:t,gps:F,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>Y(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>q(!0),isIdle:x&&t.idleModeEnabled})}),s.jsxs("div",{style:ve("right"),children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:s.jsx("button",{className:`tab-btn ${ae==="army"?"active":""}`,onClick:()=>De("army"),children:"Future"})}),s.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:ae==="army"&&s.jsx(Le,{gameState:t})})]})]}),K&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[I==="buildings"&&s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:s.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsx(ke,{gameState:t,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),I==="throne"&&s.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:s.jsx(Me,{gameState:t,gps:F,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>Y(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>ne(!0),onOpenEmpire:()=>q(!0),isIdle:x&&t.idleModeEnabled})}),I==="army"&&s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:s.jsx("button",{className:"tab-btn active",children:"Future"})}),s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsx(Le,{gameState:t})})]}),I==="empire"&&s.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[s.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),s.jsx("p",{children:"Construct massive infrastructure to boost global production."}),s.jsx("button",{className:"btn",onClick:()=>q(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[s.jsxs("button",{className:`mobile-nav-btn ${I==="buildings"?"active":""}`,onClick:()=>{A("light"),V("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),s.jsx("div",{children:"Estates"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="throne"?"active":""}`,onClick:()=>{A("light"),V("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),s.jsx("div",{children:"Throne"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="army"?"active":""}`,onClick:()=>{A("light"),V("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),s.jsx("div",{children:"Future"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="empire"?"active":""}`,onClick:()=>{A("light"),V("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),s.jsx("div",{children:"Projects"})]})]})]}),!(x&&t.idleModeEnabled)&&k&&s.jsxs("div",{className:"achievement-popup",children:[s.jsx("div",{style:{fontSize:"2rem"},children:k.icon}),s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),s.jsx("div",{style:{color:"var(--accent-color)"},children:k.name})]})]}),D&&s.jsx(St,{gained:D.gained,effectiveTime:D.effectiveTime,totalTime:D.totalTime,efficiency:D.efficiency,completedProjects:D.completedProjects,currentLevel:D.currentLevel,maxDuration:D.maxDuration,numberFormat:t.numberFormat,onClose:()=>X(null)}),Fe&&s.jsx(Pt,{gameState:t,onClose:()=>q(!1),onStartProject:e=>{var i;const o=((i=t.nationalProjects[e])==null?void 0:i.level)||0;if(o>=ut)return;const n=ft(e,o+1);if(t.gold.lt(n.gold))return;const l=yt(o+1);c(u=>d(a({},u),{gold:u.gold.minus(n.gold),nationalProjects:d(a({},u.nationalProjects),{[e]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+l*1e3}})})),p("Construction started!","info")},onUpgradeClickPower:We,onUpgradeOffline:He}),Be&&s.jsx(Et,{gameState:t,onGamble:(e,o)=>{const n=r(e);c(l=>d(a({},l),{gold:o?l.gold.plus(n):l.gold.minus(n).max(0),stats:d(a({},l.stats),{tavernGamesPlayed:l.stats.tavernGamesPlayed.plus(r(1))})}))},onClose:()=>te(!1)}),Ge&&s.jsx(Ct,{gameState:t,onPrestige:qe,onClose:()=>Y(!1)}),Re&&s.jsx(jt,{gameState:t,onClose:()=>R(!1),onHardReset:Xe,onSave:Ke,onSetTheme:e=>c(o=>d(a({},o),{theme:e})),onSetNumberFormat:e=>c(o=>d(a({},o),{numberFormat:e})),onToggleIdleMode:()=>c(e=>d(a({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>c(o=>d(a({},o),{interface:a(a({},o.interface),e)})),onOpenPromoCodes:()=>{R(!1),re(!0)},onChangeName:()=>fe(!0)}),$e&&s.jsx(Tt,{gameState:t,onClose:()=>re(!1),onRedeemPromoCode:Ze,onBackToSettings:()=>{re(!1),R(!0)}}),Ue&&s.jsx(kt,{gameState:t,currentGps:F,onClose:()=>oe(!1)}),Ae&&s.jsx(Lt,{onClose:()=>_e(!1)}),ie&&s.jsx(Mt,{isOpen:ie,onClose:()=>{ce(!1),C(!0)},onConfirm:Ye,gameState:t}),de&&s.jsx(It,{isOpen:de,onClose:()=>ne(!1),playerProfile:t.playerProfile}),ue&&s.jsx(Nt,{isOpen:ue,onClose:()=>fe(!1),onConfirm:Qe,currentName:((xe=t.playerProfile)==null?void 0:xe.rulerName)||""})]})},Ie=document.getElementById("root");if(!Ie)throw new Error("Could not find root element to mount to");const Rt=at.createRoot(Ie);Rt.render(s.jsx(it.StrictMode,{children:s.jsx(Gt,{})}))});export default At();
