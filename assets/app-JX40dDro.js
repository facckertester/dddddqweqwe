import{r as jt,g as wt}from"./vendor-B--z-fyW.js";import{t as o,f as w,B as ge,P as We,g as we,a as Ke,b as kt,U as lt,c as Ve,S as De,W as at,d as Ne,T as Ge,C as Xe,A as Be,N as St,e as dt,M as Oe,h as ct,i as xt,j as Ue,k as Ee,l as pt,m as _e,n as Fe}from"./core-DEU_YNIC.js";import{a as ce,i as Ct,g as Tt,d as Je,s as Ze,b as Qe,q as ut,c as gt,o as ht,l as ft,e as mt}from"./game-DOhdzVw7.js";var Ie={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var et;function Rt(){if(et)return Se;et=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function x(i,c,r){var l=null;if(r!==void 0&&(l=""+r),c.key!==void 0&&(l=""+c.key),"key"in c){r={};for(var s in c)s!=="key"&&(r[s]=c[s])}else r=c;return c=r.ref,{$$typeof:t,type:i,key:l,ref:c!==void 0?c:null,props:r}}return Se.Fragment=n,Se.jsx=x,Se.jsxs=x,Se}var tt;function Nt(){return tt||(tt=1,Ie.exports=Rt()),Ie.exports}var e=Nt(),y=jt();const Bt=wt(y),Et=({gameState:t,building:n,x,y:i,visible:c,onHide:r})=>{const l=y.useRef(null),[s,m]=y.useState({x:0,y:0});if(y.useEffect(()=>{if(!c||!l.current)return;const v=l.current.getBoundingClientRect();let z=x+15,p=i-v.height/2;z+v.width>window.innerWidth&&(z=x-v.width-15),p<10&&(p=10),p+v.height>window.innerHeight-10&&(p=window.innerHeight-v.height-10),m({x:z,y:p})},[c,x,i]),!c||!n)return null;const d=t.buildings[n.id]||o(0);if(!(t.totalGold.gte(n.baseCost)||d.gt(o(0))))return e.jsxs("div",{ref:l,className:"advanced-tooltip",style:{position:"fixed",left:`${s.x}px`,top:`${s.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"15px",lineHeight:"1.4",width:"240px",minWidth:"240px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:r,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid var(--accent-color)",paddingBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"â“"}),e.jsx("span",{children:"???"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05))",borderRadius:"6px",border:"1px solid rgba(33, 150, 243, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:"Count"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05))",borderRadius:"6px",border:"1px solid rgba(76, 175, 80, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold",fontSize:"13px"},children:"Production"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???/s"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05))",borderRadius:"6px",border:"1px solid rgba(255, 152, 0, 0.3)"},children:[e.jsx("span",{style:{color:"#ff9800",fontWeight:"bold",fontSize:"13px"},children:"Income Share"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???%"})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(141, 110, 99, 0.1), rgba(141, 110, 99, 0.05))",borderRadius:"6px",border:"1px solid var(--accent-color)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"13px"},children:"Next Building"}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"14px"},children:"??? gold"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05))",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.3)"},children:[e.jsx("span",{style:{color:"#9c27b0",fontWeight:"bold",fontSize:"13px"},children:"Each Produces"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???/s"})]})]}),e.jsx("div",{style:{padding:"6px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"6px",borderTop:"1px solid var(--border-color)",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",textAlign:"center"},children:"???"})]});const g=t.buildings[n.id]||o(0),R=bt(t,n),k=R.times(g),C=zt(t),W=C.gt(0)?k.div(C).times(100):o(0),S=Wt(n.baseCost,g);return(S.gt(0)?R.div(S):o(0)).gt(0)?S.div(R):o(0),e.jsxs("div",{ref:l,className:"advanced-tooltip",style:{position:"fixed",left:`${s.x}px`,top:`${s.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"15px",lineHeight:"1.4",width:"240px",minWidth:"240px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:r,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid var(--accent-color)",paddingBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:n.icon}),e.jsx("span",{children:n.name})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05))",borderRadius:"6px",border:"1px solid rgba(33, 150, 243, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:"Count"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:w(g,t.numberFormat)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05))",borderRadius:"6px",border:"1px solid rgba(76, 175, 80, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold",fontSize:"13px"},children:"Production"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(k,t.numberFormat),"/s"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05))",borderRadius:"6px",border:"1px solid rgba(255, 152, 0, 0.3)"},children:[e.jsx("span",{style:{color:"#ff9800",fontWeight:"bold",fontSize:"13px"},children:"Income Share"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(W,t.numberFormat),"%"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(141, 110, 99, 0.1), rgba(141, 110, 99, 0.05))",borderRadius:"6px",border:"1px solid var(--accent-color)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"13px"},children:"Next Building"}),e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"14px"},children:[w(S,t.numberFormat)," gold"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05))",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.3)"},children:[e.jsx("span",{style:{color:"#9c27b0",fontWeight:"bold",fontSize:"13px"},children:"Each Produces"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(R,t.numberFormat),"/s"]})]})]}),e.jsx("div",{style:{padding:"6px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"6px",borderTop:"1px solid var(--border-color)",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",textAlign:"center"},children:n.description})]})};function bt(t,n){var s;let x=n.baseProduction;const i=((s=t.weather)==null?void 0:s.current)||"clear";i==="sunny"&&(n.id==="peasant"||n.id==="field")?x=x.times(o(1.2)):i==="rainy"&&(n.id==="silver_mine"||n.id==="alchemist")?x=x.times(o(1.2)):i==="stormy"?(n.id==="blacksmith"&&(x=x.times(o(1.3))),n.id==="field"&&(x=x.times(o(.8)))):i==="windy"&&n.id==="market"&&(x=x.times(o(1.15)));let c=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(m=>{c+=m.level||0});const r=1+c*We;x=x.times(o(r));const l=ue(t.renown);return x=x.times(l),x}function ue(t){const n=t.toNumber();if(n<=0)return o(1);let x=o(1);n<=100?x=o(1+n*.01):n<=1e3?x=o(2).plus(o(n-100).times(o(.005))):n<=1e4?x=o(2.5).plus(o(n-1e3).times(o(.001))):x=o(10).plus(o(10).times(Math.log10(n)));const i=o(1e3);return ce.min(x,i)}function zt(t){let n=o(0);return ge.forEach(x=>{const i=t.buildings[x.id]||o(0);if(i.gt(0)){const c=bt(t,x);n=n.plus(c.times(i))}}),n}function Wt(t,n){return t.times(o(1.15).pow(n)).floor()}const ot=(t,n=!1,x=!1,i=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:x?"rgba(0,0,0,0.05)":n?"rgba(46, 125, 50, 0.1)":i?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:x?"rgba(0,0,0,0.2)":i?"#7b1fa2":t?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:t&&!x?"pointer":"default",opacity:t&&!x||n?1:.7,transition:"all 0.2s",boxShadow:t&&!x?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:x?"grayscale(1)":"none"}),yt={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},nt=({gameState:t,onBuyBuilding:n,onSellBuilding:x,onSetBuyAmount:i})=>{var S;const[c,r]=y.useState({visible:!1,x:0,y:0,building:null}),l=o(1),s=((S=t.interface)==null?void 0:S.lastBuyAmount)||o(1),[m,d]=y.useState(!1),[h,g]=y.useState(1);y.useEffect(()=>{const b=z=>{z.ctrlKey?g(10):z.shiftKey?g(100):g(1)},N=z=>b(z),v=z=>b(z);return window.addEventListener("keydown",N),window.addEventListener("keyup",v),()=>{window.removeEventListener("keydown",N),window.removeEventListener("keyup",v)}},[]);const R=(b,N)=>{const v=b.currentTarget.getBoundingClientRect();r({visible:!0,x:v.right,y:v.top+v.height/2,building:N})},k=()=>{r({visible:!1,x:0,y:0,building:null})},C=(b,N)=>{var T;let v=N;const z=((T=t.weather)==null?void 0:T.current)||"clear";z==="sunny"&&(b==="peasant"||b==="field")?v=v.times(o(1.2)):z==="rainy"&&(b==="silver_mine"||b==="alchemist")?v=v.times(o(1.2)):z==="stormy"?(b==="blacksmith"&&(v=v.times(o(1.3))),b==="field"&&(v=v.times(o(.8)))):z==="windy"&&b==="market"&&(v=v.times(o(1.15)));let p=o(1),F=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(P=>F+=P.level||0);const $=1+F*.05;p=p.times(o($));const _=ue(t.renown);return p=p.times(_),v.times(p)};let W=0;return e.jsxs("div",{style:yt,children:[e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[o(1),o(10),o(100),o(500),o(1e3),o(-1)].map(b=>e.jsx("button",{onClick:()=>i(b),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:s.equals(b)?"var(--accent-color)":"var(--panel-bg)",color:s.equals(b)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:b.equals(o(-1))?"Max":`${b.toString()}`},`amount-${b.toString()}`))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[e.jsx("button",{className:"btn",style:{background:m?"var(--panel-bg)":"var(--accent-color)",color:m?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>d(!1),children:"ðŸ›’ Buy Mode"}),e.jsx("button",{className:"btn",style:{background:m?"#e65100":"var(--panel-bg)",color:m?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>d(!0),children:"ðŸ’° Sell Mode (25%)"})]}),e.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),ge.map((b,N)=>{const v=t.buildings[b.id]||o(0),z=t.totalGold.gte(b.baseCost)||v.gt(o(0));if(z||W++,!z&&W>2)return null;if(m){if(v.eq(o(0)))return null;let B;s.equals(o(-1))?B=v:(B=s.times(h),B.gt(v)&&(B=v));const D=we(b.baseCost,v.minus(B),B).times(o(.25)).floor();return C(b.id,b.baseProduction),e.jsxs("div",{style:ot(!0,!1,!1,!1),onClick:()=>x(b.id,B.toNumber()),onMouseEnter:K=>R(K,b),onMouseLeave:k,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:b.icon}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:b.name}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:w(v,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",w(D,t.numberFormat)]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",w(B,t.numberFormat)]})]})]},b.id)}let p=o(0),F=o(0);s.equals(o(-1))?(p=Ke(b.baseCost,v,t.gold.div(l)),p.eq(o(0))?(p=o(1),F=kt(b.baseCost,v).times(l).floor()):F=we(b.baseCost,v,p).times(l).floor()):(p=s,F=we(b.baseCost,v,p).times(l).floor());const $=t.gold.gte(F),_=s.equals(o(-1))&&Ke(b.baseCost,v,t.gold.div(l)).eq(o(0));let T=p,P=F,O=$;return s.equals(o(-1))||(T=p.times(h),P=we(b.baseCost,v,T).times(l).floor(),O=t.gold.gte(P)),e.jsxs("div",{style:ot(O&&!_,!1,!z),onClick:()=>{if(!(O&&!_))return;const B=s.equals(o(-1))?p:T;n(b.id,B.toNumber())},onMouseEnter:B=>R(B,b),onMouseLeave:k,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:z?b.icon:"â“"}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:z?b.name:"???"}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:w(v,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsx("div",{style:{color:O&&!_?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:w(s.equals(o(-1))?F:P,t.numberFormat)}),!s.equals(o(-1))&&e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",w(T,t.numberFormat)]})]})]},b.id)}),e.jsx(Et,{gameState:t,building:c.building,x:c.x,y:c.y,visible:c.visible,onHide:k})]})},rt=({gameState:t,onTrainSoldier:n,onTrainElite:x})=>{const[i,c]=y.useState(1);y.useEffect(()=>{const l=m=>{m.ctrlKey&&!m.shiftKey?c(10):m.shiftKey&&!m.ctrlKey?c(100):m.ctrlKey&&m.shiftKey&&c(1e3)},s=()=>c(1);return window.addEventListener("keydown",l),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",s)}},[]);const r=l=>Ve(De.times(o(l)),t.renown);return e.jsxs("div",{style:yt,children:[e.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",borderRadius:"4px",marginBottom:"10px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"5px",color:"var(--text-color)"},children:"Construction Workforce"}),e.jsx("div",{style:{fontSize:"2rem",color:"var(--text-color)"},children:w(t.soldiers,t.numberFormat)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"General Laborers Available"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1*i)),onClick:()=>{n(1*i)},"data-tooltip":`Hire 1 laborer - Cost: ${w(r(1*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1*i}`:"1"," (",w(r(1*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(10*i)),onClick:()=>{n(10*i)},"data-tooltip":`Hire 10 laborers - Cost: ${w(r(10*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${10*i}`:"10"," (",w(r(10*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(100*i)),onClick:()=>{n(100*i)},"data-tooltip":`Hire 100 laborers - Cost: ${w(r(100*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${100*i}`:"100"," (",w(r(100*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e3*i)),onClick:()=>{n(1e3*i)},"data-tooltip":`Hire 1K laborers - Cost: ${w(r(1e3*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1e3*i/1e3}K`:"1K"," (",w(r(1e3*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e6*i)),onClick:()=>{n(1e6*i)},"data-tooltip":`Hire 1M laborers - Cost: ${w(r(1e6*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1e6*i/1e6}M`:"1M"," (",w(r(1e6*i),t.numberFormat)," G)"]})]}),e.jsxs("div",{style:{borderTop:"2px solid var(--border-color)",paddingTop:"15px"},children:[e.jsxs("h3",{style:{fontSize:"1rem",color:"var(--accent-color)",fontWeight:"bold",marginBottom:"10px"},children:["Specialist Guild ",e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",color:"var(--text-secondary)"},children:"(Train from Laborers)"})]}),lt.map(l=>{const s=t.eliteUnits[l.id]||o(0),d={carpenter:"blacksmith",mason:"castle",architect:"palace"}[l.id],h=d?t.buildings[d]||o(0):o(0),g=Ve(l.goldCost,t.renown),R=t.soldiers.gte(l.soldierCost),k=t.gold.gte(g)&&R;return!d||h.lt(o(1))?null:e.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},"data-tooltip":"",children:[e.jsx("div",{style:{fontSize:"2rem"},children:l.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:"bold",color:"var(--text-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:[l.name," ",e.jsxs("span",{style:{color:"var(--text-secondary)"},children:["x",w(s,t.numberFormat)]})]}),e.jsxs("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},disabled:!k,onClick:()=>x(l.id,i),onMouseEnter:C=>{k||(C.currentTarget.style.cursor="not-allowed")},onMouseLeave:C=>{C.currentTarget.style.cursor="pointer"},"data-tooltip":"",children:["Train ",i>1?`x${i}`:""]})]}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:l.description}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"2px"},children:["Requires ",w(g,t.numberFormat)," Gold and ",w(l.soldierCost,t.numberFormat)," Laborers"]})]})]},l.id)})]})]})},it=({gameState:t,gps:n,onClick:x,onEventInteract:i,onOpenTavern:c,onOpenPrestige:r,onOpenSettings:l,onOpenStatistics:s,onOpenLeaderboard:m,onOpenEmpire:d,isIdle:h})=>{var F,$,_;const[g,R]=y.useState([]),k=y.useRef(null),C=t.interface||{showFloatingText:!0,showWeatherWidget:!0,crownAnimations:!0},W=()=>{let T=0;return t.nationalProjects&&Object.values(t.nationalProjects).forEach(P=>{T+=P.level*We}),o(T)},S=T=>{var P;if(C.showFloatingText){const O=(P=k.current)==null?void 0:P.getBoundingClientRect();if(O){const B=T.clientX-O.left+(Math.random()*40-20),D=T.clientY-O.top+(Math.random()*40-20),K=ue(t.renown),X=o(1),V=t.clickUpgradeLevel||0,ae=Math.min(V,15),re=o(2).pow(ae),se=X.times(re),he=Ne(V),fe=n.times(he);let le=se.plus(fe);if(le=le.times(K),t.godMode){const oe=n.times(o(99999));le=le.plus(oe)}const Z="+"+w(le,t.numberFormat),ie={id:Date.now(),x:B,y:D,val:Z};R(oe=>[...oe,ie]),setTimeout(()=>{R(oe=>oe.filter(M=>M.id!==ie.id))},1e3)}}x(T)},b=at[((F=t.weather)==null?void 0:F.current)||"clear"],N={transition:"transform 0.8s ease-in-out, width 0.8s ease-in-out, height 0.8s ease-in-out, margin 0.8s ease-in-out, position 0.8s ease-in-out"},v=h?{position:"fixed",bottom:"120px",right:"30px",transform:"scale(0.8)",transformOrigin:"bottom right",textAlign:"right",zIndex:100,...N}:{transform:"scale(1)",marginBottom:"3rem",zIndex:10,textAlign:"center",...N},z=h?{width:"80px",height:"80px",fontSize:"2rem",position:"fixed",bottom:"30px",right:"30px",borderRadius:"50%",zIndex:100,...N}:{width:"260px",height:"260px",fontSize:"6rem",borderRadius:"50%",position:"relative",zIndex:5,margin:"0 auto",...N},p={opacity:h?0:1,transition:"opacity 0.5s ease-in-out",pointerEvents:h?"none":"auto"};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"var(--panel-padding)",height:"100%",overflow:"hidden"},children:[C.showWeatherWidget&&e.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:20,background:b.color,padding:"8px 12px",borderRadius:"20px",border:"2px solid rgba(0,0,0,0.1)",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"8px",cursor:"help",...p},"data-tooltip":`${b.name}: ${b.description}`,children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:b.icon}),e.jsxs("div",{style:{textAlign:"left",lineHeight:"1.1"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#222"},children:b.name}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#444"},children:[o(Number((($=t.weather)==null?void 0:$.timeLeft)||0)).ceil().toString(),"s remaining"]})]})]}),e.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:20,display:"flex",gap:"5px",...p},children:[e.jsx("button",{onClick:m,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.8,color:"var(--text-color)",transition:"all 0.2s ease"},title:"Leaderboard (Available for all players)",children:"ðŸ†"}),e.jsx("button",{onClick:s,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Statistics",children:"ðŸ“Š"}),e.jsx("button",{onClick:l,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Kingdom Settings",children:"âš™ï¸"})]}),e.jsxs("div",{style:v,children:[e.jsx("div",{style:{fontSize:"1rem",color:h?"var(--text-color)":"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",letterSpacing:"2px",textShadow:h?"1px 1px 2px #000":"none"},children:"Royal Treasury"}),e.jsx("div",{style:{fontSize:"3rem",fontFamily:"var(--font-main)",color:"var(--text-color)",textShadow:h?"2px 2px 4px #000":"2px 2px 0px rgba(255, 215, 0, 0.4)"},children:w(t.gold,t.numberFormat)}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"1.1rem",color:h?"#90ee90":"var(--success-color)",fontStyle:"italic",textShadow:h?"1px 1px 2px #000":"none"},children:["+",w(n,t.numberFormat)," gold / sec"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",marginTop:"15px"},children:[e.jsxs("div",{style:{padding:"5px 15px",background:h?"rgba(0,0,0,0.5)":"rgba(103, 58, 183, 0.1)",border:"1px solid rgba(103, 58, 183, 0.3)",borderRadius:"20px",display:"inline-block"},children:[e.jsxs("span",{style:{color:h?"#b39ddb":"#673ab7",fontWeight:"bold"},children:["ðŸ‘‘ Renown: ",w(t.renown,t.numberFormat)]}),!h&&e.jsxs("span",{style:{fontSize:"0.8rem",color:"#673ab7",marginLeft:"5px"},children:["(+",ue(t.renown).minus(o(1)).times(o(100)).floor().toString(),"% Bonus)"]})]}),e.jsx("div",{style:{padding:"5px 15px",background:h?"rgba(0,0,0,0.5)":"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"20px",display:"inline-block"},children:e.jsxs("span",{style:{color:h?"#81c784":"#4caf50",fontWeight:"bold"},children:["ðŸ—ï¸ Projects: +",W().times(o(100)).floor().toString(),"%"]})})]})]}),e.jsxs("div",{style:{position:"relative",marginBottom:h?0:"3rem",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{className:"magnetic-container",children:e.jsx("button",{ref:k,className:`main-button ${h?"idle":""} ${C.crownAnimations?"":"no-animations"}`,style:{...z,display:"flex",alignItems:"center",justifyContent:"center",outline:"none",color:"#5d4037",cursor:"pointer",overflow:"hidden"},onClick:S,children:e.jsx("span",{className:C.crownAnimations?"crown-icon":"",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",lineHeight:1,marginTop:"-10px"},children:"ðŸ‘‘"})})}),!h&&g.map(T=>e.jsx("div",{className:"floating-text",style:{left:T.x,top:T.y},children:T.val},T.id))]}),e.jsxs("div",{style:{display:"flex",gap:"10px",zIndex:10,flexWrap:"wrap",justifyContent:"center",...p},children:[t.buildings.field&&t.buildings.field.gt(o(0))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)",borderColor:"var(--gold-color)"},onClick:d,children:"ðŸ—ï¸ Projects"}),((_=t.buildings.tavern)==null?void 0:_.gt(o(0)))&&e.jsx("button",{className:"btn",onClick:c,children:"ðŸº Tavern"}),(t.totalGold.gt(o(5e5))||t.renown.gt(o(0)))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)"},onClick:r,children:"ðŸ‘‘ Legacy"})]}),!h&&t.event&&t.event.type==="dragon"&&e.jsx("div",{className:"dragon-event",onMouseDown:()=>{try{i(t.event)}catch(T){console.error("Error clicking dragon:",T)}},children:"ðŸ‰"}),!h&&t.event&&t.event.type==="merchant"&&e.jsxs("div",{style:{position:"absolute",right:"20px",top:"100px",background:"#fff3e0",padding:"10px",border:"2px solid orange",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>i(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ‘³"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Merchant"}),e.jsx("small",{style:{color:"#444"},children:"Click for gift"})]}),!h&&t.event&&t.event.type==="jester"&&e.jsxs("div",{style:{position:"absolute",left:"20px",top:"100px",background:"#fce4ec",padding:"10px",border:"2px solid pink",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>i(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ðŸ¤¡"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Jester"}),e.jsx("small",{style:{color:"#444"},children:"Risk it all?"})]})]})},Ae=({currentBet:t,maxGold:n,onBetChange:x,numberFormat:i})=>{const[c,r]=y.useState(t===0?"":t.toString());y.useEffect(()=>{var h,g;t===0&&((h=document.activeElement)==null?void 0:h.tagName)!=="INPUT"?r(""):Math.abs(parseFloat(c)-t)>1e-4&&((g=document.activeElement)==null?void 0:g.tagName)!=="INPUT"&&r(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const l=h=>{try{if(h.trim()===""){x(0),r("");return}let g=parseFloat(h);const R=h.toLowerCase().trim(),k={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const W of Object.keys(k))if(R.endsWith(W)){const S=parseFloat(R.slice(0,-W.length));isNaN(S)||(g=S*k[W]);break}(isNaN(g)||g<0)&&(g=0);const C=n.toNumber();isFinite(C)&&g>C?g=C:!isFinite(C)&&o(g).gt(n)&&(g=Number.MAX_VALUE),x(g),g===0?r(""):g>=1e6?r(g.toExponential(2).replace("+","")):r(Math.floor(g).toString())}catch{r(t===0?"":t.toString())}},s=()=>{l(c)},m=h=>{h.key==="Enter"&&(l(c),h.target.blur())},d=h=>{let R=n.times(h).floor().toNumber();isFinite(R)||(R=Number.MAX_VALUE),R<1&&n.gt(0)&&(R=1),x(R),R>=1e6?r(R.toExponential(2).replace("+","")):r(R.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"ðŸ’°"}),e.jsx("input",{type:"text",value:c,onChange:h=>r(h.target.value),onBlur:s,onKeyDown:m,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager..."}),t>0&&e.jsx("button",{onClick:()=>{x(0),r("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>d(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>l(Math.floor(t/2).toString()),children:"Â½"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>l((t*2).toString()),children:"x2"})]})]})},me=1500,At=({value:t,size:n=50,color:x="#000"})=>{const i=n*.18,c=n*.25,r=n*.5,l=n*.75,s=[];return(t===1||t===3||t===5)&&s.push({cx:r,cy:r}),t>1&&(s.push({cx:c,cy:c}),s.push({cx:l,cy:l})),t>3&&(s.push({cx:l,cy:c}),s.push({cx:c,cy:l})),t===6&&(s.push({cx:c,cy:r}),s.push({cx:l,cy:r})),e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:s.map((m,d)=>e.jsx("circle",{cx:m.cx,cy:m.cy,r:i/2,fill:x},d))})},Mt=({onClose:t})=>e.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.9)",zIndex:20,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderRadius:"8px",color:"#fff"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #666",paddingBottom:"10px",width:"100%"},children:"ðŸ“œ Rules of the Game"}),e.jsxs("div",{style:{textAlign:"left",fontSize:"0.9rem",lineHeight:"1.6",maxWidth:"400px",overflowY:"auto"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Goal:"})," Reach ",me," points first."]}),e.jsx("p",{children:e.jsx("strong",{children:"Scoring Combinations:"})}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:e.jsx("strong",{children:"Single Dice:"})}),e.jsx("li",{children:"ðŸŽ² (1) = 100 points"}),e.jsx("li",{children:"ðŸŽ² (5) = 50 points"}),e.jsx("li",{children:"ðŸŽ² (2,3,4,6) = 0 points"})]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:e.jsx("strong",{children:"Three of a Kind:"})}),e.jsx("li",{children:"Triple ðŸŽ² (1) = 1000 points"}),e.jsx("li",{children:"Triple ðŸŽ² (2) = 200 points"}),e.jsx("li",{children:"Triple ðŸŽ² (3) = 300 points"}),e.jsx("li",{children:"Triple ðŸŽ² (4) = 400 points"}),e.jsx("li",{children:"Triple ðŸŽ² (5) = 500 points"}),e.jsx("li",{children:"Triple ðŸŽ² (6) = 600 points"})]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:e.jsx("strong",{children:"Four-Five-Six of a Kind:"})}),e.jsx("li",{children:"4 of a kind = Triple Ã— 2"}),e.jsx("li",{children:"5 of a kind = Triple Ã— 3"}),e.jsx("li",{children:"6 of a kind = Triple Ã— 4"})]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:e.jsx("strong",{children:"Straights (1-5 or 2-6):"})}),e.jsx("li",{children:"5 dice straight = 1500 points"}),e.jsx("li",{children:"6 dice straight = 2000 points"})]}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"5px 0"},children:[e.jsx("li",{children:e.jsx("strong",{children:"Three Pairs:"})}),e.jsx("li",{children:"Three pairs = 1500 points"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Farkle:"})," Roll no scoring dice = lose turn score."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Strategy:"})," Bank points or risk rolling again for higher scores!"]})]}),e.jsx("button",{className:"btn",onClick:t,style:{marginTop:"20px",width:"100%"},children:"I Understand"})]}),Pt=({gameState:t,onGamble:n,onLeave:x})=>{const[i,c]=y.useState(0),[r,l]=y.useState("betting"),[s,m]=y.useState("player"),[d,h]=y.useState(!1),[g,R]=y.useState(null),[k,C]=y.useState({player:0,opponent:0}),[W,S]=y.useState(0),[b,N]=y.useState([]),[v,z]=y.useState(""),[p,F]=y.useState(!1),[$,_]=y.useState(""),T=(M=6)=>Array.from({length:M},(I,A)=>({id:Math.random()+A,value:Math.floor(Math.random()*6)+1,status:"active",animating:!0}));y.useEffect(()=>{if(b.filter(I=>I.animating).length>0){const I=setTimeout(()=>{N(A=>A.map(J=>J.animating?{...J,animating:!1}:J))},600);return()=>clearTimeout(I)}},[b]);const P=M=>{let I=0;const A=[0,0,0,0,0,0,0];return M.forEach(J=>A[J]++),A[1]>=3?(I+=1e3*Math.pow(2,A[1]-3),A[1]=0):(I+=A[1]*100,A[1]=0),A[5]>=3?(I+=500*Math.pow(2,A[5]-3),A[5]=0):(I+=A[5]*50,A[5]=0),[2,3,4,6].forEach(J=>{A[J]>=3&&(I+=J*100*Math.pow(2,A[J]-3))}),I},O=M=>{const I=[0,0,0,0,0,0,0];return M.forEach(A=>I[A.value]++),M.map((A,J)=>A.value===1||A.value===5||I[A.value]>=3?J:-1).filter(A=>A!==-1)},B=()=>{if(i<=0){z("Please bet something!");return}if(t.gold.lt(o(i))){z("Not enough gold!");return}l("playing"),C({player:0,opponent:0}),R(null),m("player"),D("player")},D=M=>{m(M),S(0),F(!1),N(T(6)),M==="player"?(z(`Your Turn! Target: ${me}`),se(T(6))):z("Opponent's Turn...")};y.useEffect(()=>{let M;return s==="opponent"&&!p&&(M=setTimeout(async()=>{if(r!=="playing"||s!=="opponent"||b.length===0)return;_("Thinking..."),await new Promise(Y=>setTimeout(Y,1e3));const A=b.filter(Y=>Y.status==="active").map(Y=>Y.value);if(P(A)===0){_("Farkle!"),z("Opponent rolled no points!"),F(!0),await new Promise(Y=>setTimeout(Y,1500)),V();return}_("Selecting dice...");const J=O(b.filter(Y=>Y.status==="active")),ne=[...b];if(J.length===0){V();return}const ye=ne.filter(Y=>Y.status==="active");ye.forEach((Y,$e)=>{const Re=[0,0,0,0,0,0,0];ye.forEach(Pe=>Re[Pe.value]++),(Y.value===1||Y.value===5||Re[Y.value]>=3)&&(Y.status="selected")}),N(ne);const xe=ne.filter(Y=>Y.status==="selected").map(Y=>Y.value),Te=P(xe);await new Promise(Y=>setTimeout(Y,1e3));const pe=W+Te,ke=ne.filter(Y=>Y.status==="active").length;k.opponent+pe>=me?(_("Banking for victory!"),await new Promise(Y=>setTimeout(Y,1e3)),K(pe)):ke===0?(_("Hot Dice! Rolling again!"),await new Promise(Y=>setTimeout(Y,1e3)),X(pe)):pe>=400||ke<=2?(_(`Banking ${pe}...`),await new Promise(Y=>setTimeout(Y,1e3)),K(pe)):(_("Rolling again..."),await new Promise(Y=>setTimeout(Y,1e3)),X(pe))},500)),()=>clearTimeout(M)},[s,b,W,r,p]);const K=M=>{const I=k.opponent+M;C(A=>({...A,opponent:I})),I>=me?le("opponent"):V()},X=M=>{S(M),N(I=>I.map(A=>A.status==="selected"?{...A,status:"banked"}:A)),setTimeout(()=>{ae()},500)},V=()=>{m(M=>M==="player"?"opponent":"player"),D(s==="player"?"opponent":"player")},ae=M=>{N(I=>{let A=I.filter(J=>J.status==="active").length;return A===0&&(A=6),T(A)})},re=()=>{const I=b.filter(xe=>xe.status==="selected").map(xe=>xe.value),A=P(I);S(W+A);const J=b.filter(xe=>xe.status==="active").length,ye=T(J===0?6:J);N(ye),se(ye)},se=(M,I)=>{const A=M.map(ne=>ne.value);P(A)===0?(F(!0),z("FARKLE! No points. Turn lost."),setTimeout(V,2e3)):z("Select dice to keep.")},he=M=>{s!=="player"||p||N(I=>I.map(A=>A.id===M?{...A,status:A.status==="active"?"selected":"active"}:A))},fe=()=>{const M=b.filter(ne=>ne.status==="selected"),I=P(M.map(ne=>ne.value)),A=W+I;if(A<300&&k.player+A<me){z("Must score at least 300 to bank!");return}const J=k.player+A;C(ne=>({...ne,player:J})),J>=me?le("player"):V()},le=M=>{l("gameOver");const I=M==="player";n(i,I),z(I?"Victory!":"Defeat!"),R({won:I,amount:i})},Z=()=>{R(null),l("betting"),C({player:0,opponent:0}),N([]),z("")};g&&(g.won,g.won,g.won,g.won,g.won,g.won?(e.Fragment,w(o(g.amount),t.numberFormat)):(e.Fragment,w(o(g.amount),t.numberFormat)));const ie=P(b.filter(M=>M.status==="selected").map(M=>M.value)),oe=ie>0&&(function(){const M=b.filter(I=>I.status==="selected").map(I=>I.value);for(let I=0;I<M.length;I++){const A=[...M];if(A.splice(I,1),P(A)===ie)return!1}return!0})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
        @keyframes rollIn { 0% { transform: rotate(-360deg) scale(0.2); opacity: 0; } 70% { transform: rotate(10deg) scale(1.1); opacity: 1; } 100% { transform: rotate(0) scale(1); opacity: 1; } }
        .die-roll { animation: rollIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
      `}),d&&e.jsx(Mt,{onClose:()=>h(!1)}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",background:"var(--panel-bg)",padding:"15px 20px",borderBottom:"2px solid var(--border-color)",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"YOU"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:k.player})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-color)"},children:"TARGET"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"1.2rem"},children:me})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"OPPONENT"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:k.opponent})]})]}),e.jsxs("div",{style:{flex:1,overflow:"hidden",background:"var(--bg-color)",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},children:[r==="betting"&&e.jsxs("div",{style:{padding:"20px",textAlign:"center",maxWidth:"600px",margin:"0 auto",width:"100%",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"10px",right:"10px"},children:e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.5rem",opacity:.5},onClick:()=>h(!0),children:"â“"})}),e.jsx("div",{style:{fontSize:"3rem"},children:"ðŸŽ²"}),e.jsx("h3",{children:"High Stakes Farkle"}),e.jsxs("p",{style:{marginBottom:"auto",color:"var(--text-secondary)"},children:["Winner takes the pot. Race to ",me,"."]})]}),(r==="playing"||r==="gameOver")&&e.jsxs("div",{style:{padding:"10px",textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"10px",right:"10px"},children:e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",fontSize:"1.5rem",opacity:.5},onClick:()=>h(!0),children:"â“"})}),e.jsx("div",{style:{marginBottom:"20px",minHeight:"30px",flexShrink:0},children:s==="player"?e.jsxs("div",{style:{padding:"10px",background:"rgba(76, 175, 80, 0.1)",border:"1px solid #4caf50",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#2e7d32",fontWeight:"bold"},children:"YOUR TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:W+ie})]})]}):e.jsxs("div",{style:{padding:"10px",background:"rgba(244, 67, 54, 0.1)",border:"1px solid #ef5350",borderRadius:"8px",display:"inline-block"},children:[e.jsx("div",{style:{color:"#c62828",fontWeight:"bold"},children:"OPPONENT'S TURN"}),e.jsxs("div",{children:["Pot: ",e.jsx("strong",{children:W})]}),e.jsx("div",{style:{fontSize:"0.8rem",fontStyle:"italic"},children:$})]})}),e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap",marginBottom:"20px",flex:1,alignContent:"center"},children:b.map(M=>e.jsx("div",{className:M.animating?"die-roll":"",style:{width:"64px",height:"64px",background:M.status==="selected"?"var(--accent-color)":"#fdfdfd",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",cursor:s==="player"?"pointer":"default",border:M.status==="selected"?"2px solid var(--gold-color)":"1px solid #ccc"},onClick:()=>he(M.id),children:e.jsx(At,{value:M.value,size:50,color:M.status==="selected"?"#fff":"#333"})},M.id))}),e.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"10px",fontWeight:"bold",minHeight:"2rem",flexShrink:0},children:v})]})]}),e.jsxs("div",{style:{padding:"15px 20px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",flexShrink:0},children:[r==="betting"&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:i,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:B,disabled:i<=0,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:i<=0?.5:1,flexShrink:0,fontWeight:"bold"},children:"START"})]}),(r==="playing"||r==="gameOver")&&e.jsx("div",{children:r==="playing"&&s==="player"?e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center"},children:[e.jsxs("button",{className:"btn",onClick:re,disabled:!oe,style:{opacity:oe?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Roll (+",ie,")"]}),e.jsxs("button",{className:"btn",onClick:fe,disabled:!oe&&W===0,style:{background:"var(--success-color)",opacity:oe||W>0?1:.5,flex:1,padding:"15px",fontSize:"1.1rem"},children:["Bank ",W+ie]})]}):r==="gameOver"?e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"center"},children:e.jsx("button",{className:"btn",onClick:Z,style:{flex:1,padding:"15px",fontSize:"1.1rem",background:"var(--accent-color)"},children:"PLAY AGAIN"})}):e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"15px"}})})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),g?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:g.won?"ðŸ†":"ðŸ’€"}),e.jsx("span",{style:{color:g.won?"#4caf50":"#f44336",marginRight:"10px"},children:g.won?"Victory!":"Defeat!"}),e.jsxs("span",{style:{color:g.won?"gold":"#ef5350"},children:[g.won?"+":"-",w(o(g.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Lt=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],Ft=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],It=50,Dt=({gameState:t,onGamble:n,onLeave:x})=>{const[i,c]=y.useState([]),[r,l]=y.useState(null),[s,m]=y.useState(0),[d,h]=y.useState("betting"),[g,R]=y.useState(""),[k,C]=y.useState(null),W=y.useRef(null),S=y.useRef([]);y.useEffect(()=>{b()},[]);const b=()=>{const p=[],F=[...Lt].sort(()=>.5-Math.random());for(let $=0;$<6;$++){const _=Math.random()*5+5,T=Math.random()*5+5;let O=25-(_+T);O=O+(Math.random()*4-2),O<1.5&&(O=1.5),O>20&&(O=20),p.push({id:$,name:F[$],color:Ft[$],icon:"ðŸŽ",odds:parseFloat(O.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:_,staminaRating:T})}c(p),l(null),C(null),S.current=[],R("Select a horse and place your bet!")},N=()=>{if(r===null){R("Select a horse first!");return}if(s<=0){R("Place a valid bet!");return}if(t.gold.lt(o(s))){R("Not enough gold!");return}h("racing"),R("And they're off!");let p=0;const F=400;W.current=setInterval(()=>{p++,c($=>$.map(T=>{if(T.finished)return T;const P=Math.random()<.05?1:0,O=Math.random()<.05?-.5:0,B=.15,D=T.speedRating/10*.15,K=Math.random()*.2;let X=B+D+K+P+O,V=T.progress+X;return V>=100&&(V=100,!S.current.includes(T.id))?(S.current.push(T.id),{...T,progress:100,finished:!0,rank:S.current.length}):{...T,progress:V}}).slice(0,6)),(S.current.length===6||p>=F)&&(S.current.length<6&&c($=>($.filter(T=>!T.finished).sort((T,P)=>P.progress-T.progress).forEach(T=>{S.current.includes(T.id)||S.current.push(T.id)}),$.map(T=>{const P=S.current.indexOf(T.id);return P!==-1?{...T,rank:P+1,finished:!0,progress:100}:T}))),v())},It)},v=()=>{W.current&&clearInterval(W.current);const p=i.map(T=>{const P=S.current.indexOf(T.id);return P!==-1?{...T,rank:P+1,finished:!0}:T});c(p);const F=S.current[0],$=p.find(T=>T.id===F);if(!$)return;if(h("finished"),F===r){const T=p.find(B=>B.id===r),P=(T==null?void 0:T.odds)||1,O=Math.max(1,Math.floor(s*(P-1)));n(O,!0),C({won:!0,amount:O,winnerName:$.name})}else n(s,!1),C({won:!1,amount:s,winnerName:$.name})};y.useEffect(()=>()=>{W.current&&clearInterval(W.current)},[]);const z=()=>{h("betting"),m(0),b()};return k&&(k.won,k.won,k.won,k.won,k.won,k.winnerName,k.won?(e.Fragment,w(o(k.amount),t.numberFormat)):(e.Fragment,w(o(k.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:g}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),i.map(p=>e.jsxs("div",{onClick:()=>d==="betting"&&l(p.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:d==="betting"?"pointer":"default",background:r===p.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid var(--border-color)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"var(--panel-bg)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--text-color)"},children:p.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:r===p.id?"var(--accent-color)":"var(--text-secondary)",fontWeight:"bold"},children:[p.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${p.progress}% - ${p.progress*.8}px)`,transition:d==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:r===p.id?"drop-shadow(0 0 5px gold)":"drop-shadow(0 2px 2px rgba(0,0,0,0.3))",color:p.color},children:e.jsx("div",{style:{fontSize:"2rem"},children:p.icon})}),p.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5,color:"#000",textShadow:"0 0 2px rgba(0,0,0,0.3)"},children:p.rank===1?"ðŸ¥‡":p.rank===2?"ðŸ¥ˆ":p.rank===3?"ðŸ¥‰":p.rank?`#${p.rank}`:"?"})]},p.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:s,maxGold:t.gold,onBetChange:m,numberFormat:t.numberFormat})}),e.jsxs("div",{style:{flexShrink:0},children:[d==="betting"&&e.jsx("button",{className:"btn",onClick:N,disabled:r===null||s<=0,style:{opacity:r===null||s<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"START"}),d==="finished"&&e.jsx("button",{className:"btn",onClick:z,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"RACE AGAIN"}),d==="racing"&&e.jsx("div",{style:{width:"100%",height:"60px"}})]})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),k?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:k.won?"ðŸ‡":"ðŸ¢"}),e.jsx("span",{style:{color:k.won?"#4caf50":"#f44336",marginRight:"10px"},children:k.won?"Winner!":"Better luck next time"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Winner: ",k.winnerName]}),e.jsxs("span",{style:{color:k.won?"gold":"#ef5350"},children:[k.won?"+":"-",w(o(k.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Gt=({gameState:t,onGamble:n,onLeave:x})=>{const[i,c]=y.useState(0),[r,l]=y.useState(null),[s,m]=y.useState(!1),[d,h]=y.useState(0),[g,R]=y.useState(null),[k,C]=y.useState("Select a side and place your wager.");g&&(g.won,g.won,g.won,g.won,g.won,g.side,g.won?(e.Fragment,w(o(g.amount),t.numberFormat)):(e.Fragment,w(o(g.amount),t.numberFormat)));const W=()=>{if(!r){C("Please select Heads or Tails!");return}if(i<=0){C("Please enter a valid bet amount.");return}if(t.gold.lt(o(i))){C("Not enough gold!");return}m(!0),C("");const b=Math.random()>.5?"heads":"tails",N=r===b,v=d,p=360*5;let F=v+p;const $=F%360;b==="heads"?F+=360-$:F+=180-$+360,h(F),setTimeout(()=>{m(!1),N?(n(i,!0),C("Victory!")):(n(i,!1),C("Defeat!")),setTimeout(()=>{R({won:N,amount:i,side:b})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${d}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"ðŸ‘‘"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"20px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:k}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>l("heads"),disabled:s,style:{padding:"10px 20px",border:`3px solid ${r==="heads"?"var(--gold-color)":"transparent"}`,background:r==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:s?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:s?"none":"scale(1)",boxShadow:s?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:s?.6:1},onMouseEnter:S=>{!s&&r!=="heads"&&(S.currentTarget.style.transform="scale(1.1)",S.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",S.currentTarget.style.border="3px solid var(--accent-color)",S.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:S=>{!s&&r!=="heads"&&(S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",S.currentTarget.style.border="3px solid transparent",S.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"ðŸ‘‘"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>l("tails"),disabled:s,style:{padding:"10px 20px",border:`3px solid ${r==="tails"?"var(--gold-color)":"transparent"}`,background:r==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:s?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:s?"none":"scale(1)",boxShadow:s?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:s?.6:1},onMouseEnter:S=>{!s&&r!=="tails"&&(S.currentTarget.style.transform="scale(1.1)",S.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",S.currentTarget.style.border="3px solid var(--accent-color)",S.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:S=>{!s&&r!=="tails"&&(S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",S.currentTarget.style.border="3px solid transparent",S.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:i,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:W,disabled:!r||i<=0||s,style:{opacity:!r||i<=0||s?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),g?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:g.won?"âœ¨":"ðŸ’¸"}),e.jsx("span",{style:{color:g.won?"#4caf50":"#f44336",marginRight:"10px"},children:g.won?"Victory!":"Defeat!"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Result: ",g.side]}),e.jsxs("span",{style:{color:g.won?"gold":"#ef5350"},children:[g.won?"+":"-",w(o(g.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},st=({value:t,size:n=80,color:x="#3e2723"})=>{const i=n*.18,c=n*.25,r=n*.5,l=n*.75,s=[];return(t===1||t===3||t===5)&&s.push({cx:r,cy:r}),t>1&&(s.push({cx:c,cy:c}),s.push({cx:l,cy:l})),t>3&&(s.push({cx:l,cy:c}),s.push({cx:c,cy:l})),t===6&&(s.push({cx:c,cy:r}),s.push({cx:l,cy:r})),e.jsx("div",{style:{width:n,height:n,backgroundColor:"#fff",borderRadius:n*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:s.map((m,d)=>e.jsx("circle",{cx:m.cx,cy:m.cy,r:i/2,fill:x},d))})})},Ot=({gameState:t,onGamble:n,onLeave:x})=>{const[i,c]=y.useState(0),[r,l]=y.useState(!1),[s,m]=y.useState([1,1]),[d,h]=y.useState(null),[g,R]=y.useState("Place your wager and roll!"),k=()=>{if(i<=0){R("Please enter a valid bet amount.");return}if(t.gold.lt(o(i))){R("Not enough gold!");return}l(!0),R("Rolling..."),h(null);let W=0;const S=10,b=setInterval(()=>{m([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),W++,W>=S&&(clearInterval(b),C())},100)},C=()=>{const W=Math.floor(Math.random()*6)+1,S=Math.floor(Math.random()*6)+1,b=W+S;m([W,S]),l(!1);let N=0,v=!1,z="";if(b===2?(N=10,v=!0,z="Snake Eyes! JACKPOT (x10)!"):b>=3&&b<=6?(N=0,v=!1,z="Low roll... House wins."):b===7?(N=2,v=!0,z="Lucky Seven! (x2)"):b>=8&&b<=11?(N=1.5,v=!0,z="Good roll! (x1.5)"):b===12&&(N=5,v=!0,z="Boxcars! Huge Win (x5)!"),v){const p=Math.max(1,Math.floor(i*(N-1)));n(p,!0),R(z),h({won:!0,amount:p,sum:b})}else n(i,!1),R(z),h({won:!1,amount:i,sum:b})};return d&&(d.won,d.won,d.won,d.won,d.won,d.sum,d.won?(e.Fragment,w(o(d.amount),t.numberFormat)):(e.Fragment,w(o(d.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 7"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 8-11"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x1.5"})]}),e.jsx("div",{style:{textAlign:"center",color:"var(--danger-color)",borderTop:"1px solid var(--border-color)",marginTop:"5px"},children:"Sum 3-6: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(st,{value:s[0],size:100}),e.jsx(st,{value:s[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:r?"":`Sum: ${s[0]+s[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:g})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Ae,{currentBet:i,maxGold:t.gold,onBetChange:c,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:k,disabled:i<=0||r,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:i<=0||r?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),d?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:d.won?"ðŸŽ²":"ðŸ“‰"}),e.jsx("span",{style:{color:d.won?"#4caf50":"#f44336",marginRight:"10px"},children:d.won?"You Won!":"You Lost"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Rolled: ",d.sum]}),e.jsxs("span",{style:{color:d.won?"gold":"#ef5350"},children:[d.won?"+":"-",w(o(d.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Ut=({gameState:t,onGamble:n,onClose:x})=>{const[i,c]=y.useState("farkle");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"95vh",maxWidth:"1000px",width:"98%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"ðŸº The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:w(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>c("farkle"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="farkle"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="farkle"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="farkle"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Farkle"}),e.jsx("button",{onClick:()=>c("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸ‡ Racing"}),e.jsx("button",{onClick:()=>c("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŸ¡ Coin"}),e.jsx("button",{onClick:()=>c("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[i==="farkle"&&e.jsx(Pt,{gameState:t,onGamble:(r,l)=>n(r,l),onLeave:x}),i==="racing"&&e.jsx(Dt,{gameState:t,onGamble:(r,l)=>n(r,l),onLeave:x}),i==="coin"&&e.jsx(Gt,{gameState:t,onGamble:(r,l)=>n(r,l),onLeave:x}),i==="dice"&&e.jsx(Ot,{gameState:t,onGamble:(r,l)=>n(r,l),onLeave:x})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:x,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},_t=({gameState:t,onPrestige:n,onClose:x})=>{var b;const c=o(1e12),r=t.totalGold;let l=o(0),s=!1,m=c.minus(r);if(r.gte(c)){const N=r.dividedBy(c);l=o(Math.floor(Math.pow(N.toNumber(),.33))).times(1).minus(t.renown),l.lt(0)&&(l=o(0)),s=l.gt(0)}const d=t.renown.plus(l),h=c.times(Math.pow(Math.floor(d.dividedBy(1).toNumber()+1),1/.33)),g=h.minus(r),k=ue(t.renown).minus(o(1)).times(o(100)),W=ue(t.renown.plus(l)).minus(o(1)).times(o(100)),S=Object.values(t.nationalProjects||{}).some(N=>N.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((b=t.playerProfile)!=null&&b.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",w(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),S&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"âš ï¸ WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",w(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",w(r,t.numberFormat)]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current Bonus:"})," +",k.toNumber().toFixed(1),"%"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," ",w(l,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After:"})," ",w(t.renown.plus(l),t.numberFormat)," (+",W.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:w(h,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:g.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",w(g.gt(0)?g:o(0),t.numberFormat)," more)"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:x,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:n,disabled:!s,children:s?"Abdicate":r.lt(c)?`Need ${w(m,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},$t=({gameState:t,onClose:n,onHardReset:x,onSave:i,onSetTheme:c,onSetNumberFormat:r,onToggleIdleMode:l,onUpdateInterface:s})=>{var N,v,z;const[m,d]=Bt.useState(!1),h=t.interface||{density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:o(1),center:o(1),right:o(1)}},g=(N=h.layout.left)!=null&&N.toNumber?h.layout.left.toNumber():Number(h.layout.left),R=(v=h.layout.center)!=null&&v.toNumber?h.layout.center.toNumber():Number(h.layout.center),k=(z=h.layout.right)!=null&&z.toNumber?h.layout.right.toNumber():Number(h.layout.right),C=()=>{m?x():d(!0)},W=(p,F)=>{s({layout:{...h.layout,[p]:o(F)}})},S={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},b={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"âš™ï¸ Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:g,onChange:p=>W("left",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:g})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:R,onChange:p=>W("center",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:R})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:k,onChange:p=>W("right",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:k})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Preset Themes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"5px",justifyContent:"center"},children:Object.values(Ge).map(p=>e.jsx("button",{className:"btn",style:{background:t.theme===p.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===p.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",minWidth:"120px",textAlign:"center"},onClick:()=>c(p.id),children:p.name},p.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["compact","normal","spacious"].map(p=>e.jsx("button",{className:"btn",style:{background:h.density===p?"var(--accent-color)":"var(--panel-bg)",color:h.density===p?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",textTransform:"capitalize",minWidth:"120px",textAlign:"center",padding:"5px 10px"},onClick:()=>s({density:p}),children:p},p))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["standard","scientific","plain"].map(p=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===p?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===p?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",textTransform:"capitalize",minWidth:"120px",textAlign:"center"},onClick:()=>r(p),children:p},p))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive. Wait 30 seconds after enabling."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:l,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:h.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({showFloatingText:!h.showFloatingText}),children:h.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:h.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({showWeatherWidget:!h.showWeatherWidget}),children:h.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:h.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>s({crownAnimations:!h.crownAnimations}),children:h.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Enable visual effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:h.reduceMotion?"#9e9e9e":"var(--success-color)",minWidth:"60px"},onClick:()=>s({reduceMotion:!h.reduceMotion}),children:h.reduceMotion?"OFF":"ON"})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:i,children:"Force Save"}),e.jsx("button",{className:"btn",style:{backgroundColor:m?"red":"#d32f2f"},onClick:C,children:m?"CONFIRM WIPE?":"Hard Reset"})]}),m&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:n,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},Ht=({onClose:t})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:Xe.map((n,x)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:x<Xe.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",n.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:n.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:n.changes.map((i,c)=>e.jsx("li",{style:{marginBottom:"3px"},children:i},c))})]},n.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),Yt=({gameState:t})=>{var s;const[n,x]=y.useState("all"),i=()=>{const m=Be.sort((d,h)=>{const g=t.achievements.includes(d.id),R=t.achievements.includes(h.id);return g&&!R?-1:!g&&R?1:0});return n==="all"?m:m.filter(d=>n==="buildings"?d.id.startsWith("build_"):n==="clicks"?d.id.startsWith("clicks_"):n==="gold"?d.id.startsWith("gold_"):n==="soldiers"?d.id.startsWith("soldiers_"):n==="renown"?d.id.startsWith("renown_"):n==="dragons"?d.id.startsWith("dragons_"):n==="gambler"?d.id.startsWith("gambler_"):n==="total_builds"?d.id.startsWith("total_builds"):n==="efficiency"?["speed_1m","speed_1b","prestige_master"].includes(d.id):n==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(d.id):n==="trade"?["first_trade","trade_master"].includes(d.id):n==="secret"?["click_master","idle_time_master"].includes(d.id):n==="bonus"?["gold_veteran","production_master","speed_baker","prestige_novice","golden_touch","combo_master"].includes(d.id):n==="combo"?["building_soldier_combo"].includes(d.id):!0)},c=[{id:"all",name:"All",icon:"ðŸ†"},{id:"buildings",name:"Buildings",icon:"ðŸ—ï¸"},{id:"clicks",name:"Clicks",icon:"ðŸ‘†"},{id:"gold",name:"Gold",icon:"ðŸ’°"},{id:"soldiers",name:"Army",icon:"âš”ï¸"},{id:"renown",name:"Prestige",icon:"ðŸ‘‘"},{id:"dragons",name:"Dragons",icon:"ðŸ‰"},{id:"gambler",name:"Tavern",icon:"ðŸŽ²"},{id:"total_builds",name:"Total Buildings",icon:"ðŸ›ï¸"},{id:"efficiency",name:"Efficiency",icon:"âš¡"},{id:"wonders",name:"Wonders",icon:"ðŸŒŸ"},{id:"trade",name:"Trade",icon:"ðŸš¢"},{id:"secret",name:"Secret",icon:"ðŸ”"},{id:"bonus",name:"Bonus",icon:"âœ¨"},{id:"combo",name:"Combo",icon:"âš¡"}],r={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"5px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},l=m=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${m?"var(--gold-color)":"#ccc"}`,background:m?"#fff8e1":"#eee",borderRadius:"4px",opacity:m?1:.3,cursor:m?"help":"default",position:"relative",fontSize:"0.8rem"});return e.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[e.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textAlign:"center"},children:[t.achievements.length," / ",Be.length," Unlocked",n!=="all"&&e.jsxs("span",{children:[" | ",i().filter(m=>t.achievements.includes(m.id)).length," / ",i().length," in ",(s=c.find(m=>m.id===n))==null?void 0:s.name]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:c.map(m=>e.jsxs("button",{onClick:()=>x(m.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${n===m.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:n===m.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:m.name,children:[e.jsx("span",{style:{marginRight:"2px"},children:m.icon}),e.jsx("span",{style:{display:n===m.id?"inline":"none"},children:m.name})]},m.id))}),e.jsx("div",{style:r,children:i().map(m=>{const d=t.achievements.includes(m.id);return e.jsx("div",{style:l(d),"data-tooltip":d?`${m.name}: ${m.description}`:"Locked",children:e.jsx("div",{style:{fontSize:"1rem",filter:d?"none":"grayscale(100%)",opacity:d?1:.2},children:d?m.icon:"â“"})},m.id)})})]})},qt=({gameState:t,currentGps:n,onClose:x})=>{var b,N;const i=Object.values(t.buildings).reduce((v,z)=>v.plus(z),o(0)),c=t.achievements.length,r=Be.length;let l="None",s="None",m=-1,d=o(0);ge.forEach((v,z)=>{const p=t.buildings[v.id]||o(0);p.gt(o(0))&&z>m&&(m=z,l=v.name),p.gt(d)&&(d=p,s=v.name)});const g=(()=>{let v=o(1);return v=v.times(ue(t.renown)),v})(),[R,k]=y.useState("");y.useEffect(()=>{const v=()=>{const p=o(Date.now()).minus(t.startTime),F=p.dividedBy(o(1e3)),$=F.minus(F.dividedBy(o(60)).floor().times(o(60))).floor(),_=p.dividedBy(o(6e4)),T=_.minus(_.dividedBy(o(60)).floor().times(o(60))).floor(),P=p.dividedBy(o(36e5)),O=P.minus(P.dividedBy(o(24)).floor().times(o(24))).floor(),B=p.dividedBy(o(864e5)).floor();let D="";B.gt(o(0))&&(D+=`${B.toString()}d `),O.gt(o(0))&&(D+=`${O.toString()}h `),D+=`${T.toString()}m ${$.toString()}s`,k(D)};v();const z=setInterval(v,1e3);return()=>clearInterval(z)},[t.startTime]);const C={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},W={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},S=(b=t.weather)!=null&&b.current&&((N=at[t.weather.current])==null?void 0:N.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"ðŸ“Š Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:W,children:"âš¡ Current Status"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(n,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(g,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:S})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",ue(t.renown).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:W,children:"â³ Time & Legacy"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:R})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:w(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:W,children:"ðŸ’° Economy Summary"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:w(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:w(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:W,children:"ðŸ° Dominion"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:w(i,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:l})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[s," (",w(d,t.numberFormat),")"]})]}),e.jsx("h3",{style:W,children:"âš”ï¸ Workforce & Court"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[w(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsx("h3",{style:W,children:"ðŸ“ˆ Player Stats"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:w(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:w(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:w(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:W,children:"ðŸŽ–ï¸ Completion"}),e.jsxs("div",{style:C,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[c," / ",r," (",Math.floor(c/r*100),"%)"]})]}),e.jsx("h3",{style:W,children:"ðŸ† Achievements"}),e.jsx(Yt,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:x,children:"Close Records"})]})})},Kt=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],Vt=({gameState:t,onStartProject:n,onUpgradeClickPower:x,onUpgradeOffline:i,onClose:c})=>{const[r,l]=y.useState("infrastructure");if(!(t.buildings.field||o(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"ðŸ—ï¸ National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"ðŸ”’"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:c,children:"Close"})]})});const d=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:St.map(g=>{var X,V,ae,re;const R=t.buildings[g.id]||o(0);if(R.lt(10))return null;const k=t.nationalProjects[g.id]||{level:0,active:!1,startTime:0,endTime:0},C=k.level,W=C>=Oe,S=k.active,b=C+1,N=dt(g.id,b),v=pt(b),z=Kt[b]||0,p=R.gte(z),F=t.gold.gte(N.gold),$=t.soldiers.gte(N.laborers),_=!N.carpenter.gt(0)||((X=t.eliteUnits.carpenter)==null?void 0:X.gte(N.carpenter)),T=!N.mason.gt(0)||((V=t.eliteUnits.mason)==null?void 0:V.gte(N.mason)),P=!N.architect.gt(0)||((ae=t.eliteUnits.architect)==null?void 0:ae.gte(N.architect)),O=F&&$&&_&&T&&P&&p;let B=0,D=0;if(S){const se=Date.now(),he=k.endTime-k.startTime,fe=se-k.startTime;B=Math.min(100,fe/he*100),D=Math.max(0,Math.ceil((k.endTime-se)/1e3))}const K=((re=ge.find(se=>se.id===g.id))==null?void 0:re.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:S?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:S?"var(--accent-color)":"rgba(0,0,0,0.05)",color:S?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:g.name.replace(" Infrastructure","")}),e.jsxs("span",{children:["Lvl ",C," / ",Oe]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:S?"#000":"#fff",marginBottom:"10px",fontStyle:"italic"},children:g.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(C*We*100).toFixed(0),"% Global"]}),S?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${B}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem",color:"#3e2723"},children:["Under Construction... ",Math.floor(D/3600),"h ",Math.floor(D%3600/60),"m"]})]}):W?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"5px"},children:[e.jsxs("span",{style:{color:F?"green":"red"},children:["ðŸ’° ",w(N.gold)," Gold"]}),e.jsxs("span",{style:{color:$?"green":"red"},children:["ðŸ‘· ",w(N.laborers)," Laborers"]}),N.carpenter.gt(0)&&e.jsxs("span",{style:{color:_?"green":"red"},children:["ðŸªš ",w(N.carpenter)," Carpenters"]}),N.mason.gt(0)&&e.jsxs("span",{style:{color:T?"green":"red"},children:["ðŸ§± ",w(N.mason)," Masons"]}),N.architect.gt(0)&&e.jsxs("span",{style:{color:P?"green":"red"},children:["ðŸ“ ",w(N.architect)," Architects"]}),e.jsxs("span",{style:{color:p?"green":"red"},children:["ðŸ  ",w(o(z))," ",K,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["â³ Duration: ",Math.floor(v/3600),"h ",Math.floor(v%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:O?"var(--accent-color)":"var(--border-color)",cursor:O?"pointer":"not-allowed"},disabled:!O,onClick:()=>n(g.id),children:"Start Project (Units Consumed)"})]})]})]},g.id)})}),h=()=>{const g=t.clickUpgradeLevel||0,R=g>=Ue,k=g+1,C=ct(k),W=t.gold.gte(C),S=o(2).pow(Math.min(g,15)),b=Ne(g),N=b>0?`${w(S)} + ${(b*100).toFixed(1)}% of GPS`:w(S),v=o(2).pow(Math.min(k,15)),z=Ne(k),p=z>0?`${w(v)} + ${(z*100).toFixed(1)}% of GPS`:w(v),F=t.offlineUpgradeLevel||0,$=F>=Ee,_=F+1,T=xt(_),P=t.renown.gte(T),{efficiency:O,duration:B}=_e(F),{efficiency:D,duration:K}=_e(_),X=V=>{const ae=Math.floor(V/3600),re=Math.floor(V%3600/60);return ae>0?`${ae}h ${re}m`:`${re}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ‘‘ Royal Scepter"}),e.jsxs("span",{children:["Lvl ",g," / ",Ue]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",N]}),R?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",p]}),e.jsxs("div",{style:{color:W?"green":"red",fontWeight:"bold"},children:["ðŸ’° ",w(C)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:W?"var(--accent-color)":"var(--border-color)",cursor:W?"pointer":"not-allowed"},disabled:!W,onClick:x,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ’¤ Offline Production"}),e.jsxs("span",{children:["Lvl ",F," / ",Ee]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Improve the efficiency of your kingdom while you are away."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(O*100).toFixed(0),"% for ",X(B)]}),$?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(D*100).toFixed(0),"% for ",X(K)]}),e.jsxs("div",{style:{color:P?"#673ab7":"red",fontWeight:"bold"},children:["ðŸ‘‘ ",w(T)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:P?"#673ab7":"var(--border-color)",cursor:P?"pointer":"not-allowed"},disabled:!P,onClick:i,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ›ï¸ National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:r==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>l("infrastructure"),children:"ðŸ—ï¸ Infrastructure"}),e.jsx("button",{className:"btn",style:{background:r==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>l("royalScepter"),children:"ðŸ‘‘ Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[r==="infrastructure"&&d(),r==="royalScepter"&&h()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:c,children:"Return to Kingdom"})})]})})},Xt=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(n=>e.jsxs("div",{className:`toast ${n.type}`,children:[n.type==="success"&&"âœ…",n.type==="warning"&&"âš ï¸",n.type==="info"&&"â„¹ï¸",n.type==="error"&&"âŒ",e.jsx("span",{children:n.message})]},n.id))}),Jt=()=>{const[t,n]=y.useState(null);if(y.useEffect(()=>{const i=l=>{const m=l.target.closest("[data-tooltip]");if(m){const d=m.getAttribute("data-tooltip");d&&n({text:d,x:l.clientX,y:l.clientY})}else n(null)},c=l=>{t&&n(s=>s?{...s,x:l.clientX,y:l.clientY}:null)},r=()=>{n(null)};return document.addEventListener("mouseover",i),document.addEventListener("mousemove",c),document.addEventListener("mouseout",r),()=>{document.removeEventListener("mouseover",i),document.removeEventListener("mousemove",c),document.removeEventListener("mouseout",r)}},[t]),!t)return null;const x={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(x.left=t.x-260),t.y+100>window.innerHeight&&(x.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:x,children:t.text.split(`
`).map((i,c)=>e.jsx("div",{style:{marginBottom:c===t.text.split(`
`).length-1?0:"4px"},children:i},c))})},Zt=({gameState:t})=>{const{weather:n,buildings:x,totalGold:i}=t,c=R=>{var k;return((k=x[R])==null?void 0:k.toNumber())||0};let r="wilderness";c("palace")>0?r="empire":c("castle")>0||c("market")>0?r="city":(c("peasant")>20||c("field")>10||i.gt(o(500)))&&(r="hamlet");let l="",s="";switch(r){case"wilderness":l="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",s="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":l="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",s="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":l="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",s="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":l="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",s="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const m=n.current;let d="none",h="",g=0;return m==="rainy"?(d="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",h="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",g=1):m==="stormy"?(d="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",h="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",g=1):m==="sunny"?(d="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",h="â˜€ï¸",g=.6):m==="windy"&&(h="ðŸƒ ðŸƒ ðŸƒ",g=.8),e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:l,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:g,animation:m==="windy"?"float 3s infinite ease-in-out":"none"},children:h}),d!=="none"&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:d,pointerEvents:"none"}}),e.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:s}),e.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),e.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},Qt={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},eo=Ct(Qt),ze=Tt(eo);function to(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function oo(){const t=new Date,n=t.getDay(),x=t.getDate()-n+(n===0?-6:1);return new Date(t.setDate(x))}async function no(t){try{const n={...t,period:"alltime"},x={...t,period:"weekly"},i=Je(ze,"leaderboard_alltime",t.rulerId);await Ze(i,{...n,gold:Number(n.gold.toString()),buildings:Number(n.buildings),achievements:Number(n.achievements),renown:Number(n.renown.toString()),timestamp:Qe()});const c=Je(ze,"leaderboard_weekly",t.rulerId);return await Ze(c,{...x,gold:Number(x.gold.toString()),buildings:Number(x.buildings),achievements:Number(x.achievements),renown:Number(x.renown.toString()),timestamp:Qe()}),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",n.customData)),n}}async function ro(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const n=ut(gt(ze,"leaderboard_alltime"),ht("gold","desc"),ft(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const x=await mt(n);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",x.docs.length);const i=x.docs.map(c=>{const r=c.data();return{id:c.id,...r,gold:r.gold instanceof ce?r.gold:new ce(r.gold),renown:r.renown instanceof ce?r.renown:new ce(r.renown),timestamp:r.timestamp}});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",i.length),i}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),n}}async function io(t=100){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const n=oo();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",n.toISOString());const x=ut(gt(ze,"leaderboard_weekly"),ht("gold","desc"),ft(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const i=await mt(x);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",i.docs.length);const r=i.docs.map(l=>{const s=l.data();return{id:l.id,...s,gold:s.gold instanceof ce?s.gold:new ce(s.gold),renown:s.renown instanceof ce?s.renown:new ce(s.renown),timestamp:s.timestamp}}).filter(l=>{var d,h;const s=((h=(d=l.timestamp)==null?void 0:d.toDate)==null?void 0:h.call(d))||new Date(l.timestamp),m=s>=n;return m||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",s.toISOString()),m});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",r.length),r}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),n}}const so=({isOpen:t,onClose:n,onConfirm:x,gameState:i})=>{const[c,r]=y.useState(""),[l,s]=y.useState(!1);if(!t)return null;const m=async()=>{if(c.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(c.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}s(!0);try{const h={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:c.trim(),rulerId:to(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};x(h),n()}catch{alert("An error occurred while creating profile. Please try again.")}finally{s(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:lo(i.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:c,onChange:d=>r(d.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:d=>d.key==="Enter"&&m()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[c.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:m,disabled:l||c.trim().length<3,style:{padding:"12px 24px",backgroundColor:l||c.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:l||c.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:l?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:n,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:d=>{d.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:d=>{d.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function lo(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const ao=({isOpen:t,onClose:n,playerProfile:x,onOpenRulerNameModal:i,gameState:c})=>{const[r,l]=y.useState([]),[s,m]=y.useState([]),[d,h]=y.useState("alltime"),[g,R]=y.useState(!1),[k,C]=y.useState(null),[W,S]=y.useState(0),[b,N]=y.useState(0),v=()=>{const B=localStorage.getItem("leaderboardCache");if(B)try{const{data:D,timestamp:K}=JSON.parse(B),X=Date.now(),V=3600*1e3;if(X-K<V&&D&&D.allTime&&D.weekly)return D}catch(D){console.error("Cache parse error:",D)}return null},z=B=>{const D={data:B,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(D)),N(Date.now())},p=()=>{const B=localStorage.getItem("leaderboardCache");if(B){const{timestamp:D}=JSON.parse(B),K=Date.now(),X=3600*1e3;return K-D<X}return!1};y.useEffect(()=>{if(t){if(p())try{const B=v();if(B){l(B.allTime),m(B.weekly);const D=JSON.parse(localStorage.getItem("leaderboardCache"));N(D.timestamp);return}}catch(B){console.error("Cache read error:",B)}F()}},[t]);const F=async()=>{R(!0),C(null);try{const B=new Promise((X,V)=>setTimeout(()=>V(new Error("Loading timeout")),1e4)),[D,K]=await Promise.all([Promise.race([ro(50),B]),Promise.race([io(50),B])]);l(D),m(K),z({allTime:D,weekly:K})}catch(B){console.error("Error loading leaderboard:",B),C("Failed to load leaderboard. Please check your internet connection and try again.")}finally{R(!1)}},$=B=>{switch(B){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${B}`}},_=()=>x?(d==="alltime"?r:s).findIndex(D=>D.rulerId===x.rulerId)+1:-1,T=()=>{const B=d==="alltime"?r:s;if(B.length>0){let D=0;if(B.forEach(K=>{if(K.timestamp){let X=0;typeof K.timestamp=="object"&&K.timestamp.toDate?X=K.timestamp.toDate().getTime():typeof K.timestamp=="number"?X=K.timestamp:typeof K.timestamp=="string"&&(X=new Date(K.timestamp).getTime()),X>D&&(D=X)}}),D>0)return D}return b},P=d==="alltime"?r:s,O=P.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),e.jsx("button",{className:"btn",onClick:n,children:"Close"})]}),!x&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),i&&c&&c.gold&&c.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{n(),i()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),O&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-T())/6e4)," minutes ago"]})}),g&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),k&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:k}),x&&O&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",x.rulerName," ",x.rulerId]}),P.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",_()>0?`#${_()}`:"Not ranked yet"," in ",d==="alltime"?"All Time":"Weekly"]})]}),O&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>h("alltime"),className:d==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>h("weekly"),className:d==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),O&&!g&&!k&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Achievements"})]})}),e.jsx("tbody",{children:P.map((B,D)=>e.jsxs("tr",{style:{backgroundColor:(x==null?void 0:x.rulerId)===B.rulerId?"rgba(191, 144, 0, 0.1)":D%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:$(D+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:B.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:B.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:w(B.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:w(B.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:B.buildings}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:B.achievements})]},B.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},co=({gained:t,effectiveTime:n,totalTime:x,efficiency:i,completedProjects:c,onClose:r,numberFormat:l})=>{const s=m=>{const d=Math.floor(m/3600),h=Math.floor(m%3600/60),g=Math.floor(m%60),R=[];return d>0&&R.push(`${d}h`),h>0&&R.push(`${h}m`),(g>0||R.length===0)&&R.push(`${g}s`),R.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"ðŸŒ™ Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:s(x.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:s(n.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(i*100).toFixed(0),"%"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",w(t,l)]})]})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"âœ… Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:c.map((m,d)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:m},d))})]})]}),e.jsx("button",{className:"btn",onClick:r,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})},be={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},je={gold:o(0),totalGold:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:be,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},Ce=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(Ce);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const n={};for(const x in t)t.hasOwnProperty(x)&&(n[x]=Ce(t[x]));return n}return t},go=()=>{var qe;const[t,n]=y.useState(()=>{var u,f,E,L,G,U;const a=localStorage.getItem("kingdom_save");if(a)try{const j=JSON.parse(a),H=j.interface||{},q={...be,...H,lastBuyAmount:o(H.lastBuyAmount??1),crownAnimations:H.crownAnimations??!0,layout:{left:o(((u=H.layout)==null?void 0:u.left)??be.layout.left),center:o(((f=H.layout)==null?void 0:f.center)??be.layout.center),right:o(((E=H.layout)==null?void 0:E.right)??be.layout.right)},borderWidth:o(H.borderWidth??be.borderWidth),customColors:{...be.customColors,...H.customColors||{}}};return{...je,...j,renown:o(j.renown||0),prestigeCount:j.prestigeCount||0,gold:o(j.gold||0),totalGold:o(j.totalGold||0),startTime:o(j.startTime||Date.now()),lastSaveTime:o(j.lastSaveTime||Date.now()),soldiers:o(j.soldiers||0),buildings:Object.keys(j.buildings||{}).reduce((ee,Q)=>(ee[Q]=o(j.buildings[Q]),ee),{}),stats:{...je.stats,...j.stats||{},totalClicks:o(((L=j.stats)==null?void 0:L.totalClicks)||0),dragonsKilled:o(((G=j.stats)==null?void 0:G.dragonsKilled)||0),tavernGamesPlayed:o(((U=j.stats)==null?void 0:U.tavernGamesPlayed)||0)},eliteUnits:Object.keys(j.eliteUnits||{}).reduce((ee,Q)=>(ee[Q]=o(j.eliteUnits[Q]),ee),{}),nationalProjects:j.nationalProjects||{},clickUpgradeLevel:j.clickUpgradeLevel||0,offlineUpgradeLevel:j.offlineUpgradeLevel||0,weather:j.weather?{...j.weather,timeLeft:o(Number(j.weather.timeLeft)||120)}:je.weather,theme:j.theme||"default",numberFormat:j.numberFormat||"standard",idleModeEnabled:j.idleModeEnabled!==void 0?j.idleModeEnabled:!1,interface:q,playerProfile:j.playerProfile?{...j.playerProfile,lastLeaderboardSubmit:j.playerProfile.lastLeaderboardSubmit||0}:null}}catch(j){console.error("Save load failed",j)}return je}),x=y.useRef(t);y.useEffect(()=>{x.current=t},[t]);const i=y.useRef("");y.useEffect(()=>{const a=u=>{i.current=(i.current+u.key).slice(-20);const f=i.current.toLowerCase();f.endsWith("godon")?(n(E=>({...E,godMode:!0})),Z("God Mode Enabled: +99999s per click","success"),i.current=""):f.endsWith("godoff")&&(n(E=>({...E,godMode:!1})),Z("God Mode Disabled","info"),i.current="")};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]);const c=()=>{const a=localStorage.getItem("kingdom_last_save_time"),u=Date.now();if(a){const f=u-parseInt(a),E=o(f/1e3);if(E.gte(o(60))){const L=o(86400),G=ce.min(E,L),U=.1+t.offlineUpgradeLevel/Ee*(.99-.1),H=ie(t).times(o(U)).times(G).floor();H.gt(o(0))&&(C({gained:H,effectiveTime:G,totalTime:E,efficiency:U,completedProjects:[]}),n(q=>({...q,gold:q.gold.plus(H),totalGold:q.totalGold.plus(H)})))}}localStorage.setItem("kingdom_last_save_time",u.toString())},[r,l]=y.useState(!1);y.useEffect(()=>{let a;const u=()=>{l(!1),clearTimeout(a),t.idleModeEnabled&&(a=setTimeout(()=>{l(!0)},2e4))};u();const f=["mousemove","mousedown","keydown","touchstart","scroll"];return f.forEach(E=>window.addEventListener(E,u)),()=>{clearTimeout(a),f.forEach(E=>window.removeEventListener(E,u))}},[t.idleModeEnabled]),y.useEffect(()=>{t.event&&l(!1)},[t.event]),y.useEffect(()=>{const a=w(t.gold);document.title=`Gold: ${a} - Kingdom Clicker`},[t.gold]),y.useEffect(()=>{const a=document.documentElement,u=t.interface||be,f=t.theme||"default",E=Ge[f]||Ge.default;E&&Object.entries(E.colors).forEach(([U,j])=>{a.style.setProperty(U,j)});const L={compact:"8px",normal:"12px",spacious:"20px"},G={compact:"6px",normal:"12px",spacious:"16px"};a.style.setProperty("--panel-padding",L[u.density]),a.style.setProperty("--gap-size",G[u.density]),a.style.setProperty("--col-left",String(u.layout.left)),a.style.setProperty("--col-center",String(u.layout.center)),a.style.setProperty("--col-right",String(u.layout.right)),u.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[s,m]=y.useState(!1);y.useEffect(()=>{var a;t.gold.gte(o(1e7))&&!((a=t.playerProfile)!=null&&a.hasChosenName)&&!s&&he(!0)},[t.gold,t.playerProfile,s]);const[d,h]=y.useState(null),[g,R]=y.useState([]),[k,C]=y.useState(null),[W,S]=y.useState("buildings"),[b,N]=y.useState("army"),[v,z]=y.useState(!1),[p,F]=y.useState("throne");y.useEffect(()=>{const a=()=>{z(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const[$,_]=y.useState(!1),[T,P]=y.useState(!1),[O,B]=y.useState(!1),[D,K]=y.useState(!1),[X,V]=y.useState(!1),[ae,re]=y.useState(!1),[se,he]=y.useState(!1),[fe,le]=y.useState(!1),Z=(a,u="info")=>{const f=Date.now().toString()+Math.random();R(E=>[...E,{id:f,message:a,type:u}]),setTimeout(()=>{R(E=>E.filter(L=>L.id!==f))},3e3)};y.useEffect(()=>{const a=Date.now();if(t.lastSaveTime&&o(a).minus(t.lastSaveTime).gt(o(6e4))){const u=o(a).minus(t.lastSaveTime).dividedBy(o(1e3)),{efficiency:f,duration:E}=_e(t.offlineUpgradeLevel||0),L=o(E),G=ce.min(u,L),j=ie(t).times(o(f)).times(G).floor(),H=[];let q={...t.nationalProjects},ee=!1;Object.keys(q).forEach(Q=>{var de;const te=q[Q];if(te.active&&te.endTime&&a>=te.endTime){q[Q]={...te,active:!1,level:te.level+1,startTime:0,endTime:0};const ve=(de=ge.find(Le=>Le.id===Q))==null?void 0:de.name;ve&&H.push(`${ve} Infrastructure (Lvl ${te.level+1})`),ee=!0}}),(j.gt(o(0))||H.length>0)&&(C({gained:j,effectiveTime:G,totalTime:u,efficiency:f,completedProjects:H}),n(Q=>({...Q,gold:Q.gold.plus(j),totalGold:Q.totalGold.plus(j),nationalProjects:ee?q:Q.nationalProjects})))}},[]),y.useEffect(()=>{const a=setInterval(()=>{Date.now()%3e4<1e3&&n(u=>{const f={...u,lastSaveTime:o(Date.now())},E=Ce(f);return localStorage.setItem("kingdom_save",JSON.stringify(E)),f})},1e3);return()=>clearInterval(a)},[]),y.useEffect(()=>{const a=()=>{const f=x.current,E=Ce(f);localStorage.setItem("kingdom_save",JSON.stringify(E)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",a);const u=()=>{document.visibilityState==="hidden"?a():document.visibilityState==="visible"&&c()};return document.addEventListener("visibilitychange",u),()=>{window.removeEventListener("beforeunload",a),document.removeEventListener("visibilitychange",u)}},[]),y.useEffect(()=>{var u;if(!((u=t.playerProfile)!=null&&u.hasChosenName))return;const a=setInterval(()=>{var U;const f=x.current,E=Date.now(),L=((U=f.playerProfile)==null?void 0:U.lastLeaderboardSubmit)||0,G=3600*1e3;E-L>=G&&no({rulerName:f.playerProfile.rulerName,rulerId:f.playerProfile.rulerId,gold:f.totalGold,renown:f.renown,buildings:Object.keys(f.buildings).length,achievements:f.achievements.length,period:"alltime"}).then(()=>{n(j=>({...j,playerProfile:{...j.playerProfile,lastLeaderboardSubmit:Date.now()}})),Z("Leaderboard data submitted successfully!","success")}).catch(j=>{console.error("Auto leaderboard submission failed:",j)})},6e4);return()=>clearInterval(a)},[(qe=t.playerProfile)==null?void 0:qe.hasChosenName]),y.useEffect(()=>{const a=setInterval(()=>{if(!t.event&&Math.random()<.05){const E=["dragon","merchant","jester"],L=E[Math.floor(Math.random()*E.length)],G=L==="dragon"?6e5:3e4,U={id:Date.now().toString(),type:L,expiresAt:o(Date.now()).plus(o(G)),hp:L==="dragon"?o(10):void 0,maxHp:L==="dragon"?o(10):void 0,reward:o(0),startTime:L==="dragon"?Date.now():void 0};n(j=>({...j,event:U}))}},1e4);return()=>clearInterval(a)},[t.event]);const ie=a=>{var U;let u=o(0);const f=((U=a.weather)==null?void 0:U.current)||"clear";ge.forEach(j=>{const H=a.buildings[j.id]||o(0);let q=j.baseProduction;f==="sunny"?(j.id==="peasant"||j.id==="field"||j.id==="stable"||j.id==="cathedral")&&(q=q.times(o(1.2))):f==="rainy"?(j.id==="silver_mine"||j.id==="alchemist"||j.id==="market"||j.id==="tavern")&&(q=q.times(o(1.2))):f==="stormy"?((j.id==="blacksmith"||j.id==="void_portal")&&(q=q.times(o(1.3))),(j.id==="field"||j.id==="stable")&&(q=q.times(o(.8)))):f==="windy"&&(j.id==="market"||j.id==="castle"||j.id==="time_chamber")&&(q=q.times(o(1.15))),u=u.plus(H.times(q))});let E=0;a.nationalProjects&&Object.values(a.nationalProjects).forEach(j=>{E+=j.level||0});let L=o(1);const G=o(1).plus(o(E*We));if(L=L.times(G),L=L.times(ue(a.renown).plus(o(a.achievements.length*.02))),a.event&&a.event.type==="dragon"&&a.event.startTime){const j=Math.floor((Date.now()-a.event.startTime)/1e3),q=1-Math.min(99,j)/100;L=L.times(o(q))}return u=u.times(L),u},oe=ie(t),M=y.useRef(oe);M.current=oe,y.useEffect(()=>{const a=setInterval(()=>{n(u=>{const f=Date.now(),E=M.current.times(o(Fe)).dividedBy(o(1e3));let L=u.totalGold.plus(E),G=u.gold.plus(E),U={...u.weather};const j=o(Fe/1e3);if(U.timeLeft=U.timeLeft.minus(j),U.timeLeft.lte(o(0))){const te=["clear","sunny","rainy","stormy","windy"],de=te[Math.floor(Math.random()*te.length)],ve=o(Math.floor(Math.random()*120)+60);U={current:de,timeLeft:ve}}let H=u.event;H&&H.expiresAt&&o(H.expiresAt).lt(o(f))&&(H=null);let q={...u.nationalProjects||{}};Object.keys(q).forEach(te=>{var ve;const de=q[te];de.active&&de.endTime&&f>=de.endTime&&(q[te]={...de,active:!1,level:de.level+1,startTime:0,endTime:0},Z(`Project Completed: ${(ve=ge.find(Le=>Le.id===te))==null?void 0:ve.name} Infrastructure Level ${de.level+1}!`,"success"))});const ee=[...u.achievements];let Q=null;return Be.forEach(te=>{ee.includes(te.id)||te.condition({...u,totalGold:L,gold:G},M.current)&&(ee.push(te.id),Q=te)}),Q&&(h(Q),setTimeout(()=>h(null),3e3)),{...u,gold:G,totalGold:L,achievements:ee,event:H,soldiers:u.soldiers,weather:U,nationalProjects:q}})},Fe);return()=>clearInterval(a)},[]);const I=(a="light")=>{if("vibrate"in navigator&&v)switch(a){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},A=(a=!1)=>{a||I("light");const u=J(x.current);n(f=>({...f,gold:f.gold.plus(u),totalGold:f.totalGold.plus(u),stats:{...f.stats,totalClicks:a?f.stats.totalClicks:f.stats.totalClicks.plus(o(1))}}))},J=a=>{const u=ue(a.renown),f=o(1),E=a.clickUpgradeLevel||0,L=Math.min(E,15),G=o(2).pow(L),U=f.times(G),j=ie(a),H=Ne(E),q=j.times(H);let ee=U.plus(q);if(ee=ee.times(u),a.godMode){const Q=j.times(o(99999));ee=ee.plus(Q)}return ee},ne=()=>{const a=t.clickUpgradeLevel||0;if(a>=Ue){Z("Maximum Royal Scepter level reached!","warning");return}const u=ct(a+1);if(t.gold.lt(u)){Z("Not enough gold!","error");return}n(f=>({...f,gold:f.gold.minus(u),clickUpgradeLevel:f.clickUpgradeLevel+1})),Z(`Royal Scepter upgraded to level ${a+1}!`,"success")},ye=()=>{const a=t.offlineUpgradeLevel||0;if(a>=Ee){Z("Maximum Passive Income level reached!","warning");return}const u=xt(a+1);if(t.renown.lt(u)){Z("Not enough Renown!","error");return}n(f=>({...f,renown:f.renown.minus(u),offlineUpgradeLevel:f.offlineUpgradeLevel+1})),Z(`Passive Income upgraded to level ${a+1}!`,"success")},xe=(a,u)=>{const f=ge.find(G=>G.id===a);if(!f||u<=0)return;const E=t.buildings[a]||o(0),L=we(f.baseCost,E,o(u)).floor();t.gold.gte(L)&&(I("medium"),n(G=>({...G,gold:G.gold.minus(L),buildings:{...G.buildings,[a]:(G.buildings[a]||o(0)).plus(o(u))}})))},Te=(a,u)=>{const f=ge.find(U=>U.id===a);if(!f||u<=0)return;const E=t.buildings[a]||o(0),L=o(Math.min(u,E.toNumber()));if(L.lte(o(0)))return;const G=we(f.baseCost,E.minus(L),L).times(o(.25)).floor();n(U=>({...U,gold:U.gold.plus(G),buildings:{...U.buildings,[a]:E.minus(L)}}))},pe=a=>{const u=De.times(o(a));t.gold.gte(u)&&n(f=>({...f,gold:f.gold.minus(u),soldiers:f.soldiers.plus(u.dividedBy(De))}))},ke=(a,u)=>{const f=lt.find(G=>G.id===a);if(!f)return;const E=f.goldCost.times(o(u)),L=f.soldierCost.times(o(u));t.gold.gte(E)&&t.soldiers.gte(L)&&n(G=>({...G,gold:G.gold.minus(E),soldiers:G.soldiers.minus(L),eliteUnits:{...G.eliteUnits,[a]:(G.eliteUnits[a]||o(0)).plus(o(u))}}))},Me=a=>{if(a.type==="merchant"){const u=M.current.times(o(10));n(f=>({...f,gold:f.gold.plus(u),totalGold:f.totalGold.plus(u),event:null})),Z(`The merchant gifted you ${w(u.floor(),t.numberFormat)} gold!`,"success")}else if(a.type==="jester"){const u=t.gold.times(o(.1)),f=Math.random()>.5;n(E=>({...E,gold:f?E.gold.plus(u):E.gold.minus(u),totalGold:f?E.totalGold.plus(u):E.totalGold,event:null})),f?Z(`Jester pays out! +${w(u.floor(),t.numberFormat)}`,"success"):Z(`Jester tricked you! -${w(u.floor(),t.numberFormat)}`,"warning")}else if(a.type==="dragon")try{let u=!1;n(f=>{if(!f.event||f.event.type!=="dragon")return f;const L=o(f.event.hp||10).minus(o(1));if(L.lte(0)){const G=M.current.times(o(30));return u=!0,{...f,gold:f.gold.plus(G),totalGold:f.totalGold.plus(G),event:null,stats:{...f.stats,dragonsKilled:f.stats.dragonsKilled.plus(o(1))}}}return{...f,event:{...f.event,hp:L}}}),u&&Z("Dragon Slain! +Treasury Boost","success")}catch(u){console.error("Error handling dragon interaction:",u),Z("Error interacting with dragon","error")}},Y=()=>{const a=o(1),u=o(1e12),f=t.totalGold;if(f.lt(u))return;const E=f.dividedBy(u),G=o(Math.floor(Math.pow(E.toNumber(),.33))).times(a).minus(t.renown);if(G.lte(0))return;const U={...t.nationalProjects};Object.keys(U).forEach(j=>{U[j].active&&(U[j]={...U[j],active:!1,startTime:0,endTime:0})}),n({...je,renown:t.renown.plus(G),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:U,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),P(!1),Z("Abdication Successful. Long live the new King!","success")},$e=()=>{localStorage.removeItem("kingdom_save"),n({...je,startTime:o(Date.now())}),B(!1),Z("Game Reset","warning")},Re=()=>{const u=Ce(t);localStorage.setItem("kingdom_save",JSON.stringify(u)),Z("Game Saved","info")},Pe=a=>{n(u=>({...u,playerProfile:a})),localStorage.setItem(`playerProfile_${a.id}`,JSON.stringify(a)),Z(`Welcome, ${a.rulerName} ${a.rulerId}!`,"success"),m(!1)},vt=async()=>{Y()},He=a=>{n(u=>({...u,interface:{...u.interface,lastBuyAmount:a}}))},Ye=a=>({flex:a==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:a==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:a==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:r&&t.idleModeEnabled?a==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:v?"column":"row"},children:[e.jsx(Xt,{toasts:g}),e.jsx(Jt,{}),r&&t.idleModeEnabled&&e.jsx(Zt,{gameState:t}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Ye("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${W==="buildings"?"active":""}`,onClick:()=>S("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:W==="buildings"&&e.jsx(nt,{gameState:t,onBuyBuilding:xe,onSellBuilding:Te,onSetBuyAmount:He})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:r&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(it,{gameState:t,gps:oe,onClick:()=>A(!1),onEventInteract:Me,onOpenTavern:()=>_(!0),onOpenPrestige:()=>P(!0),onOpenSettings:()=>B(!0),onOpenStatistics:()=>V(!0),onOpenLeaderboard:()=>{le(!0)},onOpenEmpire:()=>re(!0),isIdle:r&&t.idleModeEnabled})}),e.jsxs("div",{style:Ye("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${b==="army"?"active":""}`,onClick:()=>N("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:b==="army"&&e.jsx(rt,{gameState:t,onTrainSoldier:pe,onTrainElite:ke})})]})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[p==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(nt,{gameState:t,onBuyBuilding:xe,onSellBuilding:Te,onSetBuyAmount:He})})]}),p==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(it,{gameState:t,gps:oe,onClick:()=>A(!1),onEventInteract:Me,onOpenTavern:()=>_(!0),onOpenPrestige:()=>P(!0),onOpenSettings:()=>B(!0),onOpenStatistics:()=>V(!0),onOpenLeaderboard:()=>le(!0),onOpenEmpire:()=>re(!0),isIdle:r&&t.idleModeEnabled})}),p==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(rt,{gameState:t,onTrainSoldier:pe,onTrainElite:ke})})]}),p==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>re(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${p==="buildings"?"active":""}`,onClick:()=>{I("light"),F("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="throne"?"active":""}`,onClick:()=>{I("light"),F("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="army"?"active":""}`,onClick:()=>{I("light"),F("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="empire"?"active":""}`,onClick:()=>{I("light"),F("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),e.jsx("div",{children:"Projects"})]})]})]}),!(r&&t.idleModeEnabled)&&d&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:d.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:d.name})]})]}),k&&e.jsx(co,{gained:k.gained,effectiveTime:k.effectiveTime,totalTime:k.totalTime,efficiency:k.efficiency,completedProjects:k.completedProjects,numberFormat:t.numberFormat,onClose:()=>C(null)}),ae&&e.jsx(Vt,{gameState:t,onClose:()=>re(!1),onStartProject:a=>{var L,G,U,j;const u=((L=t.nationalProjects[a])==null?void 0:L.level)||0;if(u>=Oe)return;const f=dt(a,u+1);if(t.gold.lt(f.gold)||t.soldiers.lt(f.laborers)||(G=t.eliteUnits.carpenter)!=null&&G.lt(f.carpenter||0)||(U=t.eliteUnits.mason)!=null&&U.lt(f.mason||0)||(j=t.eliteUnits.architect)!=null&&j.lt(f.architect||0))return;const E=pt(u+1);n(H=>({...H,gold:H.gold.minus(f.gold),soldiers:H.soldiers.minus(f.laborers),eliteUnits:{...H.eliteUnits,carpenter:(H.eliteUnits.carpenter||o(0)).minus(f.carpenter||0),mason:(H.eliteUnits.mason||o(0)).minus(f.mason||0),architect:(H.eliteUnits.architect||o(0)).minus(f.architect||0)},nationalProjects:{...H.nationalProjects,[a]:{level:u,active:!0,startTime:Date.now(),endTime:Date.now()+E*1e3}}})),Z("Construction started!","info")},onUpgradeClickPower:ne,onUpgradeOffline:ye}),$&&e.jsx(Ut,{gameState:t,onGamble:(a,u)=>{const f=o(a);n(E=>({...E,gold:u?E.gold.plus(f):E.gold.minus(f),stats:{...E.stats,tavernGamesPlayed:E.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>_(!1)}),T&&e.jsx(_t,{gameState:t,onPrestige:vt,onClose:()=>P(!1)}),O&&e.jsx($t,{gameState:t,onClose:()=>B(!1),onHardReset:$e,onSave:Re,onSetTheme:a=>n(u=>({...u,theme:a})),onSetNumberFormat:a=>n(u=>({...u,numberFormat:a})),onToggleIdleMode:()=>n(a=>({...a,idleModeEnabled:!a.idleModeEnabled})),onUpdateInterface:a=>n(u=>({...u,interface:{...u.interface,...a}}))}),X&&e.jsx(qt,{gameState:t,currentGps:oe,onClose:()=>V(!1)}),D&&e.jsx(Ht,{onClose:()=>K(!1)}),se&&e.jsx(so,{isOpen:se,onClose:()=>{he(!1),m(!0)},onConfirm:Pe,gameState:t}),fe&&e.jsx(ao,{isOpen:fe,onClose:()=>le(!1),playerProfile:t.playerProfile})]})};export{go as A,Bt as R,e as j};
