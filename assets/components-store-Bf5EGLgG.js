import{r as j,j as e}from"./vendor-react-CUeQczFW.js";import{h as G,k as N,t as r,l as R,g as D,f as u,B as U,m as L,n as I,o as $,P as H}from"./core-BLe5j-6i.js";import{A as K,g as O}from"./components-ui-BeL8qPGz.js";const _=({gameState:o,onBuyTowerFloor:h})=>{const[c,y]=j.useState(0),l=G(o.totalGold);j.useEffect(()=>{const g=setInterval(()=>{y(b=>(b+1)%360)},50);return()=>clearInterval(g)},[]),N(o.totalGold);const w=o.darkMatterGold||r(0),f=o.infiniteTowerLevel||0;o.portalProgress;const a=R(f),d=w.gte(a),k=D(f).minus(r(1)).times(r(100)),B=(()=>{if(l)return 100;if(o.totalGold.lt(r(1e15)))return 0;const g=Math.log10(1e15),b=Math.log10(1e18),P=Math.log10(o.totalGold.toNumber()),t=(Math.max(g,Math.min(b,P))-g)/(b-g)*100;return Math.floor(t)})();return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",minHeight:"600px",overflow:"hidden"},children:e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"var(--panel-padding)",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"20px",background:"var(--panel-bg)",border:l?"2px solid #673ab7":"2px dashed var(--border-color)",borderRadius:"8px",position:"relative",overflow:"hidden",marginBottom:"20px"},children:[e.jsx("div",{style:{width:"120px",height:"120px",margin:"0 auto 15px",borderRadius:"50%",background:l?`radial-gradient(circle, rgba(103, 58, 183, ${.3+Math.sin(c*Math.PI/180)*.2}), rgba(103, 58, 183, 0.1))`:"radial-gradient(circle, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.05))",border:l?`3px solid rgba(103, 58, 183, ${.5+Math.sin(c*Math.PI/180)*.3})`:"3px solid rgba(128, 128, 128, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",animation:l?"pulse 2s infinite":"none",transform:`rotate(${c}deg)`,transition:"all 0.3s ease"},children:l?"ðŸŒ€":"ðŸ”’"}),e.jsx("h3",{style:{fontSize:"1.3rem",color:"#8e24aa",marginBottom:"10px",fontWeight:"bold"},children:l?"Portal to Another Dimension":"Portal Construction"}),!l&&e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginBottom:"8px"},children:["Progress: ",B,"%"]}),e.jsx("div",{style:{width:"100%",height:"8px",background:"rgba(0,0,0,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${B}%`,height:"100%",background:"linear-gradient(90deg, #673ab7, #9575cd)",transition:"width 0.3s ease"}})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"}})]}),l&&e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"The portal shimmers with infinite possibilities..."})]}),l&&e.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid #673ab7",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#8e24aa"},children:"âš« Dark Matter Gold"})}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#9c27b0"},children:u(w,o.numberFormat)})})]}),l&&e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"1px 19px 19px 19px",borderRadius:"px",border:"2px solid #ff9800",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"1.1rem",color:"#ff9800",marginBottom:"10px",fontWeight:"bold"},children:"ðŸ—ï¸ Infinite Tower of Time & Space"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Current Level"}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#ff9800"},children:f})]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px"},children:["Income Bonus: +",u(k,o.numberFormat),"%"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Next Floor Cost"}),e.jsxs("span",{style:{fontSize:"1rem",fontWeight:"bold",color:d?"#673ab7":"var(--text-secondary)"},children:[u(a,o.numberFormat)," âš«"]})]})]}),e.jsx("button",{className:"btn",onClick:h,disabled:!d,style:{width:"100%",background:d?"#ff9800":"var(--panel-bg)",color:d?"var(--text-on-accent)":"var(--text-color)",border:"2px solid #ff9800",padding:"10px",fontSize:"1rem",fontWeight:"bold",opacity:d?1:.6,cursor:d?"pointer":"default"},children:d?"Build Next Floor":"Not Enough Dark Matter Gold"})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid rgba(103, 58, 183, 0.2)",fontSize:"0.9rem",color:"var(--text-secondary)",lineHeight:"1.6",fontStyle:"italic",marginBottom:"20px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"10px",color:"#8e24aa",fontStyle:"normal",textAlign:"center",fontSize:"1rem"},children:"ðŸŒŒ The Infinite Mystery"}),e.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"When a kingdom's treasures transcend mortal comprehension, the very fabric of reality begins to unravel, revealing hidden passages to worlds beyond imagination."}),e.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"Through this gateway flows dark matter - the concentrated essence of time and space itself, capable of rewriting the fundamental laws of creation and transforming the nature of existence."}),e.jsx("p",{style:{margin:"0",textAlign:"center",fontWeight:"bold"},children:"Each floor of the Infinite Tower amplifies the flow's power, creating cascades of limitless possibilities in the eternal dance of universes..."})]})]})})},q=(o,h=!1,c=!1,y=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:c?"rgba(0,0,0,0.05)":h?"rgba(46, 125, 50, 0.1)":y?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:c?"rgba(0,0,0,0.2)":y?"#7b1fa2":o?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:o&&!c?"pointer":"default",opacity:o&&!c||h?1:.7,transition:"all 0.2s",boxShadow:o&&!c?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:c?"grayscale(1)":"none"}),Y={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},Z=({gameState:o,onBuyBuilding:h,onSellBuilding:c,onSetBuyAmount:y})=>{var A;const[l,w]=j.useState({visible:!1,x:0,y:0,building:null}),f=r(1),a=((A=o.interface)==null?void 0:A.lastBuyAmount)||r(1),[d,W]=j.useState(!1),[k,z]=j.useState(1);j.useEffect(()=>{const t=i=>{i.ctrlKey?z(10):i.shiftKey?z(100):z(1)},m=i=>t(i),n=i=>t(i);return window.addEventListener("keydown",m),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",n)}},[]);const B=(t,m)=>{const n=t.currentTarget.getBoundingClientRect();w({visible:!0,x:n.right,y:n.top+n.height/2,building:m})},g=()=>{w({visible:!1,x:0,y:0,building:null})},b=(t,m)=>{var v;let n=m;const i=((v=o.weather)==null?void 0:v.current)||"clear";i==="sunny"&&(t==="peasant"||t==="field")?n=n.times(r(1.2)):i==="rainy"&&(t==="silver_mine"||t==="alchemist")?n=n.times(r(1.2)):i==="stormy"?(t==="blacksmith"&&(n=n.times(r(1.3))),t==="field"&&(n=n.times(r(.8)))):i==="windy"&&t==="market"&&(n=n.times(r(1.15)));let s=r(1),p=0;o.nationalProjects&&Object.values(o.nationalProjects).forEach(C=>p+=C.level||0);const E=1+p*H;s=s.times(r(E));const M=O(o.renown);return s=s.times(M),n.times(s)};let P=0;return e.jsxs("div",{style:Y,children:[e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[r(1),r(10),r(100),r(500),r(1e3),r(-1)].map(t=>e.jsx("button",{onClick:()=>y(t),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:a.equals(t)?"var(--accent-color)":"var(--panel-bg)",color:a.equals(t)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:t.equals(r(-1))?"Max":`${t.toString()}`},`amount-${t.toString()}`))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[e.jsx("button",{className:"btn",style:{background:d?"var(--panel-bg)":"var(--accent-color)",color:d?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>W(!1),children:"ðŸ›’ Buy Mode"}),e.jsx("button",{className:"btn",style:{background:d?"#e65100":"var(--panel-bg)",color:d?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>W(!0),children:"ðŸ’° Sell Mode (25%)"})]}),e.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),U.map((t,m)=>{const n=o.buildings[t.id]||r(0),i=o.totalGold.gte(t.baseCost)||n.gt(r(0));if(i||P++,!i&&P>2)return null;if(d){if(n.eq(r(0)))return null;let x;a.equals(r(-1))?x=n:(x=a.times(k),x.gt(n)&&(x=n));const T=L(t.baseCost,n.minus(x),x).times(r(.25)).floor();return b(t.id,t.baseProduction),e.jsxs("div",{style:q(!0,!1,!1,!1),onClick:()=>c(t.id,x.toNumber()),onMouseEnter:F=>B(F,t),onMouseLeave:g,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:t.icon}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:t.name}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:u(n,o.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",u(T,o.numberFormat)]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",u(x,o.numberFormat)]})]})]},t.id)}let s=r(0),p=r(0);a.equals(r(-1))?(s=I(t.baseCost,n,o.gold.div(f)),s.eq(r(0))?(s=r(1),p=$(t.baseCost,n).times(f).floor()):p=L(t.baseCost,n,s).times(f).floor()):(s=a,p=L(t.baseCost,n,s).times(f).floor());const E=o.gold.gte(p),M=a.equals(r(-1))&&I(t.baseCost,n,o.gold.div(f)).eq(r(0));let v=s,C=p,S=E;return a.equals(r(-1))||(v=s.times(k),C=L(t.baseCost,n,v).times(f).floor(),S=o.gold.gte(C)),e.jsxs("div",{style:q(S&&!M,!1,!i),onClick:()=>{if(!(S&&!M))return;const x=a.equals(r(-1))?s:v;h(t.id,x.toNumber())},onMouseEnter:x=>B(x,t),onMouseLeave:g,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:i?t.icon:"â“"}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:i?t.name:"???"}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:u(n,o.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsx("div",{style:{color:S&&!M?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:u(a.equals(r(-1))?p:C,o.numberFormat)}),!a.equals(r(-1))&&e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",u(v,o.numberFormat)]})]})]},t.id)}),e.jsx(K,{gameState:o,building:l.building,x:l.x,y:l.y,visible:l.visible,onHide:g})]})},Q=({gameState:o,onBuyTowerFloor:h})=>e.jsx(_,{gameState:o,onBuyTowerFloor:h});export{Z as B,Q as P};
