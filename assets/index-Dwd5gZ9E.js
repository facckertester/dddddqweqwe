var tt=Object.defineProperty,ot=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Pe=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var Se=(o,c,b)=>c in o?tt(o,c,{enumerable:!0,configurable:!0,writable:!0,value:b}):o[c]=b,i=(o,c)=>{for(var b in c||(c={}))rt.call(c,b)&&Se(o,b,c[b]);if(Pe)for(var b of Pe(c))lt.call(c,b)&&Se(o,b,c[b]);return o},d=(o,c)=>ot(o,nt(c));var st=(o,c)=>()=>(c||o((c={exports:{}}).exports,c),c.exports);var Z=(o,c,b)=>new Promise((k,x)=>{var P=C=>{try{L(b.next(C))}catch(M){x(M)}},j=C=>{try{L(b.throw(C))}catch(M){x(M)}},L=C=>C.done?k(C.value):Promise.resolve(C.value).then(P,j);L((b=b.apply(o,c)).next())});import{j as s,r as h,a as it,R as at}from"./vendor-react-CUeQczFW.js";import{t as r,f as J,T as Ee,i as Ce,B as _,P as ct,m as le,A as dt,M as ut,a as ft,j as je,e as mt,c as gt,d as ht,b as pt,h as yt,g as vt}from"./core-C2y7dMvE.js";import{g as Te,T as bt,G as wt}from"./components-ui-DS-nQxSB.js";import{B as Me,W as ke}from"./components-store-BBkFRwjs.js";import{M as Le}from"./components-main-BqLD6TzP.js";import{s as xt,a as Pt,O as St,E as Et,T as Ct,P as jt,S as Tt,b as Mt,c as kt,C as Lt,R as It,L as Dt,d as Ot,u as Nt}from"./components-modals-CDTBTcmO.js";import{P as Bt}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-nXLPWf92.js";import"./vendor-firebase-IMiYFFvY.js";var _t=st(ee=>{(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))k(x);new MutationObserver(x=>{for(const P of x)if(P.type==="childList")for(const j of P.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&k(j)}).observe(document,{childList:!0,subtree:!0});function b(x){const P={};return x.integrity&&(P.integrity=x.integrity),x.referrerPolicy&&(P.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?P.credentials="include":x.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function k(x){if(x.ep)return;x.ep=!0;const P=b(x);fetch(x.href,P)}})();const Gt=({gameState:o})=>{const{weather:c,buildings:b,totalGold:k}=o,x=X=>{var O;return((O=b[X])==null?void 0:O.toNumber())||0};let P="wilderness";x("palace")>0?P="empire":x("castle")>0||x("market")>0?P="city":(x("peasant")>20||x("field")>10||k.gt(r(500)))&&(P="hamlet");let j="",L="";switch(P){case"wilderness":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",L="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",L="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":j="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",L="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":j="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",L="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const C=c.current;let M="none",N="",G=0;return C==="rainy"?(M="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",N="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",G=1):C==="stormy"?(M="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",N="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",G=1):C==="sunny"?(M="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",N="â˜€ï¸",G=.6):C==="windy"&&(N="ðŸƒ ðŸƒ ðŸƒ",G=.8),s.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:j,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[s.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:G,animation:C==="windy"?"float 3s infinite ease-in-out":"none"},children:N}),M!=="none"&&s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:M,pointerEvents:"none"}}),s.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:L}),s.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),s.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},B={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:r(1),layout:{left:r(1),center:r(1),right:r(1)},borderWidth:r(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},U={gold:r(0),totalGold:r(0),totalRenownEarned:r(0),startTime:r(Date.now()),lastSaveTime:r(Date.now()),buildings:{},achievements:[],renown:r(0),prestigeCount:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:r(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:B,stats:{totalClicks:r(0),dragonsKilled:r(0),tavernGamesPlayed:r(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1},F=o=>{if(o==null||typeof o=="string"||typeof o=="number"||typeof o=="boolean")return o;if(Array.isArray(o))return o.map(F);if(typeof o=="object"&&o.toString&&typeof o.toString=="function"&&(o.hasOwnProperty("mantissa")||o.hasOwnProperty("exponent")))return o.toString();if(typeof o=="object"){const c={};for(const b in o)o.hasOwnProperty(b)&&(c[b]=F(o[b]));return c}return o},Rt=()=>{var be,we;const[o,c]=h.useState(()=>{var t,n,l,a,u,p,g,f,E,w,v,S,T;const e=localStorage.getItem("kingdom_save");if(e)try{const m=JSON.parse(e);if((t=m.playerProfile)!=null&&t.id){const H=localStorage.getItem(`playerProfile_${m.playerProfile.id}`);H&&(m.playerProfile=JSON.parse(H))}const D=m.interface||{},et=d(i(i({},B),D),{lastBuyAmount:r((n=D.lastBuyAmount)!=null?n:1),crownAnimations:(l=D.crownAnimations)!=null?l:!0,layout:{left:r((u=(a=D.layout)==null?void 0:a.left)!=null?u:B.layout.left),center:r((g=(p=D.layout)==null?void 0:p.center)!=null?g:B.layout.center),right:r((E=(f=D.layout)==null?void 0:f.right)!=null?E:B.layout.right)},borderWidth:r((w=D.borderWidth)!=null?w:B.borderWidth),customColors:i(i({},B.customColors),D.customColors||{})});return d(i(i({},U),m),{renown:r(m.renown||0),totalRenownEarned:r(m.totalRenownEarned||0),prestigeCount:m.prestigeCount||0,gold:r(m.gold||0),totalGold:r(m.totalGold||0),startTime:r(m.startTime||Date.now()),lastSaveTime:r(m.lastSaveTime||Date.now()),buildings:Object.keys(m.buildings||{}).reduce((H,xe)=>(H[xe]=r(m.buildings[xe]),H),{}),stats:d(i(i({},U.stats),m.stats||{}),{totalClicks:r(((v=m.stats)==null?void 0:v.totalClicks)||0),dragonsKilled:r(((S=m.stats)==null?void 0:S.dragonsKilled)||0),tavernGamesPlayed:r(((T=m.stats)==null?void 0:T.tavernGamesPlayed)||0)}),nationalProjects:m.nationalProjects||{},clickUpgradeLevel:m.clickUpgradeLevel||0,offlineUpgradeLevel:m.offlineUpgradeLevel||0,weather:m.weather?d(i({},m.weather),{timeLeft:r(Number(m.weather.timeLeft)||120)}):U.weather,theme:m.theme||"default",numberFormat:m.numberFormat||"standard",idleModeEnabled:m.idleModeEnabled!==void 0?m.idleModeEnabled:!1,interface:et,playerProfile:m.playerProfile?d(i({},m.playerProfile),{lastLeaderboardSubmit:m.playerProfile.lastLeaderboardSubmit||0}):null,isDeveloperWifeBlessingObtained:m.isDeveloperWifeBlessingObtained||!1,globalIncomeMultiplier:m.globalIncomeMultiplier||1})}catch(m){console.error("Save load failed",m)}return U}),b=h.useRef(o);h.useEffect(()=>{b.current=o},[o]);const k=h.useRef("");h.useEffect(()=>{const e=t=>{k.current=(k.current+t.key).slice(-20);const n=k.current.toLowerCase();n.endsWith("godon")?(c(l=>d(i({},l),{godMode:!0})),y("God Mode Enabled: +99999s per click","success"),k.current=""):n.endsWith("godoff")&&(c(l=>d(i({},l),{godMode:!1})),y("God Mode Disabled","info"),k.current="")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const x=()=>{K(null);const e=localStorage.getItem("kingdom_last_save_time"),t=Date.now();if(e){const n=t-parseInt(e),l=r(n/1e3);if(l.gte(r(60))){const a=o.offlineUpgradeLevel||0,{efficiency:u,duration:p}=Ce(a),g=r(p),f=l.lt(g)?l:g,w=$(o).times(r(u)).times(f).floor();w.gt(r(0))&&(K({gained:w,effectiveTime:f,totalTime:l,efficiency:u,completedProjects:[],currentLevel:a,maxDuration:p}),c(v=>d(i({},v),{gold:v.gold.plus(w),totalGold:v.totalGold.plus(w)})))}}localStorage.setItem("kingdom_last_save_time",t.toString())},[P,j]=h.useState(!1);h.useEffect(()=>{let e;const t=()=>{j(!1),clearTimeout(e),o.idleModeEnabled&&(e=setTimeout(()=>{j(!0)},2e4))};t();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(l=>window.addEventListener(l,t)),()=>{clearTimeout(e),n.forEach(l=>window.removeEventListener(l,t))}},[o.idleModeEnabled]),h.useEffect(()=>{o.event&&j(!1)},[o.event]),h.useEffect(()=>{const e=J(o.gold);document.title=`Gold: ${e} - Kingdom Clicker`},[o.gold]),h.useEffect(()=>{const e=document.documentElement,t=o.interface||B,n=o.theme||"default",l=Ee[n]||Ee.default;l&&Object.entries(l.colors).forEach(([p,g])=>{e.style.setProperty(p,g)});const a={compact:"8px",normal:"12px",spacious:"20px"},u={compact:"6px",normal:"12px",spacious:"16px"};e.style.setProperty("--panel-padding",a[t.density]),e.style.setProperty("--gap-size",u[t.density]),e.style.setProperty("--col-left",String(t.layout.left)),e.style.setProperty("--col-center",String(t.layout.center)),e.style.setProperty("--col-right",String(t.layout.right)),t.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[o.theme,o.interface]);const[L,C]=h.useState(!1);h.useEffect(()=>{var e;o.gold.gte(r(1e7))&&!((e=o.playerProfile)!=null&&e.hasChosenName)&&!L&&ce(!0)},[o.gold,o.playerProfile,L]);const[M,N]=h.useState(null),[G,X]=h.useState([]),[O,K]=h.useState(null),[se,De]=h.useState("buildings"),[ie,Oe]=h.useState("army"),[V,Ne]=h.useState(!1),[I,Y]=h.useState("throne");h.useEffect(()=>{const e=()=>{Ne(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[Be,te]=h.useState(!1),[Ge,q]=h.useState(!1),[Re,R]=h.useState(!1),[Ae,_e]=h.useState(!1),[Ue,oe]=h.useState(!1),[Fe,Q]=h.useState(!1),[ae,ce]=h.useState(!1),[de,ne]=h.useState(!1),[$e,re]=h.useState(!1),[ue,fe]=h.useState(!1),y=(e,t="info")=>{const n=Date.now().toString()+Math.random();X(l=>[...l,{id:n,message:e,type:t}]),setTimeout(()=>{X(l=>l.filter(a=>a.id!==n))},3e3)};h.useEffect(()=>{const e=Date.now();if(o.lastSaveTime&&r(e).minus(o.lastSaveTime).gt(r(6e4))){const t=r(e).minus(o.lastSaveTime).dividedBy(r(1e3)),{efficiency:n,duration:l}=Ce(o.offlineUpgradeLevel||0),a=r(l),u=t.lt(a)?t:a,g=$(o).times(r(n)).times(u).floor(),f=[];let E=i({},o.nationalProjects),w=!1;Object.keys(E).forEach(v=>{var T;const S=E[v];if(S.active&&S.endTime&&e>=S.endTime){E[v]=d(i({},S),{active:!1,level:S.level+1,startTime:0,endTime:0});const m=(T=_.find(D=>D.id===v))==null?void 0:T.name;m&&f.push(`${m} Infrastructure (Lvl ${S.level+1})`),w=!0}}),(g.gt(r(0))||f.length>0)&&(K(v=>v||{gained:g,effectiveTime:u,totalTime:t,efficiency:n,completedProjects:f,currentLevel:o.offlineUpgradeLevel||0,maxDuration:l}),c(v=>d(i({},v),{gold:v.gold.plus(g),totalGold:v.totalGold.plus(g),nationalProjects:w?E:v.nationalProjects})))}},[]),h.useEffect(()=>{const e=setInterval(()=>{Date.now()%3e4<1e3&&c(t=>{const n=d(i({},t),{lastSaveTime:r(Date.now())}),l=F(n);return localStorage.setItem("kingdom_save",JSON.stringify(l)),n})},1e3);return()=>clearInterval(e)},[]),h.useEffect(()=>{const e=()=>{const n=b.current,l=F(n);localStorage.setItem("kingdom_save",JSON.stringify(l)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",e);const t=()=>{document.visibilityState==="hidden"?e():document.visibilityState==="visible"&&x()};return document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[]),h.useEffect(()=>{var t;if(!((t=o.playerProfile)!=null&&t.hasChosenName))return;const e=setInterval(()=>{var p;const n=b.current,l=Date.now(),a=((p=n.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,u=3600*1e3;l-a>=u&&(xt(n,n.playerProfile.rulerId,n.playerProfile.rulerName).catch(g=>{console.error("Failed to save player stats:",g)}),Pt({rulerName:n.playerProfile.rulerName,rulerId:n.playerProfile.rulerId,gold:n.totalGold,renown:n.totalRenownEarned,achievements:n.achievements.length,totalClicks:n.stats.totalClicks,period:"alltime"}).then(()=>{c(g=>d(i({},g),{playerProfile:d(i({},g.playerProfile),{lastLeaderboardSubmit:Date.now()})})),y("Leaderboard data submitted successfully!","success")}).catch(g=>{console.error("Auto leaderboard submission failed:",g)}))},6e4);return()=>clearInterval(e)},[(be=o.playerProfile)==null?void 0:be.hasChosenName]),h.useEffect(()=>{const e=setInterval(()=>{if(!o.event&&Math.random()<.05){const l=["dragon","merchant","jester"],a=l[Math.floor(Math.random()*l.length)],u=a==="dragon"?6e5:3e4,p={id:Date.now().toString(),type:a,expiresAt:r(Date.now()).plus(r(u)),hp:a==="dragon"?r(10):void 0,maxHp:a==="dragon"?r(10):void 0,reward:r(0),startTime:a==="dragon"?Date.now():void 0};c(g=>d(i({},g),{event:p}))}},1e4);return()=>clearInterval(e)},[o.event]);const $=e=>{var g;let t=r(0);const n=((g=e.weather)==null?void 0:g.current)||"clear";_.forEach(f=>{const E=e.buildings[f.id]||r(0);let w=f.baseProduction;t=t.plus(E.times(w))});const l=Te(e.totalRenownEarned);l.gt(r(1))&&(t=t.times(l));let a=0;e.nationalProjects&&Object.values(e.nationalProjects).forEach(f=>{a+=f.level||0});const u=r(1).plus(r(a*ct));t=t.times(u),r(1),_.forEach(f=>{const E=e.buildings[f.id]||r(0);if(E.gt(0)){let w=r(1);n==="sunny"?(f.id==="peasant"||f.id==="field"||f.id==="stable"||f.id==="cathedral")&&(w=r(1.2)):n==="rainy"?(f.id==="silver_mine"||f.id==="alchemist"||f.id==="market"||f.id==="tavern")&&(w=r(1.2)):n==="stormy"?((f.id==="blacksmith"||f.id==="void_portal")&&(w=r(1.3)),(f.id==="field"||f.id==="stable")&&(w=r(.8))):n==="windy"&&(f.id==="market"||f.id==="castle"||f.id==="time_chamber")&&(w=r(1.15));const v=E.times(f.baseProduction);if(l.gt(r(1))){const S=v.times(l).times(u).times(w.minus(r(1)));t=t.plus(S)}else{const S=v.times(u).times(w.minus(r(1)));t=t.plus(S)}}});const p=r(1).plus(r(e.achievements.length*.02));if(t=t.times(p),e.globalIncomeMultiplier&&(t=t.times(r(e.globalIncomeMultiplier))),e.event&&e.event.type==="dragon"&&e.event.startTime){const f=Math.floor((Date.now()-e.event.startTime)/1e3),w=1-Math.min(99,f)/100;t=t.times(r(w))}return t},W=$(o),z=h.useRef(W);z.current=W,h.useEffect(()=>{const e=setInterval(()=>{c(t=>{const n=Date.now(),l=z.current.times(r(le)).dividedBy(r(1e3));let a=t.totalGold.plus(l),u=t.gold.plus(l),p=i({},t.weather);const g=r(le/1e3);if(p.timeLeft=p.timeLeft.minus(g),p.timeLeft.lte(r(0))){const S=["clear","sunny","rainy","stormy","windy"],T=S[Math.floor(Math.random()*S.length)],m=r(Math.floor(Math.random()*120)+60);p={current:T,timeLeft:m}}let f=t.event;f&&f.expiresAt&&r(f.expiresAt).lt(r(n))&&(f=null);let E=i({},t.nationalProjects||{});Object.keys(E).forEach(S=>{var m;const T=E[S];T.active&&T.endTime&&n>=T.endTime&&(E[S]=d(i({},T),{active:!1,level:T.level+1,startTime:0,endTime:0}),y(`Project Completed: ${(m=_.find(D=>D.id===S))==null?void 0:m.name} Infrastructure Level ${T.level+1}!`,"success"))});const w=[...t.achievements];let v=null;return dt.forEach(S=>{w.includes(S.id)||S.condition(d(i({},t),{totalGold:a,gold:u}),z.current)&&(w.push(S.id),v=S)}),v&&(N(v),setTimeout(()=>N(null),3e3)),d(i({},t),{gold:u,totalGold:a,achievements:w,event:f,weather:p,nationalProjects:E})})},le);return()=>clearInterval(e)},[]);const A=(e="light")=>{if("vibrate"in navigator&&V)switch(e){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},me=(e=!1)=>{if(e||A("light"),!e&&!o.isDeveloperWifeBlessingObtained&&o.totalGold.gte(r(1e12))&&Math.random()<1e-6){c(l=>d(i({},l),{globalIncomeMultiplier:(l.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...l.achievements,"developer_wife_blessing"])]})),y("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const t=We(b.current);c(n=>d(i({},n),{gold:n.gold.plus(t),totalGold:n.totalGold.plus(t),stats:d(i({},n.stats),{totalClicks:e?n.stats.totalClicks:n.stats.totalClicks.plus(r(1))})}))},We=e=>{const t=r(1),n=e.clickUpgradeLevel||0,l=Math.min(n,15),a=r(2).pow(l),u=t.times(a),p=Te(e.totalRenownEarned);let g=u;p.gt(r(1))&&(g=u.times(p));const f=vt(n);if(f>0){const v=$(e).times(f);g=g.plus(v)}const E=r(1).plus(r(e.achievements.length*.02));if(g=g.times(E),e.globalIncomeMultiplier&&(g=g.times(r(e.globalIncomeMultiplier))),e.godMode){const v=$(e).times(r(99999));g=g.plus(v)}return g},ze=()=>{const e=o.clickUpgradeLevel||0;if(e>=ht){y("Maximum Royal Scepter level reached!","warning");return}const t=pt(e+1);if(o.gold.lt(t)){y("Not enough gold!","error");return}c(n=>d(i({},n),{gold:n.gold.minus(t),clickUpgradeLevel:n.clickUpgradeLevel+1})),y(`Royal Scepter upgraded to level ${e+1}!`,"success")},He=()=>{const e=o.offlineUpgradeLevel||0;if(e>=mt){y("Maximum Passive Income level reached!","warning");return}const t=gt(e+1);if(o.renown.lt(t)){y("Not enough Renown!","error");return}c(n=>d(i({},n),{renown:n.renown.minus(t),offlineUpgradeLevel:n.offlineUpgradeLevel+1})),y(`Passive Income upgraded to level ${e+1}!`,"success")},ge=(e,t)=>{const n=_.find(u=>u.id===e);if(!n||t<=0)return;const l=o.buildings[e]||r(0),a=je(n.baseCost,l,r(t)).floor();o.gold.gte(a)&&(A("medium"),c(u=>d(i({},u),{gold:u.gold.minus(a),buildings:d(i({},u.buildings),{[e]:(u.buildings[e]||r(0)).plus(r(t))})})))},he=(e,t)=>{const n=_.find(p=>p.id===e);if(!n||t<=0)return;const l=o.buildings[e]||r(0),a=r(Math.min(t,l.toNumber()));if(a.lte(r(0)))return;const u=je(n.baseCost,l.minus(a),a).times(r(.25)).floor();c(p=>d(i({},p),{gold:p.gold.plus(u),buildings:d(i({},p.buildings),{[e]:l.minus(a)})}))},pe=e=>{if(e.type==="merchant"){const t=z.current.times(r(10));c(n=>d(i({},n),{gold:n.gold.plus(t),totalGold:n.totalGold.plus(t),event:null})),y(`The merchant gifted you ${J(t.floor(),o.numberFormat)} gold!`,"success")}else if(e.type==="jester"){const t=o.gold.times(r(.1)),n=Math.random()>.5;c(l=>d(i({},l),{gold:n?l.gold.plus(t):l.gold.minus(t),totalGold:n?l.totalGold.plus(t):l.totalGold,event:null})),n?y(`Jester pays out! +${J(t.floor(),o.numberFormat)}`,"success"):y(`Jester tricked you! -${J(t.floor(),o.numberFormat)}`,"warning")}else if(e.type==="dragon")try{let t=!1;c(n=>{if(!n.event||n.event.type!=="dragon")return n;const a=r(n.event.hp||10).minus(r(1));if(a.lte(0)){const u=z.current.times(r(30));return t=!0,d(i({},n),{gold:n.gold.plus(u),totalGold:n.totalGold.plus(u),event:null,stats:d(i({},n.stats),{dragonsKilled:n.stats.dragonsKilled.plus(r(1))})})}return d(i({},n),{event:d(i({},n.event),{hp:a})})}),t&&y("Dragon Slain! +Treasury Boost","success")}catch(t){console.error("Error handling dragon interaction:",t),y("Error interacting with dragon","error")}},Je=()=>{const e=r(1),t=r(1e12),n=o.totalGold;if(n.lt(t))return;const l=n.dividedBy(t),u=r(Math.floor(Math.pow(l.toNumber(),.33))).times(e).minus(o.renown);if(u.lte(0))return;const p=i({},o.nationalProjects);Object.keys(p).forEach(g=>{p[g].active&&(p[g]=d(i({},p[g]),{active:!1,startTime:0,endTime:0}))}),c(d(i({},U),{renown:o.renown.plus(u),totalRenownEarned:o.totalRenownEarned.plus(u),prestigeCount:o.prestigeCount+1,totalGold:o.totalGold,achievements:o.achievements,nationalProjects:p,offlineUpgradeLevel:o.offlineUpgradeLevel,playerProfile:o.playerProfile,startTime:r(Date.now()),lastSaveTime:r(Date.now()),theme:o.theme,idleModeEnabled:o.idleModeEnabled,interface:o.interface})),q(!1),y("Abdication Successful. Long live the new King!","success")},Xe=()=>{localStorage.removeItem("kingdom_save"),c(d(i({},U),{startTime:r(Date.now())})),R(!1),y("Game Reset","warning")},Ke=()=>{const t=F(o);localStorage.setItem("kingdom_save",JSON.stringify(t)),y("Game Saved","info")},Ve=()=>{c(e=>{const t=i({},e.nationalProjects);return Object.keys(t).forEach(n=>{t[n].active&&(t[n]=d(i({},t[n]),{endTime:Date.now()+5e3}))}),d(i({},e),{nationalProjects:t})}),y("Projects sped up to 5 seconds!","success")};window.speedUpProjects=Ve;const Ye=e=>{c(t=>d(i({},t),{playerProfile:e})),localStorage.setItem(`playerProfile_${e.id}`,JSON.stringify(e)),y(`Welcome, ${e.rulerName} ${e.rulerId}!`,"success"),C(!1)},qe=()=>Z(null,null,function*(){Je()}),Qe=e=>Z(null,null,function*(){var t;if(!((t=o.playerProfile)!=null&&t.id)){y("Error: Player profile not found","error");return}try{yield Nt(o.playerProfile.id,e);const n=d(i({},o.playerProfile),{rulerName:e});c(u=>d(i({},u),{playerProfile:n}));const l=d(i({},o),{playerProfile:n}),a=F(l);localStorage.setItem("kingdom_save",JSON.stringify(a)),y(`Name successfully changed to "${e}"!`,"success")}catch(n){console.error("Error changing name:",n),y("Failed to change name. Please try again.","error")}}),Ze=e=>Z(null,null,function*(){var l;const t=((l=o.playerProfile)==null?void 0:l.id)||"default_player",n=yield Bt.redeemPromoCode(t,e);if(!n){y("Invalid or expired promo code!","error");return}switch(n.type){case"gold":c(a=>d(i({},a),{gold:a.gold.plus(r(n.value)),totalGold:a.totalGold.plus(r(n.value))})),y(`Received ${J(r(n.value))} gold!`,"success");break;case"betaTester":c(a=>{const u=a.playerProfile?d(i({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:n.icon||"ðŸ§ª",specialTitle:n.title||"Beta Tester",isBetaTester:!0}):null;return u&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(u)),d(i({},a),{playerProfile:u})}),y("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":c(a=>{const u=a.playerProfile?d(i({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],e],specialIcon:n.icon||"â­",specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(u)),d(i({},a),{playerProfile:u})}),y(`Special icon unlocked: ${n.icon}!`,"success");break;case"title":c(a=>{const u=a.playerProfile?d(i({},a.playerProfile),{usedPromoCodes:[...a.playerProfile.usedPromoCodes||[],e],specialTitle:n.title||"Special"}):null;return u&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(u)),d(i({},a),{playerProfile:u})}),y(`Special title unlocked: ${n.title}!`,"success");break;default:y("Promo code redeemed!","success")}}),ye=e=>{c(t=>d(i({},t),{interface:d(i({},t.interface),{lastBuyAmount:e})}))},ve=e=>({flex:e==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:e==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:e==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:P&&o.idleModeEnabled?e==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return s.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:V?"column":"row"},children:[s.jsx(bt,{toasts:G}),s.jsx(wt,{}),P&&o.idleModeEnabled&&s.jsx(Gt,{gameState:o}),!V&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:ve("left"),children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:s.jsx("button",{className:`tab-btn ${se==="buildings"?"active":""}`,onClick:()=>De("buildings"),children:"Estates"})}),s.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:se==="buildings"&&s.jsx(Me,{gameState:o,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),s.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:P&&o.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:s.jsx(Le,{gameState:o,gps:W,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>Q(!0),isIdle:P&&o.idleModeEnabled})}),s.jsxs("div",{style:ve("right"),children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:s.jsx("button",{className:`tab-btn ${ie==="army"?"active":""}`,onClick:()=>Oe("army"),children:"Future"})}),s.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:ie==="army"&&s.jsx(ke,{gameState:o})})]})]}),V&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[I==="buildings"&&s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:s.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsx(Me,{gameState:o,onBuyBuilding:ge,onSellBuilding:he,onSetBuyAmount:ye})})]}),I==="throne"&&s.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:s.jsx(Le,{gameState:o,gps:W,onClick:()=>me(!1),onEventInteract:pe,onOpenTavern:()=>te(!0),onOpenPrestige:()=>q(!0),onOpenSettings:()=>R(!0),onOpenStatistics:()=>oe(!0),onOpenLeaderboard:()=>ne(!0),onOpenEmpire:()=>Q(!0),isIdle:P&&o.idleModeEnabled})}),I==="army"&&s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[s.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:s.jsx("button",{className:"tab-btn active",children:"Future"})}),s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsx(ke,{gameState:o})})]}),I==="empire"&&s.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:s.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:s.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[s.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),s.jsx("p",{children:"Construct massive infrastructure to boost global production."}),s.jsx("button",{className:"btn",onClick:()=>Q(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[s.jsxs("button",{className:`mobile-nav-btn ${I==="buildings"?"active":""}`,onClick:()=>{A("light"),Y("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),s.jsx("div",{children:"Estates"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="throne"?"active":""}`,onClick:()=>{A("light"),Y("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),s.jsx("div",{children:"Throne"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="army"?"active":""}`,onClick:()=>{A("light"),Y("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),s.jsx("div",{children:"Future"})]}),s.jsxs("button",{className:`mobile-nav-btn ${I==="empire"?"active":""}`,onClick:()=>{A("light"),Y("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:I==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[s.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),s.jsx("div",{children:"Projects"})]})]})]}),!(P&&o.idleModeEnabled)&&M&&s.jsxs("div",{className:"achievement-popup",children:[s.jsx("div",{style:{fontSize:"2rem"},children:M.icon}),s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),s.jsx("div",{style:{color:"var(--accent-color)"},children:M.name})]})]}),O&&s.jsx(St,{gained:O.gained,effectiveTime:O.effectiveTime,totalTime:O.totalTime,efficiency:O.efficiency,completedProjects:O.completedProjects,currentLevel:O.currentLevel,maxDuration:O.maxDuration,numberFormat:o.numberFormat,onClose:()=>K(null)}),Fe&&s.jsx(Et,{gameState:o,onClose:()=>Q(!1),onStartProject:e=>{var a;const t=((a=o.nationalProjects[e])==null?void 0:a.level)||0;if(t>=ut)return;const n=ft(e,t+1);if(o.gold.lt(n.gold))return;const l=yt(t+1);c(u=>d(i({},u),{gold:u.gold.minus(n.gold),nationalProjects:d(i({},u.nationalProjects),{[e]:{level:t,active:!0,startTime:Date.now(),endTime:Date.now()+l*1e3}})})),y("Construction started!","info")},onUpgradeClickPower:ze,onUpgradeOffline:He}),Be&&s.jsx(Ct,{gameState:o,onGamble:(e,t)=>{const n=r(e);c(l=>d(i({},l),{gold:t?l.gold.plus(n):l.gold.minus(n).max(0),stats:d(i({},l.stats),{tavernGamesPlayed:l.stats.tavernGamesPlayed.plus(r(1))})}))},onClose:()=>te(!1)}),Ge&&s.jsx(jt,{gameState:o,onPrestige:qe,onClose:()=>q(!1)}),Re&&s.jsx(Tt,{gameState:o,onClose:()=>R(!1),onHardReset:Xe,onSave:Ke,onSetTheme:e=>c(t=>d(i({},t),{theme:e})),onSetNumberFormat:e=>c(t=>d(i({},t),{numberFormat:e})),onToggleIdleMode:()=>c(e=>d(i({},e),{idleModeEnabled:!e.idleModeEnabled})),onUpdateInterface:e=>c(t=>d(i({},t),{interface:i(i({},t.interface),e)})),onOpenPromoCodes:()=>{R(!1),re(!0)},onChangeName:()=>fe(!0)}),$e&&s.jsx(Mt,{gameState:o,onClose:()=>re(!1),onRedeemPromoCode:Ze,onBackToSettings:()=>{re(!1),R(!0)}}),Ue&&s.jsx(kt,{gameState:o,currentGps:W,onClose:()=>oe(!1)}),Ae&&s.jsx(Lt,{onClose:()=>_e(!1)}),ae&&s.jsx(It,{isOpen:ae,onClose:()=>{ce(!1),C(!0)},onConfirm:Ye,gameState:o}),de&&s.jsx(Dt,{isOpen:de,onClose:()=>ne(!1),playerProfile:o.playerProfile}),ue&&s.jsx(Ot,{isOpen:ue,onClose:()=>fe(!1),onConfirm:Qe,currentName:((we=o.playerProfile)==null?void 0:we.rulerName)||""})]})},Ie=document.getElementById("root");if(!Ie)throw new Error("Could not find root element to mount to");const At=it.createRoot(Ie);At.render(s.jsx(at.StrictMode,{children:s.jsx(Rt,{})}))});export default _t();
