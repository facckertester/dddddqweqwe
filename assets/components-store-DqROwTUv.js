import{r as j,j as e}from"./vendor-react-CUeQczFW.js";import{h as G,k as N,t as n,l as R,g as D,f as u,B as U,m as L,n as I,o as $,P as H}from"./core-BLe5j-6i.js";import{A as K,g as O}from"./components-ui-pystH6UY.js";const _=({gameState:o,onBuyTowerFloor:h})=>{const[c,v]=j.useState(0),i=G(o.totalGold);j.useEffect(()=>{const g=setInterval(()=>{v(b=>(b+1)%360)},50);return()=>clearInterval(g)},[]),N(o.totalGold);const w=o.darkMatterGold||n(0),f=o.infiniteTowerLevel||0;o.portalProgress;const a=R(f),d=w.gte(a),k=D(f).minus(n(1)).times(n(100)),M=(()=>{if(i)return 100;if(o.totalGold.lt(n(1e15)))return 0;const g=Math.log10(1e15),b=Math.log10(1e18),P=Math.log10(o.totalGold.toNumber()),t=(Math.max(g,Math.min(b,P))-g)/(b-g)*100;return Math.floor(t)})();return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",minHeight:"600px",overflow:"hidden"},children:e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"var(--panel-padding)",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"20px",background:"var(--panel-bg)",border:i?"2px solid #673ab7":"2px dashed var(--border-color)",borderRadius:"8px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{width:"120px",height:"120px",margin:"0 auto 15px",borderRadius:"50%",background:i?`radial-gradient(circle, rgba(103, 58, 183, ${.3+Math.sin(c*Math.PI/180)*.2}), rgba(103, 58, 183, 0.1))`:"radial-gradient(circle, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.05))",border:i?`3px solid rgba(103, 58, 183, ${.5+Math.sin(c*Math.PI/180)*.3})`:"3px solid rgba(128, 128, 128, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",animation:i?"pulse 2s infinite":"none",transform:`rotate(${c}deg)`,transition:"all 0.3s ease"},children:i?"ðŸŒ€":"ðŸ”’"}),e.jsx("h3",{style:{fontSize:"1.3rem",color:i?"#673ab7":"var(--accent-color)",marginBottom:"10px",fontWeight:"bold"},children:i?"Portal to Another Dimension":"Portal Construction"}),!i&&e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginBottom:"8px"},children:["Progress: ",M,"%"]}),e.jsx("div",{style:{width:"100%",height:"8px",background:"rgba(0,0,0,0.1)",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${M}%`,height:"100%",background:"linear-gradient(90deg, #673ab7, #9575cd)",transition:"width 0.3s ease"}})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"}})]}),i&&e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"The portal shimmers with infinite possibilities..."})]}),i&&e.jsx("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid #673ab7"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#673ab7"},children:"âš« Dark Matter Gold"})}),e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#673ab7"},children:u(w,o.numberFormat)})})]})}),i&&e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"15px",borderRadius:"8px",border:"2px solid #ff9800"},children:[e.jsx("h4",{style:{fontSize:"1.1rem",color:"#ff9800",marginBottom:"10px",fontWeight:"bold"},children:"ðŸ—ï¸ Infinite Tower of Time & Space"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Current Level"}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#ff9800"},children:f})]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px"},children:["Income Bonus: +",u(k,o.numberFormat),"%"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Next Floor Cost"}),e.jsxs("span",{style:{fontSize:"1rem",fontWeight:"bold",color:d?"#673ab7":"var(--text-secondary)"},children:[u(a,o.numberFormat)," âš«"]})]})]}),e.jsx("button",{className:"btn",onClick:h,disabled:!d,style:{width:"100%",background:d?"#ff9800":"var(--panel-bg)",color:d?"var(--text-on-accent)":"var(--text-color)",border:"2px solid #ff9800",padding:"10px",fontSize:"1rem",fontWeight:"bold",opacity:d?1:.6,cursor:d?"pointer":"default"},children:d?"Build Next Floor":"Not Enough Dark Matter Gold"})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid rgba(103, 58, 183, 0.2)",fontSize:"0.9rem",color:"var(--text-secondary)",lineHeight:"1.6",fontStyle:"italic"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"10px",color:"#673ab7",fontStyle:"normal",textAlign:"center",fontSize:"1rem"},children:"ðŸŒŒ The Infinite Mystery"}),e.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"When accumulated gold reaches quintillion scales, the fabric of reality begins to thin, opening passages to dimensions beyond comprehension."}),e.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"Through this portal flows dark matter - concentrated essence of time and space itself, capable of reshaping the fundamental laws of creation."}),e.jsx("p",{style:{margin:"0",textAlign:"center",fontWeight:"bold"},children:"Each floor of the Infinite Tower doubles the flow's power, creating cascades of infinite possibilities..."})]})]})})},q=(o,h=!1,c=!1,v=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:c?"rgba(0,0,0,0.05)":h?"rgba(46, 125, 50, 0.1)":v?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:c?"rgba(0,0,0,0.2)":v?"#7b1fa2":o?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:o&&!c?"pointer":"default",opacity:o&&!c||h?1:.7,transition:"all 0.2s",boxShadow:o&&!c?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:c?"grayscale(1)":"none"}),Y={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},Z=({gameState:o,onBuyBuilding:h,onSellBuilding:c,onSetBuyAmount:v})=>{var A;const[i,w]=j.useState({visible:!1,x:0,y:0,building:null}),f=n(1),a=((A=o.interface)==null?void 0:A.lastBuyAmount)||n(1),[d,W]=j.useState(!1),[k,z]=j.useState(1);j.useEffect(()=>{const t=l=>{l.ctrlKey?z(10):l.shiftKey?z(100):z(1)},m=l=>t(l),r=l=>t(l);return window.addEventListener("keydown",m),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",r)}},[]);const M=(t,m)=>{const r=t.currentTarget.getBoundingClientRect();w({visible:!0,x:r.right,y:r.top+r.height/2,building:m})},g=()=>{w({visible:!1,x:0,y:0,building:null})},b=(t,m)=>{var y;let r=m;const l=((y=o.weather)==null?void 0:y.current)||"clear";l==="sunny"&&(t==="peasant"||t==="field")?r=r.times(n(1.2)):l==="rainy"&&(t==="silver_mine"||t==="alchemist")?r=r.times(n(1.2)):l==="stormy"?(t==="blacksmith"&&(r=r.times(n(1.3))),t==="field"&&(r=r.times(n(.8)))):l==="windy"&&t==="market"&&(r=r.times(n(1.15)));let s=n(1),p=0;o.nationalProjects&&Object.values(o.nationalProjects).forEach(C=>p+=C.level||0);const E=1+p*H;s=s.times(n(E));const B=O(o.renown);return s=s.times(B),r.times(s)};let P=0;return e.jsxs("div",{style:Y,children:[e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[n(1),n(10),n(100),n(500),n(1e3),n(-1)].map(t=>e.jsx("button",{onClick:()=>v(t),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:a.equals(t)?"var(--accent-color)":"var(--panel-bg)",color:a.equals(t)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:t.equals(n(-1))?"Max":`${t.toString()}`},`amount-${t.toString()}`))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[e.jsx("button",{className:"btn",style:{background:d?"var(--panel-bg)":"var(--accent-color)",color:d?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>W(!1),children:"ðŸ›’ Buy Mode"}),e.jsx("button",{className:"btn",style:{background:d?"#e65100":"var(--panel-bg)",color:d?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>W(!0),children:"ðŸ’° Sell Mode (25%)"})]}),e.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),U.map((t,m)=>{const r=o.buildings[t.id]||n(0),l=o.totalGold.gte(t.baseCost)||r.gt(n(0));if(l||P++,!l&&P>2)return null;if(d){if(r.eq(n(0)))return null;let x;a.equals(n(-1))?x=r:(x=a.times(k),x.gt(r)&&(x=r));const T=L(t.baseCost,r.minus(x),x).times(n(.25)).floor();return b(t.id,t.baseProduction),e.jsxs("div",{style:q(!0,!1,!1,!1),onClick:()=>c(t.id,x.toNumber()),onMouseEnter:F=>M(F,t),onMouseLeave:g,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:t.icon}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:t.name}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:u(r,o.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",u(T,o.numberFormat)]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",u(x,o.numberFormat)]})]})]},t.id)}let s=n(0),p=n(0);a.equals(n(-1))?(s=I(t.baseCost,r,o.gold.div(f)),s.eq(n(0))?(s=n(1),p=$(t.baseCost,r).times(f).floor()):p=L(t.baseCost,r,s).times(f).floor()):(s=a,p=L(t.baseCost,r,s).times(f).floor());const E=o.gold.gte(p),B=a.equals(n(-1))&&I(t.baseCost,r,o.gold.div(f)).eq(n(0));let y=s,C=p,S=E;return a.equals(n(-1))||(y=s.times(k),C=L(t.baseCost,r,y).times(f).floor(),S=o.gold.gte(C)),e.jsxs("div",{style:q(S&&!B,!1,!l),onClick:()=>{if(!(S&&!B))return;const x=a.equals(n(-1))?s:y;h(t.id,x.toNumber())},onMouseEnter:x=>M(x,t),onMouseLeave:g,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:l?t.icon:"â“"}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:l?t.name:"???"}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:u(r,o.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsx("div",{style:{color:S&&!B?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:u(a.equals(n(-1))?p:C,o.numberFormat)}),!a.equals(n(-1))&&e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",u(y,o.numberFormat)]})]})]},t.id)}),e.jsx(K,{gameState:o,building:i.building,x:i.x,y:i.y,visible:i.visible,onHide:g})]})},Q=({gameState:o,onBuyTowerFloor:h})=>e.jsx(_,{gameState:o,onBuyTowerFloor:h});export{Z as B,Q as P};
